import './polyfills.server.mjs';
import{$ as mt,A as rE,B as jm,Ba as bu,C as je,Ca as wu,D as se,Da as uE,E as _e,Ea as Eu,F as H,Fa as dE,G as uu,Ga as Su,H as Nt,Ha as hE,I as oe,Ia as fE,J as Et,K as du,L as hu,La as mE,M as fu,N as sE,O as oE,P as zi,Pa as pE,Q as aE,R as on,Ra as Cu,S as Gm,Sa as Wm,T as mu,U as lE,V as Pt,W as ue,X as pu,Y as Xs,Z as ft,_ as Zs,a as qi,aa as Wr,b as su,ba as zn,c as ou,ca as he,d as Kw,da as Ce,e as Hr,ea as Gt,f as Qs,fa as cE,g as Un,ga as St,h as Ui,ha as Js,i as Le,ia as $a,j as au,ja as Kr,k as Qw,ka as gu,l as Yw,la as pt,m as Xw,ma as Qr,n as Ha,na as Yr,o as Zw,oa as yu,p as Jw,pa as vu,q as eE,r as tE,s as lu,t as cu,u as Um,v as nE,va as Hm,w as Ys,x as $r,xa as _u,y as zm,ya as $m,z as iE,za as Wa}from"./chunk-CILJJG2B.mjs";import{a as gE,b as Km,c as yE,d as Tu,e as vE,f as xu,g as _E,h as bE,i as Re,j as Xr,k as jn,l as Iu,m as Ka,n as wE,o as EE,p as ji,q as Ht}from"./chunk-HS54PXOJ.mjs";import{a as it,b as qn,c as de,e as w,g as Ww,h as qm,i as p}from"./chunk-LK223424.mjs";var ae=w(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=ln.Propagate=ln.LogVerbosity=ln.Status=void 0;var SC=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(SC||(ln.Status=SC={})),CC=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(CC||(ln.LogVerbosity=CC={})),TC=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(TC||(ln.Propagate=TC={}));ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var lg=w((sK,UN)=>{UN.exports={name:"@grpc/grpc-js",version:"1.9.13",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ve=w(Lt=>{"use strict";var cg,ug,dg,hg;Object.defineProperty(Lt,"__esModule",{value:!0});Lt.isTracerEnabled=Lt.trace=Lt.log=Lt.setLoggerVerbosity=Lt.setLogger=Lt.getLogger=void 0;var Wi=ae(),zN=de("process"),jN=lg().version,GN={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},ss=GN,co=Wi.LogVerbosity.ERROR,HN=(ug=(cg=process.env.GRPC_NODE_VERBOSITY)!==null&&cg!==void 0?cg:process.env.GRPC_VERBOSITY)!==null&&ug!==void 0?ug:"";switch(HN.toUpperCase()){case"DEBUG":co=Wi.LogVerbosity.DEBUG;break;case"INFO":co=Wi.LogVerbosity.INFO;break;case"ERROR":co=Wi.LogVerbosity.ERROR;break;case"NONE":co=Wi.LogVerbosity.NONE;break;default:}var $N=()=>ss;Lt.getLogger=$N;var WN=n=>{ss=n};Lt.setLogger=WN;var KN=n=>{co=n};Lt.setLoggerVerbosity=KN;var QN=(n,...e)=>{let t;if(n>=co){switch(n){case Wi.LogVerbosity.DEBUG:t=ss.debug;break;case Wi.LogVerbosity.INFO:t=ss.info;break;case Wi.LogVerbosity.ERROR:t=ss.error;break}t||(t=ss.error),t&&t.bind(ss)(...e)}};Lt.log=QN;var YN=(hg=(dg=process.env.GRPC_NODE_TRACE)!==null&&dg!==void 0?dg:process.env.GRPC_TRACE)!==null&&hg!==void 0?hg:"",fg=new Set,xC=new Set;for(let n of YN.split(","))n.startsWith("-")?xC.add(n.substring(1)):fg.add(n);var XN=fg.has("all");function ZN(n,e,t){IC(e)&&(0,Lt.log)(n,new Date().toISOString()+" | v"+jN+" "+zN.pid+" | "+e+" | "+t)}Lt.trace=ZN;function IC(n){return!xC.has(n)&&(XN||fg.has(n))}Lt.isTracerEnabled=IC});var fd=w(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.getErrorCode=uo.getErrorMessage=void 0;function JN(n){return n instanceof Error?n.message:String(n)}uo.getErrorMessage=JN;function eP(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}uo.getErrorCode=eP});var Bt=w(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});pd.Metadata=void 0;var tP=Ve(),nP=ae(),iP=fd(),rP=/^[0-9a-z_.-]+$/,sP=/^[ -~]*$/;function oP(n){return rP.test(n)}function aP(n){return sP.test(n)}function DC(n){return n.endsWith("-bin")}function lP(n){return!n.startsWith("grpc-")}function md(n){return n.toLowerCase()}function AC(n,e){if(!oP(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(DC(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!aP(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var mg=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=md(e),AC(e,t),this.internalRepr.set(e,[t])}add(e,t){e=md(e),AC(e,t);let i=this.internalRepr.get(e);i===void 0?this.internalRepr.set(e,[t]):i.push(t)}remove(e){e=md(e),this.internalRepr.delete(e)}get(e){return e=md(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,i]of this.internalRepr)if(i.length>0){let r=i[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[i,r]of this.internalRepr){let s=r.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(i,s)}return e}merge(e){for(let[t,i]of e.internalRepr){let r=(this.internalRepr.get(t)||[]).concat(i);this.internalRepr.set(t,r)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,i]of this.internalRepr)e[t]=i.map(cP);return e}toJSON(){let e={};for(let[t,i]of this.internalRepr)e[t]=i;return e}static fromHttp2Headers(e){let t=new n;for(let i of Object.keys(e)){if(i.charAt(0)===":")continue;let r=e[i];try{DC(i)?Array.isArray(r)?r.forEach(s=>{t.add(i,Buffer.from(s,"base64"))}):r!==void 0&&(lP(i)?r.split(",").forEach(s=>{t.add(i,Buffer.from(s.trim(),"base64"))}):t.add(i,Buffer.from(r,"base64"))):Array.isArray(r)?r.forEach(s=>{t.add(i,s)}):r!==void 0&&t.add(i,r)}catch(s){let o=`Failed to add metadata entry ${i}: ${r}. ${(0,iP.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,tP.log)(nP.LogVerbosity.ERROR,o)}}return t}};pd.Metadata=mg;var cP=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var _g=w(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.CallCredentials=void 0;var vg=Bt();function uP(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var ho=class n{static createFromMetadataGenerator(e){return new gg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,i)=>{let r;uP(e)?r=e.getRequestHeaders(t.service_url):r=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),r.then(s=>{let o=new vg.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);i(null,o)},s=>{i(s)})})}static createEmpty(){return new yg}};gd.CallCredentials=ho;var pg=class n extends ho{constructor(e){super(),this.creds=e}generateMetadata(e){return p(this,null,function*(){let t=new vg.Metadata,i=yield Promise.all(this.creds.map(r=>r.generateMetadata(e)));for(let r of i)t.merge(r);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,i)=>t._equals(e.creds[i])):!1}},gg=class n extends ho{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,i)=>{this.metadataGenerator(e,(r,s)=>{s!==void 0?t(s):i(r)})})}compose(e){return new pg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},yg=class n extends ho{generateMetadata(e){return Promise.resolve(new vg.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var wg=w(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.getDefaultRootsData=fo.CIPHER_SUITES=void 0;var dP=de("fs");fo.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var kC=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,bg=null;function hP(){return kC?(bg===null&&(bg=dP.readFileSync(kC)),bg):null}fo.getDefaultRootsData=hP});var _d=w(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.ChannelCredentials=void 0;var fP=de("tls"),mP=_g(),RC=wg();function Eg(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var mo=class{constructor(e){this.callCredentials=e||mP.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,i,r){var s;if(Eg(e,"Root certificate"),Eg(t,"Private key"),Eg(i,"Certificate chain"),t&&!i)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&i)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,fP.createSecureContext)({ca:(s=e??(0,RC.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:i??void 0,ciphers:RC.CIPHER_SUITES});return new yd(o,r??{})}static createFromSecureContext(e,t){return new yd(e,t??{})}static createInsecure(){return new Sg}};vd.ChannelCredentials=mo;var Sg=class n extends mo{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},yd=class n extends mo{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Cg(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Cg=class n extends mo{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Qi=w(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateLoadBalancingConfig=xt.getFirstUsableConfig=xt.isLoadBalancerNameRegistered=xt.createLoadBalancer=xt.registerDefaultLoadBalancerType=xt.registerLoadBalancerType=xt.createChildChannelControlHelper=void 0;function pP(n,e){var t,i,r,s,o,a,l,c,u,d;return{createSubchannel:(i=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&i!==void 0?i:n.createSubchannel.bind(n),updateState:(s=(r=e.updateState)===null||r===void 0?void 0:r.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}xt.createChildChannelControlHelper=pP;var Ki={},Tg=null;function gP(n,e,t){Ki[n]={LoadBalancer:e,LoadBalancingConfig:t}}xt.registerLoadBalancerType=gP;function yP(n){Tg=n}xt.registerDefaultLoadBalancerType=yP;function vP(n,e){let t=n.getLoadBalancerName();return t in Ki?new Ki[t].LoadBalancer(e):null}xt.createLoadBalancer=vP;function _P(n){return n in Ki}xt.isLoadBalancerNameRegistered=_P;function bP(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Ki)return t;return e&&Tg?new Ki[Tg].LoadBalancingConfig:null}xt.getFirstUsableConfig=bP;function wP(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Ki)return Ki[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}xt.validateLoadBalancingConfig=wP});var xg=w(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.extractAndSelectServiceConfig=Yi.validateServiceConfig=Yi.validateRetryThrottling=void 0;var EP=de("os"),bd=ae(),SP=Qi(),wd=/^\d+(\.\d{1,9})?s$/,CP="node";function TP(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function xP(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!wd.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!wd.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(bd.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(bd.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function IP(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!wd.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(bd.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(bd.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function AP(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let i of n.name)t.name.push(TP(i));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&wd.test(n.timeout)){let i=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:i[0]|0,nanos:((e=i[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=xP(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=IP(n.hedgingPolicy));return t}function MC(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Yi.validateRetryThrottling=MC;function OC(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let i of n.loadBalancingConfig)e.loadBalancingConfig.push((0,SP.validateLoadBalancingConfig)(i));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let i of n.methodConfig)e.methodConfig.push(AP(i));"retryThrottling"in n&&(e.retryThrottling=MC(n.retryThrottling));let t=[];for(let i of e.methodConfig)for(let r of i.name){for(let s of t)if(r.service===s.service&&r.method===s.method)throw new Error(`Invalid service config: duplicate name ${r.service}/${r.method}`);t.push(r)}return e}Yi.validateServiceConfig=OC;function DP(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:OC(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let i of n.clientLanguage)if(typeof i=="string")e.clientLanguage.push(i);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let i of n.clientHostname)if(typeof i=="string")e.clientHostname.push(i);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let i in n)if(!t.includes(i))throw new Error(`Invalid service config choice: unexpected field ${i}`);return e}function kP(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let i=DP(t);if(!(typeof i.percentage=="number"&&e>i.percentage)){if(Array.isArray(i.clientHostname)){let r=!1;for(let s of i.clientHostname)s===EP.hostname()&&(r=!0);if(!r)continue}if(Array.isArray(i.clientLanguage)){let r=!1;for(let s of i.clientLanguage)s===CP&&(r=!0);if(!r)continue}return i.serviceConfig}}throw new Error("No matching service config found")}function RP(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let i=t.join("").substring(12),r=JSON.parse(i);return kP(r,e)}return null}Yi.extractAndSelectServiceConfig=RP});var cn=w(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.ConnectivityState=void 0;var NC=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(NC||(Ed.ConnectivityState=NC={}))});var Jt=w(Xi=>{"use strict";Object.defineProperty(Xi,"__esModule",{value:!0});Xi.uriToString=Xi.splitHostPort=Xi.parseUri=void 0;var MP=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function OP(n){let e=MP.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Xi.parseUri=OP;var PC=/^\d+$/;function NP(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let i=n.substring(e+2);return PC.test(i)?{host:t,port:+i}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?PC.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Xi.splitHostPort=NP;function PP(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Xi.uriToString=PP});var Wn=w(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.mapUriDefaultScheme=un.getDefaultAuthority=un.createResolver=un.registerDefaultScheme=un.registerResolver=void 0;var Ag=Jt(),po={},Ig=null;function FP(n,e){po[n]=e}un.registerResolver=FP;function LP(n){Ig=n}un.registerDefaultScheme=LP;function BP(n,e,t){if(n.scheme!==void 0&&n.scheme in po)return new po[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Ag.uriToString)(n)}`)}un.createResolver=BP;function VP(n){if(n.scheme!==void 0&&n.scheme in po)return po[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Ag.uriToString)(n)}`)}un.getDefaultAuthority=VP;function qP(n){return n.scheme===void 0||!(n.scheme in po)?Ig!==null?{scheme:Ig,authority:void 0,path:(0,Ag.uriToString)(n)}:null:n}un.mapUriDefaultScheme=qP});var Ji=w(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});Zi.QueuePicker=Zi.UnavailablePicker=Zi.PickResultType=void 0;var UP=Bt(),zP=ae(),Sd=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Sd||(Zi.PickResultType=Sd={})),Dg=class{constructor(e){this.status=Object.assign({code:zP.Status.UNAVAILABLE,details:"No connection established",metadata:new UP.Metadata},e)}pick(e){return{pickResultType:Sd.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Zi.UnavailablePicker=Dg;var kg=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Sd.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Zi.QueuePicker=kg});var El=w(Cd=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});Cd.BackoffTimeout=void 0;var jP=1e3,GP=1.6,HP=12e4,$P=.2;function WP(n,e){return Math.random()*(e-n)+n}var Rg=class{constructor(e,t){this.callback=e,this.initialDelay=jP,this.multiplier=GP,this.maxDelay=HP,this.jitter=$P,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,i;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(i=(t=this.timerId).unref)===null||i===void 0||i.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+WP(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Cd.BackoffTimeout=Rg});var xd=w(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.ChildLoadBalancerHandler=void 0;var KP=Qi(),QP=cn(),YP="child_load_balancer_helper",Mg=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,i){return this.parent.channelControlHelper.createSubchannel(t,i)}updateState(t,i){var r;if(this.calledByPendingChild()){if(t===QP.ConnectivityState.CONNECTING)return;(r=this.parent.currentChild)===null||r===void 0||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,i)}requestReresolution(){var t;let i=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===i&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,i){let r;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,KP.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,r=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,r=this.pendingChild)}else this.pendingChild===null?r=this.currentChild:r=this.pendingChild;this.latestConfig=t,r.updateAddressList(e,t,i)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return YP}};Td.ChildLoadBalancerHandler=Mg});var LC=w(Id=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});Id.ResolvingLoadBalancer=void 0;var XP=Qi(),ZP=xg(),Wt=cn(),JP=Wn(),go=Ji(),eF=El(),Og=ae(),tF=Bt(),nF=Ve(),iF=ae(),rF=Jt(),sF=xd(),oF="resolving_load_balancer";function FC(n){nF.trace(iF.LogVerbosity.DEBUG,oF,n)}var aF=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function lF(n,e,t,i){for(let r of t.name)switch(i){case"EMPTY":if(!r.service&&!r.method)return!0;break;case"SERVICE":if(r.service===n&&!r.method)return!0;break;case"SERVICE_AND_METHOD":if(r.service===n&&r.method===e)return!0}return!1}function cF(n,e,t,i){for(let r of t)if(lF(n,e,r,i))return r;return null}function uF(n){return function(t,i){var r,s;let o=t.split("/").filter(c=>c.length>0),a=(r=o[0])!==null&&r!==void 0?r:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of aF){let u=cF(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Og.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Og.Status.OK,dynamicFilterFactories:[]}}}var Ng=class{constructor(e,t,i,r,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=r,this.onFailedResolution=s,this.latestChildState=Wt.ConnectivityState.IDLE,this.latestChildPicker=new go.QueuePicker(this),this.currentState=Wt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,i["grpc.service_config"]?this.defaultServiceConfig=(0,ZP.validateServiceConfig)(JSON.parse(i["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Wt.ConnectivityState.IDLE,new go.QueuePicker(this)),this.childLoadBalancer=new sF.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(FC("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,JP.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let m=null;l===null?c===null?(this.previousServiceConfig=null,m=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):m=this.previousServiceConfig:(m=l,this.previousServiceConfig=l);let y=(h=m?.loadBalancingConfig)!==null&&h!==void 0?h:[],v=(0,XP.getFirstUsableConfig)(y,!0);if(v===null){this.handleResolutionFailure({code:Og.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new tF.Metadata});return}this.childLoadBalancer.updateAddressList(a,v,d);let b=m??this.defaultServiceConfig;this.onSuccessfulResolution(b,u??uF(b))},onError:a=>{this.handleResolutionFailure(a)}},i);let o={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new eF.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Wt.ConnectivityState.IDLE&&this.updateState(Wt.ConnectivityState.CONNECTING,new go.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){FC((0,rF.uriToString)(this.target)+" "+Wt.ConnectivityState[this.currentState]+" -> "+Wt.ConnectivityState[e]),e===Wt.ConnectivityState.IDLE&&(t=new go.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Wt.ConnectivityState.IDLE&&(this.updateState(Wt.ConnectivityState.TRANSIENT_FAILURE,new go.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Wt.ConnectivityState.IDLE||this.currentState===Wt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Wt.ConnectivityState.IDLE,this.latestChildPicker=new go.QueuePicker(this),this.currentState=Wt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Id.ResolvingLoadBalancer=Ng});var BC=w(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.channelOptionsEqual=yo.recognizedOptions=void 0;yo.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function dF(n,e){let t=Object.keys(n).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==i[r]||n[t[r]]!==e[i[r]])return!1;return!0}yo.channelOptionsEqual=dF});var Qn=w(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.stringToSubchannelAddress=Kn.subchannelAddressToString=Kn.subchannelAddressEqual=Kn.isTcpSubchannelAddress=void 0;var hF=de("net");function Sl(n){return"port"in n}Kn.isTcpSubchannelAddress=Sl;function fF(n,e){return!n&&!e?!0:!n||!e?!1:Sl(n)?Sl(e)&&n.host===e.host&&n.port===e.port:!Sl(e)&&n.path===e.path}Kn.subchannelAddressEqual=fF;function mF(n){return Sl(n)?n.host+":"+n.port:n.path}Kn.subchannelAddressToString=mF;var pF=443;function gF(n,e){return(0,hF.isIP)(n)?{host:n,port:e??pF}:{path:n}}Kn.stringToSubchannelAddress=gF});var Ad=w(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.addAdminServicesToServer=vo.registerAdminService=void 0;var VC=[];function yF(n,e){VC.push({getServiceDefinition:n,getHandlers:e})}vo.registerAdminService=yF;function vF(n){for(let{getServiceDefinition:e,getHandlers:t}of VC)n.addService(e(),t())}vo.addAdminServicesToServer=vF});var qC=w(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.ClientDuplexStreamImpl=dn.ClientWritableStreamImpl=dn.ClientReadableStreamImpl=dn.ClientUnaryCallImpl=dn.callErrorFromStatus=void 0;var _F=de("events"),Vg=de("stream"),Cl=ae();function bF(n,e){let t=`${n.code} ${Cl.Status[n.code]}: ${n.details}`,r=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:r})}dn.callErrorFromStatus=bF;var Pg=class extends _F.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};dn.ClientUnaryCallImpl=Pg;var Fg=class extends Vg.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};dn.ClientReadableStreamImpl=Fg;var Lg=class extends Vg.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientWritableStreamImpl=Lg;var Bg=class extends Vg.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,i){var r;let s={callback:i},o=Number(t);Number.isNaN(o)||(s.flags=o),(r=this.call)===null||r===void 0||r.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientDuplexStreamImpl=Bg});var UC=w(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.InterceptingListenerImpl=_o.isInterceptingListener=void 0;function wF(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}_o.isInterceptingListener=wF;var qg=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};_o.InterceptingListenerImpl=qg});var Wg=w(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.getInterceptingCall=hn.InterceptingCall=hn.RequesterBuilder=hn.ListenerBuilder=hn.InterceptorConfigurationError=void 0;var EF=Bt(),zC=UC(),jC=ae(),GC=fd(),xl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};hn.InterceptorConfigurationError=xl;var zg=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};hn.ListenerBuilder=zg;var jg=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};hn.RequesterBuilder=jg;var Ug={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Tl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Gg=class{constructor(e,t){var i,r,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(i=t.start)!==null&&i!==void 0?i:Tl.start,sendMessage:(r=t.sendMessage)!==null&&r!==void 0?r:Tl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Tl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Tl.cancel}:this.requester=Tl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var i,r,s,o,a,l;let c={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,m,y;this.processingMetadata=!1;let v;if((0,zC.isInterceptingListener)(d))v=d;else{let b={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:Ug.onReceiveMetadata,onReceiveMessage:(m=d.onReceiveMessage)!==null&&m!==void 0?m:Ug.onReceiveMessage,onReceiveStatus:(y=d.onReceiveStatus)!==null&&y!==void 0?y:Ug.onReceiveStatus};v=new zC.InterceptingListenerImpl(b,c)}this.nextCall.start(u,v),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,i=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,i),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};hn.InterceptingCall=Gg;function SF(n,e,t){var i,r;let s=(i=t.deadline)!==null&&i!==void 0?i:1/0,o=t.host,a=(r=t.parent)!==null&&r!==void 0?r:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Dd=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let i;try{i=this.methodDefinition.requestSerialize(t)}catch(r){this.call.cancelWithStatus(jC.Status.INTERNAL,`Request message serialization failure: ${(0,GC.getErrorMessage)(r)}`);return}this.call.sendMessageWithContext(e,i)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let i=null;this.call.start(e,{onReceiveMetadata:r=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,r)},onReceiveMessage:r=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(r)}catch(a){i={code:jC.Status.INTERNAL,details:`Response message parsing error: ${(0,GC.getErrorMessage)(a)}`,metadata:new EF.Metadata},this.call.cancelWithStatus(i.code,i.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:r=>{var s,o;i?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,i):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,r)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Hg=class extends Dd{constructor(e,t){super(e,t)}start(e,t){var i,r;let s=!1,o={onReceiveMetadata:(r=(i=t?.onReceiveMetadata)===null||i===void 0?void 0:i.bind(t))!==null&&r!==void 0?r:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},$g=class extends Dd{};function CF(n,e,t){let i=SF(n,t.path,e);return t.responseStream?new $g(i,t):new Hg(i,t)}function TF(n,e,t,i){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new xl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new xl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let r=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?r=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):r=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return r.reduceRight((a,l)=>c=>l(c,a),a=>CF(i,a,e))(s)}hn.getInterceptingCall=TF});var Yg=w(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.Client=void 0;var Yn=qC(),xF=Xg(),IF=cn(),er=ae(),bo=Bt(),kd=Wg(),xn=Symbol(),wo=Symbol(),Eo=Symbol(),Ei=Symbol();function Kg(n){return typeof n=="function"}function So(n){return n.stack.split(`
`).slice(1).join(`
`)}var Qg=class{constructor(e,t,i={}){var r,s;if(i=Object.assign({},i),this[wo]=(r=i.interceptors)!==null&&r!==void 0?r:[],delete i.interceptors,this[Eo]=(s=i.interceptor_providers)!==null&&s!==void 0?s:[],delete i.interceptor_providers,this[wo].length>0&&this[Eo].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Ei]=i.callInvocationTransformer,delete i.callInvocationTransformer,i.channelOverride)this[xn]=i.channelOverride;else if(i.channelFactoryOverride){let o=i.channelFactoryOverride;delete i.channelFactoryOverride,this[xn]=o(e,t,i)}else this[xn]=new xF.ChannelImplementation(e,t,i)}close(){this[xn].close()}getChannel(){return this[xn]}waitForReady(e,t){let i=r=>{if(r){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[xn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===IF.ConnectivityState.READY)t();else try{this[xn].watchConnectivityState(s,e,i)}catch{t(new Error("The channel has been closed"))}};setImmediate(i)}checkOptionalUnaryResponseArguments(e,t,i){if(Kg(e))return{metadata:new bo.Metadata,options:{},callback:e};if(Kg(t))return e instanceof bo.Metadata?{metadata:e,options:{},callback:t}:{metadata:new bo.Metadata,options:e,callback:t};if(!(e instanceof bo.Metadata&&t instanceof Object&&Kg(i)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:i}}makeUnaryRequest(e,t,i,r,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:i},h={argument:r,metadata:u.metadata,call:new Yn.ClientUnaryCallImpl,channel:this[xn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[Ei]&&(h=this[Ei](h));let m=h.call,y={clientInterceptors:this[wo],clientInterceptorProviders:this[Eo],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},v=(0,kd.getInterceptingCall)(y,h.methodDefinition,h.callOptions,h.channel);m.call=v;let b=null,D=!1,E=new Error;return v.start(h.metadata,{onReceiveMetadata:k=>{m.emit("metadata",k)},onReceiveMessage(k){b!==null&&v.cancelWithStatus(er.Status.INTERNAL,"Too many responses received"),b=k},onReceiveStatus(k){if(!D){if(D=!0,k.code===er.Status.OK)if(b===null){let R=So(E);h.callback((0,Yn.callErrorFromStatus)({code:er.Status.INTERNAL,details:"No message received",metadata:k.metadata},R))}else h.callback(null,b);else{let R=So(E);h.callback((0,Yn.callErrorFromStatus)(k,R))}E=null,m.emit("status",k)}}}),v.sendMessage(r),v.halfClose(),m}makeClientStreamRequest(e,t,i,r,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(r,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:i},d={metadata:c.metadata,call:new Yn.ClientWritableStreamImpl(t),channel:this[xn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Ei]&&(d=this[Ei](d));let h=d.call,m={clientInterceptors:this[wo],clientInterceptorProviders:this[Eo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,kd.getInterceptingCall)(m,d.methodDefinition,d.callOptions,d.channel);h.call=y;let v=null,b=!1,D=new Error;return y.start(d.metadata,{onReceiveMetadata:E=>{h.emit("metadata",E)},onReceiveMessage(E){v!==null&&y.cancelWithStatus(er.Status.INTERNAL,"Too many responses received"),v=E},onReceiveStatus(E){if(!b){if(b=!0,E.code===er.Status.OK)if(v===null){let k=So(D);d.callback((0,Yn.callErrorFromStatus)({code:er.Status.INTERNAL,details:"No message received",metadata:E.metadata},k))}else d.callback(null,v);else{let k=So(D);d.callback((0,Yn.callErrorFromStatus)(E,k))}D=null,h.emit("status",E)}}}),h}checkMetadataAndOptions(e,t){let i,r;return e instanceof bo.Metadata?(i=e,t?r=t:r={}):(e?r=e:r={},i=new bo.Metadata),{metadata:i,options:r}}makeServerStreamRequest(e,t,i,r,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:i},d={argument:r,metadata:c.metadata,call:new Yn.ClientReadableStreamImpl(i),channel:this[xn],methodDefinition:u,callOptions:c.options};this[Ei]&&(d=this[Ei](d));let h=d.call,m={clientInterceptors:this[wo],clientInterceptorProviders:this[Eo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,kd.getInterceptingCall)(m,d.methodDefinition,d.callOptions,d.channel);h.call=y;let v=!1,b=new Error;return y.start(d.metadata,{onReceiveMetadata(D){h.emit("metadata",D)},onReceiveMessage(D){h.push(D)},onReceiveStatus(D){if(!v){if(v=!0,h.push(null),D.code!==er.Status.OK){let E=So(b);h.emit("error",(0,Yn.callErrorFromStatus)(D,E))}b=null,h.emit("status",D)}}}),y.sendMessage(r),y.halfClose(),h}makeBidiStreamRequest(e,t,i,r,s){var o,a;let l=this.checkMetadataAndOptions(r,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:i},u={metadata:l.metadata,call:new Yn.ClientDuplexStreamImpl(t,i),channel:this[xn],methodDefinition:c,callOptions:l.options};this[Ei]&&(u=this[Ei](u));let d=u.call,h={clientInterceptors:this[wo],clientInterceptorProviders:this[Eo],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},m=(0,kd.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=m;let y=!1,v=new Error;return m.start(u.metadata,{onReceiveMetadata(b){d.emit("metadata",b)},onReceiveMessage(b){d.push(b)},onReceiveStatus(b){if(!y){if(y=!0,d.push(null),b.code!==er.Status.OK){let D=So(v);d.emit("error",(0,Yn.callErrorFromStatus)(b,D))}v=null,d.emit("status",b)}}}),d}};Rd.Client=Qg});var Jg=w(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.loadPackageDefinition=Co.makeClientConstructor=void 0;var Il=Yg(),AF={unary:Il.Client.prototype.makeUnaryRequest,server_stream:Il.Client.prototype.makeServerStreamRequest,client_stream:Il.Client.prototype.makeClientStreamRequest,bidi:Il.Client.prototype.makeBidiStreamRequest};function Zg(n){return["__proto__","prototype","constructor"].includes(n)}function HC(n,e,t){t||(t={});class i extends Il.Client{}return Object.keys(n).forEach(r=>{if(Zg(r))return;let s=n[r],o;if(typeof r=="string"&&r.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=DF(AF[o],s.path,a,l);i.prototype[r]=c,Object.assign(i.prototype[r],s),s.originalName&&!Zg(s.originalName)&&(i.prototype[s.originalName]=i.prototype[r])}),i.service=n,i.serviceName=e,i}Co.makeClientConstructor=HC;function DF(n,e,t,i){return function(...r){return n.call(this,e,t,i,...r)}}function kF(n){return"format"in n}function RF(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],r=t.split(".");if(r.some(a=>Zg(a)))continue;let s=r[r.length-1],o=e;for(let a of r.slice(0,-1))o[a]||(o[a]={}),o=o[a];kF(i)?o[s]=i:o[s]=HC(i,s,{})}return e}Co.loadPackageDefinition=RF});var gT=w((RK,pT)=>{var MF=1/0,OF="[object Symbol]",NF=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,PF=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Od="\\ud800-\\udfff",JC="\\u0300-\\u036f\\ufe20-\\ufe23",eT="\\u20d0-\\u20f0",tT="\\u2700-\\u27bf",nT="a-z\\xdf-\\xf6\\xf8-\\xff",FF="\\xac\\xb1\\xd7\\xf7",LF="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",BF="\\u2000-\\u206f",VF=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",iT="A-Z\\xc0-\\xd6\\xd8-\\xde",rT="\\ufe0e\\ufe0f",sT=FF+LF+BF+VF,ty="['\u2019]",qF="["+Od+"]",$C="["+sT+"]",Md="["+JC+eT+"]",oT="\\d+",UF="["+tT+"]",aT="["+nT+"]",lT="[^"+Od+sT+oT+tT+nT+iT+"]",ey="\\ud83c[\\udffb-\\udfff]",zF="(?:"+Md+"|"+ey+")",cT="[^"+Od+"]",ny="(?:\\ud83c[\\udde6-\\uddff]){2}",iy="[\\ud800-\\udbff][\\udc00-\\udfff]",To="["+iT+"]",uT="\\u200d",WC="(?:"+aT+"|"+lT+")",jF="(?:"+To+"|"+lT+")",KC="(?:"+ty+"(?:d|ll|m|re|s|t|ve))?",QC="(?:"+ty+"(?:D|LL|M|RE|S|T|VE))?",dT=zF+"?",hT="["+rT+"]?",GF="(?:"+uT+"(?:"+[cT,ny,iy].join("|")+")"+hT+dT+")*",fT=hT+dT+GF,HF="(?:"+[UF,ny,iy].join("|")+")"+fT,$F="(?:"+[cT+Md+"?",Md,ny,iy,qF].join("|")+")",WF=RegExp(ty,"g"),KF=RegExp(Md,"g"),QF=RegExp(ey+"(?="+ey+")|"+$F+fT,"g"),YF=RegExp([To+"?"+aT+"+"+KC+"(?="+[$C,To,"$"].join("|")+")",jF+"+"+QC+"(?="+[$C,To+WC,"$"].join("|")+")",To+"?"+WC+"+"+KC,To+"+"+QC,oT,HF].join("|"),"g"),XF=RegExp("["+uT+Od+JC+eT+rT+"]"),ZF=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,JF={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},eL=typeof global=="object"&&global&&global.Object===Object&&global,tL=typeof self=="object"&&self&&self.Object===Object&&self,nL=eL||tL||Function("return this")();function iL(n,e,t,i){var r=-1,s=n?n.length:0;for(i&&s&&(t=n[++r]);++r<s;)t=e(t,n[r],r,n);return t}function rL(n){return n.split("")}function sL(n){return n.match(NF)||[]}function oL(n){return function(e){return n?.[e]}}var aL=oL(JF);function mT(n){return XF.test(n)}function lL(n){return ZF.test(n)}function cL(n){return mT(n)?uL(n):rL(n)}function uL(n){return n.match(QF)||[]}function dL(n){return n.match(YF)||[]}var hL=Object.prototype,fL=hL.toString,YC=nL.Symbol,XC=YC?YC.prototype:void 0,ZC=XC?XC.toString:void 0;function mL(n,e,t){var i=-1,r=n.length;e<0&&(e=-e>r?0:r+e),t=t>r?r:t,t<0&&(t+=r),r=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=n[i+e];return s}function pL(n){if(typeof n=="string")return n;if(bL(n))return ZC?ZC.call(n):"";var e=n+"";return e=="0"&&1/n==-MF?"-0":e}function gL(n,e,t){var i=n.length;return t=t===void 0?i:t,!e&&t>=i?n:mL(n,e,t)}function yL(n){return function(e){e=Nd(e);var t=mT(e)?cL(e):void 0,i=t?t[0]:e.charAt(0),r=t?gL(t,1).join(""):e.slice(1);return i[n]()+r}}function vL(n){return function(e){return iL(TL(SL(e).replace(WF,"")),n,"")}}function _L(n){return!!n&&typeof n=="object"}function bL(n){return typeof n=="symbol"||_L(n)&&fL.call(n)==OF}function Nd(n){return n==null?"":pL(n)}var wL=vL(function(n,e,t){return e=e.toLowerCase(),n+(t?EL(e):e)});function EL(n){return CL(Nd(n).toLowerCase())}function SL(n){return n=Nd(n),n&&n.replace(PF,aL).replace(KF,"")}var CL=yL("toUpperCase");function TL(n,e,t){return n=Nd(n),e=t?void 0:e,e===void 0?lL(n)?dL(n):sL(n):n.match(e)||[]}pT.exports=wL});var ry=w((MK,yT)=>{"use strict";yT.exports=xL;function xL(n,e){for(var t=new Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)t[i++]=arguments[r++];return new Promise(function(a,l){t[i]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var wT=w(bT=>{"use strict";var Pd=bT;Pd.length=function(e){var t=e.length;if(!t)return 0;for(var i=0;--t%4>1&&e.charAt(t)==="=";)++i;return Math.ceil(e.length*3)/4-i};var xo=new Array(64),_T=new Array(123);for(In=0;In<64;)_T[xo[In]=In<26?In+65:In<52?In+71:In<62?In-4:In-59|43]=In++;var In;Pd.encode=function(e,t,i){for(var r=null,s=[],o=0,a=0,l;t<i;){var c=e[t++];switch(a){case 0:s[o++]=xo[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=xo[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=xo[l|c>>6],s[o++]=xo[c&63],a=0;break}o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=xo[l],s[o++]=61,a===1&&(s[o++]=61)),r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var vT="invalid encoding";Pd.decode=function(e,t,i){for(var r=i,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=_T[l])===void 0)throw Error(vT);switch(s){case 0:o=l,s=1;break;case 1:t[i++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[i++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[i++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(vT);return i-r};Pd.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var ST=w((NK,ET)=>{"use strict";ET.exports=Fd;function Fd(){this._listeners={}}Fd.prototype.on=function(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this};Fd.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var i=this._listeners[e],r=0;r<i.length;)i[r].fn===t?i.splice(r,1):++r;return this};Fd.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,i)}return this}});var kT=w((PK,DT)=>{"use strict";DT.exports=CT(CT);function CT(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),i=t[3]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=i?r:s,n.writeFloatBE=i?s:r;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=i?o:a,n.readFloatBE=i?a:o}():function(){function e(i,r,s,o){var a=r<0?1:0;if(a&&(r=-r),r===0)i(1/r>0?0:2147483648,s,o);else if(isNaN(r))i(2143289344,s,o);else if(r>34028234663852886e22)i((a<<31|2139095040)>>>0,s,o);else if(r<11754943508222875e-54)i((a<<31|Math.round(r/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(r)/Math.LN2),c=Math.round(r*Math.pow(2,-l)*8388608)&8388607;i((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,TT),n.writeFloatBE=e.bind(null,xT);function t(i,r,s){var o=i(r,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,IT),n.readFloatBE=t.bind(null,AT)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),i=t[7]===128;function r(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=i?r:s,n.writeDoubleBE=i?s:r;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=i?o:a,n.readDoubleBE=i?a:o}():function(){function e(i,r,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)i(0,a,l+r),i(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))i(0,a,l+r),i(2146959360,a,l+s);else if(o>17976931348623157e292)i(0,a,l+r),i((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,i(u>>>0,a,l+r),i((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),i(u*4503599627370496>>>0,a,l+r),i((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,TT,0,4),n.writeDoubleBE=e.bind(null,xT,4,0);function t(i,r,s,o,a){var l=i(o,a+r),c=i(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,IT,0,4),n.readDoubleBE=t.bind(null,AT,4,0)}(),n}function TT(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function xT(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function IT(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function AT(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var sy=w((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var MT=w(RT=>{"use strict";var oy=RT;oy.length=function(e){for(var t=0,i=0,r=0;r<e.length;++r)i=e.charCodeAt(r),i<128?t+=1:i<2048?t+=2:(i&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320?(++r,t+=4):t+=3;return t};oy.read=function(e,t,i){var r=i-t;if(r<1)return"";for(var s=null,o=[],a=0,l;t<i;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};oy.write=function(e,t,i){for(var r=i,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=s&63|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=s&63|128);return i-r}});var NT=w((LK,OT)=>{"use strict";OT.exports=IL;function IL(n,e,t){var i=t||8192,r=i>>>1,s=null,o=i;return function(l){if(l<1||l>r)return n(l);o+l>i&&(s=n(i),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var FT=w((BK,PT)=>{"use strict";PT.exports=ot;var Al=Xn();function ot(n,e){this.lo=n>>>0,this.hi=e>>>0}var os=ot.zero=new ot(0,0);os.toNumber=function(){return 0};os.zzEncode=os.zzDecode=function(){return this};os.length=function(){return 1};var AL=ot.zeroHash="\0\0\0\0\0\0\0\0";ot.fromNumber=function(e){if(e===0)return os;var t=e<0;t&&(e=-e);var i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new ot(i,r)};ot.from=function(e){if(typeof e=="number")return ot.fromNumber(e);if(Al.isString(e))if(Al.Long)e=Al.Long.fromString(e);else return ot.fromNumber(parseInt(e,10));return e.low||e.high?new ot(e.low>>>0,e.high>>>0):os};ot.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,i=~this.hi>>>0;return t||(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296};ot.prototype.toLong=function(e){return Al.Long?new Al.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var tr=String.prototype.charCodeAt;ot.fromHash=function(e){return e===AL?os:new ot((tr.call(e,0)|tr.call(e,1)<<8|tr.call(e,2)<<16|tr.call(e,3)<<24)>>>0,(tr.call(e,4)|tr.call(e,5)<<8|tr.call(e,6)<<16|tr.call(e,7)<<24)>>>0)};ot.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ot.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ot.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ot.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}});var Xn=w(ay=>{"use strict";var U=ay;U.asPromise=ry();U.base64=wT();U.EventEmitter=ST();U.float=kT();U.inquire=sy();U.utf8=MT();U.pool=NT();U.LongBits=FT();U.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);U.global=U.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||ay;U.emptyArray=Object.freeze?Object.freeze([]):[];U.emptyObject=Object.freeze?Object.freeze({}):{};U.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};U.isString=function(e){return typeof e=="string"||e instanceof String};U.isObject=function(e){return e&&typeof e=="object"};U.isset=U.isSet=function(e,t){var i=e[t];return i!=null&&e.hasOwnProperty(t)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};U.Buffer=function(){try{var n=U.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();U._Buffer_from=null;U._Buffer_allocUnsafe=null;U.newBuffer=function(e){return typeof e=="number"?U.Buffer?U._Buffer_allocUnsafe(e):new U.Array(e):U.Buffer?U._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};U.Array=typeof Uint8Array<"u"?Uint8Array:Array;U.Long=U.global.dcodeIO&&U.global.dcodeIO.Long||U.global.Long||U.inquire("long");U.key2Re=/^true|false|0|1$/;U.key32Re=/^-?(?:0|[1-9][0-9]*)$/;U.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;U.longToHash=function(e){return e?U.LongBits.from(e).toHash():U.LongBits.zeroHash};U.longFromHash=function(e,t){var i=U.LongBits.fromHash(e);return U.Long?U.Long.fromBits(i.lo,i.hi,t):i.toNumber(!!t)};function LT(n,e,t){for(var i=Object.keys(e),r=0;r<i.length;++r)(n[i[r]]===void 0||!t)&&(n[i[r]]=e[i[r]]);return n}U.merge=LT;U.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function BT(n){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&LT(this,i)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}U.newError=BT;U.ProtocolError=BT("ProtocolError");U.oneOfGetter=function(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=1;return function(){for(var r=Object.keys(this),s=r.length-1;s>-1;--s)if(t[r[s]]===1&&this[r[s]]!==void 0&&this[r[s]]!==null)return r[s]}};U.oneOfSetter=function(e){return function(t){for(var i=0;i<e.length;++i)e[i]!==t&&delete this[e[i]]}};U.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};U._configure=function(){var n=U.Buffer;if(!n){U._Buffer_from=U._Buffer_allocUnsafe=null;return}U._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)},U._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Bd=w((qK,zT)=>{"use strict";zT.exports=re;var fn=Xn(),ly,Ld=fn.LongBits,VT=fn.base64,qT=fn.utf8;function Dl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function uy(){}function DL(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function re(){this.len=0,this.head=new Dl(uy,0,0),this.tail=this.head,this.states=null}var UT=function(){return fn.Buffer?function(){return(re.create=function(){return new ly})()}:function(){return new re}};re.create=UT();re.alloc=function(e){return new fn.Array(e)};fn.Array!==Array&&(re.alloc=fn.pool(re.alloc,fn.Array.prototype.subarray));re.prototype._push=function(e,t,i){return this.tail=this.tail.next=new Dl(e,t,i),this.len+=t,this};function dy(n,e,t){e[t]=n&255}function kL(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function hy(n,e){this.len=n,this.next=void 0,this.val=e}hy.prototype=Object.create(Dl.prototype);hy.prototype.fn=kL;re.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new hy((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};re.prototype.int32=function(e){return e<0?this._push(fy,10,Ld.fromNumber(e)):this.uint32(e)};re.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function fy(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}re.prototype.uint64=function(e){var t=Ld.from(e);return this._push(fy,t.length(),t)};re.prototype.int64=re.prototype.uint64;re.prototype.sint64=function(e){var t=Ld.from(e).zzEncode();return this._push(fy,t.length(),t)};re.prototype.bool=function(e){return this._push(dy,1,e?1:0)};function cy(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}re.prototype.fixed32=function(e){return this._push(cy,4,e>>>0)};re.prototype.sfixed32=re.prototype.fixed32;re.prototype.fixed64=function(e){var t=Ld.from(e);return this._push(cy,4,t.lo)._push(cy,4,t.hi)};re.prototype.sfixed64=re.prototype.fixed64;re.prototype.float=function(e){return this._push(fn.float.writeFloatLE,4,e)};re.prototype.double=function(e){return this._push(fn.float.writeDoubleLE,8,e)};var RL=fn.Array.prototype.set?function(e,t,i){t.set(e,i)}:function(e,t,i){for(var r=0;r<e.length;++r)t[i+r]=e[r]};re.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(dy,1,0);if(fn.isString(e)){var i=re.alloc(t=VT.length(e));VT.decode(e,i,0),e=i}return this.uint32(t)._push(RL,t,e)};re.prototype.string=function(e){var t=qT.length(e);return t?this.uint32(t)._push(qT.write,t,e):this._push(dy,1,0)};re.prototype.fork=function(){return this.states=new DL(this),this.head=this.tail=new Dl(uy,0,0),this.len=0,this};re.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Dl(uy,0,0),this.len=0),this};re.prototype.ldelim=function(){var e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=t,this.len+=i),this};re.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t};re._configure=function(n){ly=n,re.create=UT(),ly._configure()}});var HT=w((UK,GT)=>{"use strict";GT.exports=Zn;var jT=Bd();(Zn.prototype=Object.create(jT.prototype)).constructor=Zn;var nr=Xn();function Zn(){jT.call(this)}Zn._configure=function(){Zn.alloc=nr._Buffer_allocUnsafe,Zn.writeBytesBuffer=nr.Buffer&&nr.Buffer.prototype instanceof Uint8Array&&nr.Buffer.prototype.set.name==="set"?function(e,t,i){t.set(e,i)}:function(e,t,i){if(e.copy)e.copy(t,i,0,e.length);else for(var r=0;r<e.length;)t[i++]=e[r++]}};Zn.prototype.bytes=function(e){nr.isString(e)&&(e=nr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Zn.writeBytesBuffer,t,e),this};function ML(n,e,t){n.length<40?nr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Zn.prototype.string=function(e){var t=nr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(ML,t,e),this};Zn._configure()});var qd=w((zK,YT)=>{"use strict";YT.exports=Ge;var An=Xn(),py,KT=An.LongBits,OL=An.utf8;function Dn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ge(n){this.buf=n,this.pos=0,this.len=n.length}var $T=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ge(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ge(e);throw Error("illegal buffer")},QT=function(){return An.Buffer?function(t){return(Ge.create=function(r){return An.Buffer.isBuffer(r)?new py(r):$T(r)})(t)}:$T};Ge.create=QT();Ge.prototype._slice=An.Array.prototype.subarray||An.Array.prototype.slice;Ge.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Dn(this,10);return e}}();Ge.prototype.int32=function(){return this.uint32()|0};Ge.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function my(){var n=new KT(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Dn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Dn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ge.prototype.bool=function(){return this.uint32()!==0};function Vd(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ge.prototype.fixed32=function(){if(this.pos+4>this.len)throw Dn(this,4);return Vd(this.buf,this.pos+=4)};Ge.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Dn(this,4);return Vd(this.buf,this.pos+=4)|0};function WT(){if(this.pos+8>this.len)throw Dn(this,8);return new KT(Vd(this.buf,this.pos+=4),Vd(this.buf,this.pos+=4))}Ge.prototype.float=function(){if(this.pos+4>this.len)throw Dn(this,4);var e=An.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ge.prototype.double=function(){if(this.pos+8>this.len)throw Dn(this,4);var e=An.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ge.prototype.bytes=function(){var e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw Dn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,i);if(t===i){var r=An.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,i)};Ge.prototype.string=function(){var e=this.bytes();return OL.read(e,0,e.length)};Ge.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Dn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Dn(this);while(this.buf[this.pos++]&128);return this};Ge.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ge._configure=function(n){py=n,Ge.create=QT(),py._configure();var e=An.Long?"toLong":"toNumber";An.merge(Ge.prototype,{int64:function(){return my.call(this)[e](!1)},uint64:function(){return my.call(this)[e](!0)},sint64:function(){return my.call(this).zzDecode()[e](!1)},fixed64:function(){return WT.call(this)[e](!0)},sfixed64:function(){return WT.call(this)[e](!1)}})}});var ex=w((jK,JT)=>{"use strict";JT.exports=as;var ZT=qd();(as.prototype=Object.create(ZT.prototype)).constructor=as;var XT=Xn();function as(n){ZT.call(this,n)}as._configure=function(){XT.Buffer&&(as.prototype._slice=XT.Buffer.prototype.slice)};as.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};as._configure()});var nx=w((GK,tx)=>{"use strict";tx.exports=kl;var gy=Xn();(kl.prototype=Object.create(gy.EventEmitter.prototype)).constructor=kl;function kl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");gy.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}kl.prototype.rpcCall=function n(e,t,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return gy.asPromise(n,o,e,t,i,r);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof i))try{c=i[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};kl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var yy=w(ix=>{"use strict";var NL=ix;NL.Service=nx()});var vy=w(($K,rx)=>{"use strict";rx.exports={}});var ax=w(ox=>{"use strict";var Kt=ox;Kt.build="minimal";Kt.Writer=Bd();Kt.BufferWriter=HT();Kt.Reader=qd();Kt.BufferReader=ex();Kt.util=Xn();Kt.rpc=yy();Kt.roots=vy();Kt.configure=sx;function sx(){Kt.util._configure(),Kt.Writer._configure(Kt.BufferWriter),Kt.Reader._configure(Kt.BufferReader)}sx()});var cx=w((KK,lx)=>{"use strict";lx.exports=_y;function _y(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function i(s){if(typeof s!="string"){var o=r();if(_y.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(y,v){var b=d[h++];switch(v){case"d":case"f":return String(Number(b));case"i":return String(Math.floor(b));case"j":return JSON.stringify(b);case"s":return String(b)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),i}function r(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return i.toString=r,i}_y.verbose=!1});var dx=w((QK,ux)=>{"use strict";ux.exports=Rl;var PL=ry(),FL=sy(),by=FL("fs");function Rl(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&by&&by.readFile?by.readFile(n,function(r,s){return r&&typeof XMLHttpRequest<"u"?Rl.xhr(n,e,t):r?t(r):t(null,e.binary?s:s.toString("utf8"))}):Rl.xhr(n,e,t):PL(Rl,this,n,e)}Rl.xhr=function(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!==0&&r.status!==200)return i(Error("status "+r.status));if(t.binary){var o=r.response;if(!o){o=[];for(var a=0;a<r.responseText.length;++a)o.push(r.responseText.charCodeAt(a)&255)}return i(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return i(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}});var mx=w(fx=>{"use strict";var Ey=fx,hx=Ey.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},wy=Ey.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),i=hx(e),r="";i&&(r=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):i?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return r+t.join("/")};Ey.resolve=function(e,t,i){return i||(t=wy(t)),hx(t)?t:(i||(e=wy(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?wy(e+"/"+t):t)}});var ls=w(px=>{"use strict";var Ml=px,LL=at(),BL=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Ol(n,e){var t=0,i={};for(e|=0;t<n.length;)i[BL[t+e]]=n[t++];return i}Ml.basic=Ol([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Ml.defaults=Ol([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",LL.emptyArray,null]);Ml.long=Ol([0,0,0,1,1],7);Ml.mapKey=Ol([0,0,0,5,5,0,0,0,1,1,0,2],2);Ml.packed=Ol([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ir=w((ZK,vx)=>{"use strict";vx.exports=mn;var Ud=cs();((mn.prototype=Object.create(Ud.prototype)).constructor=mn).className="Field";var gx=kn(),yx=ls(),Xe=at(),Sy,VL=/^required|optional|repeated$/;mn.fromJSON=function(e,t){return new mn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function mn(n,e,t,i,r,s,o){if(Xe.isObject(i)?(o=r,s=i,i=r=void 0):Xe.isObject(r)&&(o=s,s=r,r=void 0),Ud.call(this,n,s),!Xe.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Xe.isString(t))throw TypeError("type must be a string");if(i!==void 0&&!VL.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(r!==void 0&&!Xe.isString(r))throw TypeError("extend must be a string");i==="proto3_optional"&&(i="optional"),this.rule=i&&i!=="optional"?i:void 0,this.type=t,this.id=e,this.extend=r||void 0,this.required=i==="required",this.optional=!this.required,this.repeated=i==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Xe.Long?yx.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(mn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});mn.prototype.setOption=function(e,t,i){return e==="packed"&&(this._packed=null),Ud.prototype.setOption.call(this,e,t,i)};mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Xe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};mn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=yx.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Sy?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof gx&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof gx))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Xe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Xe.base64.test(this.typeDefault)?Xe.base64.decode(this.typeDefault,e=Xe.newBuffer(Xe.base64.length(this.typeDefault)),0):Xe.utf8.write(this.typeDefault,e=Xe.newBuffer(Xe.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Xe.emptyObject:this.repeated?this.defaultValue=Xe.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Sy&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Ud.prototype.resolve.call(this)};mn.d=function(e,t,i,r){return typeof t=="function"?t=Xe.decorateType(t).name:t&&typeof t=="object"&&(t=Xe.decorateEnum(t).name),function(o,a){Xe.decorateType(o.constructor).add(new mn(a,e,t,i,{default:r}))}};mn._configure=function(e){Sy=e}});var Io=w((JK,wx)=>{"use strict";wx.exports=pn;var jd=cs();((pn.prototype=Object.create(jd.prototype)).constructor=pn).className="OneOf";var _x=ir(),zd=at();function pn(n,e,t,i){if(Array.isArray(e)||(t=e,e=void 0),jd.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}pn.fromJSON=function(e,t){return new pn(e,t.oneof,t.options,t.comment)};pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return zd.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function bx(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}pn.prototype.add=function(e){if(!(e instanceof _x))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,bx(this),this};pn.prototype.remove=function(e){if(!(e instanceof _x))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};pn.prototype.onAdd=function(e){jd.prototype.onAdd.call(this,e);for(var t=this,i=0;i<this.oneof.length;++i){var r=e.get(this.oneof[i]);r&&!r.partOf&&(r.partOf=t,t.fieldsArray.push(r))}bx(this)};pn.prototype.onRemove=function(e){for(var t=0,i;t<this.fieldsArray.length;++t)(i=this.fieldsArray[t]).parent&&i.parent.remove(i);jd.prototype.onRemove.call(this,e)};pn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(r,s){zd.decorateType(r.constructor).add(new pn(s,e)),Object.defineProperty(r,s,{get:zd.oneOfGetter(e),set:zd.oneOfSetter(e)})}}});var ko=w((e7,Tx)=>{"use strict";Tx.exports=le;var Cy=cs();((le.prototype=Object.create(Cy.prototype)).constructor=le).className="Namespace";var Ex=ir(),Gd=at(),qL=Io(),Ao,Nl,Do;le.fromJSON=function(e,t){return new le(e,t.options).addJSON(t.nested)};function Sx(n,e){if(n&&n.length){for(var t={},i=0;i<n.length;++i)t[n[i].name]=n[i].toJSON(e);return t}}le.arrayToJSON=Sx;le.isReservedId=function(e,t){if(e){for(var i=0;i<e.length;++i)if(typeof e[i]!="string"&&e[i][0]<=t&&e[i][1]>t)return!0}return!1};le.isReservedName=function(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i]===t)return!0}return!1};function le(n,e){Cy.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Cx(n){return n._nestedArray=null,n}Object.defineProperty(le.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Gd.toArray(this.nested))}});le.prototype.toJSON=function(e){return Gd.toObject(["options",this.options,"nested",Sx(this.nestedArray,e)])};le.prototype.addJSON=function(e){var t=this;if(e)for(var i=Object.keys(e),r=0,s;r<i.length;++r)s=e[i[r]],t.add((s.fields!==void 0?Ao.fromJSON:s.values!==void 0?Do.fromJSON:s.methods!==void 0?Nl.fromJSON:s.id!==void 0?Ex.fromJSON:le.fromJSON)(i[r],s));return this};le.prototype.get=function(e){return this.nested&&this.nested[e]||null};le.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Do)return this.nested[e].values;throw Error("no such enum: "+e)};le.prototype.add=function(e){if(!(e instanceof Ex&&e.extend!==void 0||e instanceof Ao||e instanceof qL||e instanceof Do||e instanceof Nl||e instanceof le))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof le&&e instanceof le&&!(t instanceof Ao||t instanceof Nl)){for(var i=t.nestedArray,r=0;r<i.length;++r)e.add(i[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Cx(this)};le.prototype.remove=function(e){if(!(e instanceof Cy))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Cx(this)};le.prototype.define=function(e,t){if(Gd.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var i=this;e.length>0;){var r=e.shift();if(i.nested&&i.nested[r]){if(i=i.nested[r],!(i instanceof le))throw Error("path conflicts with non-namespace objects")}else i.add(i=new le(r))}return t&&i.addJSON(t),i};le.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof le?e[t++].resolveAll():e[t++].resolve();return this.resolve()};le.prototype.lookup=function(e,t,i){if(typeof t=="boolean"?(i=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Gd.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(e.length===1){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof le&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof le&&(r=this._nestedArray[s].lookup(e,t,!0)))return r;return this.parent===null||i?null:this.parent.lookup(e,t)};le.prototype.lookupType=function(e){var t=this.lookup(e,[Ao]);if(!t)throw Error("no such type: "+e);return t};le.prototype.lookupEnum=function(e){var t=this.lookup(e,[Do]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};le.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ao,Do]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};le.prototype.lookupService=function(e){var t=this.lookup(e,[Nl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};le._configure=function(n,e,t){Ao=n,Nl=e,Do=t}});var Hd=w((t7,xx)=>{"use strict";xx.exports=Si;var Ty=ir();((Si.prototype=Object.create(Ty.prototype)).constructor=Si).className="MapField";var UL=ls(),Pl=at();function Si(n,e,t,i,r,s){if(Ty.call(this,n,e,i,void 0,void 0,r,s),!Pl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Si.fromJSON=function(e,t){return new Si(e,t.id,t.keyType,t.type,t.options,t.comment)};Si.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Pl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Si.prototype.resolve=function(){if(this.resolved)return this;if(UL.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Ty.prototype.resolve.call(this)};Si.d=function(e,t,i){return typeof i=="function"?i=Pl.decorateType(i).name:i&&typeof i=="object"&&(i=Pl.decorateEnum(i).name),function(s,o){Pl.decorateType(s.constructor).add(new Si(o,e,t,i))}}});var $d=w((n7,Ix)=>{"use strict";Ix.exports=us;var xy=cs();((us.prototype=Object.create(xy.prototype)).constructor=us).className="Method";var Ro=at();function us(n,e,t,i,r,s,o,a,l){if(Ro.isObject(r)?(o=r,r=s=void 0):Ro.isObject(s)&&(o=s,s=void 0),!(e===void 0||Ro.isString(e)))throw TypeError("type must be a string");if(!Ro.isString(t))throw TypeError("requestType must be a string");if(!Ro.isString(i))throw TypeError("responseType must be a string");xy.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=r?!0:void 0,this.responseType=i,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}us.fromJSON=function(e,t){return new us(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};us.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ro.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};us.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),xy.prototype.resolve.call(this))}});var Wd=w((i7,Dx)=>{"use strict";Dx.exports=gn;var rr=ko();((gn.prototype=Object.create(rr.prototype)).constructor=gn).className="Service";var Iy=$d(),Fl=at(),zL=yy();function gn(n,e){rr.call(this,n,e),this.methods={},this._methodsArray=null}gn.fromJSON=function(e,t){var i=new gn(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)i.add(Iy.fromJSON(r[s],t.methods[r[s]]));return t.nested&&i.addJSON(t.nested),i.comment=t.comment,i};gn.prototype.toJSON=function(e){var t=rr.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return Fl.toObject(["options",t&&t.options||void 0,"methods",rr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};Object.defineProperty(gn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Fl.toArray(this.methods))}});function Ax(n){return n._methodsArray=null,n}gn.prototype.get=function(e){return this.methods[e]||rr.prototype.get.call(this,e)};gn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return rr.prototype.resolve.call(this)};gn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Iy?(this.methods[e.name]=e,e.parent=this,Ax(this)):rr.prototype.add.call(this,e)};gn.prototype.remove=function(e){if(e instanceof Iy){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Ax(this)}return rr.prototype.remove.call(this,e)};gn.prototype.create=function(e,t,i){for(var r=new zL.Service(e,t,i),s=0,o;s<this.methodsArray.length;++s){var a=Fl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");r[a]=Fl.codegen(["r","c"],Fl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return r}});var Kd=w((r7,kx)=>{"use strict";kx.exports=Jn;var jL=Xn();function Jn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Jn.create=function(e){return this.$type.create(e)};Jn.encode=function(e,t){return this.$type.encode(e,t)};Jn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Jn.decode=function(e){return this.$type.decode(e)};Jn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Jn.verify=function(e){return this.$type.verify(e)};Jn.fromObject=function(e){return this.$type.fromObject(e)};Jn.toObject=function(e,t){return this.$type.toObject(e,t)};Jn.prototype.toJSON=function(){return this.$type.toObject(this,jL.toJSONOptions)}});var Ay=w((s7,Mx)=>{"use strict";Mx.exports=$L;var GL=kn(),Ci=ls(),Rx=at();function HL(n){return"missing required '"+n.name+"'"}function $L(n){var e=Rx.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var i=n._fieldsArray[t].resolve(),r=i.resolvedType instanceof GL?"int32":i.type,s="m"+Rx.safeProp(i.name);e("case %i: {",i.id),i.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Ci.defaults[i.keyType]!==void 0?e("k=%j",Ci.defaults[i.keyType]):e("k=null"),Ci.defaults[r]!==void 0?e("value=%j",Ci.defaults[r]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),Ci.basic[r]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",r),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Ci.long[i.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):i.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Ci.packed[r]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,r)("}else"),Ci.basic[r]===void 0?e(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,r)):Ci.basic[r]===void 0?e(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,r),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",HL(o))}return e("return m")}});var Ry=w((o7,Ox)=>{"use strict";Ox.exports=QL;var WL=kn(),Dy=at();function yn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function ky(n,e,t,i){if(e.resolvedType)if(e.resolvedType instanceof WL){n("switch(%s){",i)("default:")("return%j",yn(e,"enum value"));for(var r=Object.keys(e.resolvedType.values),s=0;s<r.length;++s)n("case %i:",e.resolvedType.values[r[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",i)("return%j",yn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",yn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',i)("return%j",yn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',i)("return%j",yn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",i)("return%j",yn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",yn(e,"buffer"));break}return n}function KL(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",yn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",yn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",yn(e,"boolean key"));break}return n}function QL(n){var e=Dy.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,i={};t.length&&e("var p={}");for(var r=0;r<n.fieldsArray.length;++r){var s=n._fieldsArray[r].resolve(),o="m"+Dy.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",yn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),KL(e,s,"k[i]"),ky(e,s,r,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",yn(s,"array"))("for(var i=0;i<%s.length;++i){",o),ky(e,s,r,o+"[i]")("}");else{if(s.partOf){var a=Dy.safeProp(s.partOf.name);i[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,e("p%s=1",a)}ky(e,s,r,o)}s.optional&&e("}")}return e("return null")}});var Ny=w(Px=>{"use strict";var Nx=Px,Ll=kn(),ei=at();function My(n,e,t,i){var r=!1;if(e.resolvedType)if(e.resolvedType instanceof Ll){n("switch(d%s){",i);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!r&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),e.repeated||n("break"),r=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",i,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',i)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,t,i);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",i,i);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,l)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":n("m%s=String(d%s)",i,i);break;case"bool":n("m%s=Boolean(d%s)",i,i);break}}return n}Nx.fromObject=function(e){var t=e.fieldsArray,i=ei.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return i("return new this.ctor");i("var m=new this.ctor");for(var r=0;r<t.length;++r){var s=t[r].resolve(),o=ei.safeProp(s.name);s.map?(i("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),My(i,s,r,o+"[ks[i]]")("}")("}")):s.repeated?(i("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),My(i,s,r,o+"[i]")("}")("}")):(s.resolvedType instanceof Ll||i("if(d%s!=null){",o),My(i,s,r,o),s.resolvedType instanceof Ll||i("}"))}return i("return m")};function Oy(n,e,t,i){if(e.resolvedType)e.resolvedType instanceof Ll?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,t,i,i,t,i,i):n("d%s=types[%i].toObject(m%s,o)",i,t,i);else{var r=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":r=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,r?"true":"",i);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:n("d%s=m%s",i,i);break}}return n}Nx.toObject=function(e){var t=e.fieldsArray.slice().sort(ei.compareFieldsById);if(!t.length)return ei.codegen()("return {}");for(var i=ei.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?r:t[a].map?s:o).push(t[a]);if(r.length){for(i("if(o.arrays||o.defaults){"),a=0;a<r.length;++a)i("d%s=[]",ei.safeProp(r[a].name));i("}")}if(s.length){for(i("if(o.objects||o.defaults){"),a=0;a<s.length;++a)i("d%s={}",ei.safeProp(s[a].name));i("}")}if(o.length){for(i("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=ei.safeProp(l.name);if(l.resolvedType instanceof Ll)i("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else i("d%s=%j",c,l.typeDefault)}i("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=ei.safeProp(l.name);l.map?(d||(d=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Oy(i,l,h,c+"[ks2[j]]")("}")):l.repeated?(i("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Oy(i,l,h,c+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Oy(i,l,h,c),l.partOf&&i("if(o.oneofs)")("d%s=%j",ei.safeProp(l.partOf.name),l.name)),i("}")}return i("return d")}});var Py=w(Fx=>{"use strict";var YL=Fx,XL=Kd();YL[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var i=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return i.indexOf("/")===-1&&(i="/"+i),this.create({type_url:i,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",i="",r="";if(e&&e.json&&n.type_url&&n.value){r=n.type_url.substring(n.type_url.lastIndexOf("/")+1),i=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(r);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof XL){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return i===""&&(i=t),r=i+a,o["@type"]=r,o}return this.toObject(n,e)}}});var Xd=w((c7,Bx)=>{"use strict";Bx.exports=be;var Rn=ko();((be.prototype=Object.create(Rn.prototype)).constructor=be).className="Type";var ZL=kn(),By=Io(),Qd=ir(),JL=Hd(),e2=Wd(),Fy=Kd(),Ly=qd(),t2=Bd(),It=at(),n2=Vy(),i2=Ay(),r2=Ry(),Lx=Ny(),s2=Py();function be(n,e){Rn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(be.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],i=t.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=It.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=It.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=be.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Fy||((n.prototype=new Fy).constructor=n,It.merge(n.prototype,e)),n.$type=n.prototype.$type=this,It.merge(n,Fy,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var i={};for(t=0;t<this.oneofsArray.length;++t)i[this._oneofsArray[t].resolve().name]={get:It.oneOfGetter(this._oneofsArray[t].oneof),set:It.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,i)}}});be.generateConstructor=function(e){for(var t=It.codegen(["p"],e.name),i=0,r;i<e.fieldsArray.length;++i)(r=e._fieldsArray[i]).map?t("this%s={}",It.safeProp(r.name)):r.repeated&&t("this%s=[]",It.safeProp(r.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Yd(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}be.fromJSON=function(e,t){var i=new be(e,t.options);i.extensions=t.extensions,i.reserved=t.reserved;for(var r=Object.keys(t.fields),s=0;s<r.length;++s)i.add((typeof t.fields[r[s]].keyType<"u"?JL.fromJSON:Qd.fromJSON)(r[s],t.fields[r[s]]));if(t.oneofs)for(r=Object.keys(t.oneofs),s=0;s<r.length;++s)i.add(By.fromJSON(r[s],t.oneofs[r[s]]));if(t.nested)for(r=Object.keys(t.nested),s=0;s<r.length;++s){var o=t.nested[r[s]];i.add((o.id!==void 0?Qd.fromJSON:o.fields!==void 0?be.fromJSON:o.values!==void 0?ZL.fromJSON:o.methods!==void 0?e2.fromJSON:Rn.fromJSON)(r[s],o))}return t.extensions&&t.extensions.length&&(i.extensions=t.extensions),t.reserved&&t.reserved.length&&(i.reserved=t.reserved),t.group&&(i.group=!0),t.comment&&(i.comment=t.comment),i};be.prototype.toJSON=function(e){var t=Rn.prototype.toJSON.call(this,e),i=e?!!e.keepComments:!1;return It.toObject(["options",t&&t.options||void 0,"oneofs",Rn.arrayToJSON(this.oneofsArray,e),"fields",Rn.arrayToJSON(this.fieldsArray.filter(function(r){return!r.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])};be.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return Rn.prototype.resolveAll.call(this)};be.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};be.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Qd&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Yd(this)}return e instanceof By?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Yd(this)):Rn.prototype.add.call(this,e)};be.prototype.remove=function(e){if(e instanceof Qd&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Yd(this)}if(e instanceof By){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Yd(this)}return Rn.prototype.remove.call(this,e)};be.prototype.isReservedId=function(e){return Rn.isReservedId(this.reserved,e)};be.prototype.isReservedName=function(e){return Rn.isReservedName(this.reserved,e)};be.prototype.create=function(e){return new this.ctor(e)};be.prototype.setup=function(){for(var e=this.fullName,t=[],i=0;i<this.fieldsArray.length;++i)t.push(this._fieldsArray[i].resolve().resolvedType);this.encode=n2(this)({Writer:t2,types:t,util:It}),this.decode=i2(this)({Reader:Ly,types:t,util:It}),this.verify=r2(this)({types:t,util:It}),this.fromObject=Lx.fromObject(this)({types:t,util:It}),this.toObject=Lx.toObject(this)({types:t,util:It});var r=s2[e];if(r){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(s),s.toObject=this.toObject,this.toObject=r.toObject.bind(s)}return this};be.prototype.encode=function(e,t){return this.setup().encode(e,t)};be.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};be.prototype.decode=function(e,t){return this.setup().decode(e,t)};be.prototype.decodeDelimited=function(e){return e instanceof Ly||(e=Ly.create(e)),this.decode(e,e.uint32())};be.prototype.verify=function(e){return this.setup().verify(e)};be.prototype.fromObject=function(e){return this.setup().fromObject(e)};be.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};be.d=function(e){return function(i){It.decorateType(i,e)}}});var eh=w((u7,jx)=>{"use strict";jx.exports=en;var Jd=ko();((en.prototype=Object.create(Jd.prototype)).constructor=en).className="Root";var Uy=ir(),qx=kn(),o2=Io(),sr=at(),Ux,qy,Bl;function en(n){Jd.call(this,"",n),this.deferred=[],this.files=[]}en.fromJSON=function(e,t){return t||(t=new en),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};en.prototype.resolvePath=sr.path.resolve;en.prototype.fetch=sr.fetch;function zx(){}en.prototype.load=function n(e,t,i){typeof t=="function"&&(i=t,t=void 0);var r=this;if(!i)return sr.asPromise(n,r,e,t);var s=i===zx;function o(m,y){if(i){var v=i;if(i=null,s)throw m;v(m,y)}}function a(m){var y=m.lastIndexOf("google/protobuf/");if(y>-1){var v=m.substring(y);if(v in Bl)return v}return null}function l(m,y){try{if(sr.isString(y)&&y.charAt(0)==="{"&&(y=JSON.parse(y)),!sr.isString(y))r.setOptions(y.options).addJSON(y.nested);else{qy.filename=m;var v=qy(y,r,t),b,D=0;if(v.imports)for(;D<v.imports.length;++D)(b=a(v.imports[D])||r.resolvePath(m,v.imports[D]))&&c(b);if(v.weakImports)for(D=0;D<v.weakImports.length;++D)(b=a(v.weakImports[D])||r.resolvePath(m,v.weakImports[D]))&&c(b,!0)}}catch(E){o(E)}!s&&!u&&o(null,r)}function c(m,y){if(m=a(m)||m,!(r.files.indexOf(m)>-1)){if(r.files.push(m),m in Bl){s?l(m,Bl[m]):(++u,setTimeout(function(){--u,l(m,Bl[m])}));return}if(s){var v;try{v=sr.fs.readFileSync(m).toString("utf8")}catch(b){y||o(b);return}l(m,v)}else++u,r.fetch(m,function(b,D){if(--u,!!i){if(b){y?u||o(null,r):o(b);return}l(m,D)}})}}var u=0;sr.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=r.resolvePath("",e[d]))&&c(h);if(s)return r;u||o(null,r)};en.prototype.loadSync=function(e,t){if(!sr.isNode)throw Error("not supported");return this.load(e,t,zx)};en.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Jd.prototype.resolveAll.call(this)};var Zd=/^[A-Z]/;function Vx(n,e){var t=e.parent.lookup(e.extend);if(t){var i=new Uy(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(i.name)||(i.declaringField=e,e.extensionField=i,t.add(i)),!0}return!1}en.prototype._handleAdd=function(e){if(e instanceof Uy)e.extend!==void 0&&!e.extensionField&&(Vx(this,e)||this.deferred.push(e));else if(e instanceof qx)Zd.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof o2)){if(e instanceof Ux)for(var t=0;t<this.deferred.length;)Vx(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var i=0;i<e.nestedArray.length;++i)this._handleAdd(e._nestedArray[i]);Zd.test(e.name)&&(e.parent[e.name]=e)}};en.prototype._handleRemove=function(e){if(e instanceof Uy){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof qx)Zd.test(e.name)&&delete e.parent[e.name];else if(e instanceof Jd){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);Zd.test(e.name)&&delete e.parent[e.name]}};en._configure=function(n,e,t){Ux=n,qy=e,Bl=t}});var at=w((d7,Hx)=>{"use strict";var He=Hx.exports=Xn(),Gx=vy(),zy,jy;He.codegen=cx();He.fetch=dx();He.path=mx();He.fs=He.inquire("fs");He.toArray=function(e){if(e){for(var t=Object.keys(e),i=new Array(t.length),r=0;r<t.length;)i[r]=e[t[r++]];return i}return[]};He.toObject=function(e){for(var t={},i=0;i<e.length;){var r=e[i++],s=e[i++];s!==void 0&&(t[r]=s)}return t};var a2=/\\/g,l2=/"/g;He.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};He.safeProp=function(e){return!/^[$\w_]+$/.test(e)||He.isReserved(e)?'["'+e.replace(a2,"\\\\").replace(l2,'\\"')+'"]':"."+e};He.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var c2=/_([a-z])/g;He.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(c2,function(t,i){return i.toUpperCase()})};He.compareFieldsById=function(e,t){return e.id-t.id};He.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(He.decorateRoot.remove(e.$type),e.$type.name=t,He.decorateRoot.add(e.$type)),e.$type;zy||(zy=Xd());var i=new zy(t||e.name);return He.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var u2=0;He.decorateEnum=function(e){if(e.$type)return e.$type;jy||(jy=kn());var t=new jy("Enum"+u2++,e);return He.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};He.setProperty=function(e,t,i){function r(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=r(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),r(e,t,i)};Object.defineProperty(He,"decorateRoot",{get:function(){return Gx.decorated||(Gx.decorated=new(eh()))}})});var cs=w((h7,$x)=>{"use strict";$x.exports=tn;tn.className="ReflectionObject";var th=at(),nh;function tn(n,e){if(!th.isString(n))throw TypeError("name must be a string");if(e&&!th.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(tn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});tn.prototype.toJSON=function(){throw Error()};tn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof nh&&t._handleAdd(this)};tn.prototype.onRemove=function(e){var t=e.root;t instanceof nh&&t._handleRemove(this),this.parent=null,this.resolved=!1};tn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof nh&&(this.resolved=!0),this)};tn.prototype.getOption=function(e){if(this.options)return this.options[e]};tn.prototype.setOption=function(e,t,i){return(!i||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};tn.prototype.setParsedOption=function(e,t,i){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(i){var s=r.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];th.setProperty(o,i,t)}else s={},s[e]=th.setProperty({},i,t),r.push(s)}else{var a={};a[e]=t,r.push(a)}return this};tn.prototype.setOptions=function(e,t){if(e)for(var i=Object.keys(e),r=0;r<i.length;++r)this.setOption(i[r],e[i[r]],t);return this};tn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};tn._configure=function(n){nh=n}});var kn=w((f7,Qx)=>{"use strict";Qx.exports=ti;var Wx=cs();((ti.prototype=Object.create(Wx.prototype)).constructor=ti).className="Enum";var Kx=ko(),ih=at();function ti(n,e,t,i,r,s){if(Wx.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=r||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}ti.fromJSON=function(e,t){var i=new ti(e,t.values,t.options,t.comment,t.comments);return i.reserved=t.reserved,i};ti.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ih.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};ti.prototype.add=function(e,t,i,r){if(!ih.isString(e))throw TypeError("name must be a string");if(!ih.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=i||null,this};ti.prototype.remove=function(e){if(!ih.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};ti.prototype.isReservedId=function(e){return Kx.isReservedId(this.reserved,e)};ti.prototype.isReservedName=function(e){return Kx.isReservedName(this.reserved,e)}});var Vy=w((m7,Xx)=>{"use strict";Xx.exports=h2;var d2=kn(),Gy=ls(),Hy=at();function Yx(n,e,t,i){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,i,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,i,(e.id<<3|2)>>>0)}function h2(n){for(var e=Hy.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,i,r=n.fieldsArray.slice().sort(Hy.compareFieldsById),t=0;t<r.length;++t){var s=r[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof d2?"int32":s.type,l=Gy.basic[a];i="m"+Hy.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Gy.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,i):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,i),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",i,i),s.packed&&Gy.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",a,i)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",i),l===void 0?Yx(e,s,o,i+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,i)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),l===void 0?Yx(e,s,o,i):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,i))}return e("return w")}});var Jx=w((p7,Zx)=>{"use strict";var te=Zx.exports=ax();te.build="light";function f2(n,e,t){return typeof e=="function"?(t=e,e=new te.Root):e||(e=new te.Root),e.load(n,t)}te.load=f2;function m2(n,e){return e||(e=new te.Root),e.loadSync(n)}te.loadSync=m2;te.encoder=Vy();te.decoder=Ay();te.verifier=Ry();te.converter=Ny();te.ReflectionObject=cs();te.Namespace=ko();te.Root=eh();te.Enum=kn();te.Type=Xd();te.Field=ir();te.OneOf=Io();te.MapField=Hd();te.Service=Wd();te.Method=$d();te.Message=Kd();te.wrappers=Py();te.types=ls();te.util=at();te.ReflectionObject._configure(te.Root);te.Namespace._configure(te.Type,te.Service,te.Enum);te.Root._configure(te.Type);te.Field._configure(te.Type)});var Wy=w((g7,nI)=>{"use strict";nI.exports=tI;var $y=/[\s{}=;:[\],'"()<>]/g,p2=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,g2=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,y2=/^ *[*/]+ */,v2=/^\s*\*?\/*/,_2=/\n/g,b2=/\s/,w2=/\\(.?)/g,E2={0:"\0",r:"\r",n:`
`,t:"	"};function eI(n){return n.replace(w2,function(e,t){switch(t){case"\\":case"":return t;default:return E2[t]||""}})}tI.unescape=eI;function tI(n,e){n=n.toString();var t=0,i=n.length,r=1,s=0,o={},a=[],l=null;function c(R){return Error("illegal "+R+" (line "+r+")")}function u(){var R=l==="'"?g2:p2;R.lastIndex=t-1;var V=R.exec(n);if(!V)throw c("string");return t=R.lastIndex,b(l),l=null,eI(V[1])}function d(R){return n.charAt(R)}function h(R,V,$){var Z={type:n.charAt(R++),lineEmpty:!1,leading:$},tt;e?tt=2:tt=3;var _t=R-tt,ve;do if(--_t<0||(ve=n.charAt(_t))===`
`){Z.lineEmpty=!0;break}while(ve===" "||ve==="	");for(var C=n.substring(R,V).split(_2),Pe=0;Pe<C.length;++Pe)C[Pe]=C[Pe].replace(e?v2:y2,"").trim();Z.text=C.join(`
`).trim(),o[r]=Z,s=r}function m(R){var V=y(R),$=n.substring(R,V),Z=/^\s*\/\//.test($);return Z}function y(R){for(var V=R;V<i&&d(V)!==`
`;)V++;return V}function v(){if(a.length>0)return a.shift();if(l)return u();var R,V,$,Z,tt,_t=t===0;do{if(t===i)return null;for(R=!1;b2.test($=d(t));)if($===`
`&&(_t=!0,++r),++t===i)return null;if(d(t)==="/"){if(++t===i)throw c("comment");if(d(t)==="/")if(e){if(Z=t,tt=!1,m(t-1)){tt=!0;do if(t=y(t),t===i||(t++,!_t))break;while(m(t))}else t=Math.min(i,y(t)+1);tt&&(h(Z,t,_t),_t=!0),r++,R=!0}else{for(tt=d(Z=t+1)==="/";d(++t)!==`
`;)if(t===i)return null;++t,tt&&(h(Z,t-1,_t),_t=!0),++r,R=!0}else if(($=d(t))==="*"){Z=t+1,tt=e||d(Z)==="*";do{if($===`
`&&++r,++t===i)throw c("comment");V=$,$=d(t)}while(V!=="*"||$!=="/");++t,tt&&(h(Z,t-2,_t),_t=!0),R=!0}else return"/"}}while(R);var ve=t;$y.lastIndex=0;var C=$y.test(d(ve++));if(!C)for(;ve<i&&!$y.test(d(ve));)++ve;var Pe=n.substring(t,t=ve);return(Pe==='"'||Pe==="'")&&(l=Pe),Pe}function b(R){a.push(R)}function D(){if(!a.length){var R=v();if(R===null)return null;b(R)}return a[0]}function E(R,V){var $=D(),Z=$===R;if(Z)return v(),!0;if(!V)throw c("token '"+$+"', '"+R+"' expected");return!1}function k(R){var V=null,$;return R===void 0?($=o[r-1],delete o[r-1],$&&(e||$.type==="*"||$.lineEmpty)&&(V=$.leading?$.text:null)):(s<R&&D(),$=o[R],delete o[R],$&&!$.lineEmpty&&(e||$.type==="/")&&(V=$.leading?null:$.text)),V}return Object.defineProperty({next:v,peek:D,push:b,skip:E,cmnt:k},"line",{get:function(){return r}})}});var lI=w((y7,aI)=>{"use strict";aI.exports=Ti;Ti.filename=null;Ti.defaults={keepCase:!1};var S2=Wy(),iI=eh(),rI=Xd(),sI=ir(),C2=Hd(),oI=Io(),T2=kn(),x2=Wd(),I2=$d(),Ky=ls(),Qy=at(),A2=/^[1-9][0-9]*$/,D2=/^-?[1-9][0-9]*$/,k2=/^0[x][0-9a-fA-F]+$/,R2=/^-?0[x][0-9a-fA-F]+$/,M2=/^0[0-7]+$/,O2=/^-?0[0-7]+$/,N2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ni=/^[a-zA-Z_][a-zA-Z_0-9]*$/,ii=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,P2=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Ti(n,e,t){e instanceof iI||(t=e,e=new iI),t||(t=Ti.defaults);var i=t.preferTrailingComment||!1,r=S2(n,t.alternateCommentMode||!1),s=r.next,o=r.push,a=r.peek,l=r.skip,c=r.cmnt,u=!0,d,h,m,y,v=!1,b=e,D=t.keepCase?function(x){return x}:Qy.camelCase;function E(x,I,M){var G=Ti.filename;return M||(Ti.filename=null),Error("illegal "+(I||"token")+" '"+x+"' ("+(G?G+", ":"")+"line "+r.line+")")}function k(){var x=[],I;do{if((I=s())!=='"'&&I!=="'")throw E(I);x.push(s()),l(I),I=a()}while(I==='"'||I==="'");return x.join("")}function R(x){var I=s();switch(I){case"'":case'"':return o(I),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(I,!0)}catch{if(x&&ii.test(I))return I;throw E(I,"value")}}function V(x,I){var M,G;do I&&((M=a())==='"'||M==="'")?x.push(k()):x.push([G=Z(s()),l("to",!0)?Z(s()):G]);while(l(",",!0));l(";")}function $(x,I){var M=1;switch(x.charAt(0)==="-"&&(M=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return M*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(A2.test(x))return M*parseInt(x,10);if(k2.test(x))return M*parseInt(x,16);if(M2.test(x))return M*parseInt(x,8);if(N2.test(x))return M*parseFloat(x);throw E(x,"number",I)}function Z(x,I){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!I&&x.charAt(0)==="-")throw E(x,"id");if(D2.test(x))return parseInt(x,10);if(R2.test(x))return parseInt(x,16);if(O2.test(x))return parseInt(x,8);throw E(x,"id")}function tt(){if(d!==void 0)throw E("package");if(d=s(),!ii.test(d))throw E(d,"name");b=b.define(d),l(";")}function _t(){var x=a(),I;switch(x){case"weak":I=m||(m=[]),s();break;case"public":s();default:I=h||(h=[]);break}x=k(),l(";"),I.push(x)}function ve(){if(l("="),y=k(),v=y==="proto3",!v&&y!=="proto2")throw E(y,"syntax");l(";")}function C(x,I){switch(I){case"option":return Se(x,I),l(";"),!0;case"message":return T(x,I),!0;case"enum":return pe(x,I),!0;case"service":return Ye(x,I),!0;case"extend":return Ks(x,I),!0}return!1}function Pe(x,I,M){var G=r.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=Ti.filename),l("{",!0)){for(var z;(z=s())!=="}";)I(z);l(";",!0)}else M&&M(),l(";"),x&&(typeof x.comment!="string"||i)&&(x.comment=c(G)||x.comment)}function T(x,I){if(!ni.test(I=s()))throw E(I,"type name");var M=new rI(I);Pe(M,function(z){if(!C(M,z))switch(z){case"map":ie(M,z);break;case"required":case"repeated":f(M,z);break;case"optional":v?f(M,"proto3_optional"):f(M,"optional");break;case"oneof":Ie(M,z);break;case"extensions":V(M.extensions||(M.extensions=[]));break;case"reserved":V(M.reserved||(M.reserved=[]),!0);break;default:if(!v||!ii.test(z))throw E(z);o(z),f(M,"optional");break}}),x.add(M)}function f(x,I,M){var G=s();if(G==="group"){F(x,I);return}for(;G.endsWith(".")||a().startsWith(".");)G+=s();if(!ii.test(G))throw E(G,"type");var z=s();if(!ni.test(z))throw E(z,"name");z=D(z),l("=");var J=new sI(z,Z(s()),G,I,M);if(Pe(J,function(Xt){if(Xt==="option")Se(J,Xt),l(";");else throw E(Xt)},function(){bt(J)}),I==="proto3_optional"){var ht=new oI("_"+z);J.setOption("proto3_optional",!0),ht.add(J),x.add(ht)}else x.add(J);!v&&J.repeated&&(Ky.packed[G]!==void 0||Ky.basic[G]===void 0)&&J.setOption("packed",!1,!0)}function F(x,I){var M=s();if(!ni.test(M))throw E(M,"name");var G=Qy.lcFirst(M);M===G&&(M=Qy.ucFirst(M)),l("=");var z=Z(s()),J=new rI(M);J.group=!0;var ht=new sI(G,z,M,I);ht.filename=Ti.filename,Pe(J,function(Xt){switch(Xt){case"option":Se(J,Xt),l(";");break;case"required":case"repeated":f(J,Xt);break;case"optional":v?f(J,"proto3_optional"):f(J,"optional");break;case"message":T(J,Xt);break;case"enum":pe(J,Xt);break;default:throw E(Xt)}}),x.add(J).add(ht)}function ie(x){l("<");var I=s();if(Ky.mapKey[I]===void 0)throw E(I,"type");l(",");var M=s();if(!ii.test(M))throw E(M,"type");l(">");var G=s();if(!ni.test(G))throw E(G,"name");l("=");var z=new C2(D(G),Z(s()),I,M);Pe(z,function(ht){if(ht==="option")Se(z,ht),l(";");else throw E(ht)},function(){bt(z)}),x.add(z)}function Ie(x,I){if(!ni.test(I=s()))throw E(I,"name");var M=new oI(D(I));Pe(M,function(z){z==="option"?(Se(M,z),l(";")):(o(z),f(M,"optional"))}),x.add(M)}function pe(x,I){if(!ni.test(I=s()))throw E(I,"name");var M=new T2(I);Pe(M,function(z){switch(z){case"option":Se(M,z),l(";");break;case"reserved":V(M.reserved||(M.reserved=[]),!0);break;default:ze(M,z)}}),x.add(M)}function ze(x,I){if(!ni.test(I))throw E(I,"name");l("=");var M=Z(s(),!0),G={options:void 0};G.setOption=function(z,J){this.options===void 0&&(this.options={}),this.options[z]=J},Pe(G,function(J){if(J==="option")Se(G,J),l(";");else throw E(J)},function(){bt(G)}),x.add(I,M,G.comment,G.options)}function Se(x,I){var M=l("(",!0);if(!ii.test(I=s()))throw E(I,"name");var G=I,z=G,J;M&&(l(")"),G="("+G+")",z=G,I=a(),P2.test(I)&&(J=I.slice(1),G+=I,s())),l("=");var ht=Mt(x,G);Fe(x,z,ht,J)}function Mt(x,I){if(l("{",!0)){for(var M={};!l("}",!0);){if(!ni.test(wt=s()))throw E(wt,"name");if(wt===null)throw E(wt,"end of input");var G,z=wt;if(l(":",!0),a()==="{")G=Mt(x,I+"."+wt);else if(a()==="["){G=[];var J;if(l("[",!0)){do J=R(!0),G.push(J);while(l(",",!0));l("]"),typeof J<"u"&&Qe(x,I+"."+wt,J)}}else G=R(!0),Qe(x,I+"."+wt,G);var ht=M[z];ht&&(G=[].concat(ht).concat(G)),M[z]=G,l(",",!0),l(";",!0)}return M}var Vi=R(!0);return Qe(x,I,Vi),Vi}function Qe(x,I,M){x.setOption&&x.setOption(I,M)}function Fe(x,I,M,G){x.setParsedOption&&x.setParsedOption(I,M,G)}function bt(x){if(l("[",!0)){do Se(x,"option");while(l(",",!0));l("]")}return x}function Ye(x,I){if(!ni.test(I=s()))throw E(I,"service name");var M=new x2(I);Pe(M,function(z){if(!C(M,z))if(z==="rpc")Ot(M,z);else throw E(z)}),x.add(M)}function Ot(x,I){var M=c(),G=I;if(!ni.test(I=s()))throw E(I,"name");var z=I,J,ht,Vi,Xt;if(l("("),l("stream",!0)&&(ht=!0),!ii.test(I=s())||(J=I,l(")"),l("returns"),l("("),l("stream",!0)&&(Xt=!0),!ii.test(I=s())))throw E(I);Vi=I,l(")");var ru=new I2(z,G,J,Vi,ht,Xt);ru.comment=M,Pe(ru,function(Vm){if(Vm==="option")Se(ru,Vm),l(";");else throw E(Vm)}),x.add(ru)}function Ks(x,I){if(!ii.test(I=s()))throw E(I,"reference");var M=I;Pe(null,function(z){switch(z){case"required":case"repeated":f(x,z,M);break;case"optional":v?f(x,"proto3_optional",M):f(x,"optional",M);break;default:if(!v||!ii.test(z))throw E(z);o(z),f(x,"optional",M);break}})}for(var wt;(wt=s())!==null;)switch(wt){case"package":if(!u)throw E(wt);tt();break;case"import":if(!u)throw E(wt);_t();break;case"syntax":if(!u)throw E(wt);ve();break;case"option":Se(b,wt),l(";");break;default:if(C(b,wt)){u=!1;continue}throw E(wt)}return Ti.filename=null,{package:d,imports:h,weakImports:m,syntax:y,root:e}}});var dI=w((v7,uI)=>{"use strict";uI.exports=Mn;var F2=/\/|\./;function Mn(n,e){F2.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Mn[n]=e}Mn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var cI;Mn("duration",{Duration:cI={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Mn("timestamp",{Timestamp:cI});Mn("empty",{Empty:{fields:{}}});Mn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Mn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Mn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Mn.get=function(e){return Mn[e]||null}});var fI=w((_7,hI)=>{"use strict";var or=hI.exports=Jx();or.build="full";or.tokenize=Wy();or.parse=lI();or.common=dI();or.Root._configure(or.Type,or.parse,or.common)});var rh=w((b7,mI)=>{"use strict";mI.exports=fI()});var Yy=w((w7,L2)=>{L2.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var _I=w((X,vI)=>{"use strict";var Vt=rh();vI.exports=X=Vt.descriptor=Vt.Root.fromJSON(Yy()).lookup(".google.protobuf");var pI=Vt.Namespace,Vl=Vt.Root,xi=Vt.Enum,ar=Vt.Type,lr=Vt.Field,B2=Vt.MapField,sh=Vt.OneOf,ql=Vt.Service,oh=Vt.Method;Vl.fromDescriptor=function(e){typeof e.length=="number"&&(e=X.FileDescriptorSet.decode(e));var t=new Vl;if(e.file)for(var i,r,s=0,o;s<e.file.length;++s){if(r=t,(i=e.file[s]).package&&i.package.length&&(r=t.define(i.package)),i.name&&i.name.length&&t.files.push(r.filename=i.name),i.messageType)for(o=0;o<i.messageType.length;++o)r.add(ar.fromDescriptor(i.messageType[o],i.syntax));if(i.enumType)for(o=0;o<i.enumType.length;++o)r.add(xi.fromDescriptor(i.enumType[o]));if(i.extension)for(o=0;o<i.extension.length;++o)r.add(lr.fromDescriptor(i.extension[o]));if(i.service)for(o=0;o<i.service.length;++o)r.add(ql.fromDescriptor(i.service[o]));var a=Mo(i.options,X.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)r.setOption(l[o],a[l[o]])}}return t};Vl.prototype.toDescriptor=function(e){var t=X.FileDescriptorSet.create();return gI(this,t.file,e),t};function gI(n,e,t){var i=X.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(i.syntax=t),n instanceof Vl||(i.package=n.fullName.substring(1));for(var r=0,s;r<n.nestedArray.length;++r)(s=n._nestedArray[r])instanceof ar?i.messageType.push(s.toDescriptor(t)):s instanceof xi?i.enumType.push(s.toDescriptor()):s instanceof lr?i.extension.push(s.toDescriptor(t)):s instanceof ql?i.service.push(s.toDescriptor()):s instanceof pI&&gI(s,e,t);i.options=Oo(n.options,X.FileOptions),i.messageType.length+i.enumType.length+i.extension.length+i.service.length&&e.push(i)}var V2=0;ar.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=X.DescriptorProto.decode(e));var i=new ar(e.name.length?e.name:"Type"+V2++,Mo(e.options,X.MessageOptions)),r;if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(sh.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=lr.fromDescriptor(e.field[r],t);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(lr.fromDescriptor(e.extension[r],t));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(ar.fromDescriptor(e.nestedType[r],t)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(xi.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(i.extensions=[],r=0;r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i};ar.prototype.toDescriptor=function(e){var t=X.DescriptorProto.create({name:this.name}),i;for(i=0;i<this.fieldsArray.length;++i){var r;if(t.field.push(r=this._fieldsArray[i].toDescriptor(e)),this._fieldsArray[i]instanceof B2){var s=Xy(this._fieldsArray[i].keyType,this._fieldsArray[i].resolvedKeyType),o=Xy(this._fieldsArray[i].type,this._fieldsArray[i].resolvedType),a=o===11||o===14?this._fieldsArray[i].resolvedType&&yI(this.parent,this._fieldsArray[i].resolvedType)||this._fieldsArray[i].type:void 0;t.nestedType.push(X.DescriptorProto.create({name:r.typeName,field:[X.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),X.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:X.MessageOptions.create({mapEntry:!0})}))}}for(i=0;i<this.oneofsArray.length;++i)t.oneofDecl.push(this._oneofsArray[i].toDescriptor());for(i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof lr?t.field.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof ar?t.nestedType.push(this._nestedArray[i].toDescriptor(e)):this._nestedArray[i]instanceof xi&&t.enumType.push(this._nestedArray[i].toDescriptor());if(this.extensions)for(i=0;i<this.extensions.length;++i)t.extensionRange.push(X.DescriptorProto.ExtensionRange.create({start:this.extensions[i][0],end:this.extensions[i][1]}));if(this.reserved)for(i=0;i<this.reserved.length;++i)typeof this.reserved[i]=="string"?t.reservedName.push(this.reserved[i]):t.reservedRange.push(X.DescriptorProto.ReservedRange.create({start:this.reserved[i][0],end:this.reserved[i][1]}));return t.options=Oo(this.options,X.MessageOptions),t};var q2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;lr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=X.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var i;e.typeName&&e.typeName.length?i=e.typeName:i=H2(e.type);var r;switch(e.label){case 1:r=void 0;break;case 2:r="required";break;case 3:r="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new lr(e.name.length?e.name:"field"+e.number,e.number,i,r,s);if(o.options=Mo(e.options,X.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=q2.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return $2(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};lr.prototype.toDescriptor=function(e){var t=X.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Vt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Xy(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?yI(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Oo(this.options,X.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=X.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=X.FieldOptions.create())).packed=!0),t};var U2=0;xi.fromDescriptor=function(e){typeof e.length=="number"&&(e=X.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var i=0;i<e.value.length;++i){var r=e.value[i].name,s=e.value[i].number||0;t[r&&r.length?r:"NAME"+s]=s}return new xi(e.name&&e.name.length?e.name:"Enum"+U2++,t,Mo(e.options,X.EnumOptions))};xi.prototype.toDescriptor=function(){for(var e=[],t=0,i=Object.keys(this.values);t<i.length;++t)e.push(X.EnumValueDescriptorProto.create({name:i[t],number:this.values[i[t]]}));return X.EnumDescriptorProto.create({name:this.name,value:e,options:Oo(this.options,X.EnumOptions)})};var z2=0;sh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=X.OneofDescriptorProto.decode(e)),new sh(e.name&&e.name.length?e.name:"oneof"+z2++)};sh.prototype.toDescriptor=function(){return X.OneofDescriptorProto.create({name:this.name})};var j2=0;ql.fromDescriptor=function(e){typeof e.length=="number"&&(e=X.ServiceDescriptorProto.decode(e));var t=new ql(e.name&&e.name.length?e.name:"Service"+j2++,Mo(e.options,X.ServiceOptions));if(e.method)for(var i=0;i<e.method.length;++i)t.add(oh.fromDescriptor(e.method[i]));return t};ql.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return X.ServiceDescriptorProto.create({name:this.name,method:e,options:Oo(this.options,X.ServiceOptions)})};var G2=0;oh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=X.MethodDescriptorProto.decode(e)),new oh(e.name&&e.name.length?e.name:"Method"+G2++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Mo(e.options,X.MethodOptions))};oh.prototype.toDescriptor=function(){return X.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Oo(this.options,X.MethodOptions)})};function H2(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function $2(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Xy(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof xi)return 14;if(e instanceof ar)return e.group?10:11;throw Error("illegal type: "+n)}function Mo(n,e){if(n){for(var t=[],i=0,r,s,o;i<e.fieldsArray.length;++i)(s=(r=e._fieldsArray[i]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],r.resolvedType instanceof xi&&typeof o=="number"&&r.resolvedType.valuesById[o]!==void 0&&(o=r.resolvedType.valuesById[o]),t.push(W2(s),o));return t.length?Vt.util.toObject(t):void 0}}function Oo(n,e){if(n){for(var t=[],i=0,r=Object.keys(n),s,o;i<r.length;++i)if(o=n[s=r[i]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Vt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Vt.util.toObject(t)):void 0}}function yI(n,e){var t=n.fullName.split("."),i=e.fullName.split("."),r=0,s=0,o=i.length-1;if(!(n instanceof Vl)&&e instanceof pI)for(;r<t.length&&s<o&&t[r]===i[s];){var a=e.lookup(t[r++],!0);if(a!==null&&a!==e)break;++s}else for(;r<t.length&&s<o&&t[r]===i[s];++r,++s);return i.slice(s).join(".")}function W2(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var bI=w((E7,K2)=>{K2.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var wI=w((S7,Q2)=>{Q2.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var EI=w((C7,Y2)=>{Y2.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var xI=w(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.addCommonProtos=cr.loadProtosWithOptionsSync=cr.loadProtosWithOptions=void 0;var SI=de("fs"),CI=de("path"),No=rh();function TI(n,e){let t=n.resolvePath;n.resolvePath=(i,r)=>{if(CI.isAbsolute(r))return r;for(let s of e){let o=CI.join(s,r);try{return SI.accessSync(o,SI.constants.R_OK),o}catch{continue}}return process.emitWarning(`${r} not found in any of the include paths ${e}`),t(i,r)}}function X2(n,e){return p(this,null,function*(){let t=new No.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));TI(t,e.includeDirs)}let i=yield t.load(n,e);return i.resolveAll(),i})}cr.loadProtosWithOptions=X2;function Z2(n,e){let t=new No.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");TI(t,e.includeDirs)}let i=t.loadSync(n,e);return i.resolveAll(),i}cr.loadProtosWithOptionsSync=Z2;function J2(){let n=bI(),e=Yy(),t=wI(),i=EI();No.common("api",n.nested.google.nested.protobuf.nested),No.common("descriptor",e.nested.google.nested.protobuf.nested),No.common("source_context",t.nested.google.nested.protobuf.nested),No.common("type",i.nested.google.nested.protobuf.nested)}cr.addCommonProtos=J2});var DI=w((AI,Zy)=>{var II=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(T,f,F){this.low=T|0,this.high=f|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function i(T){return(T&&T.__isLong__)===!0}function r(T){var f=Math.clz32(T&-T);return T?31-f:f}t.isLong=i;var s={},o={};function a(T,f){var F,ie,Ie;return f?(T>>>=0,(Ie=0<=T&&T<256)&&(ie=o[T],ie)?ie:(F=c(T,0,!0),Ie&&(o[T]=F),F)):(T|=0,(Ie=-128<=T&&T<128)&&(ie=s[T],ie)?ie:(F=c(T,T<0?-1:0,!1),Ie&&(s[T]=F),F))}t.fromInt=a;function l(T,f){if(isNaN(T))return f?R:k;if(f){if(T<0)return R;if(T>=b)return _t}else{if(T<=-D)return ve;if(T+1>=D)return tt}return T<0?l(-T,f).neg():c(T%v|0,T/v|0,f)}t.fromNumber=l;function c(T,f,F){return new t(T,f,F)}t.fromBits=c;var u=Math.pow;function d(T,f,F){if(T.length===0)throw Error("empty string");if(typeof f=="number"?(F=f,f=!1):f=!!f,T==="NaN"||T==="Infinity"||T==="+Infinity"||T==="-Infinity")return f?R:k;if(F=F||10,F<2||36<F)throw RangeError("radix");var ie;if((ie=T.indexOf("-"))>0)throw Error("interior hyphen");if(ie===0)return d(T.substring(1),f,F).neg();for(var Ie=l(u(F,8)),pe=k,ze=0;ze<T.length;ze+=8){var Se=Math.min(8,T.length-ze),Mt=parseInt(T.substring(ze,ze+Se),F);if(Se<8){var Qe=l(u(F,Se));pe=pe.mul(Qe).add(l(Mt))}else pe=pe.mul(Ie),pe=pe.add(l(Mt))}return pe.unsigned=f,pe}t.fromString=d;function h(T,f){return typeof T=="number"?l(T,f):typeof T=="string"?d(T,f):c(T.low,T.high,typeof f=="boolean"?f:T.unsigned)}t.fromValue=h;var m=65536,y=1<<24,v=m*m,b=v*v,D=b/2,E=a(y),k=a(0);t.ZERO=k;var R=a(0,!0);t.UZERO=R;var V=a(1);t.ONE=V;var $=a(1,!0);t.UONE=$;var Z=a(-1);t.NEG_ONE=Z;var tt=c(-1,2147483647,!1);t.MAX_VALUE=tt;var _t=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_t;var ve=c(0,-2147483648,!1);t.MIN_VALUE=ve;var C=t.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*v+(this.low>>>0):this.high*v+(this.low>>>0)},C.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ve)){var F=l(f),ie=this.div(F),Ie=ie.mul(F).sub(this);return ie.toString(f)+Ie.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var pe=l(u(f,6),this.unsigned),ze=this,Se="";;){var Mt=ze.div(pe),Qe=ze.sub(Mt.mul(pe)).toInt()>>>0,Fe=Qe.toString(f);if(ze=Mt,ze.isZero())return Fe+Se;for(;Fe.length<6;)Fe="0"+Fe;Se=""+Fe+Se}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ve)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,F=31;F>0&&!(f&1<<F);F--);return this.high!=0?F+33:F+1},C.isZero=function(){return this.high===0&&this.low===0},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(this.low&1)===1},C.isEven=function(){return(this.low&1)===0},C.equals=function(f){return i(f)||(f=h(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},C.eq=C.equals,C.notEquals=function(f){return!this.eq(f)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(f){return this.comp(f)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(f){return this.comp(f)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(f){return this.comp(f)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(f){return this.comp(f)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(f){if(i(f)||(f=h(f)),this.eq(f))return 0;var F=this.isNegative(),ie=f.isNegative();return F&&!ie?-1:!F&&ie?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(ve)?ve:this.not().add(V)},C.neg=C.negate,C.add=function(f){i(f)||(f=h(f));var F=this.high>>>16,ie=this.high&65535,Ie=this.low>>>16,pe=this.low&65535,ze=f.high>>>16,Se=f.high&65535,Mt=f.low>>>16,Qe=f.low&65535,Fe=0,bt=0,Ye=0,Ot=0;return Ot+=pe+Qe,Ye+=Ot>>>16,Ot&=65535,Ye+=Ie+Mt,bt+=Ye>>>16,Ye&=65535,bt+=ie+Se,Fe+=bt>>>16,bt&=65535,Fe+=F+ze,Fe&=65535,c(Ye<<16|Ot,Fe<<16|bt,this.unsigned)},C.subtract=function(f){return i(f)||(f=h(f)),this.add(f.neg())},C.sub=C.subtract,C.multiply=function(f){if(this.isZero())return this;if(i(f)||(f=h(f)),e){var F=e.mul(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?R:k;if(this.eq(ve))return f.isOdd()?ve:k;if(f.eq(ve))return this.isOdd()?ve:k;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(E)&&f.lt(E))return l(this.toNumber()*f.toNumber(),this.unsigned);var ie=this.high>>>16,Ie=this.high&65535,pe=this.low>>>16,ze=this.low&65535,Se=f.high>>>16,Mt=f.high&65535,Qe=f.low>>>16,Fe=f.low&65535,bt=0,Ye=0,Ot=0,Ks=0;return Ks+=ze*Fe,Ot+=Ks>>>16,Ks&=65535,Ot+=pe*Fe,Ye+=Ot>>>16,Ot&=65535,Ot+=ze*Qe,Ye+=Ot>>>16,Ot&=65535,Ye+=Ie*Fe,bt+=Ye>>>16,Ye&=65535,Ye+=pe*Qe,bt+=Ye>>>16,Ye&=65535,Ye+=ze*Mt,bt+=Ye>>>16,Ye&=65535,bt+=ie*Fe+Ie*Qe+pe*Mt+ze*Se,bt&=65535,c(Ot<<16|Ks,bt<<16|Ye,this.unsigned)},C.mul=C.multiply,C.divide=function(f){if(i(f)||(f=h(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?R:k;var ie,Ie,pe;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return R;if(f.gt(this.shru(1)))return $;pe=R}else{if(this.eq(ve)){if(f.eq(V)||f.eq(Z))return ve;if(f.eq(ve))return V;var ze=this.shr(1);return ie=ze.div(f).shl(1),ie.eq(k)?f.isNegative()?V:Z:(Ie=this.sub(f.mul(ie)),pe=ie.add(Ie.div(f)),pe)}else if(f.eq(ve))return this.unsigned?R:k;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();pe=k}for(Ie=this;Ie.gte(f);){ie=Math.max(1,Math.floor(Ie.toNumber()/f.toNumber()));for(var Se=Math.ceil(Math.log(ie)/Math.LN2),Mt=Se<=48?1:u(2,Se-48),Qe=l(ie),Fe=Qe.mul(f);Fe.isNegative()||Fe.gt(Ie);)ie-=Mt,Qe=l(ie,this.unsigned),Fe=Qe.mul(f);Qe.isZero()&&(Qe=V),pe=pe.add(Qe),Ie=Ie.sub(Fe)}return pe},C.div=C.divide,C.modulo=function(f){if(i(f)||(f=h(f)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return c(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(f){return i(f)||(f=h(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},C.or=function(f){return i(f)||(f=h(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},C.xor=function(f){return i(f)||(f=h(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},C.shiftLeft=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(f){return i(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(f){var F;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.low<<f|this.high>>>F,this.high<<f|this.low>>>F,this.unsigned)):(f-=32,F=32-f,c(this.high<<f|this.low>>>F,this.low<<f|this.high>>>F,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(f){var F;return i(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.high<<F|this.low>>>f,this.low<<F|this.high>>>f,this.unsigned)):(f-=32,F=32-f,c(this.low<<F|this.high>>>f,this.high<<F|this.low>>>f,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},C.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var f=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},C.toBytesBE=function(){var f=this.high,F=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(f,F,ie){return ie?t.fromBytesLE(f,F):t.fromBytesBE(f,F)},t.fromBytesLE=function(f,F){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,F)},t.fromBytesBE=function(f,F){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],F)};var Pe=t;return n.default=Pe,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return II}):typeof Zy=="object"&&typeof AI=="object"&&(Zy.exports=II)});var nv=w(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.loadFileDescriptorSetFromObject=At.loadFileDescriptorSetFromBuffer=At.fromJSON=At.loadSync=At.load=At.isAnyExtension=At.Long=void 0;var eB=gT(),ri=rh(),ev=_I(),tv=xI(),tB=DI();At.Long=tB;function nB(n){return"@type"in n&&typeof n["@type"]=="string"}At.isAnyExtension=nB;var MI={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function iB(n,e){return n===""?e:n+"."+e}function rB(n){return n instanceof ri.Service||n instanceof ri.Type||n instanceof ri.Enum}function sB(n){return n instanceof ri.Namespace||n instanceof ri.Root}function OI(n,e){let t=iB(e,n.name);return rB(n)?[[t,n]]:sB(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(i=>OI(n.nested[i],t)).reduce((i,r)=>i.concat(r),[]):[]}function kI(n,e){return function(i){return n.toObject(n.decode(i),e)}}function RI(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let i=n.fromObject(t);return n.encode(i).finish()}}function oB(n,e,t,i){let r=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:RI(r),requestDeserialize:kI(r,t),responseSerialize:RI(s),responseDeserialize:kI(s,t),originalName:eB(n.name),requestType:Jy(r,i),responseType:Jy(s,i)}}function aB(n,e,t,i){let r={};for(let s of n.methodsArray)r[s.name]=oB(s,e,t,i);return r}function Jy(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,MI),fileDescriptorProtos:e}}function lB(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,MI),fileDescriptorProtos:e}}function cB(n,e,t,i){if(n instanceof ri.Service)return aB(n,e,t,i);if(n instanceof ri.Type)return Jy(n,i);if(n instanceof ri.Enum)return lB(n,i);throw new Error("Type mismatch in reflection object handling")}function ah(n,e){let t={};n.resolveAll();let r=n.toDescriptor("proto3").file.map(s=>Buffer.from(ev.FileDescriptorProto.encode(s).finish()));for(let[s,o]of OI(n,""))t[s]=cB(o,s,e,r);return t}function NI(n,e){e=e||{};let t=ri.Root.fromDescriptor(n);return t.resolveAll(),ah(t,e)}function uB(n,e){return(0,tv.loadProtosWithOptions)(n,e).then(t=>ah(t,e))}At.load=uB;function dB(n,e){let t=(0,tv.loadProtosWithOptionsSync)(n,e);return ah(t,e)}At.loadSync=dB;function hB(n,e){e=e||{};let t=ri.Root.fromJSON(n);return t.resolveAll(),ah(t,e)}At.fromJSON=hB;function fB(n,e){let t=ev.FileDescriptorSet.decode(n);return NI(t,e)}At.loadFileDescriptorSetFromBuffer=fB;function mB(n,e){let t=ev.FileDescriptorSet.fromObject(n);return NI(t,e)}At.loadFileDescriptorSetFromObject=mB;(0,tv.addCommonProtos)()});var ds=w(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.setup=Ae.getChannelzServiceDefinition=Ae.getChannelzHandlers=Ae.unregisterChannelzRef=Ae.registerChannelzSocket=Ae.registerChannelzServer=Ae.registerChannelzSubchannel=Ae.registerChannelzChannel=Ae.ChannelzCallTracker=Ae.ChannelzChildrenTracker=Ae.ChannelzTrace=void 0;var PI=de("net"),Ul=cn(),jl=ae(),pB=Qn(),gB=Ad(),yB=Jg();function iv(n){return{channel_id:n.id,name:n.name}}function av(n){return{subchannel_id:n.id,name:n.name}}function vB(n){return{server_id:n.id}}function ch(n){return{socket_id:n.id,name:n.name}}var FI=32,rv=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,i){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:i?.kind==="channel"?i:void 0,childSubchannel:i?.kind==="subchannel"?i:void 0}),this.events.length>=FI*2&&(this.events=this.events.slice(FI)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Ii(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Ii(e.timestamp),channel_ref:e.childChannel?iv(e.childChannel):null,subchannel_ref:e.childSubchannel?av(e.childSubchannel):null}))}}};Ae.ChannelzTrace=rv;var sv=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,i,r;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(i=this.subchannelChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(r=this.socketChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:r}of this.channelChildren.values())e.push(r);let t=[];for(let{ref:r}of this.subchannelChildren.values())t.push(r);let i=[];for(let{ref:r}of this.socketChildren.values())i.push(r);return{channels:e,subchannels:t,sockets:i}}};Ae.ChannelzChildrenTracker=sv;var ov=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ae.ChannelzCallTracker=ov;var _B=1;function uh(){return _B++}var zl=[],lv=[],ur=[],cv=[];function bB(n,e,t){let i=uh(),r={id:i,name:n,kind:"channel"};return t&&(zl[i]={ref:r,getInfo:e}),r}Ae.registerChannelzChannel=bB;function wB(n,e,t){let i=uh(),r={id:i,name:n,kind:"subchannel"};return t&&(lv[i]={ref:r,getInfo:e}),r}Ae.registerChannelzSubchannel=wB;function EB(n,e){let t=uh(),i={id:t,kind:"server"};return e&&(ur[t]={ref:i,getInfo:n}),i}Ae.registerChannelzServer=EB;function SB(n,e,t){let i=uh(),r={id:i,name:n,kind:"socket"};return t&&(cv[i]={ref:r,getInfo:e}),r}Ae.registerChannelzSocket=SB;function CB(n){switch(n.kind){case"channel":delete zl[n.id];return;case"subchannel":delete lv[n.id];return;case"server":delete ur[n.id];return;case"socket":delete cv[n.id];return}}Ae.unregisterChannelzRef=CB;function TB(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function LI(n){if(n==="")return[];let e=n.split(":").map(i=>TB(i));return[].concat(...e)}function xB(n){if((0,PI.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,PI.isIPv6)(n)){let e,t,i=n.indexOf("::");i===-1?(e=n,t=""):(e=n.substring(0,i),t=n.substring(i+2));let r=Buffer.from(LI(e)),s=Buffer.from(LI(t)),o=Buffer.alloc(16-r.length-s.length,0);return Buffer.concat([r,o,s])}else return null}function VI(n){switch(n){case Ul.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Ul.ConnectivityState.IDLE:return{state:"IDLE"};case Ul.ConnectivityState.READY:return{state:"READY"};case Ul.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Ul.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Ii(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function qI(n){let e=n.getInfo();return{ref:iv(n.ref),data:{target:e.target,state:VI(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Ii(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>iv(t)),subchannel_ref:e.children.subchannels.map(t=>av(t))}}function IB(n,e){let t=Number.parseInt(n.request.channel_id),i=zl[t];if(i===void 0){e({code:jl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:qI(i)})}function AB(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_channel_id);for(;r<zl.length;r++){let s=zl[r];if(s!==void 0&&(i.push(qI(s)),i.length>=t))break}e(null,{channel:i,end:r>=ur.length})}function UI(n){let e=n.getInfo();return{ref:vB(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Ii(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ch(t))}}function DB(n,e){let t=Number.parseInt(n.request.server_id),i=ur[t];if(i===void 0){e({code:jl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:UI(i)})}function kB(n,e){let t=Number.parseInt(n.request.max_results),i=[],r=Number.parseInt(n.request.start_server_id);for(;r<ur.length;r++){let s=ur[r];if(s!==void 0&&(i.push(UI(s)),i.length>=t))break}e(null,{server:i,end:r>=ur.length})}function RB(n,e){let t=Number.parseInt(n.request.subchannel_id),i=lv[t];if(i===void 0){e({code:jl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let r=i.getInfo(),s={ref:av(i.ref),data:{target:r.target,state:VI(r.state),calls_started:r.callTracker.callsStarted,calls_succeeded:r.callTracker.callsSucceeded,calls_failed:r.callTracker.callsFailed,last_call_started_timestamp:Ii(r.callTracker.lastCallStartedTimestamp),trace:r.trace.getTraceMessage()},socket_ref:r.children.sockets.map(o=>ch(o))};e(null,{subchannel:s})}function BI(n){var e;return(0,pB.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=xB(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function MB(n,e){var t,i,r,s,o;let a=Number.parseInt(n.request.socket_id),l=cv[a];if(l===void 0){e({code:jl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(i=c.security.cipherSuiteOtherName)!==null&&i!==void 0?i:void 0,local_certificate:(r=c.security.localCertificate)!==null&&r!==void 0?r:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:ch(l.ref),local:c.localAddress?BI(c.localAddress):null,remote:c.remoteAddress?BI(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Ii(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Ii(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Ii(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Ii(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function OB(n,e){let t=Number.parseInt(n.request.server_id),i=ur[t];if(i===void 0){e({code:jl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let r=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=i.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=r&&(l.push(ch(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function zI(){return{GetChannel:IB,GetTopChannels:AB,GetServer:DB,GetServers:kB,GetSubchannel:RB,GetSocket:MB,GetServerSockets:OB}}Ae.getChannelzHandlers=zI;var lh=null;function jI(){if(lh)return lh;let n=nv().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return lh=(0,yB.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,lh}Ae.getChannelzServiceDefinition=jI;function NB(){(0,gB.registerAdminService)(jI,zI)}Ae.setup=NB});var GI=w(hh=>{"use strict";Object.defineProperty(hh,"__esModule",{value:!0});hh.Subchannel=void 0;var we=cn(),PB=El(),uv=Ve(),dh=ae(),FB=Jt(),LB=Qn(),Po=ds(),BB="subchannel",VB=~(1<<31),dv=class{constructor(e,t,i,r,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=i,this.credentials=r,this.connector=s,this.connectivityState=we.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Po.ChannelzCallTracker,this.childrenTracker=new Po.ChannelzChildrenTracker,this.streamTracker=new Po.ChannelzCallTracker;let a={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new PB.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,LB.subchannelAddressToString)(t),this.keepaliveTime=(o=i["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Po.ChannelzTrace,this.channelzRef=(0,Po.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(i,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){uv.trace(dh.LogVerbosity.DEBUG,BB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){uv.trace(dh.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([we.ConnectivityState.TRANSIENT_FAILURE],we.ConnectivityState.CONNECTING):this.transitionToState([we.ConnectivityState.TRANSIENT_FAILURE],we.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,VB);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([we.ConnectivityState.CONNECTING],we.ConnectivityState.READY)&&(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(i=>{this.transitionToState([we.ConnectivityState.READY],we.ConnectivityState.IDLE),i&&this.keepaliveTime>0&&(this.keepaliveTime*=2,uv.log(dh.LogVerbosity.ERROR,`Connection to ${(0,FB.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},t=>{this.transitionToState([we.ConnectivityState.CONNECTING],we.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,i){var r,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(we.ConnectivityState[this.connectivityState]+" -> "+we.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+we.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case we.ConnectivityState.READY:this.stopBackoff();break;case we.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case we.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(r=this.transport)===null||r===void 0||r.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case we.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,i);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Po.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([we.ConnectivityState.CONNECTING,we.ConnectivityState.READY],we.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,i,r){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===dh.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,i,r,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([we.ConnectivityState.IDLE],we.ConnectivityState.CONNECTING)||this.connectivityState===we.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([we.ConnectivityState.TRANSIENT_FAILURE],we.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};hh.Subchannel=dv});var pv=w(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.setup=fr.DEFAULT_PORT=void 0;var HI=Wn(),WI=de("dns"),KI=de("util"),qB=xg(),hv=ae(),fv=Bt(),UB=Ve(),zB=ae(),dr=Jt(),$I=de("net"),jB=El(),GB="dns_resolver";function hr(n){UB.trace(zB.LogVerbosity.DEBUG,GB,n)}fr.DEFAULT_PORT=443;var HB=3e4,$B=KI.promisify(WI.resolveTxt),WB=KI.promisify(WI.lookup);function KB(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(i=>i.length));t++)for(let i of n)t<i.length&&e.push(i[t]);return e}var mv=class{constructor(e,t,i){var r,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,hr("Resolver constructed for target "+(0,dr.uriToString)(e));let a=(0,dr.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,$I.isIPv4)(a.host)||(0,$I.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(r=a.port)!==null&&r!==void 0?r:fr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:fr.DEFAULT_PORT),this.percentage=Math.random()*100,i["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:hv.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,dr.uriToString)(this.target)}`,metadata:new fv.Metadata};let l={initialDelay:i["grpc.initial_reconnect_backoff_ms"],maxDelay:i["grpc.max_reconnect_backoff_ms"]};this.backoff=new jB.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=i["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:HB,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(hr("Returning IP address for target "+(0,dr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)hr("Failed to parse DNS address "+(0,dr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:hv.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,dr.uriToString)(this.target)}`,metadata:new fv.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;hr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=WB(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let i=t.filter(o=>o.family===4),r=t.filter(o=>o.family===6);this.latestLookupResult=KB(r,i).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(hr("Resolved addresses for target "+(0,dr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(hr("Resolution error for target "+(0,dr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=$B(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,qB.extractAndSelectServiceConfig)(t,this.percentage)}catch(i){this.latestServiceConfigError={code:hv.Status.UNAVAILABLE,details:`Parsing service config failed with error ${i.message}`,metadata:new fv.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?hr('resolution update delayed by "min time between resolutions" rate limit'):hr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function QB(){(0,HI.registerResolver)("dns",mv),(0,HI.registerDefaultScheme)("dns")}fr.setup=QB});var gv=w(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.getProxiedConnection=Bo.mapProxyName=void 0;var Gl=Ve(),Fo=ae(),YB=Wn(),XB=de("http"),ZB=de("tls"),JB=Ve(),QI=Qn(),Lo=Jt(),eV=de("url"),tV=pv(),nV="proxy";function mr(n){JB.trace(Fo.LogVerbosity.DEBUG,nV,n)}function iV(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new eV.URL(n)}catch{return(0,Gl.log)(Fo.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Gl.log)(Fo.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let i=null;t.username&&(t.password?((0,Gl.log)(Fo.LogVerbosity.INFO,"userinfo found in proxy URI"),i=`${t.username}:${t.password}`):i=t.username);let r=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${r}:${s}`};return i&&(o.creds=i),mr("Proxy server "+o.address+" set by environment variable "+e),o}function rV(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(mr("No proxy server list set by environment variable "+e),n.split(",")):[]}function sV(n,e){var t;let i={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return i;let r=iV();if(!r.address)return i;let s=(0,Lo.splitHostPort)(n.path);if(!s)return i;let o=s.host;for(let l of rV())if(l===o)return mr("Not using proxy for target in no_proxy list: "+(0,Lo.uriToString)(n)),i;let a={"grpc.http_connect_target":(0,Lo.uriToString)(n)};return r.creds&&(a["grpc.http_connect_creds"]=r.creds),{target:{scheme:"dns",path:r.address},extraOptions:a}}Bo.mapProxyName=sV;function oV(n,e,t){var i;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let r=e["grpc.http_connect_target"],s=(0,Lo.parseUri)(r);if(s===null)return Promise.resolve({});let o=(0,Lo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(i=o.port)!==null&&i!==void 0?i:tV.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,QI.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,QI.subchannelAddressToString)(n);return mr("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let m=XB.request(l);m.once("connect",(y,v,b)=>{var D;if(m.removeAllListeners(),v.removeAllListeners(),y.statusCode===200)if(mr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let E=(0,YB.getDefaultAuthority)(s),k=(0,Lo.splitHostPort)(E),R=(D=k?.host)!==null&&D!==void 0?D:E,V=ZB.connect(Object.assign({host:R,servername:R,socket:v},t),()=>{mr("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:V,realTarget:s})});V.on("error",$=>{mr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+$.message),h()})}else mr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:v,realTarget:s});else(0,Gl.log)(Fo.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+y.statusCode),h()}),m.once("error",y=>{m.removeAllListeners(),(0,Gl.log)(Fo.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+y.message),h()}),m.end()})}Bo.getProxiedConnection=oV});var vv=w(fh=>{"use strict";Object.defineProperty(fh,"__esModule",{value:!0});fh.StreamDecoder=void 0;var Ai=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Ai||{}),yv=class{constructor(){this.readState=Ai.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,i,r=[];for(;t<e.length;)switch(this.readState){case Ai.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Ai.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Ai.READING_SIZE:if(i=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+i),this.readSizeRemaining-=i,t+=i,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Ai.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Ai.NO_DATA,r.push(s)}break;case Ai.READING_MESSAGE:if(i=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+i)),this.readMessageRemaining-=i,t+=i,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Ai.NO_DATA,r.push(o)}break;default:throw new Error("Unexpected read state")}return r}};fh.StreamDecoder=yv});var YI=w(mh=>{"use strict";Object.defineProperty(mh,"__esModule",{value:!0});mh.Http2SubchannelCall=void 0;var Di=de("http2"),aV=de("os"),ge=ae(),pr=Bt(),lV=vv(),cV=Ve(),uV=ae(),dV="subchannel_call";function hV(n){for(let[e,t]of Object.entries(aV.constants.errno))if(t===n)return e;return"Unknown system error "+n}var _v=class{constructor(e,t,i,r,s){this.http2Stream=e,this.callEventTracker=t,this.listener=i,this.transport=r,this.callId=s,this.decoder=new lV.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ge.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=ge.Status.INTERNAL;break;case 401:this.mappedStatusCode=ge.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ge.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ge.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ge.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ge.Status.UNKNOWN}if(a&Di.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=pr.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:ge.Status.UNKNOWN,details:u.message,metadata:new pr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===ge.Status.OK)return;let a,l="";switch(e.rstCode){case Di.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=ge.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Di.constants.NGHTTP2_REFUSED_STREAM:a=ge.Status.UNAVAILABLE,l="Stream refused by server";break;case Di.constants.NGHTTP2_CANCEL:a=ge.Status.CANCELLED,l="Call cancelled";break;case Di.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=ge.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Di.constants.NGHTTP2_INADEQUATE_SECURITY:a=ge.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Di.constants.NGHTTP2_INTERNAL_ERROR:a=ge.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=ge.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=ge.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new pr.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+hV(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ge.Status.UNAVAILABLE,details:"Connection dropped",metadata:new pr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){cV.trace(uV.LogVerbosity.DEBUG,dV,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ge.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ge.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let i;try{i=pr.Metadata.fromHttp2Headers(e)}catch{i=new pr.Metadata}let r=i.getMap(),s=this.mappedStatusCode;if(s===ge.Status.UNKNOWN&&typeof r["grpc-status"]=="string"){let l=Number(r["grpc-status"]);l in ge.Status&&(s=l,this.trace("received status code "+l+" from server")),i.remove("grpc-status")}let o="";if(typeof r["grpc-message"]=="string"){try{o=decodeURI(r["grpc-message"])}catch{o=r["grpc-message"]}i.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:i};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ge.Status.OK?t=Di.constants.NGHTTP2_NO_ERROR:t=Di.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new pr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ge.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let i=r=>{process.nextTick(()=>{var s;let o=ge.Status.UNAVAILABLE;r?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ge.Status.INTERNAL),r&&this.cancelWithStatus(o,`Write error: ${r.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,i)}catch(r){this.endCall({code:ge.Status.UNAVAILABLE,details:`Write failed with error ${r.message}`,metadata:new pr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};mh.Http2SubchannelCall=_v});var bv=w(ph=>{"use strict";Object.defineProperty(ph,"__esModule",{value:!0});ph.getNextCallNumber=void 0;var fV=0;function mV(){return fV++}ph.getNextCallNumber=mV});var JI=w(yh=>{"use strict";Object.defineProperty(yh,"__esModule",{value:!0});yh.Http2SubchannelConnector=void 0;var Tv=de("http2"),XI=de("tls"),wv=ds(),Hl=ae(),pV=gv(),qo=Ve(),ZI=Wn(),gh=Qn(),Vo=Jt(),gV=de("net"),yV=YI(),vV=bv(),Ev="transport",_V="transport_flowctrl",bV=lg().version,{HTTP2_HEADER_AUTHORITY:wV,HTTP2_HEADER_CONTENT_TYPE:EV,HTTP2_HEADER_METHOD:SV,HTTP2_HEADER_PATH:CV,HTTP2_HEADER_TE:TV,HTTP2_HEADER_USER_AGENT:xV}=Tv.constants,IV=2e4,AV=Buffer.from("too_many_pings","ascii"),Sv=class{constructor(e,t,i,r){this.session=e,this.remoteName=r,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=IV,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new wv.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,gh.subchannelAddressToString)(t),i["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,wv.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[i["grpc.primary_user_agent"],`grpc-node-js/${bV}`,i["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in i&&(this.keepaliveTimeMs=i["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in i&&(this.keepaliveTimeoutMs=i["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in i?this.keepaliveWithoutCalls=i["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Tv.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(AV)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),qo.isTracerEnabled(Ev)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,i;let r=this.session.socket,s=r.remoteAddress?(0,gh.stringToSubchannelAddress)(r.remoteAddress,r.remotePort):null,o=r.localAddress?(0,gh.stringToSubchannelAddress)(r.localAddress,r.localPort):null,a;if(this.session.encrypted){let c=r,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(i=this.session.state.remoteWindowSize)!==null&&i!==void 0?i:null}}trace(e){qo.trace(Hl.LogVerbosity.DEBUG,Ev,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){qo.trace(Hl.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){qo.trace(Hl.LogVerbosity.DEBUG,_V,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){qo.trace(Hl.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((i,r,s)=>{i&&(this.keepaliveTrace("Ping failed with error "+i.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,i,r,s){let o=e.toHttp2Headers();o[wV]=t,o[xV]=this.userAgent,o[EV]="application/grpc",o[SV]="POST",o[CV]=i,o[TV]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new yV.Http2SubchannelCall(a,l,r,this,(0,vV.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,wv.unregisterChannelzRef)(this.channelzRef)}},Cv=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){qo.trace(Hl.LogVerbosity.DEBUG,Ev,(0,Vo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,i,r){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;r.realTarget?(u=(0,Vo.uriToString)(r.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Vo.uriToString)(r.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,gh.subchannelAddressToString)(e)));let d=(0,ZI.getDefaultAuthority)((a=r.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in i?h.maxSessionMemory=i["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let m="http://";if("secureContext"in h){if(m="https://",i["grpc.ssl_target_name_override"]){let b=i["grpc.ssl_target_name_override"];h.checkServerIdentity=(D,E)=>(0,XI.checkServerIdentity)(b,E),h.servername=b}else{let b=(c=(l=(0,Vo.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=b}r.socket&&(h.createConnection=(b,D)=>r.socket)}else h.createConnection=(b,D)=>r.socket?r.socket:gV.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:i["grpc-node.tls_enable_trace"]===1});let y=Tv.connect(m+d,h);this.session=y;let v="Failed to connect";y.unref(),y.once("connect",()=>{y.removeAllListeners(),s(new Sv(y,e,i,u)),this.session=null}),y.once("close",()=>{this.session=null,setImmediate(()=>{o(`${v} (${new Date().toISOString()})`)})}),y.once("error",b=>{v=b.message,this.trace("connection failed with error "+v)})})}connect(e,t,i){var r,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],i["grpc.ssl_target_name_override"]){let a=i["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,XI.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in i){let a=(0,ZI.getDefaultAuthority)((r=(0,Vo.parseUri)(i["grpc.http_connect_target"]))!==null&&r!==void 0?r:{path:"localhost"}),l=(0,Vo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}i["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,pV.getProxiedConnection)(e,i,o).then(a=>this.createSession(e,t,i,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};yh.Http2SubchannelConnector=Cv});var eA=w(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.getSubchannelPool=Uo.SubchannelPool=void 0;var DV=BC(),kV=GI(),RV=Qn(),MV=Jt(),OV=JI(),NV=1e4,$l=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},NV),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,i,r){this.ensureCleanupTask();let s=(0,MV.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,RV.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,DV.channelOptionsEqual)(i,l.channelArguments)&&r._equals(l.channelCredentials))return l.subchannel}let o=new kV.Subchannel(e,t,i,r,new OV.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:i,channelCredentials:r,subchannel:o}),o.ref(),o}};Uo.SubchannelPool=$l;var PV=new $l;function FV(n){return n?PV:new $l}Uo.getSubchannelPool=FV});var Iv=w(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.FilterStackFactory=zo.FilterStack=void 0;var vh=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let i=0;i<this.filters.length;i++)t=this.filters[i].sendMessage(t);return t}receiveMessage(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let i=this.filters.length-1;i>=0;i--)t=this.filters[i].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};zo.FilterStack=vh;var xv=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new vh(this.factories.map(e=>e.createFilter()))}};zo.FilterStackFactory=xv});var Av=w(_h=>{"use strict";Object.defineProperty(_h,"__esModule",{value:!0});_h.CompressionAlgorithms=void 0;var tA=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(tA||(_h.CompressionAlgorithms=tA={}))});var wh=w(bh=>{"use strict";Object.defineProperty(bh,"__esModule",{value:!0});bh.BaseFilter=void 0;var Dv=class{sendMetadata(e){return p(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return p(this,null,function*(){return e})}receiveMessage(e){return p(this,null,function*(){return e})}receiveTrailers(e){return e}};bh.BaseFilter=Dv});var rA=w(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.CompressionFilterFactory=Go.CompressionFilter=void 0;var Eh=de("zlib"),iA=Av(),LV=ae(),BV=wh(),VV=Ve(),qV=n=>typeof n=="number"&&typeof iA.CompressionAlgorithms[n]=="string",jo=class{writeMessage(e,t){return p(this,null,function*(){let i=e;t&&(i=yield this.compressMessage(i));let r=Buffer.allocUnsafe(i.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(i.length,1),i.copy(r,5),r})}readMessage(e){return p(this,null,function*(){let t=e.readUInt8(0)===1,i=e.slice(5);return t&&(i=yield this.decompressMessage(i)),i})}},hs=class extends jo{compressMessage(e){return p(this,null,function*(){return e})}writeMessage(e,t){return p(this,null,function*(){let i=Buffer.allocUnsafe(e.length+5);return i.writeUInt8(0,0),i.writeUInt32BE(e.length,1),e.copy(i,5),i})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},kv=class extends jo{compressMessage(e){return new Promise((t,i)=>{Eh.deflate(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Eh.inflate(e,(r,s)=>{r?i(r):t(s)})})}},Rv=class extends jo{compressMessage(e){return new Promise((t,i)=>{Eh.gzip(e,(r,s)=>{r?i(r):t(s)})})}decompressMessage(e){return new Promise((t,i)=>{Eh.unzip(e,(r,s)=>{r?i(r):t(s)})})}},Mv=class extends jo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function nA(n){switch(n){case"identity":return new hs;case"deflate":return new kv;case"gzip":return new Rv;default:return new Mv(n)}}var Sh=class extends BV.BaseFilter{constructor(e,t){var i;super(),this.sharedFilterConfig=t,this.sendCompression=new hs,this.receiveCompression=new hs,this.currentCompressionAlgorithm="identity";let r=e["grpc.default_compression_algorithm"];if(r!==void 0)if(qV(r)){let s=iA.CompressionAlgorithms[r],o=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=nA(this.currentCompressionAlgorithm))}else VV.log(LV.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${r}`)}sendMetadata(e){return p(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let r=t[0];typeof r=="string"&&(this.receiveCompression=nA(r))}e.remove("grpc-encoding");let i=e.get("grpc-accept-encoding")[0];return i&&(this.sharedFilterConfig.serverSupportedEncodingHeader=i,i.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new hs,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return p(this,null,function*(){var t;let i=yield e,r;return this.sendCompression instanceof hs?r=!1:r=(((t=i.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(i.message,r),flags:i.flags}})}receiveMessage(e){return p(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Go.CompressionFilter=Sh;var Ov=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Sh(this.options,this.sharedFilterConfig)}};Go.CompressionFilterFactory=Ov});var oA=w(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.MaxMessageSizeFilterFactory=Ho.MaxMessageSizeFilter=void 0;var UV=wh(),Ch=ae(),sA=Bt(),Th=class extends UV.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Ch.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ch.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return p(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:Ch.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new sA.Metadata};return t}})}receiveMessage(e){return p(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:Ch.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new sA.Metadata};return t}})}};Ho.MaxMessageSizeFilter=Th;var Nv=class{constructor(e){this.options=e}createFilter(){return new Th(this.options)}};Ho.MaxMessageSizeFilterFactory=Nv});var xh=w(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.deadlineToString=si.getRelativeTimeout=si.getDeadlineTimeoutString=si.minDeadline=void 0;function zV(...n){let e=1/0;for(let t of n){let i=t instanceof Date?t.getTime():t;i<e&&(e=i)}return e}si.minDeadline=zV;var jV=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function GV(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[i,r]of jV){let s=t/r;if(s<1e8)return String(Math.ceil(s))+i}throw new Error("Deadline is too far in the future")}si.getDeadlineTimeoutString=GV;var HV=2147483647;function $V(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),i=e-t;return i<0?0:i>HV?1/0:i}si.getRelativeTimeout=$V;function WV(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}si.deadlineToString=WV});var Ah=w(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});Ih.restrictControlPlaneStatusCode=void 0;var oi=ae(),KV=[oi.Status.OK,oi.Status.INVALID_ARGUMENT,oi.Status.NOT_FOUND,oi.Status.ALREADY_EXISTS,oi.Status.FAILED_PRECONDITION,oi.Status.ABORTED,oi.Status.OUT_OF_RANGE,oi.Status.DATA_LOSS];function QV(n,e){return KV.includes(n)?{code:oi.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${oi.Status[n]} ${e}`}:{code:n,details:e}}Ih.restrictControlPlaneStatusCode=QV});var lA=w(Rh=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});Rh.LoadBalancingCall=void 0;var aA=cn(),Dh=ae(),YV=xh(),kh=Bt(),Wl=Ji(),XV=Jt(),ZV=Ve(),Pv=Ah(),JV=de("http2"),eq="load_balancing_call",Fv=class{constructor(e,t,i,r,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,XV.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){ZV.trace(Dh.LogVerbosity.DEBUG,eq,"["+this.callNumber+"] "+e)}outputStatus(e,t){var i,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(i=this.listener)===null||i===void 0||i.onReceiveStatus(s),(r=this.onCallEnded)===null||r===void 0||r.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let i=this.channel.doPick(this.metadata,this.callConfig.pickInformation),r=i.subchannel?"("+i.subchannel.getChannelzRef().id+") "+i.subchannel.getAddress():""+i.subchannel;switch(this.trace("Pick result: "+Wl.PickResultType[i.pickResultType]+" subchannel: "+r+" status: "+((e=i.status)===null||e===void 0?void 0:e.code)+" "+((t=i.status)===null||t===void 0?void 0:t.details)),i.pickResultType){case Wl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:Dh.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new kh.Metadata},"PROCESSED"),i.subchannel.getConnectivityState()!==aA.ConnectivityState.READY){this.trace("Picked subchannel "+r+" has state "+aA.ConnectivityState[i.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,YV.getDeadlineTimeoutString)(this.deadline));try{this.child=i.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===JV.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+r+" with error "+h.message),this.outputStatus({code:Dh.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new kh.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=i.onCallStarted)===null||u===void 0||u.call(i),this.onCallEnded=i.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Pv.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:Dh.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new kh.Metadata},"PROCESSED")});break;case Wl.PickResultType.DROP:let{code:s,details:o}=(0,Pv.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:i.status.metadata},"DROP")});break;case Wl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Pv.restrictControlPlaneStatusCode)(i.status.code,i.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:i.status.metadata},"PROCESSED")})}break;case Wl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new kh.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Rh.LoadBalancingCall=Fv});var uA=w(Oh=>{"use strict";Object.defineProperty(Oh,"__esModule",{value:!0});Oh.ResolvingCall=void 0;var $o=ae(),Mh=xh(),cA=Bt(),tq=Ve(),nq=Ah(),iq="resolving_call",Lv=class{constructor(e,t,i,r,s,o){this.channel=e,this.method=t,this.filterStackFactory=r,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=i.deadline,this.host=i.host,i.parentCall&&(i.flags&$o.Propagate.CANCELLATION&&i.parentCall.on("cancelled",()=>{this.cancelWithStatus($o.Status.CANCELLED,"Cancelled by parent call")}),i.flags&$o.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+i.parentCall.getDeadline()),this.deadline=(0,Mh.minDeadline)(this.deadline,i.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){tq.trace($o.LogVerbosity.DEBUG,iq,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Mh.deadlineToString)(this.deadline));let e=(0,Mh.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus($o.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(i=>i(t)),process.nextTick(()=>{var i;(i=this.listener)===null||i===void 0||i.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let i=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(r=>{this.writeFilterPending=!1,i.sendMessageWithContext(e,r.message),this.pendingHalfClose&&i.halfClose()},r=>{this.cancelWithStatus(r.code,r.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==$o.Status.OK){let{code:i,details:r}=(0,nq.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:i,details:r,metadata:new cA.Metadata});return}if(t.methodConfig.timeout){let i=new Date;i.setSeconds(i.getSeconds()+t.methodConfig.timeout.seconds),i.setMilliseconds(i.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Mh.minDeadline)(this.deadline,i),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(i=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(i,{onReceiveMetadata:r=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(r))},onReceiveMessage:r=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(r).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:r=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=r:this.outputStatus(r)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},i=>{this.outputStatus(i)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var i;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(i=this.child)===null||i===void 0||i.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new cA.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Oh.ResolvingCall=Lv});var dA=w(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.RetryingCall=gr.MessageBufferTracker=gr.RetryThrottler=void 0;var Nh=ae(),rq=Bt(),sq=Ve(),oq="retrying_call",Vv=class{constructor(e,t,i){this.maxTokens=e,this.tokenRatio=t,i?this.tokens=i.tokens*(e/i.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};gr.RetryThrottler=Vv;var qv=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var i;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;return this.limitPerCall-r<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var i;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=(i=this.allocatedPerCall.get(t))!==null&&i!==void 0?i:0;if(r<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let i=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<i)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${i} > total allocated ${this.totalAllocated}`);this.totalAllocated-=i,this.allocatedPerCall.delete(e)}};gr.MessageBufferTracker=qv;var Bv="grpc-previous-rpc-attempts",Uv=class{constructor(e,t,i,r,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=i,this.host=r,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){sq.trace(Nh.LogVerbosity.DEBUG,oq,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new rq.Metadata});for(let{call:i}of this.underlyingCalls)i.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let i=this.getBufferEntry(t);i.allocated&&this.bufferTracker.free(i.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Nh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[i,r]of this.underlyingCalls.entries())r.state==="ACTIVE"&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=i);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(i=>i===t||i.toString().toLowerCase()===Nh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let i=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),i}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let i=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(i.maxAttempts,5)){t(!1);return}let r;if(e===null)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,i){var r,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&r!==void 0?r:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(i===null)a=0;else if(i<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=i;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(i,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var i;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Nh.Status.OK){(i=this.retryThrottler)===null||i===void 0||i.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let r=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,r):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,r);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,i;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let s=(e=r.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(i=(t=this.hedgingTimer).unref)===null||i===void 0||i.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let i=this.attempts-1,r=this.initialMetadata.clone();i>0&&r.set(Bv,`${i}`);let s=!1;e.start(r,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,i>0&&o.set(Bv,`${i}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&i>0&&o.metadata.set(Bv,`${i}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,i;let r=this.underlyingCalls[e],s=r.nextMessageToSend;(i=(t=this.getBufferEntry(s)).callback)===null||i===void 0||i.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let i=this.getBufferEntry(t.nextMessageToSend);switch(i.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:r=>{this.handleChildWriteCompleted(e)}},i.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var i;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(i=e.callback)===null||i===void 0||i.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};gr.RetryingCall=Uv});var Fh=w(Ph=>{"use strict";Object.defineProperty(Ph,"__esModule",{value:!0});Ph.BaseSubchannelWrapper=void 0;var zv=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Ph.BaseSubchannelWrapper=zv});var mA=w(Vh=>{"use strict";Object.defineProperty(Vh,"__esModule",{value:!0});Vh.InternalChannel=void 0;var aq=_d(),lq=LC(),cq=eA(),hA=Ji(),Kl=ae(),uq=Iv(),dq=rA(),fA=Wn(),jv=Ve(),hq=oA(),fq=gv(),Lh=Jt(),ai=cn(),Ql=ds(),mq=lA(),pq=xh(),gq=uA(),Gv=bv(),yq=Ah(),Hv=dA(),vq=Fh(),_q=2147483647,bq=1e3,wq=30*60*1e3,Bh=new Map,Eq=1<<24,Sq=1<<20,$v=class extends vq.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(i,r,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Wv=class{constructor(e,t,i){var r,s,o,a,l,c,u,d;if(this.credentials=t,this.options=i,this.connectivityState=ai.ConnectivityState.IDLE,this.currentPicker=new hA.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Ql.ChannelzCallTracker,this.childrenTracker=new Ql.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof aq.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,Lh.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let m=(0,fA.mapUriDefaultScheme)(h);if(m===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},_q),(s=(r=this.callRefTimer).unref)===null||s===void 0||s.call(r),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ql.ChannelzTrace,this.channelzRef=(0,Ql.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,fA.getDefaultAuthority)(m);let y=(0,fq.mapProxyName)(m,i);this.target=y.target,this.options=Object.assign({},this.options,y.extraOptions),this.subchannelPool=(0,cq.getSubchannelPool)(((o=i["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Hv.MessageBufferTracker((a=i["grpc.retry_buffer_size"])!==null&&a!==void 0?a:Eq,(l=i["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:Sq),this.keepaliveTime=(c=i["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=i["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:wq,bq);let v={createSubchannel:(D,E)=>{let k=this.subchannelPool.getOrCreateSubchannel(this.target,D,Object.assign({},this.options,E),this.credentials);k.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",k.getChannelzRef());let R=new $v(k,this);return this.wrappedSubchannels.add(R),R},updateState:(D,E)=>{this.currentPicker=E;let k=this.pickQueue.slice();this.pickQueue=[],k.length>0&&this.callRefTimerUnref();for(let R of k)R.doPick();this.updateState(D)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.refChild(D)},removeChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.unrefChild(D)}};this.resolvingLoadBalancer=new lq.ResolvingLoadBalancer(this.target,v,i,(D,E)=>{D.retryThrottling?Bh.set(this.getTarget(),new Hv.RetryThrottler(D.retryThrottling.maxTokens,D.retryThrottling.tokenRatio,Bh.get(this.getTarget()))):Bh.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=E,this.currentResolutionError=null,process.nextTick(()=>{let k=this.configSelectionQueue;this.configSelectionQueue=[],k.length>0&&this.callRefTimerUnref();for(let R of k)R.getConfig()})},D=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+D.code+' and details "'+D.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,yq.restrictControlPlaneStatusCode)(D.code,D.details)),{metadata:D.metadata}));let E=this.configSelectionQueue;this.configSelectionQueue=[],E.length>0&&this.callRefTimerUnref();for(let k of E)k.reportResolverError(D)}),this.filterStackFactory=new uq.FilterStackFactory([new hq.MaxMessageSizeFilterFactory(this.options),new dq.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(i,void 0,2));let b=new Error;(0,jv.trace)(Kl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=b.stack)===null||d===void 0?void 0:d.substring(b.stack.indexOf(`
`)+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,jv.trace)(t??Kl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Lh.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,i,r;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(r=(i=this.callRefTimer).ref)===null||r===void 0||r.call(i))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(i=>i===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,jv.trace)(Kl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Lh.uriToString)(this.target)+" "+ai.ConnectivityState[this.connectivityState]+" -> "+ai.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ai.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let i of t)e!==i.currentState&&(i.timer&&clearTimeout(i.timer),this.removeConnectivityStateWatcher(i),i.callback());e!==ai.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(ai.ConnectivityState.IDLE),this.currentPicker=new hA.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var e,t;this.connectivityState!==ai.ConnectivityState.SHUTDOWN&&this.callCount===0&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),(t=(e=this.idleTimer).unref)===null||t===void 0||t.call(e))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd(e){this.channelzEnabled&&(e.code===Kl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,i,r,s){let o=(0,Gv.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new mq.LoadBalancingCall(this,e,t,i,r,s,o)}createRetryingCall(e,t,i,r,s){let o=(0,Gv.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Hv.RetryingCall(this,e,t,i,r,s,o,this.retryBufferTracker,Bh.get(this.getTarget()))}createInnerCall(e,t,i,r,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,i,r,s):this.createRetryingCall(e,t,i,r,s)}createResolvingCall(e,t,i,r,s){let o=(0,Gv.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,pq.deadlineToString)(t));let a={deadline:t,flags:s??Kl.Propagate.DEFAULTS,host:i??this.defaultAuthority,parentCall:r},l=new gq.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(ai.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Ql.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Lh.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,i){if(this.connectivityState===ai.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let r=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(i,new Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(s),i(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:i,timer:r};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===ai.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,i,r,s)}};Vh.InternalChannel=Wv});var Xg=w(qh=>{"use strict";Object.defineProperty(qh,"__esModule",{value:!0});qh.ChannelImplementation=void 0;var Cq=_d(),Tq=mA(),Kv=class{constructor(e,t,i){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof Cq.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(i&&typeof i!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new Tq.InternalChannel(e,t,i)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,i){this.internalChannel.watchConnectivityState(e,t,i)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,i,r,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,i,r,s)}};qh.ChannelImplementation=Kv});var CA=w(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.Http2ServerCallStream=vn.ServerDuplexStreamImpl=vn.ServerWritableStreamImpl=vn.ServerReadableStreamImpl=vn.ServerUnaryCallImpl=void 0;var _A=de("events"),Wo=de("http2"),Xv=de("stream"),bA=de("zlib"),wA=de("util"),De=ae(),Zv=Bt(),xq=vv(),EA=Ve(),Xl=fd(),SA="server_call",Iq=(0,wA.promisify)(bA.unzip),Aq=(0,wA.promisify)(bA.inflate);function Yl(n){EA.trace(De.LogVerbosity.DEBUG,SA,n)}var Dq="grpc-accept-encoding",kq="grpc-encoding",pA="grpc-message",gA="grpc-status",yA="grpc-timeout",Rq=/(\d{1,8})\s*([HMSmun])/,Mq={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},Oq={[Dq]:"identity,deflate,gzip",[kq]:"identity"},vA={[Wo.constants.HTTP2_HEADER_STATUS]:Wo.constants.HTTP_STATUS_OK,[Wo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},Nq={waitForTrailers:!0},Qv=class extends _A.EventEmitter{constructor(e,t,i){super(),this.call=e,this.metadata=t,this.request=i,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerUnaryCallImpl=Qv;var Uh=class extends Xv.Readable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=i,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerReadableStreamImpl=Uh;var Zl=class extends Xv.Writable{constructor(e,t,i,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.request=r,this.cancelled=!1,this.trailingMetadata=new Zv.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,i){try{let r=this.call.serializeMessage(e);if(!this.call.write(r)){this.call.once("drain",i);return}}catch(r){this.emit("error",{details:(0,Xl.getErrorMessage)(r),code:De.Status.INTERNAL})}i()}_final(e){this.call.sendStatus({code:De.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerWritableStreamImpl=Zl;var Ko=class extends Xv.Duplex{constructor(e,t,i,r,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=i,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new Zv.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerDuplexStreamImpl=Ko;Ko.prototype._read=Uh.prototype._read;Ko.prototype._write=Zl.prototype._write;Ko.prototype._final=Zl.prototype._final;var Yv=class extends _A.EventEmitter{constructor(e,t,i){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=De.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=De.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",r=>{}),this.stream.once("close",()=>{var r;Yl("Request to method "+((r=this.handler)===null||r===void 0?void 0:r.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:De.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in i&&(this.maxSendMessageSize=i["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in i&&(this.maxReceiveMessageSize=i["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?Aq(e.subarray(5)):t==="gzip"?Iq(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:De.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,i=Object.assign(Object.assign(Object.assign({},vA),Oq),t);this.stream.respond(i,Nq)}receiveMetadata(e){let t=Zv.Metadata.fromHttp2Headers(e);EA.isTracerEnabled(SA)&&Yl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let i=t.get(yA);if(i.length>0){let r=i[0].toString().match(Rq);if(r===null){let a=new Error("Invalid deadline");return a.code=De.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+r[1]*Mq[r[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(Pq,s,this),t.remove(yA)}return t.remove(Wo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Wo.constants.HTTP2_HEADER_TE),t.remove(Wo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,i)=>{let{stream:r}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),i({code:De.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(r.removeListener("data",c),r.removeListener("end",u),r.removeListener("error",u),d!==void 0){i({code:De.Status.INTERNAL,details:d.message});return}if(s===0){i({code:De.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),y=h.readUInt8(0)===1?e:"identity",v=o.getDecompressedMessage(h,y);if(Buffer.isBuffer(v)){t(o.deserializeMessageWithInternalError(v));return}v.then(b=>t(o.deserializeMessageWithInternalError(b)),b=>i(b.code?b:{code:De.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return p(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Xl.getErrorMessage)(t),code:De.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),i=t.byteLength,r=Buffer.allocUnsafe(i+5);return r.writeUInt8(0,0),r.writeUInt32BE(i,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,i,r){return p(this,null,function*(){if(!this.checkCancelled()){if(i===void 0&&(i=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&i&&(e.metadata=i),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:De.Status.OK,details:"OK",metadata:i})}catch(s){this.sendError({details:(0,Xl.getErrorMessage)(s),code:De.Status.INTERNAL})}}})}sendStatus(e){var t,i;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===De.Status.OK),!this.checkCancelled())if(Yl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+De.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var r;let s=Object.assign({[gA]:e.code,[pA]:encodeURI(e.details)},(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let r=Object.assign(Object.assign({[gA]:e.code,[pA]:encodeURI(e.details)},vA),(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.respond(r,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:De.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:De.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let i=new xq.StreamDecoder,r=!1,s=!1,o=!1,a=()=>p(this,null,function*(){!o&&r&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>p(this,null,function*(){let c=i.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:De.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",m=yield this.getDecompressedMessage(u,h);if(!m)return;yield this.pushOrBufferMessage(e,m)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>p(this,null,function*(){r=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),i=e.push(t);if(t===null||i===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return p(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return p(this,null,function*(){if(t===null){Yl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Yl("Received message of length "+t.length),this.isPushPending=!0;try{let i=yield this.deserializeMessage(t);this.canPush?e.push(i)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(i)}catch(i){this.bufferedMessages.length=0;let r=(0,Xl.getErrorCode)(i);(r===null||r<De.Status.OK||r>De.Status.UNAUTHENTICATED)&&(r=De.Status.INTERNAL),e.emit("error",{details:(0,Xl.getErrorMessage)(i),code:r})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};vn.Http2ServerCallStream=Yv;function Pq(n){let e=new Error("Deadline exceeded");e.code=De.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var t_=w(zh=>{"use strict";Object.defineProperty(zh,"__esModule",{value:!0});zh.ServerCredentials=void 0;var TA=wg(),Jl=class{static createInsecure(){return new Jv}static createSsl(e,t,i=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof i!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let r=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);r.push(a.cert_chain),s.push(a.private_key)}return new e_({ca:e||(0,TA.getDefaultRootsData)()||void 0,cert:r,key:s,requestCert:i,ciphers:TA.CIPHER_SUITES})}};zh.ServerCredentials=Jl;var Jv=class extends Jl{_isSecure(){return!1}_getSettings(){return null}},e_=class extends Jl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var AA=w(Hh=>{"use strict";Object.defineProperty(Hh,"__esModule",{value:!0});Hh.Server=void 0;var yr=de("http2"),ki=ae(),fs=CA(),Fq=t_(),xA=Wn(),jh=Ve(),On=Qn(),Lq=Jt(),Qt=ds(),Gh=~(1<<31),Bq=~(1<<31),Vq=2e4,{HTTP2_HEADER_PATH:IA}=yr.constants,qq="server";function Uq(){}function n_(n){return{code:ki.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function zq(n,e){let t=n_(e);switch(n){case"unary":return(i,r)=>{r(t,null)};case"clientStream":return(i,r)=>{r(t,null)};case"serverStream":return i=>{i.emit("error",t)};case"bidi":return i=>{i.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var i_=class{constructor(e){var t,i,r,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Qt.ChannelzTrace,this.callTracker=new Qt.ChannelzCallTracker,this.listenerChildrenTracker=new Qt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Qt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Qt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Gh,this.maxConnectionAgeGraceMs=(i=this.options["grpc.max_connection_age_grace_ms"])!==null&&i!==void 0?i:Gh,this.keepaliveTimeMs=(r=this.options["grpc.keepalive_time_ms"])!==null&&r!==void 0?r:Bq,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:Vq,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,i,r;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,On.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,On.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),m=d.getCertificate(),y=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(i=e.state.localWindowSize)!==null&&i!==void 0?i:null,remoteFlowControlWindow:(r=e.state.remoteWindowSize)!==null&&r!==void 0?r:null}}}trace(e){jh.trace(ki.LogVerbosity.DEBUG,qq,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let i=Object.keys(e);if(i.length===0)throw new Error("Cannot add an empty service to a server");i.forEach(r=>{let s=e[r],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[r],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=zq(o,r),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(i=>{let r=e[i];this.unregister(r.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,i){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof Fq.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof i!="function")throw new TypeError("callback must be a function");let r=(0,Lq.parseUri)(e);if(r===null)throw new Error(`Could not parse port "${e}"`);let s=(0,xA.mapUriDefaultScheme)(r);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(m,y)=>{process.nextTick(()=>i(m,y))},l=()=>{let m;if(t._isSecure()){let y=Object.assign(o,t._getSettings());y.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,m=yr.createSecureServer(y),m.on("secureConnection",v=>{v.on("error",b=>{this.trace("An incoming TLS connection closed with error: "+b.message)})})}else m=yr.createServer(o);return m.setTimeout(0,Uq),this._setupHandlers(m),m},c=(m,y,v)=>m.length===0?Promise.resolve({port:y,count:v}):Promise.all(m.map(b=>{this.trace("Attempting to bind "+(0,On.subchannelAddressToString)(b));let D;(0,On.isTcpSubchannelAddress)(b)?D={host:b.host,port:y}:D=b;let E=l();return new Promise((k,R)=>{let V=$=>{this.trace("Failed to bind "+(0,On.subchannelAddressToString)(b)+" with error "+$.message),k($)};E.once("error",V),E.listen(D,()=>{if(this.shutdown){E.close(),k(new Error("bindAsync failed because server is shutdown"));return}let $=E.address(),Z;typeof $=="string"?Z={path:$}:Z={host:$.address,port:$.port};let tt=(0,Qt.registerChannelzSocket)((0,On.subchannelAddressToString)(Z),()=>({localAddress:Z,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(tt),this.http2ServerList.push({server:E,channelzRef:tt}),this.trace("Successfully bound "+(0,On.subchannelAddressToString)(Z)),k("port"in Z?Z.port:y),E.removeListener("error",V)})})})).then(b=>{let D=0;for(let E of b)if(typeof E=="number"&&(D+=1,E!==y))throw new Error("Invalid state: multiple port numbers added from single address");return{port:y,count:D+v}}),u=m=>{if(m.length===0)return Promise.resolve({port:0,count:0});let y=m[0],v=l();return new Promise((b,D)=>{let E=k=>{this.trace("Failed to bind "+(0,On.subchannelAddressToString)(y)+" with error "+k.message),b(u(m.slice(1)))};v.once("error",E),v.listen(y,()=>{if(this.shutdown){v.close(),b({port:0,count:0});return}let k=v.address(),R={host:k.address,port:k.port},V=(0,Qt.registerChannelzSocket)((0,On.subchannelAddressToString)(R),()=>({localAddress:R,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(V),this.http2ServerList.push({server:v,channelzRef:V}),this.trace("Successfully bound "+(0,On.subchannelAddressToString)(R)),b(c(m.slice(1),k.port,1)),v.removeListener("error",E)})})},d={onSuccessfulResolution:(m,y,v)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),m.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let b;(0,On.isTcpSubchannelAddress)(m[0])?m[0].port===0?b=u(m):b=c(m,m[0].port,0):b=c(m,1,0),b.then(D=>{if(D.count===0){let E=`No address added out of total ${m.length} resolved`;jh.log(ki.LogVerbosity.ERROR,E),a(new Error(E),0)}else D.count<m.length&&jh.log(ki.LogVerbosity.INFO,`WARNING Only ${D.count} addresses added out of total ${m.length} resolved`),a(null,D.port)},D=>{let E=`No address added out of total ${m.length} resolved`;jh.log(ki.LogVerbosity.ERROR,E),a(new Error(E),0)})},onError:m=>{a(new Error(m.details),0)}};(0,xA.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Qt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(yr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Qt.unregisterChannelzRef)(this.channelzRef)}register(e,t,i,r,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:i,deserialize:r,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Qt.unregisterChannelzRef)(this.channelzRef),e(s)},i=0;function r(){i--,i===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(i++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Qt.unregisterChannelzRef)(o)),r()}));this.sessions.forEach((s,o)=>{o.closed||(i+=1,o.close(r))}),i===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let i=t[yr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof i!="string"||!i.startsWith("application/grpc")?(e.respond({[yr.constants.HTTP2_HEADER_STATUS]:yr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,i=null){let r=new fs.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=ki.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let i=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),i?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed();return}let r=t[IA],s=this._retrieveHandler(r);if(!s){this._respondWithError(n_(r),e,i);return}let o=new fs.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===ki.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),i&&(o.once("streamEnd",a=>{a?i.streamTracker.addCallSucceeded():i.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{i.messagesSent+=1,i.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{i.messagesReceived+=1,i.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),i?.streamTracker.addCallFailed(),o.sendError({code:ki.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let i=t[IA],r=this._retrieveHandler(i);if(!r){this._respondWithError(n_(i),e,null);return}let s=new fs.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(s,r,t)||s.sendError({code:ki.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,i){var r;let s=e.receiveMetadata(i),o=(r=s.get("grpc-encoding")[0])!==null&&r!==void 0?r:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")jq(e,t,s,o);else if(a==="clientStream")Gq(e,t,s,o);else if(a==="serverStream")Hq(e,t,s,o);else if(a==="bidi")$q(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),i="null";t&&(typeof t=="string"?i=t:i=t.address+":"+t.port),this.serverAddressString=i;let r=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",r.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Qt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new Qt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let m=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+m),this.sessionChildrenTracker.refChild(d));let y=null,v=null,b=!1;if(this.maxConnectionAgeMs!==Gh){let E=this.maxConnectionAgeMs/10,k=Math.random()*E*2-E;y=(l=(a=setTimeout(()=>{var R,V;b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+m);try{s.goaway(yr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Gh&&(v=(V=(R=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||V===void 0?void 0:V.call(R))},this.maxConnectionAgeMs+k)).unref)===null||l===void 0?void 0:l.call(a)}let D=(u=(c=setInterval(()=>{var E,k;let R=(k=(E=setTimeout(()=>{b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+m),s.close()},this.keepaliveTimeoutMs)).unref)===null||k===void 0?void 0:k.call(E);try{s.ping((V,$,Z)=>{clearTimeout(R)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(b||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+m),this.sessionChildrenTracker.unrefChild(d),(0,Qt.unregisterChannelzRef)(d)),y&&clearTimeout(y),v&&clearTimeout(v),D&&clearTimeout(D),this.sessions.delete(s)})})}};Hh.Server=i_;function jq(n,e,t,i){return p(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new fs.ServerUnaryCallImpl(n,t,r);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(r){n.sendError(r)}})}function Gq(n,e,t,i){let r=new fs.ServerReadableStreamImpl(n,t,e.deserialize,i);function s(o,a,l,c){r.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(r.on("error",s),e.func(r,s))}function Hq(n,e,t,i){return p(this,null,function*(){try{let r=yield n.receiveUnaryMessage(i);if(r===void 0||n.cancelled)return;let s=new fs.ServerWritableStreamImpl(n,t,e.serialize,r);e.func(s)}catch(r){n.sendError(r)}})}function $q(n,e,t,i){let r=new fs.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,i);n.cancelled||e.func(r)}});var DA=w($h=>{"use strict";Object.defineProperty($h,"__esModule",{value:!0});$h.StatusBuilder=void 0;var r_=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};$h.StatusBuilder=r_});var s_=w(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.isDuration=vr.durationToMs=vr.msToDuration=void 0;function Wq(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}vr.msToDuration=Wq;function Kq(n){return n.seconds*1e3+n.nanos/1e6|0}vr.durationToMs=Kq;function Qq(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}vr.isDuration=Qq});var f_=w(_r=>{"use strict";var o_;Object.defineProperty(_r,"__esModule",{value:!0});_r.setup=_r.OutlierDetectionLoadBalancer=_r.OutlierDetectionLoadBalancingConfig=void 0;var Kh=cn(),RA=ae(),ms=s_(),MA=m_(),OA=Qi(),Yq=xd(),Xq=Ji(),kA=Qn(),Zq=Fh(),Jq=Ve(),e3="outlier_detection";function lt(n){Jq.trace(RA.LogVerbosity.DEBUG,e3,n)}var h_="outlier_detection",t3=((o_=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&o_!==void 0?o_:"true")==="true",n3={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},i3={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Qo(n,e,t,i){if(e in n&&typeof n[e]!==t){let r=i?`${i}.${e}`:e;throw new Error(`outlier detection config ${r} parse error: expected ${t}, got ${typeof n[e]}`)}}function a_(n,e,t){let i=t?`${t}.${e}`:e;if(e in n){if(!(0,ms.isDuration)(n[e]))throw new Error(`outlier detection config ${i} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${i} parse error: values out of range for non-negative Duaration`)}}function Wh(n,e,t){let i=t?`${t}.${e}`:e;if(Qo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${i} parse error: value out of range for percentage (0-100)`)}var ec=class n{constructor(e,t,i,r,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=i??3e5,this.maxEjectionPercent=r??10,this.successRateEjection=s?Object.assign(Object.assign({},n3),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},i3),o):null}getLoadBalancerName(){return h_}toJsonObject(){return{interval:(0,ms.msToDuration)(this.intervalMs),base_ejection_time:(0,ms.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ms.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(a_(e,"interval"),a_(e,"base_ejection_time"),a_(e,"max_ejection_time"),Wh(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Qo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Wh(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Qo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Qo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Wh(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Wh(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Qo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Qo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ms.durationToMs)(e.interval):null,e.base_ejection_time?(0,ms.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ms.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(OA.validateLoadBalancingConfig))}};_r.OutlierDetectionLoadBalancingConfig=ec;var c_=class extends Zq.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((i,r,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,r,s,o)})}getConnectivityState(){return this.ejected?Kh.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Kh.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Kh.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function l_(){return{success:0,failure:0}}var u_=class{constructor(){this.activeBucket=l_(),this.inactiveBucket=l_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=l_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},d_=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===Xq.PickResultType.COMPLETE){let i=t.subchannel,r=i.getMapEntry();if(r){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===RA.Status.OK?r.counter.addSuccess():r.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:i.getWrappedSubchannel()})}else return t}},Qh=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new Yq.ChildLoadBalancerHandler((0,MA.createChildChannelControlHelper)(e,{createSubchannel:(t,i)=>{let r=e.createSubchannel(t,i),s=this.addressMap.get((0,kA.subchannelAddressToString)(t)),o=new c_(r,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,i)=>{t===Kh.ConnectivityState.READY?e.updateState(t,new d_(i,this.isCountingEnabled())):e.updateState(t,i)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;lt("Running success rate check");let i=t.request_volume,r=0,s=[];for(let[d,h]of this.addressMap){let m=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();lt("Stats for "+d+": successes="+m+" failures="+y+" targetRequestVolume="+i),m+y>=i&&(r+=1,s.push(m/(m+y)))}if(lt("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),r<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);lt("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let m=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();if(m+y<i)continue;let v=m/(m+y);if(lt("Checking candidate "+d+" successRate="+v),v<u){let b=Math.random()*100;lt("Candidate "+d+" randomNumber="+b+" enforcement_percentage="+t.enforcement_percentage),b<t.enforcement_percentage&&(lt("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;lt("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let i=0;for(let r of this.addressMap.values()){let s=r.counter.getLastSuccesses(),o=r.counter.getLastFailures();s+o>=t.request_volume&&(i+=1)}if(!(i<t.minimum_hosts))for(let[r,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(lt("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;lt("Candidate "+r+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(lt("Ejecting candidate "+r),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let i of e.subchannelWrappers)i.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,i;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(i=(t=this.ejectionTimer).unref)===null||i===void 0||i.call(t)}runChecks(){let e=new Date;if(lt("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,i]of this.addressMap.entries())if(i.currentEjectionTimestamp===null)i.ejectionTimeMultiplier>0&&(i.ejectionTimeMultiplier-=1);else{let r=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(i.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(r*i.ejectionTimeMultiplier,Math.max(r,s))),o<new Date&&(lt("Unejecting "+t),this.uneject(i))}}}updateAddressList(e,t,i){if(!(t instanceof ec))return;let r=new Set;for(let o of e)r.add((0,kA.subchannelAddressToString)(o));for(let o of r)this.addressMap.has(o)||(lt("Adding map entry for "+o),this.addressMap.set(o,{counter:new u_,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())r.has(o)||(lt("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,OA.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,i),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){lt("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else lt("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{lt("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return h_}};_r.OutlierDetectionLoadBalancer=Qh;function r3(){t3&&(0,MA.registerLoadBalancerType)(h_,Qh,ec)}_r.setup=r3});var m_=w(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.OutlierDetectionLoadBalancingConfig=K.BaseSubchannelWrapper=K.registerAdminService=K.FilterStackFactory=K.BaseFilter=K.PickResultType=K.QueuePicker=K.UnavailablePicker=K.ChildLoadBalancerHandler=K.subchannelAddressToString=K.validateLoadBalancingConfig=K.getFirstUsableConfig=K.registerLoadBalancerType=K.createChildChannelControlHelper=K.BackoffTimeout=K.durationToMs=K.uriToString=K.createResolver=K.registerResolver=K.log=K.trace=void 0;var NA=Ve();Object.defineProperty(K,"trace",{enumerable:!0,get:function(){return NA.trace}});Object.defineProperty(K,"log",{enumerable:!0,get:function(){return NA.log}});var PA=Wn();Object.defineProperty(K,"registerResolver",{enumerable:!0,get:function(){return PA.registerResolver}});Object.defineProperty(K,"createResolver",{enumerable:!0,get:function(){return PA.createResolver}});var s3=Jt();Object.defineProperty(K,"uriToString",{enumerable:!0,get:function(){return s3.uriToString}});var o3=s_();Object.defineProperty(K,"durationToMs",{enumerable:!0,get:function(){return o3.durationToMs}});var a3=El();Object.defineProperty(K,"BackoffTimeout",{enumerable:!0,get:function(){return a3.BackoffTimeout}});var Yh=Qi();Object.defineProperty(K,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Yh.createChildChannelControlHelper}});Object.defineProperty(K,"registerLoadBalancerType",{enumerable:!0,get:function(){return Yh.registerLoadBalancerType}});Object.defineProperty(K,"getFirstUsableConfig",{enumerable:!0,get:function(){return Yh.getFirstUsableConfig}});Object.defineProperty(K,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Yh.validateLoadBalancingConfig}});var l3=Qn();Object.defineProperty(K,"subchannelAddressToString",{enumerable:!0,get:function(){return l3.subchannelAddressToString}});var c3=xd();Object.defineProperty(K,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c3.ChildLoadBalancerHandler}});var p_=Ji();Object.defineProperty(K,"UnavailablePicker",{enumerable:!0,get:function(){return p_.UnavailablePicker}});Object.defineProperty(K,"QueuePicker",{enumerable:!0,get:function(){return p_.QueuePicker}});Object.defineProperty(K,"PickResultType",{enumerable:!0,get:function(){return p_.PickResultType}});var u3=wh();Object.defineProperty(K,"BaseFilter",{enumerable:!0,get:function(){return u3.BaseFilter}});var d3=Iv();Object.defineProperty(K,"FilterStackFactory",{enumerable:!0,get:function(){return d3.FilterStackFactory}});var h3=Ad();Object.defineProperty(K,"registerAdminService",{enumerable:!0,get:function(){return h3.registerAdminService}});var f3=Fh();Object.defineProperty(K,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return f3.BaseSubchannelWrapper}});var m3=f_();Object.defineProperty(K,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return m3.OutlierDetectionLoadBalancingConfig}})});var FA=w(Xh=>{"use strict";Object.defineProperty(Xh,"__esModule",{value:!0});Xh.setup=void 0;var p3=Wn(),g_=class{constructor(e,t,i){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let r;e.authority===""?r="/"+e.path:r=e.path,this.addresses=[{path:r}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function g3(){(0,p3.registerResolver)("unix",g_)}Xh.setup=g3});var UA=w(ef=>{"use strict";Object.defineProperty(ef,"__esModule",{value:!0});ef.setup=void 0;var LA=de("net"),Zh=ae(),y_=Bt(),BA=Wn(),VA=Jt(),y3=Ve(),v3="ip_resolver";function qA(n){y3.trace(Zh.LogVerbosity.DEBUG,v3,n)}var v_="ipv4",__="ipv6",_3=443,Jh=class{constructor(e,t,i){var r;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,qA("Resolver constructed for target "+(0,VA.uriToString)(e));let s=[];if(!(e.scheme===v_||e.scheme===__)){this.error={code:Zh.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new y_.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,VA.splitHostPort)(a);if(l===null){this.error={code:Zh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new y_.Metadata};return}if(e.scheme===v_&&!(0,LA.isIPv4)(l.host)||e.scheme===__&&!(0,LA.isIPv6)(l.host)){this.error={code:Zh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new y_.Metadata};return}s.push({host:l.host,port:(r=l.port)!==null&&r!==void 0?r:_3})}this.addresses=s,qA("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function b3(){(0,BA.registerResolver)(v_,Jh),(0,BA.registerResolver)(__,Jh)}ef.setup=b3});var GA=w(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.setup=li.PickFirstLoadBalancer=li.shuffled=li.PickFirstLoadBalancingConfig=void 0;var zA=Qi(),Dt=cn(),tf=Ji(),w3=Ve(),E3=ae(),S3="pick_first";function b_(n){w3.trace(E3.LogVerbosity.DEBUG,S3,n)}var tc="pick_first",C3=250,nc=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return tc}toJsonObject(){return{[tc]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};li.PickFirstLoadBalancingConfig=nc;var w_=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:tf.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function jA(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let i=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[i],e[i]=r}return e}li.shuffled=jA;var nf=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Dt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.onSubchannelStateUpdate(t,i,r,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Dt.ConnectivityState.READY,new w_(this.currentPick)):this.children.length===0?this.updateState(Dt.ConnectivityState.IDLE,new tf.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Dt.ConnectivityState.TRANSIENT_FAILURE,new tf.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Dt.ConnectivityState.CONNECTING,new tf.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,i,r){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){i!==Dt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){i===Dt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),i===Dt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,i]of this.children.entries())if(t>=e){let r=i.subchannel.getConnectivityState();if(r===Dt.ConnectivityState.IDLE||r===Dt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,i;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Dt.ConnectivityState.IDLE&&(b_("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var r;(r=this.children[e])===null||r===void 0||r.subchannel.startConnecting()})),this.connectionDelayTimeout=(i=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},C3)).unref)===null||i===void 0?void 0:i.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(b_("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){b_(Dt.ConnectivityState[this.currentState]+" -> "+Dt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(i=>({subchannel:this.channelControlHelper.createSubchannel(i,{}),hasReportedTransientFailure:!1}));for(let{subchannel:i}of t)i.ref(),this.channelControlHelper.addChannelzChild(i.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:i}of this.children)if(i.addConnectivityStateListener(this.subchannelStateListener),i.getConnectivityState()===Dt.ConnectivityState.READY){this.pickSubchannel(i);return}for(let i of this.children)i.subchannel.getConnectivityState()===Dt.ConnectivityState.TRANSIENT_FAILURE&&(i.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof nc&&(t.getShuffleAddressList()&&(e=jA(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Dt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return tc}};li.PickFirstLoadBalancer=nf;function T3(){(0,zA.registerLoadBalancerType)(tc,nf,nc),(0,zA.registerDefaultLoadBalancerType)(tc)}li.setup=T3});var $A=w(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.setup=Yo.RoundRobinLoadBalancer=void 0;var x3=Qi(),kt=cn(),rf=Ji(),I3=Qn(),A3=Ve(),D3=ae(),k3="round_robin";function HA(n){A3.trace(D3.LogVerbosity.DEBUG,k3,n)}var sf="round_robin",E_=class n{getLoadBalancerName(){return sf}constructor(){}toJsonObject(){return{[sf]:{}}}static createFromJson(e){return new n}},S_=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:rf.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},of=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=kt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,i,r,s,o)=>{this.calculateAndUpdateState(),(r===kt.ConnectivityState.TRANSIENT_FAILURE||r===kt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(kt.ConnectivityState.READY)>0){let e=this.subchannels.filter(i=>i.getConnectivityState()===kt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(kt.ConnectivityState.READY,new S_(e,t))}else this.countSubchannelsWithState(kt.ConnectivityState.CONNECTING)>0?this.updateState(kt.ConnectivityState.CONNECTING,new rf.QueuePicker(this)):this.countSubchannelsWithState(kt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(kt.ConnectivityState.TRANSIENT_FAILURE,new rf.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(kt.ConnectivityState.IDLE,new rf.QueuePicker(this))}updateState(e,t){HA(kt.ConnectivityState[this.currentState]+" -> "+kt.ConnectivityState[e]),e===kt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),HA("Connect to address list "+e.map(i=>(0,I3.subchannelAddressToString)(i))),this.subchannels=e.map(i=>this.channelControlHelper.createSubchannel(i,{}));for(let i of this.subchannels){i.ref(),i.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(i.getChannelzRef());let r=i.getConnectivityState();(r===kt.ConnectivityState.IDLE||r===kt.ConnectivityState.TRANSIENT_FAILURE)&&i.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return sf}};Yo.RoundRobinLoadBalancer=of;function R3(){(0,x3.registerLoadBalancerType)(sf,of,E_)}Yo.setup=R3});var YA=w(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.experimental=B.addAdminServicesToServer=B.getChannelzHandlers=B.getChannelzServiceDefinition=B.InterceptorConfigurationError=B.InterceptingCall=B.RequesterBuilder=B.ListenerBuilder=B.StatusBuilder=B.getClientChannel=B.ServerCredentials=B.Server=B.setLogVerbosity=B.setLogger=B.load=B.loadObject=B.CallCredentials=B.ChannelCredentials=B.waitForClientReady=B.closeClient=B.Channel=B.makeGenericClientConstructor=B.makeClientConstructor=B.loadPackageDefinition=B.Client=B.compressionAlgorithms=B.propagate=B.connectivityState=B.status=B.logVerbosity=B.Metadata=B.credentials=void 0;var af=_g();Object.defineProperty(B,"CallCredentials",{enumerable:!0,get:function(){return af.CallCredentials}});var M3=Xg();Object.defineProperty(B,"Channel",{enumerable:!0,get:function(){return M3.ChannelImplementation}});var O3=Av();Object.defineProperty(B,"compressionAlgorithms",{enumerable:!0,get:function(){return O3.CompressionAlgorithms}});var N3=cn();Object.defineProperty(B,"connectivityState",{enumerable:!0,get:function(){return N3.ConnectivityState}});var lf=_d();Object.defineProperty(B,"ChannelCredentials",{enumerable:!0,get:function(){return lf.ChannelCredentials}});var WA=Yg();Object.defineProperty(B,"Client",{enumerable:!0,get:function(){return WA.Client}});var C_=ae();Object.defineProperty(B,"logVerbosity",{enumerable:!0,get:function(){return C_.LogVerbosity}});Object.defineProperty(B,"status",{enumerable:!0,get:function(){return C_.Status}});Object.defineProperty(B,"propagate",{enumerable:!0,get:function(){return C_.Propagate}});var KA=Ve(),T_=Jg();Object.defineProperty(B,"loadPackageDefinition",{enumerable:!0,get:function(){return T_.loadPackageDefinition}});Object.defineProperty(B,"makeClientConstructor",{enumerable:!0,get:function(){return T_.makeClientConstructor}});Object.defineProperty(B,"makeGenericClientConstructor",{enumerable:!0,get:function(){return T_.makeClientConstructor}});var P3=Bt();Object.defineProperty(B,"Metadata",{enumerable:!0,get:function(){return P3.Metadata}});var F3=AA();Object.defineProperty(B,"Server",{enumerable:!0,get:function(){return F3.Server}});var L3=t_();Object.defineProperty(B,"ServerCredentials",{enumerable:!0,get:function(){return L3.ServerCredentials}});var B3=DA();Object.defineProperty(B,"StatusBuilder",{enumerable:!0,get:function(){return B3.StatusBuilder}});B.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),combineCallCredentials:(n,...e)=>e.reduce((t,i)=>t.compose(i),n),createInsecure:lf.ChannelCredentials.createInsecure,createSsl:lf.ChannelCredentials.createSsl,createFromSecureContext:lf.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:af.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:af.CallCredentials.createFromGoogleCredential,createEmpty:af.CallCredentials.createEmpty};var V3=n=>n.close();B.closeClient=V3;var q3=(n,e,t)=>n.waitForReady(e,t);B.waitForClientReady=q3;var U3=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.loadObject=U3;var z3=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.load=z3;var j3=n=>{KA.setLogger(n)};B.setLogger=j3;var G3=n=>{KA.setLoggerVerbosity(n)};B.setLogVerbosity=G3;var H3=n=>WA.Client.prototype.getChannel.call(n);B.getClientChannel=H3;var cf=Wg();Object.defineProperty(B,"ListenerBuilder",{enumerable:!0,get:function(){return cf.ListenerBuilder}});Object.defineProperty(B,"RequesterBuilder",{enumerable:!0,get:function(){return cf.RequesterBuilder}});Object.defineProperty(B,"InterceptingCall",{enumerable:!0,get:function(){return cf.InterceptingCall}});Object.defineProperty(B,"InterceptorConfigurationError",{enumerable:!0,get:function(){return cf.InterceptorConfigurationError}});var QA=ds();Object.defineProperty(B,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return QA.getChannelzServiceDefinition}});Object.defineProperty(B,"getChannelzHandlers",{enumerable:!0,get:function(){return QA.getChannelzHandlers}});var $3=Ad();Object.defineProperty(B,"addAdminServicesToServer",{enumerable:!0,get:function(){return $3.addAdminServicesToServer}});var W3=m_();B.experimental=W3;var K3=pv(),Q3=FA(),Y3=UA(),X3=GA(),Z3=$A(),J3=f_(),eU=ds();K3.setup(),Q3.setup(),Y3.setup(),X3.setup(),Z3.setup(),J3.setup(),eU.setup()});var Qm;try{Qm=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Qm=!1}var Ya=(()=>{let e=class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?dE(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||Qm)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};e.\u0275fac=function(r){return new(r||e)(H(zi))},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Qa;function qM(){if(Qa==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Qa=!0}))}finally{Qa=Qa||!1}return Qa}function Ym(n){return qM()?n:!!n.capture}function SE(n){return n.composedPath?n.composedPath()[0]:n.target}function CE(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Xm(n){return Array.isArray(n)?n:[n]}function Zm(n){return n instanceof on?n.nativeElement:n}var UM=(()=>{let e=class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var xE=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({providers:[UM]});let n=e;return n})();var IE=new Set,Zr,zM=(()=>{let e=class e{constructor(i,r){this._platform=i,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):GM}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&jM(i,this._nonce),this._matchMedia(i)}};e.\u0275fac=function(r){return new(r||e)(H(Ya),H(aE,8))},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function jM(n,e){if(!IE.has(n))try{Zr||(Zr=document.createElement("style"),e&&(Zr.nonce=e),Zr.setAttribute("type","text/css"),document.head.appendChild(Zr)),Zr.sheet&&(Zr.sheet.insertRule(`@media ${n} {body{ }}`,0),IE.add(n))}catch(t){console.error(t)}}function GM(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var DE=(()=>{let e=class e{constructor(i,r){this._mediaMatcher=i,this._zone=r,this._queries=new Map,this._destroySubject=new su}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return AE(Xm(i)).some(s=>this._registerQuery(s).mql.matches)}observe(i){let s=AE(Xm(i)).map(a=>this._registerQuery(a).observable),o=au(s);return o=Qw(o.pipe(Jw(1)),o.pipe(nE(1),Zw(0))),o.pipe(Le(a=>{let l={matches:!1,breakpoints:{}};return a.forEach(({matches:c,query:u})=>{l.matches=l.matches||c,l.breakpoints[u]=c}),l}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);let r=this._mediaMatcher.matchMedia(i),o={observable:new qi(a=>{let l=c=>this._zone.run(()=>a.next(c));return r.addListener(l),()=>{r.removeListener(l)}}).pipe(Ys(r),Le(({matches:a})=>({query:i,matches:a})),iE(this._destroySubject)),mql:r};return this._queries.set(i,o),o}};e.\u0275fac=function(r){return new(r||e)(H(zM),H(ft))},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function AE(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function ME(n){return n.buttons===0||n.detail===0}function OE(n){let e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!e&&e.identifier===-1&&(e.radiusX==null||e.radiusX===1)&&(e.radiusY==null||e.radiusY===1)}var kE="cdk-high-contrast-black-on-white",RE="cdk-high-contrast-white-on-black",ep="cdk-high-contrast-active",NE=(()=>{let e=class e{constructor(i,r){this._platform=i,this._document=r,this._breakpointSubscription=uu(DE).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;let i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);let r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(i):null,o=(s&&s.backgroundColor||"").replace(/ /g,"");switch(i.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let i=this._document.body.classList;i.remove(ep,kE,RE),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===1?i.add(ep,kE):r===2&&i.add(ep,RE)}}};e.\u0275fac=function(r){return new(r||e)(H(Ya),H(Wa))},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var tp=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({});let n=e;return n})();function YM(){return!0}var XM=new _e("mat-sanity-checks",{providedIn:"root",factory:YM}),_i=(()=>{let e=class e{constructor(i,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return CE()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[i]}};e.\u0275fac=function(r){return new(r||e)(H(NE),H(XM,8),H(Wa))},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[tp,tp]});let n=e;return n})();var np=class{constructor(e,t,i,r=!1){this._renderer=e,this.element=t,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}},PE=Ym({passive:!0,capture:!0}),ip=class{constructor(){this._events=new Map,this._delegateEventHandler=e=>{let t=SE(e);t&&this._events.get(e.type)?.forEach((i,r)=>{(r===t||r.contains(t))&&i.forEach(s=>s.handleEvent(e))})}}addHandler(e,t,i,r){let s=this._events.get(t);if(s){let o=s.get(i);o?o.add(r):s.set(i,new Set([r]))}else this._events.set(t,new Map([[i,new Set([r])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,PE)})}removeHandler(e,t,i){let r=this._events.get(e);if(!r)return;let s=r.get(t);s&&(s.delete(i),s.size===0&&r.delete(t),r.size===0&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,PE)))}},FE={enterDuration:225,exitDuration:150},ZM=800,LE=Ym({passive:!0,capture:!0}),BE=["mousedown","touchstart"],VE=["mouseup","mouseleave","touchend","touchcancel"],Xa=class Xa{constructor(e,t,i,r){this._target=e,this._ngZone=t,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Zm(i))}fadeInRipple(e,t,i={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s=it(it({},FE),i.animation);i.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);let o=i.radius||JM(e,t,r),a=e-r.left,l=t-r.top,c=s.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=`${a-o}px`,u.style.top=`${l-o}px`,u.style.height=`${o*2}px`,u.style.width=`${o*2}px`,i.color!=null&&(u.style.backgroundColor=i.color),u.style.transitionDuration=`${c}ms`,this._containerElement.appendChild(u);let d=window.getComputedStyle(u),h=d.transitionProperty,m=d.transitionDuration,y=h==="none"||m==="0s"||m==="0s, 0s"||r.width===0&&r.height===0,v=new np(this,u,i,y);u.style.transform="scale3d(1, 1, 1)",v.state=0,i.persistent||(this._mostRecentTransientRipple=v);let b=null;return!y&&(c||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let D=()=>this._finishRippleTransition(v),E=()=>this._destroyRipple(v);u.addEventListener("transitionend",D),u.addEventListener("transitioncancel",E),b={onTransitionEnd:D,onTransitionCancel:E}}),this._activeRipples.set(v,b),(y||!c)&&this._finishRippleTransition(v),v}fadeOutRipple(e){if(e.state===2||e.state===3)return;let t=e.element,i=it(it({},FE),e.config.animation);t.style.transitionDuration=`${i.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){let t=Zm(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,BE.forEach(i=>{Xa._eventManager.addHandler(this._ngZone,i,t,this)}))}handleEvent(e){e.type==="mousedown"?this._onMousedown(e):e.type==="touchstart"?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{VE.forEach(t=>{this._triggerElement.addEventListener(t,this,LE)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){e.state===0?this._startFadeOutTransition(e):e.state===2&&this._destroyRipple(e)}_startFadeOutTransition(e){let t=e===this._mostRecentTransientRipple,{persistent:i}=e.config;e.state=1,!i&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){let t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,t!==null&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){let t=ME(e),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+ZM;!this._target.rippleDisabled&&!t&&!i&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!OE(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let t=e.changedTouches;if(t)for(let i=0;i<t.length;i++)this.fadeInRipple(t[i].clientX,t[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{let t=e.state===1||e.config.terminateOnPointerUp&&e.state===0;!e.config.persistent&&t&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let e=this._triggerElement;e&&(BE.forEach(t=>Xa._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&VE.forEach(t=>e.removeEventListener(t,this,LE)))}};Xa._eventManager=new ip;var qE=Xa;function JM(n,e,t){let i=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),r=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(i*i+r*r)}var eO=["*"];var tO=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],nO=["[mat-card-avatar], [matCardAvatar]",`mat-card-title, mat-card-subtitle,
      [mat-card-title], [mat-card-subtitle],
      [matCardTitle], [matCardSubtitle]`,"*"],iO=new _e("MAT_CARD_CONFIG"),Du=(()=>{let e=class e{constructor(i){this.appearance=i?.appearance||"raised"}};e.\u0275fac=function(r){return new(r||e)(ue(iO,8))},e.\u0275cmp=Nt({type:e,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(r,s){r&2&&Wr("mat-mdc-card-outlined",s.appearance==="outlined")("mdc-card--outlined",s.appearance==="outlined")},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:eO,decls:1,vars:0,template:function(r,s){r&1&&($a(),Kr(0))},styles:['.mdc-card{display:flex;flex-direction:column;box-sizing:border-box}.mdc-card::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none;pointer-events:none}@media screen and (forced-colors: active){.mdc-card::after{border-color:CanvasText}}.mdc-card--outlined::after{border:none}.mdc-card__content{border-radius:inherit;height:100%}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__media--square::before{margin-top:100%}.mdc-card__media--16-9::before{margin-top:56.25%}.mdc-card__media-content{position:absolute;top:0;right:0;bottom:0;left:0;box-sizing:border-box}.mdc-card__primary-action{display:flex;flex-direction:column;box-sizing:border-box;position:relative;outline:none;color:inherit;text-decoration:none;cursor:pointer;overflow:hidden}.mdc-card__primary-action:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__primary-action:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mdc-card__actions--full-bleed{padding:0}.mdc-card__action-buttons,.mdc-card__action-icons{display:flex;flex-direction:row;align-items:center;box-sizing:border-box}.mdc-card__action-icons{color:rgba(0, 0, 0, 0.6);flex-grow:1;justify-content:flex-end}.mdc-card__action-buttons+.mdc-card__action-icons{margin-left:16px;margin-right:0}[dir=rtl] .mdc-card__action-buttons+.mdc-card__action-icons,.mdc-card__action-buttons+.mdc-card__action-icons[dir=rtl]{margin-left:0;margin-right:16px}.mdc-card__action{display:inline-flex;flex-direction:row;align-items:center;box-sizing:border-box;justify-content:center;cursor:pointer;user-select:none}.mdc-card__action:focus{outline:none}.mdc-card__action--button{margin-left:0;margin-right:8px;padding:0 8px}[dir=rtl] .mdc-card__action--button,.mdc-card__action--button[dir=rtl]{margin-left:8px;margin-right:0}.mdc-card__action--button:last-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-card__action--button:last-child,.mdc-card__action--button:last-child[dir=rtl]{margin-left:0;margin-right:0}.mdc-card__actions--full-bleed .mdc-card__action--button{justify-content:space-between;width:100%;height:auto;max-height:none;margin:0;padding:8px 16px;text-align:left}[dir=rtl] .mdc-card__actions--full-bleed .mdc-card__action--button,.mdc-card__actions--full-bleed .mdc-card__action--button[dir=rtl]{text-align:right}.mdc-card__action--icon{margin:-6px 0;padding:12px}.mdc-card__action--icon:not(:disabled){color:rgba(0, 0, 0, 0.6)}.mat-mdc-card{border-radius:var(--mdc-elevated-card-container-shape);background-color:var(--mdc-elevated-card-container-color);border-width:0;border-style:solid;border-color:var(--mdc-elevated-card-container-color);box-shadow:var(--mdc-elevated-card-container-elevation)}.mat-mdc-card .mdc-card::after{border-radius:var(--mdc-elevated-card-container-shape)}.mat-mdc-card-outlined{border-width:var(--mdc-outlined-card-outline-width);border-style:solid;border-color:var(--mdc-outlined-card-outline-color);border-radius:var(--mdc-outlined-card-container-shape);background-color:var(--mdc-outlined-card-container-color);box-shadow:var(--mdc-outlined-card-container-elevation)}.mat-mdc-card-outlined .mdc-card::after{border-radius:var(--mdc-outlined-card-container-shape)}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font);line-height:var(--mat-card-title-text-line-height);font-size:var(--mat-card-title-text-size);letter-spacing:var(--mat-card-title-text-tracking);font-weight:var(--mat-card-title-text-weight)}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color);font-family:var(--mat-card-subtitle-text-font);line-height:var(--mat-card-subtitle-text-line-height);font-size:var(--mat-card-subtitle-text-size);letter-spacing:var(--mat-card-subtitle-text-tracking);font-weight:var(--mat-card-subtitle-text-weight)}.mat-mdc-card{position:relative}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0});let n=e;return n})();var ku=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Et({type:e,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"]});let n=e;return n})();var Ru=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Nt({type:e,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-mdc-card-header"],ngContentSelectors:nO,decls:4,vars:0,consts:[[1,"mat-mdc-card-header-text"]],template:function(r,s){r&1&&($a(tO),Kr(0),he(1,"div",0),Kr(2,1),Ce(),Kr(3,2))},encapsulation:2,changeDetection:0});let n=e;return n})(),Mu=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=Et({type:e,selectors:[["mat-card-footer"]],hostAttrs:[1,"mat-mdc-card-footer"]});let n=e;return n})();var zE=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[_i,Eu,_i]});let n=e;return n})();var rO="firebase",sO="10.7.1";ji(rO,sO,"app");var eo=new mu("ANGULARFIRE2_VERSION");var oO=(n,e)=>{let t=e?[e]:EE(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Jr=class{constructor(){return oO(aO)}},aO="app-check";function rp(){}var Ou=class{zone;delegate;constructor(e,t=Kw){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,i)}},sp=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",rp,{},rp,rp)),t.pipe(rE({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Nu=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ou(Zone.current)),this.insideAngular=t.run(()=>new Ou(Zone.current,ou)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(H(ft))};static \u0275prov=je({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function lO(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function $t(n){return cO(lO())(n)}function cO(n){return function(t){return t=t.lift(new sp(n.ngZone)),t.pipe(Qs(n.outsideAngular),Hr(n.insideAngular))}}var hO=new Map,fO={activated:!1,tokenObservers:[]},mO={initialized:!1,enabled:!1};function Sn(n){return hO.get(n)||Object.assign({},fO)}function QE(){return mO}var pO="https://content-firebaseappcheck.googleapis.com/v1";var gO="exchangeDebugToken",HE={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},cW=24*60*60*1e3;var ap=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new Km,this.pending.promise.catch(t=>{}),yield yO(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Km,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function yO(n){return new Promise(e=>{setTimeout(e,n)})}var vO={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Gi=new bE("appCheck","AppCheck",vO);function YE(n){if(!Sn(n).activated)throw Gi.create("use-before-activation",{appName:n.name})}function XE(i,r){return p(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let m=yield o.getHeartbeatsHeader();m&&(s["X-Firebase-Client"]=m)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(m){throw Gi.create("fetch-network-error",{originalErrorMessage:m?.message})}if(l.status!==200)throw Gi.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(m){throw Gi.create("fetch-parse-error",{originalErrorMessage:m?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Gi.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function ZE(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${pO}/projects/${t}/apps/${i}:${gO}?key=${r}`,body:{debug_token:e}}}var _O="firebase-app-check-database",bO=1,lp="firebase-app-check-store";var Pu=null;function wO(){return Pu||(Pu=new Promise((n,e)=>{try{let t=indexedDB.open(_O,bO);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Gi.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(lp,{keyPath:"compositeKey"})}}}catch(t){e(Gi.create("storage-open",{originalErrorMessage:t?.message}))}}),Pu)}function EO(n,e){return SO(CO(n),e)}function SO(n,e){return p(this,null,function*(){let i=(yield wO()).transaction(lp,"readwrite"),s=i.objectStore(lp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Gi.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function CO(n){return`${n.options.appId}-${n.name}`}var cp=new Iu("@firebase/app-check");function op(n,e){return xu()?EO(n,e).catch(t=>{cp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function JE(){return QE().enabled}function eS(){return p(this,null,function*(){let n=QE();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var TO={error:"UNKNOWN_ERROR"};function xO(n){return gE.encodeString(JSON.stringify(n),!1)}function up(n,e=!1){return p(this,null,function*(){let t=n.app;YE(t);let i=Sn(t),r=i.token,s;if(r&&!Za(r)&&(i.token=void 0,r=void 0),!r){let l=yield i.cachedTokenPromise;l&&(Za(l)?r=l:yield op(t,void 0))}if(!e&&r&&Za(r))return{token:r.token};let o=!1;if(JE()){i.exchangeTokenPromise||(i.exchangeTokenPromise=XE(ZE(t,yield eS()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield op(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield Sn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?cp.warn(l.message):cp.error(l),s=l}let a;return r?s?Za(r)?a={token:r.token,internalError:s}:a=WE(s):(a={token:r.token},i.token=r,yield op(t,r)):a=WE(s),o&&kO(t,a),a})}function IO(n){return p(this,null,function*(){let e=n.app;YE(e);let{provider:t}=Sn(e);if(JE()){let i=yield eS(),{token:r}=yield XE(ZE(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function AO(n,e,t,i){let{app:r}=n,s=Sn(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Za(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),$E(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>$E(n))}function tS(n,e){let t=Sn(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function $E(n){let{app:e}=n,t=Sn(e),i=t.tokenRefresher;i||(i=DO(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function DO(n){let{app:e}=n;return new ap(()=>p(this,null,function*(){let t=Sn(e),i;if(t.token?i=yield up(n,!0):i=yield up(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Sn(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},HE.RETRIAL_MIN_WAIT,HE.RETRIAL_MAX_WAIT)}function kO(n,e){let t=Sn(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Za(n){return n.expireTimeMillis-Date.now()>0}function WE(n){return{token:xO(TO),error:n}}var dp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Sn(this.app);for(let t of e)tS(this.app,t.next);return Promise.resolve()}};function RO(n,e){return new dp(n,e)}function MO(n){return{getToken:e=>up(n,e),getLimitedUseToken:()=>IO(n),addTokenListener:e=>AO(n,"INTERNAL",e),removeTokenListener:e=>tS(n.app,e)}}var OO="@firebase/app-check",NO="0.8.1";var PO="app-check",KE="app-check-internal";function FO(){Ka(new Xr(PO,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return RO(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(KE).initialize()})),Ka(new Xr(KE,n=>{let e=n.getProvider("app-check").getImmediate();return MO(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ji(OO,NO)}FO();var LO=["localhost","0.0.0.0","127.0.0.1"],wW=typeof window<"u"&&LO.includes(window.location.hostname);var BO="firebase",VO="10.7.1";Ht.registerVersion(BO,VO,"app-compat");var qO=["ngOnDestroy"],rS=(n,e,t,i={})=>new Proxy(n,{get:(r,s)=>t.runOutsideAngular(()=>{if(n[s])return i?.spy?.get&&i.spy.get(s,n[s]),n[s];if(qO.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return i?.spy?.apply&&i.spy.apply(s,c,d),d})})})});var Fu=class{constructor(e){return e}},to=new _e("angularfire2.app.options"),no=new _e("angularfire2.app.name");function Ja(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",r=typeof t=="object"&&t||{};r.name=r.name||i;let o=Ht.apps.filter(a=>a&&a.name===r.name)[0]||e.runOutsideAngular(()=>Ht.initializeApp(n,r));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;UO("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Fu(o)}var UO=(n,...e)=>{Hm()&&typeof console<"u"&&console[n](...e)},zO={provide:Fu,useFactory:Ja,deps:[to,ft,[new oE,no]]},sS=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:to,useValue:t},{provide:no,useValue:i}]}}constructor(t){Ht.registerVersion("angularfire",eo.full,"core"),Ht.registerVersion("angularfire",eo.full,"app-compat"),Ht.registerVersion("angular",lE.full,t.toString())}static \u0275fac=function(i){return new(i||n)(H(zi))};static \u0275mod=oe({type:n});static \u0275inj=se({providers:[zO]})}return n})();function Lu(n,e,t,i,r){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return jO(r,o)||(iS("error",`${e} was already initialized on the ${t} Firebase App with different settings.${GO?" You may need to reload as Firebase is not HMR aware.":""}`),iS("warn",{is:r,was:o})),s;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,r]),a}}function jO(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var GO=typeof module<"u"&&!!module.hot,iS=(n,...e)=>{Hm()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var hp=new _e("angularfire2.auth.use-emulator"),fp=new _e("angularfire2.auth.settings"),mp=new _e("angularfire2.auth.tenant-id"),pp=new _e("angularfire2.auth.langugage-code"),gp=new _e("angularfire2.auth.use-device-language"),yp=new _e("angularfire.auth.persistence"),vp=(n,e,t,i,r,s,o,a)=>Lu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=r,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,r,s,o,a]),Bu=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,l,c,u,d,h,m){let y=new su,v=Ui(void 0).pipe(Hr(o.outsideAngular),$r(()=>s.runOutsideAngular(()=>import("./chunk-KJ4NQCBB.mjs"))),Le(()=>Ja(t,s,i)),Le(b=>vp(b,s,a,c,u,d,l,h)),Um({bufferSize:1,refCount:!1}));if(Su(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Ui(null);else{v.pipe(tE()).subscribe();let b=v.pipe($r(k=>k.getRedirectResult().then(R=>R,()=>null)),$t,Um({bufferSize:1,refCount:!1})),D=v.pipe($r(k=>new qi(R=>({unsubscribe:s.runOutsideAngular(()=>k.onAuthStateChanged(V=>R.next(V),V=>R.error(V),()=>R.complete()))})))),E=v.pipe($r(k=>new qi(R=>({unsubscribe:s.runOutsideAngular(()=>k.onIdTokenChanged(V=>R.next(V),V=>R.error(V),()=>R.complete()))}))));this.authState=b.pipe(zm(D),Qs(o.outsideAngular),Hr(o.insideAngular)),this.user=b.pipe(zm(E),Qs(o.outsideAngular),Hr(o.insideAngular)),this.idToken=this.user.pipe($r(k=>k?Un(k.getIdToken()):Ui(null))),this.idTokenResult=this.user.pipe($r(k=>k?Un(k.getIdTokenResult()):Ui(null))),this.credential=Xw(b,y,this.authState.pipe(Ha(k=>!k))).pipe(Le(k=>k?.user?k:null),Qs(o.outsideAngular),Hr(o.insideAngular))}return rS(this,v,s,{spy:{apply:(b,D,E)=>{(b.startsWith("signIn")||b.startsWith("createUser"))&&E.then(k=>y.next(k))}}})}static \u0275fac=function(i){return new(i||n)(H(to),H(no,8),H(zi),H(ft),H(Nu),H(hp,8),H(fp,8),H(mp,8),H(pp,8),H(gp,8),H(yp,8),H(Jr,8))};static \u0275prov=je({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as tU,TextEncoder as nU,TextDecoder as iU}from"util";import{randomBytes as rU}from"crypto";var HO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tn={},N,qp=qp||{},W=HO||self;function Zu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function fl(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function $O(n){return Object.prototype.hasOwnProperty.call(n,_p)&&n[_p]||(n[_p]=++WO)}var _p="closure_uid_"+(1e9*Math.random()>>>0),WO=0;function KO(n,e,t){return n.call.apply(n.bind,arguments)}function QO(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function Ct(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Ct=KO:Ct=QO,Ct.apply(null,arguments)}function Vu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function st(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(i,o)}}function Hi(){this.s=this.s,this.o=this.o}var YO=0;Hi.prototype.s=!1;Hi.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),YO!=0)&&$O(this)};Hi.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var _S=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Up(n){let e=n.length;if(0<e){let t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function aS(n,e){for(let t=1;t<arguments.length;t++){let i=arguments[t];if(Zu(i)){let r=n.length||0,s=i.length||0;n.length=r+s;for(let o=0;o<s;o++)n[r+o]=i[o]}else n.push(i)}}function Tt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Tt.prototype.h=function(){this.defaultPrevented=!0};var XO=function(){if(!W.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};W.addEventListener("test",t,e),W.removeEventListener("test",t,e)}catch{}return n}();function sl(n){return/^[\s\xa0]*$/.test(n)}function Ju(){var n=W.navigator;return n&&(n=n.userAgent)?n:""}function Gn(n){return Ju().indexOf(n)!=-1}function zp(n){return zp[" "](n),n}zp[" "]=function(){};function ZO(n,e){var t=qN;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var JO=Gn("Opera"),oo=Gn("Trident")||Gn("MSIE"),bS=Gn("Edge"),Cp=bS||oo,wS=Gn("Gecko")&&!(Ju().toLowerCase().indexOf("webkit")!=-1&&!Gn("Edge"))&&!(Gn("Trident")||Gn("MSIE"))&&!Gn("Edge"),eN=Ju().toLowerCase().indexOf("webkit")!=-1&&!Gn("Edge");function ES(){var n=W.document;return n?n.documentMode:void 0}var Tp;e:{if(qu="",Uu=function(){var n=Ju();if(wS)return/rv:([^\);]+)(\)|;)/.exec(n);if(bS)return/Edge\/([\d\.]+)/.exec(n);if(oo)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(eN)return/WebKit\/(\S+)/.exec(n);if(JO)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Uu&&(qu=Uu?Uu[1]:""),oo&&(zu=ES(),zu!=null&&zu>parseFloat(qu))){Tp=String(zu);break e}Tp=qu}var qu,Uu,zu,xp;W.document&&oo?(bp=ES(),xp=bp||parseInt(Tp,10)||void 0):xp=void 0;var bp,tN=xp;function ol(n,e){if(Tt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(wS){e:{try{zp(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:nN[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ol.$.h.call(this)}}st(ol,Tt);var nN={2:"touch",3:"pen",4:"mouse"};ol.prototype.h=function(){ol.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ml="closure_listenable_"+(1e6*Math.random()|0),iN=0;function rN(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.la=r,this.key=++iN,this.fa=this.ia=!1}function ed(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function jp(n,e,t){for(let i in n)e.call(t,n[i],i,n)}function sN(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function SS(n){let e={};for(let t in n)e[t]=n[t];return e}var lS="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function CS(n,e){let t,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(t in i)n[t]=i[t];for(let s=0;s<lS.length;s++)t=lS[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function td(n){this.src=n,this.g={},this.h=0}td.prototype.add=function(n,e,t,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Ap(n,e,i,r);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new rN(e,this.src,s,!!i,r),e.ia=t,n.push(e)),e};function Ip(n,e){var t=e.type;if(t in n.g){var i=n.g[t],r=_S(i,e),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(ed(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Ap(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==i)return r}return-1}var Gp="closure_lm_"+(1e6*Math.random()|0),wp={};function TS(n,e,t,i,r){if(i&&i.once)return IS(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)TS(n,e[s],t,i,r);return null}return t=Wp(t),n&&n[ml]?n.O(e,t,fl(i)?!!i.capture:!!i,r):xS(n,e,t,!1,i,r)}function xS(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var o=fl(r)?!!r.capture:!!r,a=$p(n);if(a||(n[Gp]=a=new td(n)),t=a.add(e,t,i,o,s),t.proxy)return t;if(i=oN(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)XO||(r=o),r===void 0&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(DS(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function oN(){function n(t){return e.call(n.src,n.listener,t)}let e=aN;return n}function IS(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)IS(n,e[s],t,i,r);return null}return t=Wp(t),n&&n[ml]?n.P(e,t,fl(i)?!!i.capture:!!i,r):xS(n,e,t,!0,i,r)}function AS(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)AS(n,e[s],t,i,r);else i=fl(i)?!!i.capture:!!i,t=Wp(t),n&&n[ml]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Ap(s,t,i,r),-1<t&&(ed(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=$p(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ap(e,t,i,r)),(t=-1<n?e[n]:null)&&Hp(t))}function Hp(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[ml])Ip(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(DS(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=$p(e))?(Ip(t,n),t.h==0&&(t.src=null,e[Gp]=null)):ed(n)}}}function DS(n){return n in wp?wp[n]:wp[n]="on"+n}function aN(n,e){if(n.fa)n=!0;else{e=new ol(e,this);var t=n.listener,i=n.la||n.src;n.ia&&Hp(n),n=t.call(i,e)}return n}function $p(n){return n=n[Gp],n instanceof td?n:null}var Ep="__closure_events_fn_"+(1e9*Math.random()>>>0);function Wp(n){return typeof n=="function"?n:(n[Ep]||(n[Ep]=function(e){return n.handleEvent(e)}),n[Ep])}function rt(){Hi.call(this),this.i=new td(this),this.S=this,this.J=null}st(rt,Hi);rt.prototype[ml]=!0;rt.prototype.removeEventListener=function(n,e,t,i){AS(this,n,e,t,i)};function yt(n,e){var t,i=n.J;if(i)for(t=[];i;i=i.J)t.push(i);if(n=n.S,i=e.type||e,typeof e=="string")e=new Tt(e,n);else if(e instanceof Tt)e.target=e.target||n;else{var r=e;e=new Tt(i,n),CS(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];r=ju(o,i,!0,e)&&r}if(o=e.g=n,r=ju(o,i,!0,e)&&r,r=ju(o,i,!1,e)&&r,t)for(s=0;s<t.length;s++)o=e.g=t[s],r=ju(o,i,!1,e)&&r}rt.prototype.N=function(){if(rt.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)ed(t[i]);delete n.g[e],n.h--}}this.J=null};rt.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};rt.prototype.P=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function ju(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&Ip(n.i,o),r=a.call(l,i)!==!1&&r}}return r&&!i.defaultPrevented}var Kp=W.JSON.stringify,Dp=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function lN(){var n=Qp;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var kp=class{constructor(){this.h=this.g=null}add(e,t){let i=kS.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}},kS=new Dp(()=>new Rp,n=>n.reset()),Rp=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function cN(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function uN(n){W.setTimeout(()=>{throw n},0)}var al,ll=!1,Qp=new kp,RS=()=>{let n=W.Promise.resolve(void 0);al=()=>{n.then(dN)}},dN=()=>{for(var n;n=lN();){try{n.h.call(n.g)}catch(t){uN(t)}var e=kS;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ll=!1};function nd(n,e){rt.call(this),this.h=n||1,this.g=e||W,this.j=Ct(this.qb,this),this.l=Date.now()}st(nd,rt);N=nd.prototype;N.ga=!1;N.T=null;N.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yt(this,"tick"),this.ga&&(Yp(this),this.start()))}};N.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Yp(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}N.N=function(){nd.$.N.call(this),Yp(this),delete this.g};function Xp(n,e,t){if(typeof n=="function")t&&(n=Ct(n,t));else if(n&&typeof n.handleEvent=="function")n=Ct(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:W.setTimeout(n,e||0)}function MS(n){n.g=Xp(()=>{n.g=null,n.i&&(n.i=!1,MS(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Mp=class extends Hi{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:MS(this)}N(){super.N(),this.g&&(W.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function cl(n){Hi.call(this),this.h=n,this.g={}}st(cl,Hi);var cS=[];function OS(n,e,t,i){Array.isArray(t)||(t&&(cS[0]=t.toString()),t=cS);for(var r=0;r<t.length;r++){var s=TS(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function NS(n){jp(n.g,function(e,t){this.g.hasOwnProperty(t)&&Hp(e)},n),n.g={}}cl.prototype.N=function(){cl.$.N.call(this),NS(this)};cl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function id(){this.g=!0}id.prototype.Ea=function(){this.g=!1};function hN(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+`
`+t+`
`+o})}function fN(n,e,t,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+o})}function ro(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+pN(n,t)+(i?" "+i:"")})}function mN(n,e){n.info(function(){return"TIMEOUT: "+e})}id.prototype.info=function(){};function pN(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return Kp(t)}catch{return e}}var is={},uS=null;function rd(){return uS=uS||new rt}is.Ta="serverreachability";function PS(n){Tt.call(this,is.Ta,n)}st(PS,Tt);function ul(n){let e=rd();yt(e,new PS(e))}is.STAT_EVENT="statevent";function FS(n,e){Tt.call(this,is.STAT_EVENT,n),this.stat=e}st(FS,Tt);function Ft(n){let e=rd();yt(e,new FS(e,n))}is.Ua="timingevent";function LS(n,e){Tt.call(this,is.Ua,n),this.size=e}st(LS,Tt);function pl(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return W.setTimeout(function(){n()},e)}var sd={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},BS={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Zp(){}Zp.prototype.h=null;function dS(n){return n.h||(n.h=n.i())}function VS(){}var gl={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Jp(){Tt.call(this,"d")}st(Jp,Tt);function eg(){Tt.call(this,"c")}st(eg,Tt);var Op;function od(){}st(od,Zp);od.prototype.g=function(){return new XMLHttpRequest};od.prototype.i=function(){return{}};Op=new od;function yl(n,e,t,i){this.l=n,this.j=e,this.m=t,this.W=i||1,this.U=new cl(this),this.P=gN,n=Cp?125:void 0,this.V=new nd(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new qS}function qS(){this.i=null,this.g="",this.h=!1}var gN=45e3,US={},Np={};N=yl.prototype;N.setTimeout=function(n){this.P=n};function Pp(n,e,t){n.L=1,n.A=ld(wi(e)),n.u=t,n.S=!0,zS(n,null)}function zS(n,e){n.G=Date.now(),vl(n),n.B=wi(n.A);var t=n.B,i=n.W;Array.isArray(i)||(i=[String(i)]),YS(t.i,"t",i),n.o=0,t=n.l.J,n.h=new qS,n.g=yC(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Mp(Ct(n.Pa,n,n.g),n.O)),OS(n.U,n.g,"readystatechange",n.nb),e=n.I?SS(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),ul(),hN(n.j,n.v,n.B,n.m,n.W,n.u)}N.nb=function(n){n=n.target;let e=this.M;e&&Hn(n)==3?e.l():this.Pa(n)};N.Pa=function(n){try{if(n==this.g)e:{let u=Hn(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||Cp||this.g&&(this.h.h||this.g.ja()||pS(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?ul(3):ul(2)),ad(this);var t=this.g.da();this.ca=t;t:if(jS(this)){var i=pS(this.g);n="";var r=i.length,s=Hn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){es(this),rl(this);var o="";break t}this.h.i=new W.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,fN(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!sl(a)){var c=a;break t}}c=null}if(t=c)ro(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fp(this,t);else{this.i=!1,this.s=3,Ft(12),es(this),rl(this);break e}}this.S?(GS(this,u,o),Cp&&this.i&&u==3&&(OS(this.U,this.V,"tick",this.mb),this.V.start())):(ro(this.j,this.m,o,null),Fp(this,o)),u==4&&es(this),this.i&&!this.J&&(u==4?fC(this.l,this):(this.i=!1,vl(this)))}else LN(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ft(12)):(this.s=0,Ft(13)),es(this),rl(this)}}}catch{}finally{}};function jS(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function GS(n,e,t){let i=!0,r;for(;!n.J&&n.o<t.length;)if(r=yN(n,t),r==Np){e==4&&(n.s=4,Ft(14),i=!1),ro(n.j,n.m,null,"[Incomplete Response]");break}else if(r==US){n.s=4,Ft(15),ro(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else ro(n.j,n.m,r,null),Fp(n,r);jS(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ft(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),og(e),e.M=!0,Ft(11))):(ro(n.j,n.m,t,"[Invalid Chunked Response]"),es(n),rl(n))}N.mb=function(){if(this.g){var n=Hn(this.g),e=this.g.ja();this.o<e.length&&(ad(this),GS(this,n,e),this.i&&n!=4&&vl(this))}};function yN(n,e){var t=n.o,i=e.indexOf(`
`,t);return i==-1?Np:(t=Number(e.substring(t,i)),isNaN(t)?US:(i+=1,i+t>e.length?Np:(e=e.slice(i,i+t),n.o=i+t,e)))}N.cancel=function(){this.J=!0,es(this)};function vl(n){n.Y=Date.now()+n.P,HS(n,n.P)}function HS(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=pl(Ct(n.lb,n),e)}function ad(n){n.C&&(W.clearTimeout(n.C),n.C=null)}N.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(mN(this.j,this.B),this.L!=2&&(ul(),Ft(17)),es(this),this.s=2,rl(this)):HS(this,this.Y-n)};function rl(n){n.l.H==0||n.J||fC(n.l,n)}function es(n){ad(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Yp(n.V),NS(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Fp(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Lp(t.i,n))){if(!n.K&&Lp(t.i,n)&&t.H==3){try{var i=t.Ja.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Ku(t),dd(t);else break e;sg(t),Ft(18)}}else t.Fa=r[1],0<t.Fa-t.V&&37500>r[2]&&t.G&&t.A==0&&!t.v&&(t.v=pl(Ct(t.ib,t),6e3));if(1>=JS(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else ts(t,11)}else if((n.K||t.g==n)&&Ku(t),!sl(e))for(r=t.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=c[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let h=c[5];h!=null&&typeof h=="number"&&0<h&&(i=1.5*h,t.L=i,t.l.info("backChannelRequestTimeoutMs_="+i)),i=t;let m=n.g;if(m){let y=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=i.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(tg(s,s.h),s.h=null))}if(i.F){let v=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(i.Da=v,Te(i.I,i.F,v))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),i=t;var o=n;if(i.wa=gC(i,i.J?i.pa:null,i.Y),o.K){eC(i.i,o);var a=o,l=i.L;l&&a.setTimeout(l),a.C&&(ad(a),vl(a)),i.g=o}else dC(i);0<t.j.length&&hd(t)}else c[0]!="stop"&&c[0]!="close"||ts(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?ts(t,7):rg(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}ul(4)}catch{}}function vN(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Zu(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function _N(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Zu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let i in n)e[t++]=i;return e}}}function $S(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Zu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=_N(n),i=vN(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}var WS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bN(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function ns(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof ns){this.h=n.h,$u(this,n.j),this.s=n.s,this.g=n.g,Wu(this,n.m),this.l=n.l;var e=n.i,t=new dl;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),hS(this,t),this.o=n.o}else n&&(e=String(n).match(WS))?(this.h=!1,$u(this,e[1]||"",!0),this.s=nl(e[2]||""),this.g=nl(e[3]||"",!0),Wu(this,e[4]),this.l=nl(e[5]||"",!0),hS(this,e[6]||"",!0),this.o=nl(e[7]||"")):(this.h=!1,this.i=new dl(null,this.h))}ns.prototype.toString=function(){var n=[],e=this.j;e&&n.push(il(e,fS,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(il(e,fS,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(il(t,t.charAt(0)=="/"?SN:EN,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",il(t,TN)),n.join("")};function wi(n){return new ns(n)}function $u(n,e,t){n.j=t?nl(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Wu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function hS(n,e,t){e instanceof dl?(n.i=e,xN(n.i,n.h)):(t||(e=il(e,CN)),n.i=new dl(e,n.h))}function Te(n,e,t){n.i.set(e,t)}function ld(n){return Te(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function nl(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function il(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,wN),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function wN(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var fS=/[#\/\?@]/g,EN=/[#\?:]/g,SN=/[#\?]/g,CN=/[#\?@]/g,TN=/#/g;function dl(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function $i(n){n.g||(n.g=new Map,n.h=0,n.i&&bN(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}N=dl.prototype;N.add=function(n,e){$i(this),this.i=null,n=ao(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function KS(n,e){$i(n),e=ao(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function QS(n,e){return $i(n),e=ao(n,e),n.g.has(e)}N.forEach=function(n,e){$i(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)};N.ta=function(){$i(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){let r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t};N.Z=function(n){$i(this);let e=[];if(typeof n=="string")QS(this,n)&&(e=e.concat(this.g.get(ao(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};N.set=function(n,e){return $i(this),this.i=null,n=ao(this,n),QS(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};N.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function YS(n,e,t){KS(n,e),0<t.length&&(n.i=null,n.g.set(ao(n,e),Up(t)),n.h+=t.length)}N.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];let s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;o[i]!==""&&(r+="="+encodeURIComponent(String(o[i]))),n.push(r)}}return this.i=n.join("&")};function ao(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function xN(n,e){e&&!n.j&&($i(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(KS(this,i),YS(this,r,t))},n)),n.j=e}var IN=class{constructor(n,e){this.g=n,this.map=e}};function XS(n){this.l=n||AN,W.PerformanceNavigationTiming?(n=W.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(W.g&&W.g.Ka&&W.g.Ka()&&W.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var AN=10;function ZS(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function JS(n){return n.h?1:n.g?n.g.size:0}function Lp(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function tg(n,e){n.g?n.g.add(e):n.h=e}function eC(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}XS.prototype.cancel=function(){if(this.i=tC(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function tC(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Up(n.i)}var DN=class{stringify(n){return W.JSON.stringify(n,void 0)}parse(n){return W.JSON.parse(n,void 0)}};function kN(){this.g=new DN}function RN(n,e,t){let i=t||"";try{$S(n,function(r,s){let o=r;fl(r)&&(o=Kp(r)),e.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function MN(n,e){let t=new id;if(W.Image){let i=new Image;i.onload=Vu(Gu,t,i,"TestLoadImage: loaded",!0,e),i.onerror=Vu(Gu,t,i,"TestLoadImage: error",!1,e),i.onabort=Vu(Gu,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=Vu(Gu,t,i,"TestLoadImage: timeout",!1,e),W.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function Gu(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch{}}function _l(n){this.l=n.ec||null,this.j=n.ob||!1}st(_l,Zp);_l.prototype.g=function(){return new cd(this.l,this.j)};_l.prototype.i=function(n){return function(){return n}}({});function cd(n,e){rt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=ng,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}st(cd,rt);var ng=0;N=cd.prototype;N.open=function(n,e){if(this.readyState!=ng)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,hl(this)};N.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||W).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};N.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bl(this)),this.readyState=ng};N.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,hl(this)),this.g&&(this.readyState=3,hl(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof W.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nC(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function nC(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}N.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?bl(this):hl(this),this.readyState==3&&nC(this)}};N.Za=function(n){this.g&&(this.response=this.responseText=n,bl(this))};N.Ya=function(n){this.g&&(this.response=n,bl(this))};N.ka=function(){this.g&&bl(this)};function bl(n){n.readyState=4,n.l=null,n.j=null,n.A=null,hl(n)}N.setRequestHeader=function(n,e){this.v.append(n,e)};N.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};N.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function hl(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(cd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var ON=W.JSON.parse;function Be(n){rt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=iC,this.L=this.M=!1}st(Be,rt);var iC="",NN=/^https?$/i,PN=["POST","PUT"];N=Be.prototype;N.Oa=function(n){this.M=n};N.ha=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Op.g(),this.C=this.u?dS(this.u):dS(Op),this.g.onreadystatechange=Ct(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){mS(this,s);return}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(let s of i.keys())t.set(s,i.get(s));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),r=W.FormData&&n instanceof W.FormData,!(0<=_S(PN,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{oC(this),0<this.B&&((this.L=FN(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ct(this.ua,this)):this.A=Xp(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){mS(this,s)}};function FN(n){return oo&&typeof n.timeout=="number"&&n.ontimeout!==void 0}N.ua=function(){typeof qp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yt(this,"timeout"),this.abort(8))};function mS(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,rC(n),ud(n)}function rC(n){n.F||(n.F=!0,yt(n,"complete"),yt(n,"error"))}N.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,yt(this,"complete"),yt(this,"abort"),ud(this))};N.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ud(this,!0)),Be.$.N.call(this)};N.La=function(){this.s||(this.G||this.v||this.l?sC(this):this.kb())};N.kb=function(){sC(this)};function sC(n){if(n.h&&typeof qp<"u"&&(!n.C[1]||Hn(n)!=4||n.da()!=2)){if(n.v&&Hn(n)==4)Xp(n.La,0,n);else if(yt(n,"readystatechange"),Hn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=o===0){var r=String(n.I).match(WS)[1]||null;!r&&W.self&&W.self.location&&(r=W.self.location.protocol.slice(0,-1)),i=!NN.test(r?r.toLowerCase():"")}t=i}if(t)yt(n,"complete"),yt(n,"success");else{n.m=6;try{var s=2<Hn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",rC(n)}}finally{ud(n)}}}}function ud(n,e){if(n.g){oC(n);let t=n.g,i=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||yt(n,"ready");try{t.onreadystatechange=i}catch{}}}function oC(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(W.clearTimeout(n.A),n.A=null)}N.isActive=function(){return!!this.g};function Hn(n){return n.g?n.g.readyState:0}N.da=function(){try{return 2<Hn(this)?this.g.status:-1}catch{return-1}};N.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};N.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),ON(e)}};function pS(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case iC:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function LN(n){let e={};n=(n.g&&2<=Hn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let i=0;i<n.length;i++){if(sl(n[i]))continue;var t=cN(n[i]);let r=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[r]||[];e[r]=s,s.push(t)}sN(e,function(i){return i.join(", ")})}N.Ia=function(){return this.m};N.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function aC(n){let e="";return jp(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function ig(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=aC(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Te(n,e,t))}function el(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function lC(n){this.Ga=0,this.j=[],this.l=new id,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=el("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=el("baseRetryDelayMs",5e3,n),this.hb=el("retryDelaySeedMs",1e4,n),this.eb=el("forwardChannelMaxRetries",2,n),this.xa=el("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new XS(n&&n.concurrentRequestLimit),this.Ja=new kN,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}N=lC.prototype;N.ra=8;N.H=1;function rg(n){if(cC(n),n.H==3){var e=n.W++,t=wi(n.I);if(Te(t,"SID",n.K),Te(t,"RID",e),Te(t,"TYPE","terminate"),wl(n,t),e=new yl(n,n.l,e),e.L=2,e.A=ld(wi(t)),t=!1,W.navigator&&W.navigator.sendBeacon)try{t=W.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&W.Image&&(new Image().src=e.A,t=!0),t||(e.g=yC(e.l,null),e.g.ha(e.A)),e.G=Date.now(),vl(e)}pC(n)}function dd(n){n.g&&(og(n),n.g.cancel(),n.g=null)}function cC(n){dd(n),n.u&&(W.clearTimeout(n.u),n.u=null),Ku(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&W.clearTimeout(n.m),n.m=null)}function hd(n){if(!ZS(n.i)&&!n.m){n.m=!0;var e=n.Na;al||RS(),ll||(al(),ll=!0),Qp.add(e,n),n.C=0}}function BN(n,e){return JS(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=pl(Ct(n.Na,n,e),mC(n,n.C)),n.C++,!0)}N.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let r=new yl(this,this.l,n),s=this.s;if(this.U&&(s?(s=SS(s),CS(s,this.U)):s=this.U),this.o!==null||this.O||(r.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var i=this.j[t];if("__data__"in i.map&&(i=i.map.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=uC(this,r,e),t=wi(this.I),Te(t,"RID",n),Te(t,"CVER",22),this.F&&Te(t,"X-HTTP-Session-Id",this.F),wl(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(aC(s)))+"&"+e:this.o&&ig(t,this.o,s)),tg(this.i,r),this.bb&&Te(t,"TYPE","init"),this.P?(Te(t,"$req",e),Te(t,"SID","null"),r.aa=!0,Pp(r,t,null)):Pp(r,t,e),this.H=2}}else this.H==3&&(n?gS(this,n):this.j.length==0||ZS(this.i)||gS(this))};function gS(n,e){var t;e?t=e.m:t=n.W++;let i=wi(n.I);Te(i,"SID",n.K),Te(i,"RID",t),Te(i,"AID",n.V),wl(n,i),n.o&&n.s&&ig(i,n.o,n.s),t=new yl(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=uC(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),tg(n.i,t),Pp(t,i,e)}function wl(n,e){n.na&&jp(n.na,function(t,i){Te(e,i,t)}),n.h&&$S({},function(t,i){Te(e,i,t)})}function uC(n,e,t){t=Math.min(n.j.length,t);var i=n.h?Ct(n.h.Va,n.h,n):null;e:{var r=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=r[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=r[l].g,u=r[l].map;if(c-=s,0>c)s=Math.max(0,r[l].g-100),a=!1;else try{RN(u,o,"req"+c+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,i}function dC(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;al||RS(),ll||(al(),ll=!0),Qp.add(e,n),n.A=0}}function sg(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=pl(Ct(n.Ma,n),mC(n,n.A)),n.A++,!0)}N.Ma=function(){if(this.u=null,hC(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=pl(Ct(this.jb,this),n)}};N.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ft(10),dd(this),hC(this))};function og(n){n.B!=null&&(W.clearTimeout(n.B),n.B=null)}function hC(n){n.g=new yl(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=wi(n.wa);Te(e,"RID","rpc"),Te(e,"SID",n.K),Te(e,"AID",n.V),Te(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Te(e,"TO",n.qa),Te(e,"TYPE","xmlhttp"),wl(n,e),n.o&&n.s&&ig(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=ld(wi(e)),t.u=null,t.S=!0,zS(t,n)}N.ib=function(){this.v!=null&&(this.v=null,dd(this),sg(this),Ft(19))};function Ku(n){n.v!=null&&(W.clearTimeout(n.v),n.v=null)}function fC(n,e){var t=null;if(n.g==e){Ku(n),og(n),n.g=null;var i=2}else if(Lp(n.i,e))t=e.F,eC(n.i,e),i=1;else return;if(n.H!=0){if(e.i)if(i==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var r=n.C;i=rd(),yt(i,new LS(i,t)),hd(n)}else dC(n);else if(r=e.s,r==3||r==0&&0<e.ca||!(i==1&&BN(n,e)||i==2&&sg(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),r){case 1:ts(n,5);break;case 4:ts(n,10);break;case 3:ts(n,6);break;default:ts(n,2)}}}function mC(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function ts(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var i=Ct(n.pb,n);t||(t=new ns("//www.google.com/images/cleardot.gif"),W.location&&W.location.protocol=="http"||$u(t,"https"),ld(t)),MN(t.toString(),i)}else Ft(2);n.H=0,n.h&&n.h.za(e),pC(n),cC(n)}N.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ft(2)):(this.l.info("Failed to ping google.com"),Ft(1))};function pC(n){if(n.H=0,n.ma=[],n.h){let e=tC(n.i);(e.length!=0||n.j.length!=0)&&(aS(n.ma,e),aS(n.ma,n.j),n.i.i.length=0,Up(n.j),n.j.length=0),n.h.ya()}}function gC(n,e,t){var i=t instanceof ns?wi(t):new ns(t);if(i.g!="")e&&(i.g=e+"."+i.g),Wu(i,i.m);else{var r=W.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new ns(null);i&&$u(s,i),e&&(s.g=e),r&&Wu(s,r),t&&(s.l=t),i=s}return t=n.F,e=n.Da,t&&e&&Te(i,t,e),Te(i,"VER",n.ra),wl(n,i),i}function yC(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Be(new _l({ob:t})):new Be(n.va),e.Oa(n.J),e}N.isActive=function(){return!!this.h&&this.h.isActive(this)};function vC(){}N=vC.prototype;N.Ba=function(){};N.Aa=function(){};N.za=function(){};N.ya=function(){};N.isActive=function(){return!0};N.Va=function(){};function Qu(){if(oo&&!(10<=Number(tN)))throw Error("Environmental error: no available transport.")}Qu.prototype.g=function(n,e){return new Zt(n,e)};function Zt(n,e){rt.call(this),this.g=new lC(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!sl(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!sl(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new lo(this)}st(Zt,rt);Zt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ft(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=gC(n,null,n.Y),hd(n)};Zt.prototype.close=function(){rg(this.g)};Zt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Kp(n),n=t);e.j.push(new IN(e.fb++,n)),e.H==3&&hd(e)};Zt.prototype.N=function(){this.g.h=null,delete this.j,rg(this.g),delete this.g,Zt.$.N.call(this)};function _C(n){Jp.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}st(_C,Jp);function bC(){eg.call(this),this.status=1}st(bC,eg);function lo(n){this.g=n}st(lo,vC);lo.prototype.Ba=function(){yt(this.g,"a")};lo.prototype.Aa=function(n){yt(this.g,new _C(n))};lo.prototype.za=function(n){yt(this.g,new bC)};lo.prototype.ya=function(){yt(this.g,"b")};function VN(){this.blockSize=-1}function Cn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}st(Cn,VN);Cn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Sp(n,e,t){t||(t=0);var i=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)i[r]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(r=0;16>r;++r)i[r]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],r=n.g[2];var s=n.g[3],o=e+(s^t&(r^s))+i[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[2]+606105819&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[3]+3250441966&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[6]+2821735955&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[7]+4249261313&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[10]+4294925233&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[11]+2304563134&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(s^t&(r^s))+i[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(r^e&(t^r))+i[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=r+(t^s&(e^t))+i[14]+2792965006&4294967295,r=s+(o<<17&4294967295|o>>>15),o=t+(e^r&(s^e))+i[15]+1236535329&4294967295,t=r+(o<<22&4294967295|o>>>10),o=e+(r^s&(t^r))+i[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[11]+643717713&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[0]+3921069994&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[15]+3634488961&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[4]+3889429448&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[3]+4107603335&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[8]+1163531501&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(r^s&(t^r))+i[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^r&(e^t))+i[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=r+(e^t&(s^e))+i[7]+1735328473&4294967295,r=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(r^s))+i[12]+2368359562&4294967295,t=r+(o<<20&4294967295|o>>>12),o=e+(t^r^s)+i[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[11]+1839030562&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[14]+4259657740&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[7]+4139469664&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[10]+3200236656&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[3]+3572445317&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[6]+76029189&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(t^r^s)+i[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^r)+i[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=r+(s^e^t)+i[15]+530742520&4294967295,r=s+(o<<16&4294967295|o>>>16),o=t+(r^s^e)+i[2]+3299628645&4294967295,t=r+(o<<23&4294967295|o>>>9),o=e+(r^(t|~s))+i[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[14]+2878612391&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[5]+4237533241&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[10]+4293915773&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[1]+2240044497&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[6]+2734768916&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[13]+1309151649&4294967295,t=r+(o<<21&4294967295|o>>>11),o=e+(r^(t|~s))+i[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~r))+i[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=r+(e^(s|~t))+i[2]+718787259&4294967295,r=s+(o<<15&4294967295|o>>>17),o=t+(s^(r|~e))+i[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+r&4294967295,n.g[3]=n.g[3]+s&4294967295}Cn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(r==0)for(;s<=t;)Sp(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(i[r++]=n.charCodeAt(s++),r==this.blockSize){Sp(this,i),r=0;break}}else for(;s<e;)if(i[r++]=n[s++],r==this.blockSize){Sp(this,i),r=0;break}}this.h=r,this.i+=e};Cn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var i=0;32>i;i+=8)n[t++]=this.g[e]>>>i&255;return n};function fe(n,e){this.h=e;for(var t=[],i=!0,r=n.length-1;0<=r;r--){var s=n[r]|0;i&&s==e||(t[r]=s,i=!1)}this.g=t}var qN={};function ag(n){return-128<=n&&128>n?ZO(n,function(e){return new fe([e|0],0>e?-1:0)}):new fe([n|0],0>n?-1:0)}function $n(n){if(isNaN(n)||!isFinite(n))return so;if(0>n)return gt($n(-n));for(var e=[],t=1,i=0;n>=t;i++)e[i]=n/t|0,t*=Bp;return new fe(e,0)}function wC(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return gt(wC(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=$n(Math.pow(e,8)),i=so,r=0;r<n.length;r+=8){var s=Math.min(8,n.length-r),o=parseInt(n.substring(r,r+s),e);8>s?(s=$n(Math.pow(e,s)),i=i.R(s).add($n(o))):(i=i.R(t),i=i.add($n(o)))}return i}var Bp=4294967296,so=ag(0),Vp=ag(1),yS=ag(16777216);N=fe.prototype;N.ea=function(){if(an(this))return-gt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var i=this.D(t);n+=(0<=i?i:Bp+i)*e,e*=Bp}return n};N.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(bi(this))return"0";if(an(this))return"-"+gt(this).toString(n);for(var e=$n(Math.pow(n,6)),t=this,i="";;){var r=Xu(t,e).g;t=Yu(t,r.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=r,bi(t))return s+i;for(;6>s.length;)s="0"+s;i=s+i}};N.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function bi(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function an(n){return n.h==-1}N.X=function(n){return n=Yu(this,n),an(n)?-1:bi(n)?0:1};function gt(n){for(var e=n.g.length,t=[],i=0;i<e;i++)t[i]=~n.g[i];return new fe(t,~n.h).add(Vp)}N.abs=function(){return an(this)?gt(this):this};N.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0,r=0;r<=e;r++){var s=i+(this.D(r)&65535)+(n.D(r)&65535),o=(s>>>16)+(this.D(r)>>>16)+(n.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,t[r]=o<<16|s}return new fe(t,t[t.length-1]&-2147483648?-1:0)};function Yu(n,e){return n.add(gt(e))}N.R=function(n){if(bi(this)||bi(n))return so;if(an(this))return an(n)?gt(this).R(gt(n)):gt(gt(this).R(n));if(an(n))return gt(this.R(gt(n)));if(0>this.X(yS)&&0>n.X(yS))return $n(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],i=0;i<2*e;i++)t[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<n.g.length;r++){var s=this.D(i)>>>16,o=this.D(i)&65535,a=n.D(r)>>>16,l=n.D(r)&65535;t[2*i+2*r]+=o*l,Hu(t,2*i+2*r),t[2*i+2*r+1]+=s*l,Hu(t,2*i+2*r+1),t[2*i+2*r+1]+=o*a,Hu(t,2*i+2*r+1),t[2*i+2*r+2]+=s*a,Hu(t,2*i+2*r+2)}for(i=0;i<e;i++)t[i]=t[2*i+1]<<16|t[2*i];for(i=e;i<2*e;i++)t[i]=0;return new fe(t,0)};function Hu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function tl(n,e){this.g=n,this.h=e}function Xu(n,e){if(bi(e))throw Error("division by zero");if(bi(n))return new tl(so,so);if(an(n))return e=Xu(gt(n),e),new tl(gt(e.g),gt(e.h));if(an(e))return e=Xu(n,gt(e)),new tl(gt(e.g),e.h);if(30<n.g.length){if(an(n)||an(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Vp,i=e;0>=i.X(n);)t=vS(t),i=vS(i);var r=io(t,1),s=io(i,1);for(i=io(i,2),t=io(t,2);!bi(i);){var o=s.add(i);0>=o.X(n)&&(r=r.add(t),s=o),i=io(i,1),t=io(t,1)}return e=Yu(n,r.R(e)),new tl(r,e)}for(r=so;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),i=Math.ceil(Math.log(t)/Math.LN2),i=48>=i?1:Math.pow(2,i-48),s=$n(t),o=s.R(e);an(o)||0<o.X(n);)t-=i,s=$n(t),o=s.R(e);bi(s)&&(s=Vp),r=r.add(s),n=Yu(n,o)}return new tl(r,n)}N.gb=function(n){return Xu(this,n).h};N.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)&n.D(i);return new fe(t,this.h&n.h)};N.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)|n.D(i);return new fe(t,this.h|n.h)};N.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],i=0;i<e;i++)t[i]=this.D(i)^n.D(i);return new fe(t,this.h^n.h)};function vS(n){for(var e=n.g.length+1,t=[],i=0;i<e;i++)t[i]=n.D(i)<<1|n.D(i-1)>>>31;return new fe(t,n.h)}function io(n,e){var t=e>>5;e%=32;for(var i=n.g.length-t,r=[],s=0;s<i;s++)r[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new fe(r,n.h)}Qu.prototype.createWebChannel=Qu.prototype.g;Zt.prototype.send=Zt.prototype.u;Zt.prototype.open=Zt.prototype.m;Zt.prototype.close=Zt.prototype.close;sd.NO_ERROR=0;sd.TIMEOUT=8;sd.HTTP_ERROR=6;BS.COMPLETE="complete";VS.EventType=gl;gl.OPEN="a";gl.CLOSE="b";gl.ERROR="c";gl.MESSAGE="d";rt.prototype.listen=rt.prototype.O;Be.prototype.listenOnce=Be.prototype.P;Be.prototype.getLastError=Be.prototype.Sa;Be.prototype.getLastErrorCode=Be.prototype.Ia;Be.prototype.getStatus=Be.prototype.da;Be.prototype.getResponseJson=Be.prototype.Wa;Be.prototype.getResponseText=Be.prototype.ja;Be.prototype.send=Be.prototype.ha;Be.prototype.setWithCredentials=Be.prototype.Oa;Cn.prototype.digest=Cn.prototype.l;Cn.prototype.reset=Cn.prototype.reset;Cn.prototype.update=Cn.prototype.j;fe.prototype.add=fe.prototype.add;fe.prototype.multiply=fe.prototype.R;fe.prototype.modulo=fe.prototype.gb;fe.prototype.compare=fe.prototype.X;fe.prototype.toNumber=fe.prototype.ea;fe.prototype.toString=fe.prototype.toString;fe.prototype.getBits=fe.prototype.D;fe.fromNumber=$n;fe.fromString=wC;var $W=Tn.createWebChannelTransport=function(){return new Qu},WW=Tn.getStatEventTarget=function(){return rd()},KW=Tn.ErrorCode=sd,QW=Tn.EventType=BS,YW=Tn.Event=is,XW=Tn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ZW=Tn.FetchXmlHttpFactory=_l,JW=Tn.WebChannel=VS,eK=Tn.XhrIo=Be,EC=Tn.Md5=Cn,rs=Tn.Integer=fe;var Cs=Ww(YA(),1),l1=Ww(nv(),1);var XA="@firebase/firestore",ZA="4.4.0";var et=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};et.UNAUTHENTICATED=new et(null);et.GOOGLE_CREDENTIALS=new et("google-credentials-uid");et.FIRST_PARTY=new et("first-party-uid");et.MOCK_USER=new et("mock-user");var sU="10.7.0";var ka=sU;function oU(n){ka=n}function aU(n){return tU(n,{depth:100})}var Ir=new Iu("@firebase/firestore");function ra(){return Ir.logLevel}function c1(n){Ir.setLogLevel(n)}function A(n,...e){if(Ir.logLevel<=jn.DEBUG){let t=e.map(O0);Ir.debug(`Firestore (${ka}): ${n}`,...t)}}function Oe(n,...e){if(Ir.logLevel<=jn.ERROR){let t=e.map(O0);Ir.error(`Firestore (${ka}): ${n}`,...t)}}function bn(n,...e){if(Ir.logLevel<=jn.WARN){let t=e.map(O0);Ir.warn(`Firestore (${ka}): ${n}`,...t)}}function O0(n){if(typeof n=="string")return n;try{return aU(n)}catch{return n}}function L(n="Unexpected state"){let e=`FIRESTORE (${ka}) INTERNAL ASSERTION FAILED: `+n;throw Oe(e),new Error(e)}function q(n,e){n||L()}function u1(n,e){n||L()}function P(n,e){return n}var _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},S=class extends _E{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var $e=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var bf=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},P_=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(et.UNAUTHENTICATED))}shutdown(){}},F_=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},L_=class{constructor(e){this.authProvider=e,this.currentUser=et.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.tokenCounter,r=l=>this.tokenCounter!==i?(i=this.tokenCounter,t(l)):Promise.resolve(),s=new $e;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new $e,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>p(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},a=l=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new $e)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.tokenCounter!==e?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(q(typeof i.accessToken=="string"),new bf(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new et(e)}},B_=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i,this.type="FirstParty",this.user=et.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},V_=class{constructor(e,t,i){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=i}getToken(){return Promise.resolve(new B_(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(et.FIRST_PARTY))}shutdown(){}invalidateToken(){}},q_=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},U_=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let i=s=>{s.error!=null&&A("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,A("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>i(s))};let r=s=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?r(s):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.latestAppCheckToken=t.token,new q_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function lU(n){if(!n)return new P_;switch(n.type){case"firstParty":return new V_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new S(_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function cU(n){return rU(n)}var wf=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,i="",r=20;for(;i.length<r;){let s=cU(40);for(let o=0;o<s.length;++o)i.length<r&&s[o]<t&&(i+=e.charAt(s[o]%e.length))}return i}};function Q(n,e){return n<e?-1:n>e?1:0}function Ts(n,e,t){return n.length!==e.length?!1:n.every((i,r)=>t(i,e[r]))}function d1(n){return n+"\0"}var JA=-62135596800,eD=1e6,Ne=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new S(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new S(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<JA)throw new S(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new S(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),i=Math.floor((e-t*1e3)*eD);return new n(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/eD}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-JA,t=String(e).padStart(12,"0"),i=String(this.nanoseconds).padStart(9,"0");return t+"."+i}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ne(0,0))}static max(){return new n(new Ne(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var tD="__name__",Ef=class n{constructor(e,t,i){t===void 0?t=0:t>e.length&&L(),i===void 0?i=e.length-t:i>e.length-t&&L(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let i=Math.min(e.length,t.length);for(let r=0;r<i;r++){let s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ce=class n extends Ef{construct(e,t,i){return new n(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let i of e){if(i.indexOf("//")>=0)throw new S(_.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new n(t)}static emptyPath(){return new n([])}},uU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ke=class n extends Ef{construct(e,t,i){return new n(e,t,i)}static isValidIdentifier(e){return uU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===tD}static keyField(){return new n([tD])}static fromServerFormat(e){let t=[],i="",r=0,s=()=>{if(i.length===0)throw new S(_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""},o=!1;for(;r<e.length;){let a=e[r];if(a==="\\"){if(r+1===e.length)throw new S(_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[r+1];if(!(l==="\\"||l==="."||l==="`"))throw new S(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else a==="`"?(o=!o,r++):a==="."&&!o?(s(),r++):(i+=a,r++)}if(s(),o)throw new S(_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var O=class n{constructor(e){this.path=e}static fromPath(e){return new n(ce.fromString(e))}static fromName(e){return new n(ce.fromString(e).popFirst(5))}static empty(){return new n(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ce(e.slice()))}};var fa=-1,dU=0,z_=(()=>{class n{constructor(t,i,r,s){this.indexId=t,this.collectionGroup=i,this.fields=r,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function N0(n){return n.fields.find(e=>e.kind===2)}function xs(n){return n.fields.filter(e=>e.kind!==2)}function hU(n){let e=xs(n);return e.length===0?0:e[e.length-1].kind}function fU(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var ua=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var pc=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(dU,wn.min())}};function h1(n,e){let t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=j.fromTimestamp(i===1e9?new Ne(t+1,0):new Ne(t,i));return new wn(r,O.empty(),e)}function f1(n){return new wn(n.readTime,n.key,fa)}var wn=class n{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new n(j.min(),O.empty(),fa)}static max(){return new n(j.max(),O.empty(),fa)}};function P0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=O.comparator(n.documentKey,e.documentKey),t!==0)?t:Q(n.largestBatchId,e.largestBatchId)}var m1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Sf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Vr(n){return p(this,null,function*(){if(n.code===_.FAILED_PRECONDITION&&n.message===m1)A("LocalStore","Unexpectedly lost primary lease");else throw n})}var g=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,i)=>{t(e)})}static reject(e){return new n((t,i)=>{i(e)})}static waitFor(e){return new n((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},l=>i(l))}),o=!0,s===r&&t()})}static or(e){let t=n.resolve(!1);for(let i of e)t=t.next(r=>r?n.resolve(r):i());return t}static forEach(e,t){let i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new n((i,r)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(e,t){return new n((i,r)=>{let s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}};var nn="SimpleDb",mU=3,Cf=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new $e,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Ss(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=i=>{let r=F0(i.target.error);this.completionDeferred.reject(new Ss(e,r))}}static open(e,t,i,r){try{return new n(t,e.transaction(r,i))}catch(s){throw new Ss(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(A(nn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new G_(t)}},Ar=class n{constructor(e,t,i){this.name=e,this.version=t,this.schemaConverter=i,n.getIOSVersion(Tu())===12.2&&Oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return A(nn,"Removing database:",e),gs(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!xu())return!1;if(n.isMockPersistence())return!0;let e=Tu(),t=n.getIOSVersion(e),i=0<t&&t<10,r=n.getAndroidVersion(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}ensureDb(e){return p(this,null,function*(){return this.db||(A(nn,"Opening database:",this.name),this.db=yield new Promise((t,i)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{let o=s.target.result;t(o)},r.onblocked=()=>{i(new Ss(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{let o=s.target.error;o.name==="VersionError"?i(new S(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new S(_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Ss(e,o))},r.onupgradeneeded=s=>{A(nn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,r.transaction,s.oldVersion,this.version).next(()=>{A(nn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Cf.open(this.db,e,s?"readonly":"readwrite",i),l=r(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),g.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<mU;if(A(nn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},j_=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return gs(this.dbCursor.delete())}},Ss=class extends S{constructor(e,t){super(_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function qr(n){return n.name==="IndexedDbTransactionError"}var G_=class{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(A(nn,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(A(nn,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),gs(i)}add(e){A(nn,"ADD",this.store.name,e,e);let t=this.store.add(e);return gs(t)}get(e){let t=this.store.get(e);return gs(t).next(i=>(i===void 0&&(i=null),A(nn,"GET",this.store.name,e,i),i))}delete(e){A(nn,"DELETE",this.store.name,e);let t=this.store.delete(e);return gs(t)}count(){A(nn,"COUNT",this.store.name);let e=this.store.count();return gs(e)}loadAll(e,t){let i=this.options(e,t);if(!i.index&&typeof this.store.getAll=="function"){let r=this.store.getAll(i.range);return new g((s,o)=>{r.onerror=a=>{o(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}else{let r=this.cursor(i),s=[];return this.iterateCursor(r,(o,a)=>{s.push(a)}).next(()=>s)}}loadFirst(e,t){let i=this.store.getAll(e,t===null?void 0:t);return new g((r,s)=>{i.onerror=o=>{s(o.target.error)},i.onsuccess=o=>{r(o.target.result)}})}deleteAll(e,t){A(nn,"DELETE ALL",this.store.name);let i=this.options(e,t);i.keysOnly=!1;let r=this.cursor(i);return this.iterateCursor(r,(s,o,a)=>a.delete())}iterate(e,t){let i;t?i=e:(i={},t=e);let r=this.cursor(i);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new g((i,r)=>{t.onerror=s=>{let o=F0(s.target.error);r(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){i();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():i()})}})}iterateCursor(e,t){let i=[];return new g((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){r();return}let l=new j_(a),c=t(a.primaryKey,a.value,l);if(c instanceof g){let u=c.catch(d=>(l.done(),g.reject(d)));i.push(u)}l.isDone?r():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>g.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let i=this.store.index(e.index);return e.keysOnly?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function gs(n){return new g((e,t)=>{n.onsuccess=i=>{let r=i.target.result;e(r)},n.onerror=i=>{let r=F0(i.target.error);t(r)}})}var nD=!1;function F0(n){let e=Ar.getIOSVersion(Tu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let i=new S("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nD||(nD=!0,setTimeout(()=>{throw i},0)),i}}return n}var cc="IndexBackiller",pU=15*1e3,gU=60*1e3,yU=50,H_=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(pU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){A(cc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();A(cc,`Documents written: ${t}`)}catch(t){qr(t)?A(cc,"Ignoring IndexedDB error during index backfill: ",t):yield Vr(t)}yield this.schedule(gU)}))}},$_=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return p(this,arguments,function*(e=yU){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let i=new Set,r=t,s=!0;return g.doWhile(()=>s===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||i.has(o))s=!1;else return A(cc,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,r).next(a=>{r-=a,i.add(o)})})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(r,s)).next(a=>(A(cc,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let i=e;return t.changes.forEach((r,s)=>{let o=f1(s);P0(o,i)>0&&(i=o)}),new wn(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}};var rn=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.setPreviousValue(r),this.writeNewSequenceNumber=r=>i.writeSequenceNumber(r))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),da="",W_="",p1="",g1="";function Ut(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=iD(e)),e=vU(n.get(t),e);return iD(e)}function vU(n,e){let t=e,i=n.length;for(let r=0;r<i;r++){let s=n.charAt(r);switch(s){case"\0":t+=da+p1;break;case da:t+=da+g1;break;default:t+=s}}return t}function iD(n){return n+da+W_}function ui(n){let e=n.length;if(q(e>=2),e===2)return q(n.charAt(0)===da&&n.charAt(1)===W_),ce.emptyPath();let t=e-2,i=[],r="";for(let s=0;s<e;){let o=n.indexOf(da,s);switch((o<0||o>t)&&L(),n.charAt(o+1)){case W_:let l=n.substring(s,o),c;r.length===0?c=l:(r+=l,c=r,r=""),i.push(c);break;case p1:r+=n.substring(s,o),r+="\0";break;case g1:r+=n.substring(s,o+1);break;default:L()}s=o+2}return new ce(i)}var ys="remoteDocuments";var Uc="owner",Xo="owner",zc="mutationQueues",_U="userId",Nn="mutations",y1="batchId",ws="userMutationsIndex",v1=["userId","batchId"];function bU(n){return[n]}function mf(n,e){return[n,Ut(e)]}function _1(n,e,t){return[n,Ut(e),t]}var wU={},Ra="documentMutations",hm="remoteDocumentsV14",EU=["prefixPath","collectionGroup","readTime","documentId"],pf="documentKeyIndex",SU=["prefixPath","collectionGroup","documentId"],b1="collectionGroupIndex",CU=["collectionGroup","readTime","prefixPath","documentId"],jc="remoteDocumentGlobal",K_="remoteDocumentGlobalKey",Ma="targets",TU="targetId",w1="queryTargetsIndex",xU=["canonicalId","targetId"],Oa="targetDocuments",IU=["targetId","path"],L0="documentTargetsIndex",AU=["path","targetId"],Tf="targetGlobalKey",Vs="targetGlobal",gc="collectionParents",DU=["collectionId","parent"],ma="clientMetadata",kU="clientId",fm="bundles",RU="bundleId",mm="namedQueries",MU="name",B0="indexConfiguration",OU="indexId",Q_="collectionGroupIndex",NU="collectionGroup",V0="indexState",PU=["indexId","uid"],E1="sequenceNumberIndex",FU=["uid","sequenceNumber"],q0="indexEntries",LU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],S1="documentKeyIndex",BU=["indexId","uid","orderedDocumentKey"],pm="documentOverlays",VU=["userId","collectionPath","documentId"],Y_="collectionPathOverlayIndex",qU=["userId","collectionPath","largestBatchId"],C1="collectionGroupOverlayIndex",UU=["userId","collectionGroup","largestBatchId"],zU=[zc,Nn,Ra,ys,Ma,Uc,Vs,Oa],jU=zU,GU=[...jU,ma],HU=[...GU,jc],$U=[...HU,gc],T1=[...$U,fm,mm],WU=[...T1,pm],x1=[zc,Nn,Ra,hm,Ma,Uc,Vs,Oa,ma,jc,gc,fm,mm,pm],I1=x1,KU=[...I1,B0,V0,q0];function QU(n){if(n===15)return KU;if(n===14)return I1;if(n===13)return x1;if(n===12)return WU;if(n===11)return T1;L()}var yc=class extends Sf{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function dt(n,e){let t=P(n);return Ar.getStore(t.simpleDbTransaction,e)}function rD(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function A1(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var xe=class n{constructor(e,t){this.comparator=e,this.root=t||uc.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,uc.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,uc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){let r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){let e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new la(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new la(this.root,e,this.comparator,!1)}getReverseIterator(){return new la(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new la(this.root,e,this.comparator,!0)}},la=class{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},uc=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let r,s=this;if(i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),i(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),X_=class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,i,r,s){return this}insert(e,t,i){return new uc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};uc.EMPTY=new X_;var ye=class n{constructor(e){this.comparator=e,this.data=new xe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){let i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){let r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(t!==void 0?i=this.data.getIteratorFrom(t):i=this.data.getIterator();i.hasNext();){let r=i.getNext();if(!e(r.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xf(this.data.getIterator())}getIteratorFrom(e){return new xf(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},xf=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function YU(n,e,t,i,r){let s=n.getIterator(),o=e.getIterator(),a=Zo(s),l=Zo(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(i(l),l=Zo(o)):u?(r(a),a=Zo(s)):(a=Zo(s),l=Zo(o))}}function Zo(n){return n.hasNext()?n.getNext():void 0}var sn=class n{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new n([])}unionWith(e){let t=new ye(Ke.comparator);for(let i of this.fields)t=t.add(i);for(let i of e)t=t.add(i);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ts(this.fields,e.fields,(t,i)=>t.isEqual(i))}};function XU(n){return Buffer.from(n,"base64").toString("binary")}function ZU(n){return Buffer.from(n,"binary").toString("base64")}function D1(){return!0}var ut=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=XU(e);return new n(t)}static fromUint8Array(e){let t=JU(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return ZU(this.binaryString)}toUint8Array(){return e4(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ut.EMPTY_BYTE_STRING=new ut("");function JU(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function e4(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var t4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dr(n){if(q(!!n),typeof n=="string"){let e=0,t=t4.exec(n);if(q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}else{let e=Ue(n.seconds),t=Ue(n.nanos);return{seconds:e,nanos:t}}}function Ue(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kr(n){return typeof n=="string"?ut.fromBase64String(n):ut.fromUint8Array(n)}var k1="server_timestamp",R1="__type__",M1="__previous_value__",O1="__local_write_time__";function gm(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[R1])===null||t===void 0?void 0:t.stringValue)===k1}function n4(n,e){let t={fields:{[R1]:{stringValue:k1},[O1]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&gm(e)&&(e=U0(e)),e&&(t.fields[M1]=e),{mapValue:t}}function U0(n){let e=n.mapValue.fields[M1];return gm(e)?U0(e):e}function vc(n){let e=Dr(n.mapValue.fields[O1].timestampValue);return new Ne(e.seconds,e.nanos)}var Z_=class{constructor(e,t,i,r,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},sD="(default)",Rr=class n{constructor(e,t){this.projectId=e,this.database=t||sD}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===sD}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function i4(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new S(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rr(n.options.projectId,e)}var xr=-1;function Gc(n){return n==null}function _c(n){return n===0&&1/n===1/-0}function N1(n){return typeof n=="number"&&Number.isInteger(n)&&!_c(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var P1="__max__",Cr={mapValue:{fields:{__type__:{stringValue:P1}}}},gf={nullValue:"NULL_VALUE"};function Is(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gm(n)?4:F1(n)?9007199254740991:10:L()}function Pn(n,e){if(n===e)return!0;let t=Is(n),i=Is(e);if(t!==i)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return vc(n).isEqual(vc(e));case 3:return r4(n,e);case 5:return n.stringValue===e.stringValue;case 6:return o4(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return s4(n,e);case 2:return a4(n,e);case 9:return Ts(n.arrayValue.values||[],e.arrayValue.values||[],Pn);case 10:return l4(n,e);case 9007199254740991:return!0;default:return L()}}function r4(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Dr(n.timestampValue),i=Dr(e.timestampValue);return t.seconds===i.seconds&&t.nanos===i.nanos}function s4(n,e){return Ue(n.geoPointValue.latitude)===Ue(e.geoPointValue.latitude)&&Ue(n.geoPointValue.longitude)===Ue(e.geoPointValue.longitude)}function o4(n,e){return kr(n.bytesValue).isEqual(kr(e.bytesValue))}function a4(n,e){if("integerValue"in n&&"integerValue"in e)return Ue(n.integerValue)===Ue(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ue(n.doubleValue),i=Ue(e.doubleValue);return t===i?_c(t)===_c(i):isNaN(t)&&isNaN(i)}return!1}function l4(n,e){let t=n.mapValue.fields||{},i=e.mapValue.fields||{};if(rD(t)!==rD(i))return!1;for(let r in t)if(t.hasOwnProperty(r)&&(i[r]===void 0||!Pn(t[r],i[r])))return!1;return!0}function bc(n,e){return(n.values||[]).find(t=>Pn(t,e))!==void 0}function Mr(n,e){if(n===e)return 0;let t=Is(n),i=Is(e);if(t!==i)return Q(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return c4(n,e);case 3:return oD(n.timestampValue,e.timestampValue);case 4:return oD(vc(n),vc(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return h4(n.bytesValue,e.bytesValue);case 7:return u4(n.referenceValue,e.referenceValue);case 8:return d4(n.geoPointValue,e.geoPointValue);case 9:return f4(n.arrayValue,e.arrayValue);case 10:return m4(n.mapValue,e.mapValue);default:throw L()}}function c4(n,e){let t=Ue(n.integerValue||n.doubleValue),i=Ue(e.integerValue||e.doubleValue);return t<i?-1:t>i?1:t===i?0:isNaN(t)?isNaN(i)?0:-1:1}function oD(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=Dr(n),i=Dr(e),r=Q(t.seconds,i.seconds);return r!==0?r:Q(t.nanos,i.nanos)}function u4(n,e){let t=n.split("/"),i=e.split("/");for(let r=0;r<t.length&&r<i.length;r++){let s=Q(t[r],i[r]);if(s!==0)return s}return Q(t.length,i.length)}function d4(n,e){let t=Q(Ue(n.latitude),Ue(e.latitude));return t!==0?t:Q(Ue(n.longitude),Ue(e.longitude))}function h4(n,e){let t=kr(n),i=kr(e);return t.compareTo(i)}function f4(n,e){let t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){let s=Mr(t[r],i[r]);if(s)return s}return Q(t.length,i.length)}function m4(n,e){if(n===Cr.mapValue&&e===Cr.mapValue)return 0;if(n===Cr.mapValue)return 1;if(e===Cr.mapValue)return-1;let t=n.fields||{},i=Object.keys(t),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){let a=Q(i[o],s[o]);if(a!==0)return a;let l=Mr(t[i[o]],r[s[o]]);if(l!==0)return l}return Q(i.length,s.length)}function pa(n){return z0(n)}function z0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?g4(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?p4(n.bytesValue):"referenceValue"in n?v4(n.referenceValue):"geoPointValue"in n?y4(n.geoPointValue):"arrayValue"in n?b4(n.arrayValue):"mapValue"in n?_4(n.mapValue):L()}function p4(n){return kr(n).toBase64()}function g4(n){let e=Dr(n);return`time(${e.seconds},${e.nanos})`}function y4(n){return`geo(${n.latitude},${n.longitude})`}function v4(n){return O.fromName(n).toString()}function _4(n){let e=Object.keys(n.fields||{}).sort(),t="{",i=!0;for(let r of e)i?i=!1:t+=",",t+=`${r}:${z0(n.fields[r])}`;return t+"}"}function b4(n){let e="[",t=!0;for(let i of n.values||[])t?t=!1:e+=",",e+=z0(i);return e+"]"}function As(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function J_(n){return!!n&&"integerValue"in n}function w4(n){return!!n&&"doubleValue"in n}function E4(n){return J_(n)||w4(n)}function wc(n){return!!n&&"arrayValue"in n}function aD(n){return!!n&&"nullValue"in n}function lD(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function yf(n){return!!n&&"mapValue"in n}function dc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return qs(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=dc(i)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=dc(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function F1(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===P1}function S4(n){return"nullValue"in n?gf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?As(Rr.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:L()}function C4(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?As(Rr.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Cr:L()}function cD(n,e){let t=Mr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function uD(n,e){let t=Mr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Rt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!yf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let i=this.getFieldsMap(e.popLast());i[e.lastSegment()]=dc(t)}setAll(e){let t=Ke.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=dc(o):r.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){let t=this.field(e.popLast());yf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];(!yf(r)||!r.mapValue.fields)&&(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){qs(t,(r,s)=>e[r]=s);for(let r of i)delete e[r]}clone(){return new n(dc(this.value))}};function L1(n){let e=[];return qs(n.fields,(t,i)=>{let r=new Ke([t]);if(yf(i)){let o=L1(i.mapValue).fields;if(o.length===0)e.push(r);else for(let a of o)e.push(r.child(a))}else e.push(r)}),new sn(e)}var Je=class n{constructor(e,t,i,r,s,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),Rt.empty(),0)}static newFoundDocument(e,t,i,r){return new n(e,1,t,j.min(),i,r,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),Rt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),Rt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(j.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function T4(n,e,t){let i=e.data.field(n),r=t.data.field(n);return i!==null&&r!==null?Mr(i,r):L()}var mi=class{constructor(e,t){this.position=e,this.inclusive=t}};function B1(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){let s=e[r],o=n.position[r];if(s.field.isKeyField())i=O.comparator(O.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);i=Mr(o,a)}if(s.dir==="desc"&&(i=i*-1),i!==0)break}return i}function x4(n,e,t){let i=B1(n,e,t);return n.inclusive?i>=0:i>0}function I4(n,e,t){let i=B1(n,e,t);return n.inclusive?i<=0:i<0}function dD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let i=n.position[t],r=e.position[t];if(!Pn(i,r))return!1}return!0}var Ds=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function A4(n){return n.field.canonicalString()+n.dir}function D4(n){return`${n.field.canonicalString()} (${n.dir})`}function k4(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var If=class{},ee=class n extends If{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new nb(e,t,i):t==="array-contains"?new sb(e,i):t==="in"?new Af(e,i):t==="not-in"?new ob(e,i):t==="array-contains-any"?new ab(e,i):new n(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new ib(e,i):new rb(e,i)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Mr(t,this.value)):t!==null&&Is(this.value)===Is(t)&&this.matchesComparison(Mr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},me=class n extends If{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ga(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ga(n){return n.op==="and"}function eb(n){return n.op==="or"}function j0(n){return V1(n)&&ga(n)}function V1(n){for(let e of n.filters)if(e instanceof me)return!1;return!0}function tb(n){if(n instanceof ee)return n.field.canonicalString()+n.op.toString()+pa(n.value);if(j0(n))return n.filters.map(e=>tb(e)).join(",");{let e=n.filters.map(t=>tb(t)).join(",");return`${n.op}(${e})`}}function q1(n,e){if(n instanceof ee)return R4(n,e);if(n instanceof me)return M4(n,e);L()}function R4(n,e){return e instanceof ee&&n.op===e.op&&n.field.isEqual(e.field)&&Pn(n.value,e.value)}function M4(n,e){return e instanceof me&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((i,r,s)=>i&&q1(r,e.filters[s]),!0):!1}function U1(n,e){let t=n.filters.concat(e);return me.create(t,n.op)}function z1(n){return n instanceof ee?N4(n):n instanceof me?O4(n):"Filter"}function O4(n){return n.op.toString()+" {"+n.getFilters().map(z1).join(" ,")+"}"}function N4(n){return`${n.field.canonicalString()} ${n.op} ${pa(n.value)}`}var nb=class extends ee{constructor(e,t,i){super(e,t,i),this.key=O.fromName(i.referenceValue)}matches(e){let t=O.comparator(e.key,this.key);return this.matchesComparison(t)}},ib=class extends ee{constructor(e,t){super(e,"in",t),this.keys=j1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},rb=class extends ee{constructor(e,t){super(e,"not-in",t),this.keys=j1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function j1(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>O.fromName(i.referenceValue))}var sb=class extends ee{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return wc(t)&&bc(t.arrayValue,this.value)}},Af=class extends ee{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&bc(this.value.arrayValue,t)}},ob=class extends ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(bc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!bc(this.value.arrayValue,t)}},ab=class extends ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!wc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(i=>bc(this.value.arrayValue,i))}};var lb=class{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function cb(n,e=null,t=[],i=[],r=null,s=null,o=null){return new lb(n,e,t,i,r,s,o)}function ks(n){let e=P(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>tb(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>A4(i)).join(","),Gc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>pa(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>pa(i)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function P4(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>z1(t)).join(", ")}]`),Gc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>D4(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>pa(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>pa(t)).join(",")),`Target(${e})`}function Hc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!k4(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!q1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!dD(n.startAt,e.startAt)?!1:dD(n.endAt,e.endAt)}function Df(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function ym(n,e){return n.filters.filter(t=>t instanceof ee&&t.field.isEqual(e))}function F4(n,e){let t=N0(e);if(t===void 0)return null;for(let i of ym(n,t.fieldPath))switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}return null}function L4(n,e){let t=new Map;for(let i of xs(e))for(let r of ym(n,i.fieldPath))switch(r.op){case"==":case"in":t.set(i.fieldPath.canonicalString(),r.value);break;case"not-in":case"!=":return t.set(i.fieldPath.canonicalString(),r.value),Array.from(t.values())}return null}function B4(n,e){let t=[],i=!0;for(let r of xs(e)){let s=r.kind===0?G1(n,r.fieldPath,n.startAt):H1(n,r.fieldPath,n.startAt);t.push(s.value),i&&(i=s.inclusive)}return new mi(t,i)}function V4(n,e){let t=[],i=!0;for(let r of xs(e)){let s=r.kind===0?H1(n,r.fieldPath,n.endAt):G1(n,r.fieldPath,n.endAt);t.push(s.value),i&&(i=s.inclusive)}return new mi(t,i)}function G1(n,e,t){let i=gf,r=!0;for(let s of ym(n,e)){let o=gf,a=!0;switch(s.op){case"<":case"<=":o=S4(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=gf;break}cD({value:i,inclusive:r},{value:o,inclusive:a})<0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];cD({value:i,inclusive:r},{value:a,inclusive:t.inclusive})<0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function H1(n,e,t){let i=Cr,r=!0;for(let s of ym(n,e)){let o=Cr,a=!0;switch(s.op){case">=":case">":o=C4(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Cr;break}uD({value:i,inclusive:r},{value:o,inclusive:a})>0&&(i=o,r=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];uD({value:i,inclusive:r},{value:a,inclusive:t.inclusive})>0&&(i=a,r=t.inclusive);break}}return{value:i,inclusive:r}}function q4(n){let e=new ye(Ke.comparator),t=!1;for(let i of n.filters)for(let r of i.getFlattenedFilters())r.field.isKeyField()||(r.op==="array-contains"||r.op==="array-contains-any"?t=!0:e=e.add(r.field));for(let i of n.orderBy)i.field.isKeyField()||(e=e.add(i.field));return e.size+(t?1:0)}function U4(n){return n.limit!==null}var Fn=class{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function $1(n,e,t,i,r,s,o,a){return new Fn(n,e,t,i,r,s,o,a)}function Na(n){return new Fn(n)}function z4(n,e){return new Fn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function hD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function j4(n){let e=new ye(Ke.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(r=>{r.isInequality()&&(e=e.add(r.field))})}),e}function G4(n){return new Fn(ce.emptyPath(),n)}function H4(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function G0(n){return n.collectionGroup!==null}function ya(n){let e=P(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";j4(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Ds(s,i))}),t.has(Ke.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Ds(Ke.keyField(),i))}return e.memoizedNormalizedOrderBy}function zt(n){let e=P(n);return e.memoizedTarget||(e.memoizedTarget=$4(e,ya(n))),e.memoizedTarget}function $4(n,e){if(n.limitType==="F")return cb(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{let s=r.dir==="desc"?"asc":"desc";return new Ds(r.field,s)});let t=n.endAt?new mi(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new mi(n.startAt.position,n.startAt.inclusive):null;return cb(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function H0(n,e){let t=n.filters.concat([e]);return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function W4(n,e){let t=n.explicitOrderBy.concat([e]);return new Fn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function kf(n,e,t){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function K4(n,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function Q4(n,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function $c(n,e){return Hc(zt(n),zt(e))&&n.limitType===e.limitType}function W1(n){return`${ks(zt(n))}|lt:${n.limitType}`}function sa(n){return`Query(target=${P4(zt(n))}; limitType=${n.limitType})`}function Wc(n,e){return e.isFoundDocument()&&Y4(n,e)&&X4(n,e)&&Z4(n,e)&&J4(n,e)}function Y4(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):O.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function X4(n,e){for(let t of ya(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function Z4(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function J4(n,e){return!(n.startAt&&!I4(n.startAt,ya(n),e)||n.endAt&&!x4(n.endAt,ya(n),e))}function K1(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function Q1(n){return(e,t)=>{let i=!1;for(let r of ya(n)){let s=ez(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function ez(n,e,t){let i=n.field.isKeyField()?O.comparator(e.key,t.key):T4(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return L()}}var pi=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(let[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0){this.inner[i]=[[e,t]],this.innerSize++;return}for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e)){r[s]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){qs(this.inner,(t,i)=>{for(let[r,s]of i)e(r,s)})}isEmpty(){return A1(this.inner)}size(){return this.innerSize}};var tz=new xe(O.comparator);function Yt(){return tz}var Y1=new xe(O.comparator);function ac(...n){let e=Y1;for(let t of n)e=e.insert(t.key,t);return e}function nz(){return Ec()}function X1(n){let e=Y1;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function di(){return Ec()}function Z1(){return Ec()}function Ec(){return new pi(n=>n.toString(),(n,e)=>n.isEqual(e))}var iz=new xe(O.comparator);function rz(){return iz}var sz=new ye(O.comparator);function Y(...n){let e=sz;for(let t of n)e=e.add(t);return e}var oz=new ye(Q);function $0(){return oz}function J1(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_c(e)?"-0":e}}function ek(n){return{integerValue:""+n}}function tk(n,e){return N1(e)?ek(e):J1(n,e)}var va=class{constructor(){this._=void 0}};function az(n,e,t){return n instanceof Or?n4(t,e):n instanceof Mi?ik(n,e):n instanceof Oi?rk(n,e):uz(n,e)}function lz(n,e,t){return n instanceof Mi?ik(n,e):n instanceof Oi?rk(n,e):t}function nk(n,e){return n instanceof Nr?E4(e)?e:{integerValue:0}:null}function cz(n,e){return n instanceof Mi&&e instanceof Mi||n instanceof Oi&&e instanceof Oi?Ts(n.elements,e.elements,Pn):n instanceof Nr&&e instanceof Nr?Pn(n.operand,e.operand):n instanceof Or&&e instanceof Or}var Or=class extends va{},Mi=class extends va{constructor(e){super(),this.elements=e}};function ik(n,e){let t=sk(e);for(let i of n.elements)t.some(r=>Pn(r,i))||t.push(i);return{arrayValue:{values:t}}}var Oi=class extends va{constructor(e){super(),this.elements=e}};function rk(n,e){let t=sk(e);for(let i of n.elements)t=t.filter(r=>!Pn(r,i));return{arrayValue:{values:t}}}var Nr=class extends va{constructor(e,t){super(),this.serializer=e,this.operand=t}};function uz(n,e){let t=nk(n,e),i=fD(t)+fD(n.operand);return J_(t)&&J_(n.operand)?ek(i):J1(n.serializer,i)}function fD(n){return Ue(n.integerValue||n.doubleValue)}function sk(n){return wc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Rs=class{constructor(e,t){this.field=e,this.transform=t}};function dz(n,e){return n.field.isEqual(e.field)&&cz(n.transform,e.transform)}function hz(n,e){return n===void 0&&e===void 0?!0:n&&e?Ts(n,e,(t,i)=>dz(t,i)):!1}var ub=class{constructor(e,t){this.version=e,this.transformResults=t}},qe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function vm(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var _a=class{};function ok(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Fr(n.key,qe.none()):new Pr(n.key,n.data,qe.none());{let t=n.data,i=Rt.empty(),r=new ye(Ke.comparator);for(let s of e.fields)if(!r.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new Ln(n.key,i,new sn(r.toArray()),qe.none())}}function fz(n,e,t){n instanceof Pr?pz(n,e,t):n instanceof Ln?yz(n,e,t):_z(n,e,t)}function hc(n,e,t,i){return n instanceof Pr?gz(n,e,t,i):n instanceof Ln?vz(n,e,t,i):bz(n,e,t)}function mz(n,e){let t=null;for(let i of n.fieldTransforms){let r=e.data.field(i.field),s=nk(i.transform,r||null);s!=null&&(t===null&&(t=Rt.empty()),t.set(i.field,s))}return t||null}function mD(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!hz(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Pr=class extends _a{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}};function pz(n,e,t){let i=n.value.clone(),r=lk(n.fieldTransforms,e,t.transformResults);i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function gz(n,e,t,i){if(!vm(n.precondition,e))return t;let r=n.value.clone(),s=ck(n.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}var Ln=class extends _a{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function yz(n,e,t){if(!vm(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let i=lk(n.fieldTransforms,e,t.transformResults),r=e.data;r.setAll(ak(n)),r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function vz(n,e,t,i){if(!vm(n.precondition,e))return t;let r=ck(n.fieldTransforms,i,e),s=e.data;return s.setAll(ak(n)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function ak(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let i=n.data.field(t);e.set(t,i)}}),e}function lk(n,e,t){let i=new Map;q(n.length===t.length);for(let r=0;r<t.length;r++){let s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,lz(o,a,t[r]))}return i}function ck(n,e,t){let i=new Map;for(let r of n){let s=r.transform,o=t.data.field(r.field);i.set(r.field,az(s,o,e))}return i}var Fr=class extends _a{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function _z(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function bz(n,e,t){return vm(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Sc=class extends _a{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Cc=class{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){let i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){let s=this.mutations[r];if(s.key.isEqual(e.key)){let o=i[r];fz(s,e,o)}}}applyToLocalView(e,t){for(let i of this.baseMutations)i.key.isEqual(e.key)&&(t=hc(i,e,t,this.localWriteTime));for(let i of this.mutations)i.key.isEqual(e.key)&&(t=hc(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let i=Z1();return this.mutations.forEach(r=>{let s=e.get(r.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(r.key)?null:a;let l=ok(o,a);l!==null&&i.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(j.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&Ts(this.mutations,e.mutations,(t,i)=>mD(t,i))&&Ts(this.baseMutations,e.baseMutations,(t,i)=>mD(t,i))}},db=class n{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){q(e.mutations.length===i.length);let r=rz(),s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new n(e,t,i,r)}};var Tc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hb=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ct=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(ct||{});function uk(n){switch(n){case _.OK:return L();case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0;default:return L()}}function wz(n){return uk(n)&&n!==_.ABORTED}function vf(n){if(n===void 0)return Oe("GRPC error has no .code"),_.UNKNOWN;switch(n){case ct.OK:return _.OK;case ct.CANCELLED:return _.CANCELLED;case ct.UNKNOWN:return _.UNKNOWN;case ct.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case ct.INTERNAL:return _.INTERNAL;case ct.UNAVAILABLE:return _.UNAVAILABLE;case ct.UNAUTHENTICATED:return _.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case ct.NOT_FOUND:return _.NOT_FOUND;case ct.ALREADY_EXISTS:return _.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return _.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case ct.ABORTED:return _.ABORTED;case ct.OUT_OF_RANGE:return _.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return _.UNIMPLEMENTED;case ct.DATA_LOSS:return _.DATA_LOSS;default:return L()}}var fb=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var x_=null;function dk(){return new nU}function Ez(){return new iU("utf-8")}var Sz=new rs([4294967295,4294967295],0);function pD(n){let e=dk().encode(n),t=new EC;return t.update(e),new Uint8Array(t.digest())}function gD(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new rs([t,i],0),a=new rs([r,s],0);return[o,a]}var mb=class n{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Es(`Invalid padding: ${t}`);if(i<0)throw new Es(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Es(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Es(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=rs.fromNumber(this.bitCount)}getBitIndex(e,t,i){let r=e.add(t.multiply(rs.fromNumber(i)));return r.compare(Sz)===1&&(r=new rs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],i=e%8;return(t&1<<i)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=pD(e),[i,r]=gD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,i){let r=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,r,t);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=pD(e),[i,r]=gD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(i,r,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}},Es=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var xc=class n{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){let r=new Map;return r.set(e,Ic.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new n(j.min(),r,new xe(Q),Yt(),Y())}},Ic=class n{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new n(i,t,Y(),Y(),Y())}};var ha=class{constructor(e,t,i,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=i,this.newDoc=r}},Rf=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Mf=class{constructor(e,t,i=ut.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}},Of=class{constructor(){this.pendingResponses=0,this.documentChanges=vD(),this._resumeToken=ut.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Y(),t=Y(),i=Y();return this.documentChanges.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:L()}}),new Ic(this._resumeToken,this._current,e,t,i)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=vD()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,q(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},Cz="WatchChangeAggregator",pb=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Yt(),this.pendingDocumentTargetMapping=yD(),this.pendingTargetResets=new xe(Q)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let i=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&i.updateResumeToken(e.resumeToken);break;case 1:i.recordTargetResponse(),i.isPending||i.clearPendingChanges(),i.updateResumeToken(e.resumeToken);break;case 2:i.recordTargetResponse(),i.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(i.markCurrent(),i.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),i.updateResumeToken(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((i,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,i=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let s=r.target;if(Df(s))if(i===0){let o=new O(s.path);this.removeDocumentFromTarget(t,o,Je.newNoDocument(o,j.min()))}else q(i===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==i){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}x_?.notifyOnExistenceFilterMismatch(Tz(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t,o;try{o=kr(i).toUint8Array()}catch(l){if(l instanceof fb)return bn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new mb(o,r,s)}catch(l){return l instanceof Es?bn("BloomFilter error: ",l):bn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,i){let r=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return r===i-s?0:2}filterRemovedDocuments(e,t){let i=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return i.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Df(a.target)){let l=new O(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Je.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let i=Y();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(i=i.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let r=new xc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,i);return this.pendingDocumentUpdates=Yt(),this.pendingDocumentTargetMapping=yD(),this.pendingTargetResets=new xe(Q),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let i=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,i),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,i){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),i&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,i))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let i=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Of,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ye(Q),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||A(Cz,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Of),this.metadataProvider.getRemoteKeysForTarget(e).forEach(i=>{this.removeDocumentFromTarget(e,i,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function yD(){return new xe(O.comparator)}function vD(){return new xe(O.comparator)}function Tz(n,e,t,i,r){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:r===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:m=>{var y;return(y=i?.mightContain(m))!==null&&y!==void 0?y:!1}}),d}var xz=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),Iz=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),Az=(()=>{let n={};return n.and="AND",n.or="OR",n})();var gb=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Dz(n){let e=n.code===void 0?_.UNKNOWN:vf(n.code);return new S(e,n.message||"")}function yb(n,e){return n.useProto3Json||Gc(e)?e:{value:e}}function kz(n){let e;return typeof n=="object"?e=n.value:e=n,Gc(e)?null:e}function ba(n,e){if(n.useProto3Json){let i=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+e.nanoseconds).slice(-9);return`${i}.${r}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function Rz(n){let e=Dr(n);return new Ne(e.seconds,e.nanos)}function hk(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Mz(n,e){return n.useProto3Json?(q(e===void 0||typeof e=="string"),ut.fromBase64String(e||"")):(q(e===void 0||e instanceof Uint8Array),ut.fromUint8Array(e||new Uint8Array))}function Oz(n,e){return ba(n,e.toTimestamp())}function We(n){return q(!!n),j.fromTimestamp(Rz(n))}function W0(n,e){return Nz(n).child("documents").child(e).canonicalString()}function fk(n){let e=ce.fromString(n);return q(Ek(e)),e}function Ac(n,e){return W0(n.databaseId,e.path)}function hi(n,e){let t=fk(e);if(t.get(1)!==n.databaseId.projectId)throw new S(_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new S(_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(pk(t))}function vb(n,e){return W0(n.databaseId,e)}function mk(n){let e=fk(n);return e.length===4?ce.emptyPath():pk(e)}function Dc(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Nz(n){return new ce(["projects",n.projectId,"databases",n.database])}function pk(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function _D(n,e,t){return{name:Ac(n,e),fields:t.value.mapValue.fields}}function Pz(n,e){return{name:Ac(n,e.key),fields:e.data.value.mapValue.fields,updateTime:ba(n,e.version.toTimestamp()),createTime:ba(n,e.createTime.toTimestamp())}}function gk(n,e,t){let i=hi(n,e.name),r=We(e.updateTime),s=e.createTime?We(e.createTime):j.min(),o=new Rt({mapValue:{fields:e.fields}}),a=Je.newFoundDocument(i,r,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Fz(n,e){q(!!e.found),e.found.name,e.found.updateTime;let t=hi(n,e.found.name),i=We(e.found.updateTime),r=e.found.createTime?We(e.found.createTime):j.min(),s=new Rt({mapValue:{fields:e.found.fields}});return Je.newFoundDocument(t,i,r,s)}function Lz(n,e){q(!!e.missing),q(!!e.readTime);let t=hi(n,e.missing),i=We(e.readTime);return Je.newNoDocument(t,i)}function Bz(n,e){return"found"in e?Fz(n,e):"missing"in e?Lz(n,e):L()}function Vz(n,e){let t;if("targetChange"in e){e.targetChange;let i=qz(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=Mz(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&Dz(o);t=new Mf(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;let i=e.documentChange;i.document,i.document.name,i.document.updateTime;let r=hi(n,i.document.name),s=We(i.document.updateTime),o=i.document.createTime?We(i.document.createTime):j.min(),a=new Rt({mapValue:{fields:i.document.fields}}),l=Je.newFoundDocument(r,s,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];t=new ha(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let i=e.documentDelete;i.document;let r=hi(n,i.document),s=i.readTime?We(i.readTime):j.min(),o=Je.newNoDocument(r,s),a=i.removedTargetIds||[];t=new ha([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let i=e.documentRemove;i.document;let r=hi(n,i.document),s=i.removedTargetIds||[];t=new ha([],s,r,null)}else if("filter"in e){e.filter;let i=e.filter;i.targetId;let{count:r=0,unchangedNames:s}=i,o=new hb(r,s),a=i.targetId;t=new Rf(a,o)}else return L();return t}function qz(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:L()}function Uz(n){if(!("targetChange"in n))return j.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?j.min():We(e.readTime)}function kc(n,e){let t;if(e instanceof Pr)t={update:_D(n,e.key,e.value)};else if(e instanceof Fr)t={delete:Ac(n,e.key)};else if(e instanceof Ln)t={update:_D(n,e.key,e.data),updateMask:bj(e.fieldMask)};else if(e instanceof Sc)t={verify:Ac(n,e.key)};else return L();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>$z(n,i))),e.precondition.isNone||(t.currentDocument=zz(n,e.precondition)),t}function _b(n,e){let t=e.currentDocument?jz(e.currentDocument):qe.none(),i=e.updateTransforms?e.updateTransforms.map(r=>Wz(n,r)):[];if(e.update){e.update.name;let r=hi(n,e.update.name),s=new Rt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=wj(e.updateMask);return new Ln(r,s,o,t,i)}else return new Pr(r,s,t,i)}else if(e.delete){let r=hi(n,e.delete);return new Fr(r,t)}else if(e.verify){let r=hi(n,e.verify);return new Sc(r,t)}else return L()}function zz(n,e){return e.updateTime!==void 0?{updateTime:Oz(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:L()}function jz(n){return n.updateTime!==void 0?qe.updateTime(We(n.updateTime)):n.exists!==void 0?qe.exists(n.exists):qe.none()}function Gz(n,e){let t=n.updateTime?We(n.updateTime):We(e);return t.isEqual(j.min())&&(t=We(e)),new ub(t,n.transformResults||[])}function Hz(n,e){return n&&n.length>0?(q(e!==void 0),n.map(t=>Gz(t,e))):[]}function $z(n,e){let t=e.transform;if(t instanceof Or)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Mi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Oi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Nr)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw L()}function Wz(n,e){let t=null;if("setToServerValue"in e)q(e.setToServerValue==="REQUEST_TIME"),t=new Or;else if("appendMissingElements"in e){let r=e.appendMissingElements.values||[];t=new Mi(r)}else if("removeAllFromArray"in e){let r=e.removeAllFromArray.values||[];t=new Oi(r)}else"increment"in e?t=new Nr(n,e.increment):L();let i=Ke.fromServerFormat(e.fieldPath);return new Rs(i,t)}function yk(n,e){return{documents:[vb(n,e.path)]}}function Kz(n){let e=n.documents.length;q(e===1);let t=n.documents[0];return zt(Na(mk(t)))}function vk(n,e){let t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=vb(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=vb(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);let r=Jz(e.filters);r&&(t.structuredQuery.where=r);let s=tj(e.orderBy);s&&(t.structuredQuery.orderBy=s);let o=yb(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=ij(e.startAt)),e.endAt&&(t.structuredQuery.endAt=rj(e.endAt)),t}function _k(n){let e=mk(n.parent),t=n.structuredQuery,i=t.from?t.from.length:0,r=null;if(i>0){q(i===1);let u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=ej(t.where));let o=[];t.orderBy&&(o=nj(t.orderBy));let a=null;t.limit&&(a=kz(t.limit));let l=null;t.startAt&&(l=sj(t.startAt));let c=null;return t.endAt&&(c=oj(t.endAt)),$1(e,r,o,s,a,"F",l,c)}function Qz(n){return zt(_k(n))}function Yz(n,e){let t=Xz(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Xz(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}function Zz(n,e){let t,i=e.target;if(Df(i)?t={documents:yk(n,i)}:t={query:vk(n,i)},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=hk(n,e.resumeToken);let r=yb(n,e.expectedCount);r!==null&&(t.expectedCount=r)}else if(e.snapshotVersion.compareTo(j.min())>0){t.readTime=ba(n,e.snapshotVersion.toTimestamp());let r=yb(n,e.expectedCount);r!==null&&(t.expectedCount=r)}return t}function Jz(n){if(n.length!==0)return wk(me.create(n,"and"))}function ej(n){let e=bk(n);return e instanceof me&&j0(e)?e.getFilters():[e]}function bk(n){return n.unaryFilter!==void 0?yj(n):n.fieldFilter!==void 0?vj(n):n.compositeFilter!==void 0?_j(n):L()}function tj(n){if(n.length!==0)return n.map(e=>fj(e))}function nj(n){return n.map(e=>mj(e))}function ij(n){return{before:n.inclusive,values:n.position}}function rj(n){return{before:!n.inclusive,values:n.position}}function sj(n){let e=!!n.before,t=n.values||[];return new mi(t,e)}function oj(n){let e=!n.before,t=n.values||[];return new mi(t,e)}function aj(n){return xz[n]}function lj(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function cj(n){return Iz[n]}function uj(n){return Az[n]}function dj(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function hj(n){switch(n){case"AND":return"and";case"OR":return"or";default:return L()}}function oa(n){return{fieldPath:n.canonicalString()}}function ca(n){return Ke.fromServerFormat(n.fieldPath)}function fj(n){return{field:oa(n.field),direction:aj(n.dir)}}function mj(n){return new Ds(ca(n.field),lj(n.direction))}function wk(n){return n instanceof ee?gj(n):n instanceof me?pj(n):L()}function pj(n){let e=n.getFilters().map(t=>wk(t));return e.length===1?e[0]:{compositeFilter:{op:uj(n.op),filters:e}}}function gj(n){if(n.op==="=="){if(lD(n.value))return{unaryFilter:{field:oa(n.field),op:"IS_NAN"}};if(aD(n.value))return{unaryFilter:{field:oa(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(lD(n.value))return{unaryFilter:{field:oa(n.field),op:"IS_NOT_NAN"}};if(aD(n.value))return{unaryFilter:{field:oa(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oa(n.field),op:cj(n.op),value:n.value}}}function yj(n){switch(n.unaryFilter.op){case"IS_NAN":let e=ca(n.unaryFilter.field);return ee.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=ca(n.unaryFilter.field);return ee.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=ca(n.unaryFilter.field);return ee.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=ca(n.unaryFilter.field);return ee.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function vj(n){return ee.create(ca(n.fieldFilter.field),dj(n.fieldFilter.op),n.fieldFilter.value)}function _j(n){return me.create(n.compositeFilter.filters.map(e=>bk(e)),hj(n.compositeFilter.op))}function bj(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function wj(n){let e=n.fieldPaths||[];return new sn(e.map(t=>Ke.fromServerFormat(t)))}function Ek(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var wa=class n{constructor(e,t,i,r,s=j.min(),o=j.min(),a=ut.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Nf=class{constructor(e){this.remoteSerializer=e}};function Ej(n,e){let t;if(e.document)t=gk(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let i=O.fromSegments(e.noDocument.path),r=Os(e.noDocument.readTime);t=Je.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let i=O.fromSegments(e.unknownDocument.path),r=Os(e.unknownDocument.version);t=Je.newUnknownDocument(i,r)}else return L();return e.readTime&&t.setReadTime(Sj(e.readTime)),t}function bD(n,e){let t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_m(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=Pz(n.remoteSerializer,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Ms(e.version)};else if(e.isUnknownDocument())i.unknownDocument={path:t.path.toArray(),version:Ms(e.version)};else return L();return i}function _m(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Sj(n){let e=new Ne(n[0],n[1]);return j.fromTimestamp(e)}function Ms(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Os(n){let e=new Ne(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function Cj(n,e,t){let i=t.baseMutations.map(s=>kc(n.remoteSerializer,s)),r=t.mutations.map(s=>kc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:i,mutations:r}}function vs(n,e){let t=(e.baseMutations||[]).map(s=>_b(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let i=e.mutations.map(s=>_b(n.remoteSerializer,s)),r=Ne.fromMillis(e.localWriteTimeMs);return new Cc(e.batchId,r,t,i)}function lc(n){let e=Os(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Os(n.lastLimboFreeSnapshotVersion):j.min(),i;return Tj(n.query)?i=Kz(n.query):i=Qz(n.query),new wa(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ut.fromBase64String(n.resumeToken))}function Sk(n,e){let t=Ms(e.snapshotVersion),i=Ms(e.lastLimboFreeSnapshotVersion),r;Df(e.target)?r=yk(n.remoteSerializer,e.target):r=vk(n.remoteSerializer,e.target);let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ks(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Tj(n){return n.documents!==void 0}function xj(n){return{id:n.bundleId,createTime:Os(n.createTime),version:n.version}}function Ij(n){return{bundleId:n.id,createTime:Ms(We(n.createTime)),version:n.version}}function Aj(n){return{name:n.name,query:K0(n.bundledQuery),readTime:Os(n.readTime)}}function Dj(n){return{name:n.name,readTime:Ms(We(n.readTime)),bundledQuery:n.bundledQuery}}function K0(n){let e=_k({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kf(e,e.limit,"L"):e}function kj(n){return{name:n.name,query:K0(n.bundledQuery),readTime:We(n.readTime)}}function Rj(n){return{id:n.id,version:n.version,createTime:We(n.createTime)}}function I_(n,e){return new Tc(e.largestBatchId,_b(n.remoteSerializer,e.overlayMutation))}function Mj(n,e,t){let[i,r,s]=Ck(e,t.mutation.key);return{userId:e,collectionPath:r,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:kc(n.remoteSerializer,t.mutation)}}function Ck(n,e){let t=e.path.lastSegment(),i=Ut(e.path.popLast());return[n,i,t]}function Oj(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function Nj(n,e){let t=e?new pc(e.sequenceNumber,new wn(Os(e.readTime),new O(ui(e.documentKey)),e.largestBatchId)):pc.empty(),i=n.fields.map(([r,s])=>new ua(Ke.fromServerFormat(r),s));return new z_(n.indexId,n.collectionGroup,i,t)}function wD(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Ms(i.readTime),documentKey:Ut(i.documentKey.path),largestBatchId:i.largestBatchId}}var bb=class{getBundleMetadata(e,t){return ED(e).get(t).next(i=>{if(i)return xj(i)})}saveBundleMetadata(e,t){return ED(e).put(Ij(t))}getNamedQuery(e,t){return SD(e).get(t).next(i=>{if(i)return Aj(i)})}saveNamedQuery(e,t){return SD(e).put(Dj(t))}};function ED(n){return dt(n,fm)}function SD(n){return dt(n,mm)}var Pf=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let i=t.uid||"";return new n(e,i)}getOverlay(e,t){return ic(e).get(Ck(this.userId,t)).next(i=>i?I_(this.serializer,i):null)}getOverlays(e,t){let i=di();return g.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){let r=[];return i.forEach((s,o)=>{let a=new Tc(t,o);r.push(this.saveOverlay(e,a))}),g.waitFor(r)}removeOverlaysForBatchId(e,t,i){let r=new Set;t.forEach(o=>r.add(Ut(o.getCollectionPath())));let s=[];return r.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(ic(e).deleteAll(Y_,a))}),g.waitFor(s)}getOverlaysForCollection(e,t,i){let r=di(),s=Ut(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ic(e).loadAll(Y_,o).next(a=>{for(let l of a){let c=I_(this.serializer,l);r.set(c.getKey(),c)}return r})}getOverlaysForCollectionGroup(e,t,i,r){let s=di(),o,a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ic(e).iterate({index:C1,range:a},(l,c,u)=>{let d=I_(this.serializer,c);s.size()<r||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return ic(e).put(Mj(this.serializer,this.userId,t))}};function ic(n){return dt(n,pm)}var Pj=5,Fj=10,Lj=13,CD=15,Bj=20,Vj=25,qj=30,Uj=37,zj=45,jj=50,Gj=55,Hj=60,$j=2,Ri=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,Pj);else if("booleanValue"in e)this.writeValueTypeLabel(t,Fj),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,CD),t.writeNumber(Ue(e.integerValue));else if("doubleValue"in e){let i=Ue(e.doubleValue);isNaN(i)?this.writeValueTypeLabel(t,Lj):(this.writeValueTypeLabel(t,CD),_c(i)?t.writeNumber(0):t.writeNumber(i))}else if("timestampValue"in e){let i=e.timestampValue;this.writeValueTypeLabel(t,Bj),typeof i=="string"?t.writeString(i):(t.writeString(`${i.seconds||""}`),t.writeNumber(i.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,qj),t.writeBytes(kr(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let i=e.geoPointValue;this.writeValueTypeLabel(t,zj),t.writeNumber(i.latitude||0),t.writeNumber(i.longitude||0)}else"mapValue"in e?F1(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):L()}writeIndexString(e,t){this.writeValueTypeLabel(t,Vj),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let i=e.fields||{};this.writeValueTypeLabel(t,Gj);for(let r of Object.keys(i))this.writeIndexString(r,t),this.writeIndexValueAux(i[r],t)}writeIndexArray(e,t){let i=e.values||[];this.writeValueTypeLabel(t,jj);for(let r of i)this.writeIndexValueAux(r,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,Uj),O.fromName(e).path.forEach(r=>{this.writeValueTypeLabel(t,Hj),this.writeUnlabeledIndexString(r,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber($j)}};Ri.INSTANCE=new Ri;var TD="\uD800",xD="\uDBFF",Jo=0,ID=255,AD=1,ea=255,DD=255,kD=0,Wj=64,Kj=8,Qj=1024;function Yj(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function Xj(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function Zj(n){let e=0;for(let t=0;t<8;++t){let i=Xj(n[t]&255);if(e+=i,i!==8)break}return e}function RD(n){let e=Wj-Zj(n);return Math.ceil(e/Kj)}var wb=class{constructor(){this.buffer=new Uint8Array(Qj),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteAscending(i.value),i=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),i=t.next();for(;!i.done;)this.writeByteDescending(i.value),i=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteAscending(i);else if(i<2048)this.writeByteAscending(960|i>>>6),this.writeByteAscending(128|63&i);else if(t<TD||xD<t)this.writeByteAscending(480|i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i);else{let r=t.codePointAt(0);this.writeByteAscending(240|r>>>18),this.writeByteAscending(128|63&r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let i=t.charCodeAt(0);if(i<128)this.writeByteDescending(i);else if(i<2048)this.writeByteDescending(960|i>>>6),this.writeByteDescending(128|63&i);else if(t<TD||xD<t)this.writeByteDescending(480|i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i);else{let r=t.codePointAt(0);this.writeByteDescending(240|r>>>18),this.writeByteDescending(128|63&r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),i=RD(t);this.ensureAvailable(1+i),this.buffer[this.position++]=i&255;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=t[r]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),i=RD(t);this.ensureAvailable(1+i),this.buffer[this.position++]=~(i&255);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(t[r]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(ea),this.writeEscapedByteAscending(DD)}writeInfinityDescending(){this.writeEscapedByteDescending(ea),this.writeEscapedByteDescending(DD)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=Yj(e),i=(t[0]&128)!==0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}writeByteAscending(e){let t=e&255;t===Jo?(this.writeEscapedByteAscending(Jo),this.writeEscapedByteAscending(ID)):t===ea?(this.writeEscapedByteAscending(ea),this.writeEscapedByteAscending(kD)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Jo?(this.writeEscapedByteDescending(Jo),this.writeEscapedByteDescending(ID)):t===ea?(this.writeEscapedByteDescending(ea),this.writeEscapedByteDescending(kD)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Jo),this.writeEscapedByteAscending(AD)}writeSeparatorDescending(){this.writeEscapedByteDescending(Jo),this.writeEscapedByteDescending(AD)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let i=this.buffer.length*2;i<t&&(i=t);let r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}},Eb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Sb=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},_s=class{constructor(){this.orderedCode=new wb,this.ascending=new Eb(this.orderedCode),this.descending=new Sb(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var bs=class n{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new n(this.indexId,this.documentKey,this.arrayValue,i)}};function br(n,e){let t=n.indexId-e.indexId;return t!==0||(t=MD(n.arrayValue,e.arrayValue),t!==0)||(t=MD(n.directionalValue,e.directionalValue),t!==0)?t:O.comparator(n.documentKey,e.documentKey)}function MD(n,e){for(let t=0;t<n.length&&t<e.length;++t){let i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}var Ff=class{constructor(e){this.inequalityFilters=new ye((t,i)=>Ke.comparator(t.field,i.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let i=t;i.isInequality()?this.inequalityFilters=this.inequalityFilters.add(i):this.equalityFilters.push(i)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(q(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=N0(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let i=xs(e),r=new Set,s=0,o=0;for(;s<i.length&&this.hasMatchingEqualityFilter(i[s]);++s)r=r.add(i[s].fieldPath.canonicalString());if(s===i.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!r.has(a.field.canonicalString())){let l=i[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<i.length;++s){let a=i[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ye(Ke.comparator),t=[];for(let i of this.equalityFilters){if(i.field.isKeyField())continue;if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new ua(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new ua(i.field,0))}}for(let i of this.orderBys)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new ua(i.field,i.dir==="asc"?0:1)));return new z_(z_.UNKNOWN_ID,this.collectionId,t,pc.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function Tk(n){var e,t;if(q(n instanceof ee||n instanceof me),n instanceof ee)if(n instanceof Af){let r=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ee.create(n.field,"==",s)))||[];return me.create(r,"or")}else return n;let i=n.filters.map(r=>Tk(r));return me.create(i,n.op)}function Jj(n){if(n.getFilters().length===0)return[];let e=Cb(Tk(n));return q(xk(e)),Q0(e)||Y0(e)?[e]:e.getFilters()}function Q0(n){return n instanceof ee}function Y0(n){return n instanceof me&&j0(n)}function xk(n){return Q0(n)||Y0(n)||e6(n)}function e6(n){if(n instanceof me&&eb(n)){for(let e of n.getFilters())if(!Q0(e)&&!Y0(e))return!1;return!0}return!1}function Cb(n){if(q(n instanceof ee||n instanceof me),n instanceof ee)return n;if(n.filters.length===1)return Cb(n.filters[0]);let e=n.filters.map(i=>Cb(i)),t=me.create(e,n.op);return t=Lf(t),xk(t)?t:(q(t instanceof me),q(ga(t)),q(t.filters.length>1),t.filters.reduce((i,r)=>X0(i,r)))}function X0(n,e){q(n instanceof ee||n instanceof me),q(e instanceof ee||e instanceof me);let t;return n instanceof ee?e instanceof ee?t=t6(n,e):t=OD(n,e):e instanceof ee?t=OD(e,n):t=n6(n,e),Lf(t)}function t6(n,e){return me.create([n,e],"and")}function n6(n,e){if(q(n.filters.length>0&&e.filters.length>0),ga(n)&&ga(e))return U1(n,e.getFilters());let t=eb(n)?n:e,i=eb(n)?e:n,r=t.filters.map(s=>X0(s,i));return me.create(r,"or")}function OD(n,e){if(ga(e))return U1(e,n.getFilters());{let t=e.filters.map(i=>X0(n,i));return me.create(t,"or")}}function Lf(n){if(q(n instanceof ee||n instanceof me),n instanceof ee)return n;let e=n.getFilters();if(e.length===1)return Lf(e[0]);if(V1(n))return n;let t=e.map(r=>Lf(r)),i=[];return t.forEach(r=>{r instanceof ee?i.push(r):r instanceof me&&(r.op===n.op?i.push(...r.filters):i.push(r))}),i.length===1?i[0]:me.create(i,n.op)}var Tb=class{constructor(){this.collectionParentIndex=new Rc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}deleteAllFieldIndexes(e){return g.resolve()}createTargetIndexes(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(wn.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(wn.min())}updateCollectionGroup(e,t,i){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}},Rc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new ye(ce.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){let t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new ye(ce.comparator)).toArray()}};var ND="IndexedDbIndexManager",uf=new Uint8Array(0),xb=class{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new Rc,this.targetToDnfSubTargets=new pi(i=>ks(i),(i,r)=>Hc(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:i,parent:Ut(r)};return PD(e).put(s)}return g.resolve()}getCollectionParents(e,t){let i=[],r=IDBKeyRange.bound([t,""],[d1(t),""],!1,!0);return PD(e).loadAll(r).next(s=>{for(let o of s){if(o.collectionId!==t)break;i.push(ui(o.parent))}return i})}addFieldIndex(e,t){let i=rc(e),r=Oj(t);delete r.indexId;let s=i.add(r);if(t.indexState){let o=na(e);return s.next(a=>{o.put(wD(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let i=rc(e),r=na(e),s=ta(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=rc(e),i=ta(e),r=na(e);return t.deleteAll().next(()=>i.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return g.forEach(this.getSubTargets(t),i=>this.getIndexType(e,i).next(r=>{if(r===0||r===1){let o=new Ff(i).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let i=ta(e),r=!0,s=new Map;return g.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{r&&(r=!!a),s.set(o,a)})).next(()=>{if(r){let o=Y(),a=[];return g.forEach(s,(l,c)=>{A(ND,`Using index ${fU(l)} to execute ${ks(t)}`);let u=F4(c,l),d=L4(c,l),h=B4(c,l),m=V4(c,l),y=this.encodeBound(l,c,h),v=this.encodeBound(l,c,m),b=this.encodeValues(l,c,d),D=this.generateIndexRanges(l.indexId,u,y,h.inclusive,v,m.inclusive,b);return g.forEach(D,E=>i.loadFirst(E,t.limit).next(k=>{k.forEach(R=>{let V=O.fromSegments(R.documentKey);o.has(V)||(o=o.add(V),a.push(V))})}))}).next(()=>a)}else return g.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=Jj(me.create(e.filters,"and")).map(r=>cb(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,i,r,s,o,a){let l=(t!=null?t.length:1)*Math.max(i.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):uf,m=this.generateLowerBound(e,h,i[d%c],r),y=this.generateUpperBound(e,h,s[d%c],o),v=a.map(b=>this.generateLowerBound(e,h,b,!0));u.push(...this.createRange(m,y,v))}return u}generateLowerBound(e,t,i,r){let s=new bs(e,O.empty(),t,i);return r?s:s.successor()}generateUpperBound(e,t,i,r){let s=new bs(e,O.empty(),t,i);return r?s.successor():s}getFieldIndex(e,t){let i=new Ff(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let o=null;for(let a of s)i.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2,r=this.getSubTargets(t);return g.forEach(r,s=>this.getFieldIndex(e,s).next(o=>{o?i!==0&&o.fields.length<q4(s)&&(i=1):i=0})).next(()=>U4(t)&&r.length>1&&i===2?1:i)}encodeDirectionalElements(e,t){let i=new _s;for(let r of xs(e)){let s=t.data.field(r.fieldPath);if(s==null)return null;let o=i.forKind(r.kind);Ri.INSTANCE.writeIndexValue(s,o)}return i.encodedBytes()}encodeSingleElement(e){let t=new _s;return Ri.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let i=new _s;return Ri.INSTANCE.writeIndexValue(As(this.databaseId,t),i.forKind(hU(e))),i.encodedBytes()}encodeValues(e,t,i){if(i===null)return[];let r=[];r.push(new _s);let s=0;for(let o of xs(e)){let a=i[s++];for(let l of r)if(this.isInFilter(t,o.fieldPath)&&wc(a))r=this.expandIndexValues(r,o,a);else{let c=l.forKind(o.kind);Ri.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(r)}encodeBound(e,t,i){return this.encodeValues(e,t,i.position)}getEncodedBytes(e){let t=[];for(let i=0;i<e.length;++i)t[i]=e[i].encodedBytes();return t}expandIndexValues(e,t,i){let r=[...e],s=[];for(let o of i.arrayValue.values||[])for(let a of r){let l=new _s;l.seed(a.encodedBytes()),Ri.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(i=>i instanceof ee&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){let i=rc(e),r=na(e);return(t?i.loadAll(Q_,IDBKeyRange.bound(t,t)):i.loadAll()).next(s=>{let o=[];return g.forEach(s,a=>r.get([a.indexId,this.uid]).next(l=>{o.push(Nj(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>{let s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:Q(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){let r=rc(e),s=na(e);return this.getNextSequenceNumber(e).next(o=>r.loadAll(Q_,IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,l=>s.put(wD(l.indexId,this.user,o,i)))))}updateIndexEntries(e,t){let i=new Map;return g.forEach(t,(r,s)=>{let o=i.get(r.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(i.set(r.collectionGroup,l),g.forEach(l,c=>this.getExistingIndexEntries(e,r,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?g.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,i,r){return ta(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(i,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,i,r){return ta(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(i,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,i){let r=ta(e),s=new ye(br);return r.iterate({index:S1,range:IDBKeyRange.only([i.indexId,this.uid,this.encodeDirectionalKey(i,t)])},(o,a)=>{s=s.add(new bs(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let i=new ye(br),r=this.encodeDirectionalElements(t,e);if(r==null)return i;let s=N0(t);if(s!=null){let o=e.data.field(s.fieldPath);if(wc(o))for(let a of o.arrayValue.values||[])i=i.add(new bs(t.indexId,e.key,this.encodeSingleElement(a),r))}else i=i.add(new bs(t.indexId,e.key,uf,r));return i}updateEntries(e,t,i,r,s){A(ND,"Updating index entries for document '%s'",t.key);let o=[];return YU(r,s,br,a=>{o.push(this.addIndexEntry(e,t,i,a))},a=>{o.push(this.deleteIndexEntry(e,t,i,a))}),g.waitFor(o)}getNextSequenceNumber(e){let t=1;return na(e).iterate({index:E1,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>br(o,a)).filter((o,a,l)=>!a||br(o,l[a-1])!==0);let r=[];r.push(e);for(let o of i){let a=br(o,e),l=br(o,t);if(a===0)r[0]=e.successor();else if(a>0&&l<0)r.push(o),r.push(o.successor());else if(l>0)break}r.push(t);let s=[];for(let o=0;o<r.length;o+=2){if(this.isRangeMatchable(r[o],r[o+1]))return[];let a=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,uf,[]],l=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,uf,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return br(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(FD)}getMinOffset(e,t){return g.mapArray(this.getSubTargets(t),i=>this.getFieldIndex(e,i).next(r=>r||L())).next(FD)}};function PD(n){return dt(n,gc)}function ta(n){return dt(n,q0)}function rc(n){return dt(n,B0)}function na(n){return dt(n,V0)}function FD(n){q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){let r=n[i].indexState.offset;P0(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new wn(e.readTime,e.documentKey,t)}function Ik(n,e,t){let i=n.store(Nn),r=n.store(Ra),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=i.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{q(a===1)}));let c=[];for(let u of t.mutations){let d=_1(e,u.key.path,t.batchId);s.push(r.delete(d)),c.push(u.key)}return g.waitFor(s).next(()=>c)}function Bf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw L();return JSON.stringify(e).length}var Vf=class n{constructor(e,t,i,r){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,i,r){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,i,r)}checkEmpty(e){let t=!0,i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wr(e).iterate({index:ws,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){let s=aa(e),o=wr(e);return o.add({}).next(a=>{q(typeof a=="number");let l=new Cc(a,t,i,r),c=Cj(this.serializer,this.userId,l),u=[],d=new ye((h,m)=>Q(h.canonicalString(),m.canonicalString()));for(let h of r){let m=_1(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(m,wU))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),g.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return wr(e).get(t).next(i=>i?(q(i.userId===this.userId),vs(this.serializer,i)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?g.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){let r=i.keys();return this.documentKeysByBatchId[t]=r,r}else return null})}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]),s=null;return wr(e).iterate({index:ws,range:r},(o,a,l)=>{a.userId===this.userId&&(q(a.batchId>=i),s=vs(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),i=xr;return wr(e).iterate({index:ws,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,xr],[this.userId,Number.POSITIVE_INFINITY]);return wr(e).loadAll(ws,t).next(i=>i.map(r=>vs(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){let i=mf(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return aa(e).iterate({range:r},(o,a,l)=>{let[c,u,d]=o,h=ui(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return wr(e).get(d).next(m=>{if(!m)throw L();q(m.userId===this.userId),s.push(vs(this.serializer,m))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ye(Q),r=[];return t.forEach(s=>{let o=mf(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=aa(e).iterate({range:a},(c,u,d)=>{let[h,m,y]=c,v=ui(m);if(h!==this.userId||!s.path.isEqual(v)){d.done();return}i=i.add(y)});r.push(l)}),g.waitFor(r).next(()=>this.lookupMutationBatches(e,i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=mf(this.userId,i),o=IDBKeyRange.lowerBound(s),a=new ye(Q);return aa(e).iterate({range:o},(l,c,u)=>{let[d,h,m]=l,y=ui(h);if(d!==this.userId||!i.isPrefixOf(y)){u.done();return}y.length===r&&(a=a.add(m))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let i=[],r=[];return t.forEach(s=>{r.push(wr(e).get(s).next(o=>{if(o===null)throw L();q(o.userId===this.userId),i.push(vs(this.serializer,o))}))}),g.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return Ik(e.simpleDbTransaction,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),g.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();let i=IDBKeyRange.lowerBound(bU(this.userId)),r=[];return aa(e).iterate({range:i},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=ui(s[1]);r.push(c)}}).next(()=>{q(r.length===0)})})}containsKey(e,t){return Ak(e,this.userId,t)}getMutationQueueMetadata(e){return Dk(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:xr,lastStreamToken:""})}};function Ak(n,e,t){let i=mf(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return aa(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===r&&(o=!0),c.done()}).next(()=>o)}function i6(n,e){let t=!1;return Dk(n).iterateSerial(i=>Ak(n,i,e).next(r=>(r&&(t=!0),g.resolve(!r)))).next(()=>t)}function wr(n){return dt(n,Nn)}function aa(n){return dt(n,Ra)}function Dk(n){return dt(n,zc)}var A_=2,Ea=class n{constructor(e){this.lastId=e}next(){return this.lastId+=A_,this.lastId}static forTargetCache(){return new n(2-A_)}static forSyncEngine(){return new n(1-A_)}};var Ib=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let i=new Ea(t.highestTargetId);return t.highestTargetId=i.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>j.fromTimestamp(new Ne(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(i=>(i.targetCount+=1,this.updateMetadataFromTargetData(t,i),this.saveMetadata(e,i))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ia(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(i=>(q(i.targetCount>0),i.targetCount-=1,this.saveMetadata(e,i)))}removeTargets(e,t,i){let r=0,s=[];return ia(e).iterate((o,a)=>{let l=lc(a);l.sequenceNumber<=t&&i.get(l.targetId)===null&&(r++,s.push(this.removeTargetData(e,l)))}).next(()=>g.waitFor(s)).next(()=>r)}forEachTarget(e,t){return ia(e).iterate((i,r)=>{let s=lc(r);t(s)})}retrieveMetadata(e){return LD(e).get(Tf).next(t=>(q(t!==null),t))}saveMetadata(e,t){return LD(e).put(Tf,t)}saveTargetData(e,t){return ia(e).put(Sk(this.serializer,t))}updateMetadataFromTargetData(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let i=ks(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]),s=null;return ia(e).iterate({range:r,index:w1},(o,a,l)=>{let c=lc(a);Hc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,i){let r=[],s=Sr(e);return t.forEach(o=>{let a=Ut(o.path);r.push(s.put({targetId:i,path:a})),r.push(this.referenceDelegate.addReference(e,i,o))}),g.waitFor(r)}removeMatchingKeys(e,t,i){let r=Sr(e);return g.forEach(t,s=>{let o=Ut(s.path);return g.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){let i=Sr(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){let i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Sr(e),s=Y();return r.iterate({range:i,keysOnly:!0},(o,a,l)=>{let c=ui(o[1]),u=new O(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let i=Ut(t.path),r=IDBKeyRange.bound([i],[d1(i)],!1,!0),s=0;return Sr(e).iterate({index:L0,keysOnly:!0,range:r},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return ia(e).get(t).next(i=>i?lc(i):null)}};function ia(n){return dt(n,Ma)}function LD(n){return dt(n,Vs)}function Sr(n){return dt(n,Oa)}var BD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kc=-1,kk=40*1024*1024,_n=class n{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};_n.DEFAULT_COLLECTION_PERCENTILE=10;_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;_n.DEFAULT=new _n(kk,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);_n.DISABLED=new _n(Kc,0,0);var VD="LruGarbageCollector",qD=1*1024*1024,r6=1*60*1e3,s6=5*60*1e3;function UD([n,e],[t,i]){let r=Q(n,t);return r===0?Q(e,i):r}var Ab=class{constructor(e){this.maxElements=e,this.buffer=new ye(UD),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let i=this.buffer.last();UD(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}},Db=class{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Kc&&this.scheduleGC(r6)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){A(VD,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){qr(t)?A(VD,"Ignoring IndexedDB error during garbage collection: ",t):yield Vr(t)}yield this.scheduleGC(s6)}))}},kb=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return g.resolve(rn.INVALID);let i=new Ab(t);return this.delegate.forEachTarget(e,r=>i.addElement(r.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,r=>i.addElement(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.delegate.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Kc?(A("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(BD)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),BD):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let i,r,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r))).next(d=>(i=d,a=Date.now(),this.removeTargets(e,i,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(d=>{if(c=Date.now(),ra()<=jn.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;A("LruGarbageCollector",h)}return g.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:d})})}};function o6(n,e){return new kb(n,e)}var Rb=class{constructor(e,t){this.db=e,this.garbageCollector=o6(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(i,r)=>t(r))}addReference(e,t,i){return df(e,i)}removeReference(e,t,i){return df(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return df(e,t)}isPinned(e,t){return i6(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,r.getEntry(e,l).next(()=>(r.removeEntry(l,j.min()),Sr(e).delete(a6(l))))});s.push(u)}}).next(()=>g.waitFor(s)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){let i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return df(e,t)}forEachOrphanedDocument(e,t){let i=Sr(e),r=rn.INVALID,s;return i.iterate({index:L0},([o,a],{path:l,sequenceNumber:c})=>{o===0?(r!==rn.INVALID&&t(new O(ui(s)),r),r=c,s=l):r=rn.INVALID}).next(()=>{r!==rn.INVALID&&t(new O(ui(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function a6(n){return[0,Ut(n.path)]}function l6(n,e){return{targetId:0,path:Ut(n.path),sequenceNumber:e}}function df(n,e){return Sr(n).put(l6(e,n.currentSequenceNumber))}var qf=class{constructor(){this.changes=new pi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let i=this.changes.get(t);return i!==void 0?g.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Mb=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return ps(e).put(i)}removeEntry(e,t,i){return ps(e).delete(c6(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.setMetadata(e,i)))}getEntry(e,t){let i=Je.newInvalidDocument(t);return ps(e).iterate({index:pf,range:IDBKeyRange.only(sc(t))},(r,s)=>{i=this.maybeDecodeDocument(t,s)}).next(()=>i)}getSizedEntry(e,t){let i={size:0,document:Je.newInvalidDocument(t)};return ps(e).iterate({index:pf,range:IDBKeyRange.only(sc(t))},(r,s)=>{i={document:this.maybeDecodeDocument(t,s),size:Bf(s)}}).next(()=>i)}getEntries(e,t){let i=Yt();return this.forEachDbEntry(e,t,(r,s)=>{let o=this.maybeDecodeDocument(r,s);i=i.insert(r,o)}).next(()=>i)}getSizedEntries(e,t){let i=Yt(),r=new xe(O.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);i=i.insert(s,a),r=r.insert(s,Bf(o))}).next(()=>({documents:i,sizeMap:r}))}forEachDbEntry(e,t,i){if(t.isEmpty())return g.resolve();let r=new ye(GD);t.forEach(l=>r=r.add(l));let s=IDBKeyRange.bound(sc(r.first()),sc(r.last())),o=r.getIterator(),a=o.getNext();return ps(e).iterate({index:pf,range:s},(l,c,u)=>{let d=O.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&GD(a,d)<0;)i(a,null),a=o.getNext();a&&a.isEqual(d)&&(i(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(sc(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,r,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),_m(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ps(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Yt();for(let d of c){let h=this.maybeDecodeDocument(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(Wc(t,h)||r.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,i,r){let s=Yt(),o=jD(t,i),a=jD(t,wn.max());return ps(e).iterate({index:b1,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(O.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===r&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Ob(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return zD(e).get(K_).next(t=>(q(!!t),t))}setMetadata(e,t){return zD(e).put(K_,t)}maybeDecodeDocument(e,t){if(t){let i=Ej(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(j.min())))return i}return Je.newInvalidDocument(e)}};function Rk(n){return new Mb(n)}var Ob=class extends qf{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new pi(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){let t=[],i=0,r=new ye((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=bD(this.documentCache.serializer,o);r=r.add(s.path.popLast());let c=Bf(l);i+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(i-=a.size,this.trackRemovals){let l=bD(this.documentCache.serializer,o.convertToNoDocument(j.min()));t.push(this.documentCache.addEntry(e,s,l))}}),r.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,i)),g.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(i=>(this.documentStates.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:i,sizeMap:r})=>(r.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:i.get(s).readTime})}),i))}};function zD(n){return dt(n,jc)}function ps(n){return dt(n,hm)}function sc(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function c6(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],_m(e),t[t.length-1]]}function jD(n,e){let t=e.documentKey.path.toArray();return[n,_m(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function GD(n,e){let t=n.path.toArray(),i=e.path.toArray(),r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=Q(t[s],i[s]),r)return r;return r=Q(t.length,i.length),r||(r=Q(t[t.length-2],i[i.length-2]),r)?r:Q(t[t.length-1],i[i.length-1])}var u6=15;var Nb=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Uf=class{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&hc(i.mutation,r,sn.empty(),Ne.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Y()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Y()){let r=di();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let o=ac();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let i=di();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Y()))}populateOverlays(e,t,i){let r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,r){let s=Yt(),o=Ec(),a=nz();return t.forEach((l,c)=>{let u=i.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof Ln)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),hc(u.mutation,c,u.mutation.getFieldMask(),Ne.now())):o.set(c.key,sn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Nb(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let i=Ec(),r=new xe((o,a)=>o-a),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=i.get(l)||sn.empty();u=a.applyToLocalView(c,u),i.set(l,u);let d=(r.get(a.batchId)||Y()).add(l);r=r.insert(a.batchId,d)})}).next(()=>{let o=[],a=r.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=Z1();u.forEach(h=>{if(!s.has(h)){let m=ok(t.get(h),i.get(h));m!==null&&d.set(h,m),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return g.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return H4(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):G0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{let o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):g.resolve(di()),a=fa,l=s;return o.next(c=>g.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?g.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Y())).next(u=>({batchId:a,changes:X1(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(i=>{let r=ac();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){let s=t.collectionGroup,o=ac();return this.indexManager.getCollectionParents(e,s).next(a=>g.forEach(a,l=>{let c=z4(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Je.newInvalidDocument(u)))});let a=ac();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&hc(u.mutation,c,sn.empty(),Ne.now()),Wc(t,c)&&(a=a.insert(l,c))}),a})}};var Pb=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return g.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,Rj(t)),g.resolve()}getNamedQuery(e,t){return g.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,kj(t)),g.resolve()}};var Fb=class{constructor(){this.overlays=new xe(O.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){let i=di();return g.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.saveOverlay(e,t,s)}),g.resolve()}removeOverlaysForBatchId(e,t,i){let r=this.overlayByBatchId.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(i)),g.resolve()}getOverlaysForCollection(e,t,i){let r=di(),s=t.length+1,o=new O(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return g.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new xe((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let h=s.get(u.largestBatchId);h===null&&(h=di(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=di(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=r)););return g.resolve(a)}saveOverlay(e,t,i){let r=this.overlays.get(i.key);if(r!==null){let o=this.overlayByBatchId.get(r.largestBatchId).delete(i.key);this.overlayByBatchId.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Tc(t,i));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Y(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(i.key))}};var Mc=class{constructor(){this.refsByKey=new ye(Ze.compareByKey),this.refsByTarget=new ye(Ze.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let i=new Ze(e,t);this.refsByKey=this.refsByKey.add(i),this.refsByTarget=this.refsByTarget.add(i)}addReferences(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.removeRef(new Ze(e,t))}removeReferences(e,t){e.forEach(i=>this.removeReference(i,t))}removeReferencesForId(e){let t=new O(new ce([])),i=new Ze(t,e),r=new Ze(t,e+1),s=[];return this.refsByTarget.forEachInRange([i,r],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new O(new ce([])),i=new Ze(t,e),r=new Ze(t,e+1),s=Y();return this.refsByTarget.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ze(e,0),i=this.refsByKey.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}},Ze=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return O.comparator(e.key,t.key)||Q(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return Q(e.targetOrBatchId,t.targetOrBatchId)||O.comparator(e.key,t.key)}};var Lb=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ye(Ze.compareByKey)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Cc(s,t,i,r);this.mutationQueue.push(o);for(let a of r)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ze(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let i=t+1,r=this.indexOfBatchId(i),s=r<0?0:r;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?xr:this.nextBatchId-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let i=new Ze(t,0),r=new Ze(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([i,r],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ye(Q);return t.forEach(r=>{let s=new Ze(r,0),o=new Ze(r,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{i=i.add(a.targetOrBatchId)})}),g.resolve(this.findMutationBatches(i))}getAllMutationBatchesAffectingQuery(e,t){let i=t.path,r=i.length+1,s=i;O.isDocumentKey(s)||(s=s.child(""));let o=new Ze(new O(s),0),a=new ye(Q);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return i.isPrefixOf(c)?(c.length===r&&(a=a.add(l.targetOrBatchId)),!0):!1},o),g.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(i=>{let r=this.findMutationBatch(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){let i=this.indexOfExistingBatchId(t.batchId,"removed");q(i===0),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return g.forEach(t.mutations,s=>{let o=new Ze(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let i=new Ze(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(i);return g.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function d6(){return new xe(O.comparator)}var Bb=class{constructor(e){this.sizer=e,this.docs=d6(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.sizer(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let i=this.docs.get(t);return g.resolve(i?i.document.mutableCopy():Je.newInvalidDocument(t))}getEntries(e,t){let i=Yt();return t.forEach(r=>{let s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Je.newInvalidDocument(r))}),g.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Yt(),o=t.path,a=new O(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||P0(f1(u),i)<=0||!r.has(u.key)&&!Wc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(e,t,i,r){L()}forEachDocumentKey(e,t){return g.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Vb(this)}getSize(e){return g.resolve(this.size)}};function h6(n){return new Bb(n)}var Vb=class extends qf{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(i)}),g.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var qb=class{constructor(e){this.persistence=e,this.targets=new pi(t=>ks(t),Hc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Mc,this.targetCount=0,this.targetIdGenerator=Ea.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((i,r)=>t(r)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),g.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Ea(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.saveTargetData(t),g.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,i){let r=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),g.waitFor(s).next(()=>r)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){let i=this.targets.get(t)||null;return g.resolve(i)}addMatchingKeys(e,t,i){return this.references.addReferences(t,i),g.resolve()}removeMatchingKeys(e,t,i){this.references.removeReferences(t,i);let r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),g.resolve()}getMatchingKeysForTargetId(e,t){let i=this.references.referencesForId(t);return g.resolve(i)}containsKey(e,t){return g.resolve(this.references.containsKey(t))}};var f6="MemoryPersistence",zf=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new rn(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new qb(this);let i=r=>this.referenceDelegate.documentSize(r);this.indexManager=new Tb,this.remoteDocumentCache=h6(i),this.serializer=new Nf(t),this.bundleCache=new Pb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Fb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.mutationQueues[e.toKey()];return i||(i=new Lb(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=i),i}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){A(f6,"Starting transaction:",e);let r=new Ub(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),i(r).next(s=>this.referenceDelegate.onTransactionCommitted(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return g.or(Object.values(this.mutationQueues).map(i=>()=>i.containsKey(e,t)))}},Ub=class extends Sf{constructor(e){super(),this.currentSequenceNumber=e}},jf=class n{constructor(e){this.persistence=e,this.localViewReferences=new Mc,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw L()}addReference(e,t,i){return this.localViewReferences.addReference(i,t),this.orphanedDocuments.delete(i.toString()),g.resolve()}removeReference(e,t,i){return this.localViewReferences.removeReference(i,t),this.orphanedDocuments.add(i.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),g.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.orphanedDocuments,r=>{let s=O.fromPath(r);return this.isReferenced(e,s).next(o=>{o||i.removeEntry(s,j.min())})}).next(()=>(this._orphanedDocuments=null,i.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(i=>{i?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return g.or([()=>g.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var zb=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,i,r){let s=new Cf("createOrUpgrade",t);i<1&&r>=1&&(p6(e),g6(e),HD(e),v6(e));let o=g.resolve();return i<3&&r>=3&&(i!==0&&(w6(e),HD(e)),o=o.next(()=>S6(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>y6(e,s))),o=o.next(()=>{C6(e)})),i<5&&r>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),i<6&&r>=6&&(o=o.next(()=>(b6(e),this.addDocumentGlobal(s)))),i<7&&r>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),i<8&&r>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),i<9&&r>=9&&(o=o.next(()=>{E6(e)})),i<10&&r>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),i<11&&r>=11&&(o=o.next(()=>{T6(e),x6(e)})),i<12&&r>=12&&(o=o.next(()=>{A6(e)})),i<13&&r>=13&&(o=o.next(()=>_6(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ys))),i<14&&r>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),i<15&&r>=15&&(o=o.next(()=>I6(e))),o}addDocumentGlobal(e){let t=0;return e.store(ys).iterate((i,r)=>{t+=Bf(r)}).next(()=>{let i={byteSize:t};return e.store(jc).put(K_,i)})}removeAcknowledgedMutations(e){let t=e.store(zc),i=e.store(Nn);return t.loadAll().next(r=>g.forEach(r,s=>{let o=IDBKeyRange.bound([s.userId,xr],[s.userId,s.lastAcknowledgedBatchId]);return i.loadAll(ws,o).next(a=>g.forEach(a,l=>{q(l.userId===s.userId);let c=vs(this.serializer,l);return Ik(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Oa),i=e.store(ys);return e.store(Vs).get(Tf).next(s=>{let o=l=>t.put({targetId:0,path:Ut(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return i.iterate((l,c)=>{let u=new ce(l),d=m6(u);a.push(t.get(d).next(h=>h?g.resolve():o(u)))}).next(()=>g.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(gc,{keyPath:DU});let i=t.store(gc),r=new Rc,s=o=>{if(r.add(o)){let a=o.lastSegment(),l=o.popLast();return i.put({collectionId:a,parent:Ut(l)})}};return t.store(ys).iterate({keysOnly:!0},(o,a)=>{let l=new ce(o);return s(l.popLast())}).next(()=>t.store(Ra).iterate({keysOnly:!0},([o,a,l],c)=>{let u=ui(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(Ma);return t.iterate((i,r)=>{let s=lc(r),o=Sk(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let i=t.store(ys),r=[];return i.iterate((s,o)=>{let a=t.store(hm),l=D6(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(c))}).next(()=>g.waitFor(r))}runOverlayMigration(e,t){let i=t.store(Nn),r=Rk(this.serializer),s=new zf(jf.factory,this.serializer.remoteSerializer);return i.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Y();vs(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),g.forEach(a,(l,c)=>{let u=new et(c),d=Pf.forUser(this.serializer,u),h=s.getIndexManager(u),m=Vf.forUser(u,this.serializer,h,s.referenceDelegate);return new Uf(r,m,d,h).recalculateAndSaveOverlaysForDocumentKeys(new yc(t,rn.INVALID),l).next()})})}};function m6(n){return[0,Ut(n)]}function p6(n){n.createObjectStore(Uc)}function g6(n){n.createObjectStore(zc,{keyPath:_U}),n.createObjectStore(Nn,{keyPath:y1,autoIncrement:!0}).createIndex(ws,v1,{unique:!0}),n.createObjectStore(Ra)}function y6(n,e){return e.store(Nn).loadAll().next(i=>{n.deleteObjectStore(Nn),n.createObjectStore(Nn,{keyPath:y1,autoIncrement:!0}).createIndex(ws,v1,{unique:!0});let s=e.store(Nn),o=i.map(a=>s.put(a));return g.waitFor(o)})}function v6(n){n.createObjectStore(ys)}function _6(n){let e=n.createObjectStore(hm,{keyPath:EU});e.createIndex(pf,SU),e.createIndex(b1,CU)}function b6(n){n.createObjectStore(jc)}function HD(n){n.createObjectStore(Oa,{keyPath:IU}).createIndex(L0,AU,{unique:!0}),n.createObjectStore(Ma,{keyPath:TU}).createIndex(w1,xU,{unique:!0}),n.createObjectStore(Vs)}function w6(n){n.deleteObjectStore(Oa),n.deleteObjectStore(Ma),n.deleteObjectStore(Vs)}function E6(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function S6(n){let e=n.store(Vs),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return e.put(Tf,t)}function C6(n){n.createObjectStore(ma,{keyPath:kU})}function T6(n){n.createObjectStore(fm,{keyPath:RU})}function x6(n){n.createObjectStore(mm,{keyPath:MU})}function I6(n){n.createObjectStore(B0,{keyPath:OU,autoIncrement:!0}).createIndex(Q_,NU,{unique:!1}),n.createObjectStore(V0,{keyPath:PU}).createIndex(E1,FU,{unique:!1}),n.createObjectStore(q0,{keyPath:LU}).createIndex(S1,BU,{unique:!1})}function A6(n){let e=n.createObjectStore(pm,{keyPath:VU});e.createIndex(Y_,qU,{unique:!1}),e.createIndex(C1,UU,{unique:!1})}function D6(n){return n.document?new O(ce.fromString(n.document.name).popFirst(5)):n.noDocument?O.fromSegments(n.noDocument.path):n.unknownDocument?O.fromSegments(n.unknownDocument.path):L()}var Er="IndexedDbPersistence",D_=30*60*1e3,k_=5e3,k6=4e3,R_="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",R6="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",M6="firestore_zombie",Mk="main",jb=class n{constructor(e,t,i,r,s,o,a,l,c,u,d=u6){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new S(_.UNIMPLEMENTED,R6);this.referenceDelegate=new Rb(this,r),this.dbName=t+Mk,this.serializer=new Nf(l),this.simpleDb=new Ar(this.dbName,this.schemaVersion,new zb(this.serializer)),this.targetCache=new Ib(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Rk(this.serializer),this.bundleCache=new bb,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Oe(Er,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new S(_.FAILED_PRECONDITION,R_);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new rn(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>hf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(i=>{i||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(i=>this.isPrimary&&!i?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):i?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(qr(e))return A(Er,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return A(Er,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return oc(e).get(Xo).next(i=>g.resolve(this.isLocalClient(i)))}removeClientMetadata(e){return hf(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return p(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,D_)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let i=dt(t,ma);return i.loadAll().next(r=>{let s=this.filterActiveClients(r,D_),o=r.filter(a=>s.indexOf(a)===-1);return g.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",k6,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?g.resolve(!0):oc(e).get(Xo).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,k_)&&!this.isClientZombied(i.ownerId)){if(this.isLocalClient(i)&&this.networkEnabled)return!0;if(!this.isLocalClient(i)){if(!i.allowTabSynchronization)throw new S(_.FAILED_PRECONDITION,R_);return!1}}return this.networkEnabled&&this.inForeground?!0:hf(e).loadAll().next(s=>this.filterActiveClients(s,k_).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(i=>(this.isPrimary!==i&&A(Er,`Client ${i?"is":"is not"} eligible for a primary lease.`),i))}shutdown(){return p(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Uc,ma],e=>{let t=new yc(e,rn.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(i=>this.isWithinAge(i.updateTimeMs,t)&&!this.isClientZombied(i.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>hf(e).loadAll().next(t=>this.filterActiveClients(t,D_).map(i=>i.clientId)))}get started(){return this._started}getMutationQueue(e,t){return Vf.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xb(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Pf.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,i){A(Er,"Starting transaction:",e);let r=t==="readonly"?"readonly":"readwrite",s=QU(this.schemaVersion),o;return this.simpleDb.runTransaction(e,r,s,a=>(o=new yc(a,this.listenSequence?this.listenSequence.next():rn.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new S(_.FAILED_PRECONDITION,m1);return i(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>i(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return oc(e).get(Xo).next(i=>{if(i!==null&&this.isWithinAge(i.leaseTimestampMs,k_)&&!this.isClientZombied(i.ownerId)&&!this.isLocalClient(i)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!i.allowTabSynchronization))throw new S(_.FAILED_PRECONDITION,R_)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return oc(e).put(Xo,t)}static isAvailable(){return Ar.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=oc(e);return t.get(Xo).next(i=>this.isLocalClient(i)?(A(Er,"Releasing primary lease."),t.delete(Xo)):g.resolve())}isWithinAge(e,t){let i=Date.now(),r=i-t,s=i;return e<r?!1:e>s?(Oe(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;vE()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let i=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return A(Er,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Oe(Er,"Failed to get zombied client id.",i),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Oe("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${M6}_${this.persistenceKey}_${e}`}};function oc(n){return dt(n,Uc)}function hf(n){return dt(n,ma)}function Z0(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function O6(n){return p(this,null,function*(){if(!Ar.isAvailable())return Promise.resolve();let e=n+Mk;yield Ar.delete(e)})}var J0="LocalStore",N6=5*60*1e6,Oc=class{constructor(e,t,i,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new xe(Q),this.targetIdByTarget=new pi(s=>ks(s),Hc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(i)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Uf(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function Ok(n,e,t,i){return new Oc(n,e,t,i)}function Nk(n,e){return p(this,null,function*(){let t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],c=Y();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function P6(n,e){let t=P(n),i=Ne.now(),r=e.reduce((a,l)=>a.add(l.key),Y()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Yt(),c=Y();return t.remoteDocuments.getEntries(a,r).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let m=mz(h,s.get(h.key).overlayedDocument);m!=null&&d.push(new Ln(h.key,m,L1(m.value.mapValue),qe.exists(!0)))}return t.mutationQueue.addMutationBatch(a,i,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:X1(s)}))}function F6(n,e){let t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{let r=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return $6(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,L6(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function L6(n){let e=Y();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function B6(n,e){let t=P(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",i=>{let r;return t.mutationQueue.lookupMutationBatch(i,e).next(s=>(q(s!==null),r=s.keys(),t.mutationQueue.removeMutationBatch(i,s))).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,r)).next(()=>t.localDocuments.getDocuments(i,r))})}function V6(n){let e=P(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function Pk(n){let e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function q6(n,e){let t=P(n),i=e.snapshotVersion,r=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});r=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=r.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let m=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(ut.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):u.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(u.resumeToken,i)),r=r.insert(d,m),U6(h,m,u)&&a.push(t.targetCache.updateTargetData(s,m))});let l=Yt(),c=Y();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(Fk(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!i.isEqual(j.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=r,s))}function Fk(n,e,t){let i=Y(),r=Y();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let o=Yt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(j.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):A(J0,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:r}})}function U6(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=N6?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function z6(n,e){return p(this,null,function*(){let t=P(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",i=>g.forEach(e,r=>g.forEach(r.addedKeys,s=>t.persistence.referenceDelegate.addReference(i,r.targetId,s)).next(()=>g.forEach(r.removedKeys,s=>t.persistence.referenceDelegate.removeReference(i,r.targetId,s)))))}catch(i){if(qr(i))A(J0,"Failed to update sequence numbers: "+i);else throw i}for(let i of e){let r=i.targetId;if(!i.fromCache){let s=t.targetDataByTarget.get(r),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(r,a)}}})}function j6(n,e){let t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=xr),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function G6(n,e){let t=P(n);return t.persistence.runTransaction("read document","readonly",i=>t.localDocuments.getDocument(i,e))}function Sa(n,e){let t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.targetCache.getTargetData(i,e).next(s=>s?(r=s,g.resolve(r)):t.targetCache.allocateTargetId(i).next(o=>(r=new wa(e,o,"TargetPurposeListen",i.currentSequenceNumber),t.targetCache.addTargetData(i,r).next(()=>r))))}).then(i=>{let r=t.targetDataByTarget.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(i.targetId,i),t.targetIdByTarget.set(e,i.targetId)),i})}function H6(n,e,t){let i=P(n),r=i.targetIdByTarget.get(t);return r!==void 0?g.resolve(i.targetDataByTarget.get(r)):i.targetCache.getTargetData(e,t)}function Ca(n,e,t){return p(this,null,function*(){let i=P(n),r=i.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(qr(o))A(J0,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}i.targetDataByTarget=i.targetDataByTarget.remove(e),i.targetIdByTarget.delete(r.target)})}function bm(n,e,t){let i=P(n),r=j.min(),s=Y();return i.persistence.runTransaction("Execute query","readwrite",o=>H6(i,o,zt(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>i.queryEngine.getDocumentsMatchingQuery(o,e,t?r:j.min(),t?s:Y())).next(a=>(Vk(i,K1(e),a),{documents:a,remoteKeys:s})))}function $6(n,e,t,i){let r=t.batch,s=r.keys(),o=g.resolve();return s.forEach(a=>{o=o.next(()=>i.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);q(c!==null),l.version.compareTo(c)<0&&(r.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),i.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,r))}function W6(n,e){let t=P(n),i=P(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",r=>i.lookupMutationKeys(r,e).next(s=>s?t.localDocuments.getDocuments(r,s):g.resolve(null)))}function K6(n,e){P(P(n,Oc).mutationQueue).removeCachedMutationKeys(e)}function Q6(n){return P(P(n,Oc).persistence).getActiveClients()}function Lk(n,e){let t=P(n),i=P(t.targetCache),r=t.targetDataByTarget.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function Bk(n,e){let t=P(n),i=t.collectionGroupReadTime.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.remoteDocuments.getAllFromCollectionGroup(r,e,h1(i,fa),Number.MAX_SAFE_INTEGER)).then(r=>(Vk(t,e,r),r))}function Vk(n,e,t){let i=n.collectionGroupReadTime.get(e)||j.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.collectionGroupReadTime.set(e,i)}function Y6(n){return zt(Na(ce.fromString(`__bundle__/docs/${n}`)))}function X6(n,e,t,i){return p(this,null,function*(){let r=P(n),s=Y(),o=Yt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=r.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield Sa(r,Y6(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",c=>Fk(c,a,o).next(u=>(a.apply(c),u)).next(u=>r.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>r.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function Z6(n,e){let t=P(n),i=We(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",r=>t.bundleCache.getBundleMetadata(r,e.id)).then(r=>!!r&&r.createTime.compareTo(i)>=0)}function J6(n,e){let t=P(n);return t.persistence.runTransaction("Save bundle","readwrite",i=>t.bundleCache.saveBundleMetadata(i,e))}function e5(n,e){let t=P(n);return t.persistence.runTransaction("Get named query","readonly",i=>t.bundleCache.getNamedQuery(i,e))}function t5(i,r){return p(this,arguments,function*(n,e,t=Y()){let s=yield Sa(n,zt(K0(e.bundledQuery))),o=P(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=We(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(ut.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Gb=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var n5=100,i5=8,Gf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=n5,this.relativeIndexReadCostPerDocument=i5}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,i,r){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Gb;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,i,r){return i.documentReadCount<this.indexAutoCreationMinCollectionSize?(ra()<=jn.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",sa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),g.resolve()):(ra()<=jn.DEBUG&&A("QueryEngine","Query:",sa(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.relativeIndexReadCostPerDocument*r?(ra()<=jn.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",sa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zt(t))):g.resolve())}performQueryUsingIndex(e,t){if(hD(t))return g.resolve(null);let i=zt(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=kf(t,null,"F"),i=zt(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{let o=Y(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,kf(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,i,r){return hD(t)||r.isEqual(j.min())?g.resolve(null):this.localDocumentsView.getDocuments(e,i).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,i,r)?g.resolve(null):(ra()<=jn.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sa(t)),this.appendRemainingResults(e,o,t,h1(r,fa)).next(a=>a))})}applyQuery(e,t){let i=new ye(Q1(e));return t.forEach((r,s)=>{Wc(e,s)&&(i=i.add(s))}),i}needsRefill(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(r)>0:!1}executeFullCollectionScan(e,t,i){return ra()<=jn.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",sa(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,wn.min(),i)}appendRemainingResults(e,t,i,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var qk="firestore_clients";function $D(n,e){return`${qk}_${n}_${e}`}var Uk="firestore_mutations";function WD(n,e,t){let i=`${Uk}_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}var zk="firestore_targets";function M_(n,e){return`${zk}_${n}_${e}`}var r5="firestore_online_state";function s5(n){return`${r5}_${n}`}var o5="firestore_bundle_loaded_v2";function a5(n){return`${o5}_${n}`}var l5="firestore_sequence_number";function c5(n){return`${l5}_${n}`}var ci="SharedClientState",Hf=class n{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static fromWebStorageEntry(e,t,i){let r=JSON.parse(i),s=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),o;return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(o=new S(r.error.code,r.error.message))),s?new n(e,t,r.state,o):(Oe(ci,`Failed to parse mutation state for ID '${t}': ${i}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},fc=class n{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),s;return r&&i.error&&(r=typeof i.error.message=="string"&&typeof i.error.code=="string",r&&(s=new S(i.error.code,i.error.message))),r?new n(e,i.state,s):(Oe(ci,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},$f=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let i=JSON.parse(t),r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=$0();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=N1(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new n(e,s):(Oe(ci,`Failed to parse client data for instance '${e}': ${t}`),null)}},Hb=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Oe(ci,`Failed to parse online state: ${e}`),null)}},Nc=class{constructor(){this.activeTargetIds=$0()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},mc=class{constructor(e,t,i,r,s){this.window=e,this.queue=t,this.persistenceKey=i,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new xe(Q),this.started=!1,this.earlyEvents=[];let o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=$D(this.persistenceKey,this.localClientId),this.sequenceNumberKey=c5(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Nc),this.clientStateKeyRe=new RegExp(`^${qk}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${Uk}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${zk}_${o}_(\\d+)$`),this.onlineStateKey=s5(this.persistenceKey),this.bundleLoadedKey=a5(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return p(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let i of e){if(i===this.localClientId)continue;let r=this.getItem($D(this.persistenceKey,i));if(r){let s=$f.fromWebStorageEntry(i,r);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let i=this.fromWebStorageOnlineState(t);i&&this.handleOnlineStateEvent(i)}for(let i of this.earlyEvents)this.handleWebStorageEvent(i);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,i){this.persistMutationState(e,t,i),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(M_(this.persistenceKey,e));if(i){let r=fc.fromWebStorageEntry(e,i);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(M_(this.persistenceKey,e))}updateQueryState(e,t,i){this.persistQueryTargetState(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.removeMutationState(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return A(ci,"READ",e,t),t}setItem(e,t){A(ci,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){A(ci,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(A(ci,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>p(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let i=this.fromWebStorageClientState(t.key,t.newValue);if(i)return this.handleClientStateEvent(i.clientId,i)}else{let i=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(i,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(i)return this.handleMutationBatchEvent(i)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(i)return this.handleQueryTargetEvent(i)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let i=this.fromWebStorageOnlineState(t.newValue);if(i)return this.handleOnlineStateEvent(i)}}else if(t.key===this.sequenceNumberKey){let i=u5(t.newValue);i!==rn.INVALID&&this.sequenceNumberHandler(i)}else if(t.key===this.bundleLoadedKey){let i=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(i.map(r=>this.syncEngine.synchronizeWithChangedDocuments(r)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,i){let r=new Hf(this.currentUser,e,t,i),s=WD(this.persistenceKey,this.currentUser,e);this.setItem(s,r.toWebStorageJSON())}removeMutationState(e){let t=WD(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,i){let r=M_(this.persistenceKey,e),s=new fc(e,t,i);this.setItem(r,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let i=this.fromWebStorageClientStateKey(e);return $f.fromWebStorageEntry(i,t)}fromWebStorageMutationMetadata(e,t){let i=this.mutationBatchKeyRe.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return Hf.fromWebStorageEntry(new et(s),r,t)}fromWebStorageQueryTargetMetadata(e,t){let i=this.queryTargetKeyRe.exec(e),r=Number(i[1]);return fc.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return Hb.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return p(this,null,function*(){if(e.user.uid!==this.currentUser.uid){A(ci,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let i=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(i),o=[],a=[];return s.forEach(l=>{r.has(l)||o.push(l)}),r.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=i})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=$0();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}};function u5(n){let e=rn.INVALID;if(n!=null)try{let t=JSON.parse(n);q(typeof t=="number"),e=t}catch(t){Oe(ci,"Failed to read sequence number from WebStorage",t)}return e}var Wf=class{constructor(){this.localState=new Nc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,i){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Nc,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var $b=class{addCallback(e){}shutdown(){}};var Wb=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var ff=null;function d5(){return 268435456+Math.round(2147483648*Math.random())}function O_(){return ff===null?ff=d5():ff++,"0x"+ff.toString(16)}function h5(n){return new Promise((e,t)=>{n((i,r)=>{i?t(i):e(r)})})}var f5="1.9.1",qt="GrpcConnection",m5=`gl-node/${process.versions.node} fire/${ka} grpc/${f5}`;function N_(n,e,t,i){q(e===null||e.type==="OAuth");let r=new Cs.Metadata;return e&&e.headers.forEach((s,o)=>r.set(o,s)),t&&t.headers.forEach((s,o)=>r.set(o,s)),i&&r.set("X-Firebase-GMPID",i),r.set("X-Goog-Api-Client",m5),r.set("Google-Cloud-Resource-Prefix",n),r.set("x-goog-request-params",n),r}var Kb=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){A(qt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Cs.credentials.createSsl():Cs.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,i,r,s){let o=O_(),a=this.ensureActiveStub(),l=N_(this.databasePath,r,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},i);return h5(u=>(A(qt,`RPC '${e}' ${o} invoked with request:`,i),a[e](c,l,(d,h)=>{d?(A(qt,`RPC '${e}' ${o} failed with error:`,d),u(new S(vf(d.code),d.message))):(A(qt,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,i,r,s,o){let a=O_(),l=[],c=new $e;A(qt,`RPC '${e}' ${a} invoked (streaming) with request:`,i);let u=this.ensureActiveStub(),d=N_(this.databasePath,r,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},i),{database:this.databasePath}),m=u[e](h,d),y=!1;return m.on("data",v=>{A(qt,`RPC ${e} ${a} received result:`,v),l.push(v),o!==void 0&&l.length===o&&(y=!0,c.resolve(l))}),m.on("end",()=>{A(qt,`RPC '${e}' ${a} completed.`),y||(y=!0,c.resolve(l))}),m.on("error",v=>{A(qt,`RPC '${e}' ${a} failed with error:`,v);let b=vf(v.code);c.reject(new S(b,v.message))}),c.promise}openStream(e,t,i){let r=O_(),s=this.ensureActiveStub(),o=N_(this.databasePath,t,i,this.databaseInfo.appId),a=s[e](o),l=!1,c=d=>{l||(l=!0,u.callOnClose(d),a.end())},u=new Wb({sendFn:d=>{if(l)A(qt,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,d);else{A(qt,`RPC '${e}' stream ${r} sending:`,d);try{a.write(d)}catch(h){throw Oe("Failure sending:",d),Oe("Error:",h),h}}},closeFn:()=>{A(qt,`RPC '${e}' stream ${r} closed locally via close().`),c()}});return a.on("data",d=>{l||(A(qt,`RPC '${e}' stream ${r} received:`,d),u.callOnMessage(d))}),a.on("end",()=>{A(qt,`RPC '${e}' stream ${r} ended.`),c()}),a.on("error",d=>{if(!l){bn(qt,`RPC '${e}' stream ${r} error. Code:`,d.code,"Message:",d.message);let h=vf(d.code);c(new S(h,d.message))}}),A(qt,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}},jk={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},p5={nested:jk},g5=Object.freeze({__proto__:null,nested:jk,default:p5});var y5={longs:String,enums:String,defaults:!0,oneofs:!1};function v5(){let n=l1.fromJSON(g5,y5);return Cs.loadPackageDefinition(n)}function _5(n){let e=v5();return new Kb(e,n)}function b5(){return new $b}function Gk(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function w5(){return null}function Qc(n){return new gb(n,!1)}var E5="ExponentialBackoff",S5=1e3,C5=1.5,T5=60*1e3,Pc=class{constructor(e,t,i=S5,r=C5,s=T5){this.queue=e,this.timerId=t,this.initialDelayMs=i,this.backoffFactor=r,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),i=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-i);r>0&&A(E5,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var KD="PersistentStream",x5=60*1e3,I5=10*1e3,Kf=class{constructor(e,t,i,r,s,o,a,l){this.queue=e,this.idleTimerId=i,this.healthTimerId=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Pc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return p(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,x5,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return p(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return p(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===_.RESOURCE_EXHAUSTED?(Oe(t.toString()),Oe("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===_.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.closeCount===t&&this.startStream(i,r)},i=>{e(()=>{let r=new S(_.UNKNOWN,"Fetching auth token failed: "+i.message);return this.handleStreamClose(r)})})}startStream(e,t){let i=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{i(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,I5,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(r=>{i(()=>this.handleStreamClose(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>p(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return A(KD,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(A(KD,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Qb=class extends Kf{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=Vz(this.serializer,e),i=Uz(e);return this.listener.onWatchChange(t,i)}watch(e){let t={};t.database=Dc(this.serializer),t.addTarget=Zz(this.serializer,e);let i=Yz(this.serializer,e);i&&(t.labels=i),this.sendRequest(t)}unwatch(e){let t={};t.database=Dc(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Yb=class extends Kf{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=Hz(e.writeResults,e.commitTime),i=We(e.commitTime);return this.listener.onMutationResult(i,t)}else return q(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=Dc(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(i=>kc(this.serializer,i))};this.sendRequest(t)}};var Xb=class{},Zb=class extends Xb{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new S(_.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.invokeRPC(e,t,i,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new S(_.UNKNOWN,r.toString())})}invokeStreamingRPC(e,t,i,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeStreamingRPC(e,t,i,s,o,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new S(_.UNKNOWN,s.toString())})}terminate(){this.terminated=!0}};function A5(n,e,t,i){return new Zb(n,e,t,i)}function D5(n,e){return p(this,null,function*(){let t=P(n),i=Dc(t.serializer)+"/documents",r={writes:e.map(s=>kc(t.serializer,s))};yield t.invokeRPC("Commit",i,r)})}function k5(n,e){return p(this,null,function*(){let t=P(n),i=Dc(t.serializer)+"/documents",r={documents:e.map(l=>Ac(t.serializer,l))},s=yield t.invokeStreamingRPC("BatchGetDocuments",i,r,e.length),o=new Map;s.forEach(l=>{let c=Bz(t.serializer,l);o.set(c.key.toString(),c)});let a=[];return e.forEach(l=>{let c=o.get(l.toString());q(!!c),a.push(c)}),a})}function R5(n,e,t){let i=P(n);return i.verifyInitialized(),new Yb(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}function M5(n,e,t){let i=P(n);return i.verifyInitialized(),new Qb(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,t)}var O5="OnlineStateTracker",QD=1,YD=10*1e3,Jb=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",YD,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${YD/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=QD&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${QD} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Oe(t),this.shouldWarnClientIsOffline=!1):A(O5,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Ns="RemoteStore",N5=10,e0=class{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{i.enqueueAndForget(()=>p(this,null,function*(){Ur(this)&&(A(Ns,"Restarting streams for network reachability change."),yield X5(this))}))}),this.onlineStateTracker=new Jb(i,r)}};function P5(n,e,t,i,r){return new e0(n,e,t,i,r)}function F5(n){let e=P(n);return e.offlineCauses.delete(0),Yc(e)}function Yc(n){return p(this,null,function*(){if(Ur(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function L5(n){return p(this,null,function*(){let e=P(n);e.offlineCauses.add(0),yield Pa(e),e.onlineStateTracker.set("Offline")})}function Pa(n){return p(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function B5(n){return p(this,null,function*(){let e=P(n);A(Ns,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Pa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function wm(n,e){let t=P(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),nw(t)?tw(t):La(t).isOpen()&&ew(t,e))}function Xc(n,e){let t=P(n),i=La(t);t.listenTargets.delete(e),i.isOpen()&&Hk(t,e),t.listenTargets.size===0&&(i.isOpen()?i.markIdle():Ur(t)&&t.onlineStateTracker.set("Unknown"))}function ew(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}La(n).watch(e)}function Hk(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),La(n).unwatch(e)}function tw(n){n.watchChangeAggregator=new pb({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),La(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function nw(n){return Ur(n)&&!La(n).isStarted()&&n.listenTargets.size>0}function Ur(n){return P(n).offlineCauses.size===0}function $k(n){n.watchChangeAggregator=void 0}function V5(n){return p(this,null,function*(){n.listenTargets.forEach((e,t)=>{ew(n,e)})})}function q5(n,e){return p(this,null,function*(){$k(n),nw(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),tw(n)):n.onlineStateTracker.set("Unknown")})}function U5(n,e,t){return p(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Mf&&e.state===2&&e.cause){try{yield j5(n,e)}catch(i){A(Ns,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield Qf(n,i)}return}if(e instanceof ha?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Rf?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(j.min()))try{let i=yield Pk(n.localStore);t.compareTo(i)>=0&&(yield z5(n,t))}catch(i){A(Ns,"Failed to raise snapshot:",i),yield Qf(n,i)}})}function Qf(n,e,t){return p(this,null,function*(){if(qr(e))n.offlineCauses.add(1),yield Pa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>Pk(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){A(Ns,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Yc(n)}));else throw e})}function Wk(n,e){return e().catch(t=>Qf(n,t,e))}function z5(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((i,r)=>{if(i.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(r);s&&n.listenTargets.set(r,s.withResumeToken(i.resumeToken,e))}}),t.targetMismatches.forEach((i,r)=>{let s=n.listenTargets.get(i);if(!s)return;n.listenTargets.set(i,s.withResumeToken(ut.EMPTY_BYTE_STRING,s.snapshotVersion)),Hk(n,i);let o=new wa(s.target,i,r,s.sequenceNumber);ew(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function j5(n,e){return p(this,null,function*(){let t=e.cause;for(let i of e.targetIds)n.listenTargets.has(i)&&(yield n.remoteSyncer.rejectListen(i,t),n.listenTargets.delete(i),n.watchChangeAggregator.removeTarget(i))})}function Fa(n){return p(this,null,function*(){let e=P(n),t=zr(e),i=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:xr;for(;G5(e);)try{let r=yield j6(e.localStore,i);if(r===null){e.writePipeline.length===0&&t.markIdle();break}else i=r.batchId,H5(e,r)}catch(r){yield Qf(e,r)}Kk(e)&&Qk(e)})}function G5(n){return Ur(n)&&n.writePipeline.length<N5}function H5(n,e){n.writePipeline.push(e);let t=zr(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function Kk(n){return Ur(n)&&!zr(n).isStarted()&&n.writePipeline.length>0}function Qk(n){zr(n).start()}function $5(n){return p(this,null,function*(){zr(n).writeHandshake()})}function W5(n){return p(this,null,function*(){let e=zr(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function K5(n,e,t){return p(this,null,function*(){let i=n.writePipeline.shift(),r=db.from(i,e,t);yield Wk(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Fa(n)})}function Q5(n,e){return p(this,null,function*(){e&&zr(n).handshakeComplete&&(yield Y5(n,e)),Kk(n)&&Qk(n)})}function Y5(n,e){return p(this,null,function*(){if(wz(e.code)){let t=n.writePipeline.shift();zr(n).inhibitBackoff(),yield Wk(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Fa(n)}})}function X5(n){return p(this,null,function*(){let e=P(n);e.offlineCauses.add(4),yield Pa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Yc(e)})}function XD(n,e){return p(this,null,function*(){let t=P(n);t.asyncQueue.verifyOperationInProgress(),A(Ns,"RemoteStore received new credentials");let i=Ur(t);t.offlineCauses.add(3),yield Pa(t),i&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Yc(t)})}function t0(n,e){return p(this,null,function*(){let t=P(n);e?(t.offlineCauses.delete(2),yield Yc(t)):e||(t.offlineCauses.add(2),yield Pa(t),t.onlineStateTracker.set("Unknown"))})}function La(n){return n.watchStream||(n.watchStream=M5(n.datastore,n.asyncQueue,{onOpen:V5.bind(null,n),onClose:q5.bind(null,n),onWatchChange:U5.bind(null,n)}),n.onNetworkStatusChange.push(e=>p(this,null,function*(){e?(n.watchStream.inhibitBackoff(),nw(n)?tw(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),$k(n))}))),n.watchStream}function zr(n){return n.writeStream||(n.writeStream=R5(n.datastore,n.asyncQueue,{onOpen:$5.bind(null,n),onClose:Q5.bind(null,n),onHandshakeComplete:W5.bind(null,n),onMutationResult:K5.bind(null,n)}),n.onNetworkStatusChange.push(e=>p(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Fa(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(A(Ns,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var Z5="AsyncQueue",n0=class n{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new $e,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){let o=Date.now()+i,a=new n(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new S(_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ba(n,e){if(Oe(Z5,`${e}: ${n}`),qr(n))return new S(_.UNAVAILABLE,`${e}: ${n}`);throw n}var Yf=class n{constructor(e){e?this.comparator=(t,i)=>e(t,i)||O.comparator(t.key,i.key):this.comparator=(t,i)=>O.comparator(t.key,i.key),this.keyedMap=ac(),this.sortedSet=new xe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){let r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let i=new n;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}};var Xf=class{constructor(){this.changeMap=new xe(O.comparator)}track(e){let t=e.doc.key,i=this.changeMap.get(t);if(!i){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&i.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&i.type!==1?this.changeMap=this.changeMap.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&i.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):L()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,i)=>{e.push(i)}),e}},Ta=class n{constructor(e,t,i,r,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,i,r,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Yf.emptySet(t),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!$c(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}};var i0=class{constructor(){this.viewSnap=void 0,this.listeners=[]}};function J5(){return new r0}var r0=class{constructor(){this.queries=new pi(e=>W1(e),$c),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function iw(n,e){return p(this,null,function*(){let t=P(n),i=e.query,r=!1,s=t.queries.get(i);if(s||(r=!0,s=new i0),r)try{s.viewSnap=yield t.onListen(i)}catch(o){let a=Ba(o,`Initialization of query '${sa(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&sw(t)})}function rw(n,e){return p(this,null,function*(){let t=P(n),i=e.query,r=!1,s=t.queries.get(i);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),r=s.listeners.length===0)}if(r)return t.queries.delete(i),t.onUnlisten(i)})}function e9(n,e){let t=P(n),i=!1;for(let r of e){let s=r.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(r)&&(i=!0);o.viewSnap=r}}i&&sw(t)}function t9(n,e,t){let i=P(n),r=i.queries.get(e);if(r)for(let s of r.listeners)s.onError(t);i.queries.delete(e)}function n9(n,e){let t=P(n);t.onlineState=e;let i=!1;t.queries.forEach((r,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(i=!0)}),i&&sw(t)}function i9(n,e){P(n).snapshotsInSyncListeners.add(e),e.next()}function r9(n,e){P(n).snapshotsInSyncListeners.delete(e)}function sw(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var Fc=class{constructor(e,t,i){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=i||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let i=[];for(let r of e.docChanges)r.type!==3&&i.push(r);e=new Ta(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let i=t!=="Offline";return this.options.waitForSyncWhenOnline&&i?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Ta.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}};var s0=class n{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.addedKeys=i,this.removedKeys=r}static fromSnapshot(e,t){let i=Y(),r=Y();for(let s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key);break}return new n(e,t.fromCache,i,r)}};var Zf=class{constructor(e){this.serializer=e}toDocumentKey(e){return hi(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?gk(this.serializer,e.document,!1):Je.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return We(e)}},o0=class{constructor(e,t,i){this.bundleMetadata=e,this.localStore=t,this.serializer=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Yk(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let i=ce.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,i=new Zf(this.serializer);for(let r of e)if(r.metadata.queries){let s=i.toDocumentKey(r.metadata.name);for(let o of r.metadata.queries){let a=(t.get(o)||Y()).add(s);t.set(o,a)}}return t}complete(){return p(this,null,function*(){let e=yield X6(this.localStore,new Zf(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let i of this.queries)yield t5(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function Yk(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function s9(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Jf=class{constructor(e){this.key=e}},em=class{constructor(e){this.key=e}},tm=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Y(),this.mutatedKeys=Y(),this.docComparator=Q1(e),this.documentSet=new Yf(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let i=t?t.changeSet:new Xf,r=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1,l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,d)=>{let h=r.get(u),m=Wc(this.query,d)?d:null,y=h?this.mutatedKeys.has(h.key):!1,v=m?m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations:!1,b=!1;h&&m?h.data.isEqual(m.data)?y!==v&&(i.track({type:3,doc:m}),b=!0):this.shouldWaitForSyncedDocument(h,m)||(i.track({type:2,doc:m}),b=!0,(l&&this.docComparator(m,l)>0||c&&this.docComparator(m,c)<0)&&(a=!0)):!h&&m?(i.track({type:0,doc:m}),b=!0):h&&!m&&(i.track({type:1,doc:h}),b=!0,(l||c)&&(a=!0)),b&&(m?(o=o.add(m),v?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{documentSet:o,changeSet:i,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>o9(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(i),r=r??!1;let a=t&&!r?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!r?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Ta(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,i?i.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Xf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Y(),this.documentSet.forEach(i=>{this.shouldBeInLimbo(i.key)&&(this.limboDocuments=this.limboDocuments.add(i.key))});let t=[];return e.forEach(i=>{this.limboDocuments.has(i)||t.push(new em(i))}),this.limboDocuments.forEach(i=>{e.has(i)||t.push(new Jf(i))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Y();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Ta.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function o9(n,e){let t=i=>{switch(i){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return L()}};return t(n)-t(e)}var jr="SyncEngine",a0=class{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}},l0=class{constructor(e){this.key=e,this.receivedDocument=!1}},c0=class{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new pi(a=>W1(a),$c),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new xe(O.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Mc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Ea.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function a9(n,e,t,i,r,s,o){let a=new c0(n,e,t,i,r,s);return o&&(a._isPrimaryClient=!0),a}function l9(n,e){return p(this,null,function*(){let t=dw(n),i,r,s=t.queryViewsByQuery.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.computeInitialSnapshot();else{let o=yield Sa(t.localStore,zt(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=yield ow(t,e,i,a==="current",o.resumeToken),t.isPrimaryClient&&wm(t.remoteStore,o)}return r})}function ow(n,e,t,i,r){return p(this,null,function*(){n.applyDocChanges=(d,h,m)=>v9(n,d,h,m);let s=yield bm(n.localStore,e,!0),o=new tm(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Ic.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),c=o.applyChanges(a,n.isPrimaryClient,l);cw(n,t,c.limboChanges);let u=new a0(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function c9(n,e){return p(this,null,function*(){let t=P(n),i=t.queryViewsByQuery.get(e),r=t.queriesByTarget.get(i.targetId);if(r.length>1){t.queriesByTarget.set(i.targetId,r.filter(s=>!$c(s,e))),t.queryViewsByQuery.delete(e);return}t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ca(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Xc(t.remoteStore,i.targetId),xa(t,i.targetId)}).catch(Vr))):(xa(t,i.targetId),yield Ca(t.localStore,i.targetId,!0))})}function u9(n,e,t){return p(this,null,function*(){let i=hw(n);try{let r=yield P6(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),g9(i,r.batchId,t),yield Li(i,r.changes),yield Fa(i.remoteStore)}catch(r){let s=Ba(r,"Failed to persist write");t.reject(s)}})}function Xk(n,e){return p(this,null,function*(){let t=P(n);try{let i=yield q6(t.localStore,e);e.targetChanges.forEach((r,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(q(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.receivedDocument=!0:r.modifiedDocuments.size>0?q(o.receivedDocument):r.removedDocuments.size>0&&(q(o.receivedDocument),o.receivedDocument=!1))}),yield Li(t,i,e)}catch(i){yield Vr(i)}})}function ZD(n,e,t){let i=P(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){let r=[];i.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&r.push(a.snapshot)}),n9(i.eventManager,e),r.length&&i.syncEngineListener.onWatchChange(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function d9(n,e,t){return p(this,null,function*(){let i=P(n);i.sharedClientState.updateQueryState(e,"rejected",t);let r=i.activeLimboResolutionsByTarget.get(e),s=r&&r.key;if(s){let o=new xe(O.comparator);o=o.insert(s,Je.newNoDocument(s,j.min()));let a=Y().add(s),l=new xc(j.min(),new Map,new xe(Q),o,a);yield Xk(i,l),i.activeLimboTargetsByKey=i.activeLimboTargetsByKey.remove(s),i.activeLimboResolutionsByTarget.delete(e),uw(i)}else yield Ca(i.localStore,e,!1).then(()=>xa(i,e,t)).catch(Vr)})}function h9(n,e){return p(this,null,function*(){let t=P(n),i=e.batch.batchId;try{let r=yield F6(t.localStore,e);lw(t,i,null),aw(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Li(t,r)}catch(r){yield Vr(r)}})}function f9(n,e,t){return p(this,null,function*(){let i=P(n);try{let r=yield B6(i.localStore,e);lw(i,e,t),aw(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Li(i,r)}catch(r){yield Vr(r)}})}function m9(n,e){return p(this,null,function*(){let t=P(n);Ur(t.remoteStore)||A(jr,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let i=yield V6(t.localStore);if(i===xr){e.resolve();return}let r=t.pendingWritesCallbacks.get(i)||[];r.push(e),t.pendingWritesCallbacks.set(i,r)}catch(i){let r=Ba(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}})}function aw(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function p9(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(i=>{i.reject(new S(_.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function g9(n,e,t){let i=n.mutationUserCallbacks[n.currentUser.toKey()];i||(i=new xe(Q)),i=i.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=i}function lw(n,e,t){let i=P(n),r=i.mutationUserCallbacks[i.currentUser.toKey()];if(r){let s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.mutationUserCallbacks[i.currentUser.toKey()]=r}}function xa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let i of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(i),t&&n.syncEngineListener.onWatchError(i,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(r=>{n.limboDocumentRefs.containsKey(r)||Zk(n,r)})}function Zk(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Xc(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),uw(n))}function cw(n,e,t){for(let i of t)i instanceof Jf?(n.limboDocumentRefs.addReference(i.key,e),y9(n,i)):i instanceof em?(A(jr,"Document no longer in limbo: "+i.key),n.limboDocumentRefs.removeReference(i.key,e),n.limboDocumentRefs.containsKey(i.key)||Zk(n,i.key)):L()}function y9(n,e){let t=e.key,i=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(i)&&(A(jr,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(i),uw(n))}function uw(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new O(ce.fromString(e)),i=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(i,new l0(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,i),wm(n.remoteStore,new wa(zt(Na(t.path)),i,"TargetPurposeLimboResolution",rn.INVALID))}}function Li(n,e,t){return p(this,null,function*(){let i=P(n),r=[],s=[],o=[];i.queryViewsByQuery.isEmpty()||(i.queryViewsByQuery.forEach((a,l)=>{o.push(i.applyDocChanges(l,e,t).then(c=>{if((c||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){r.push(c);let u=s0.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),i.syncEngineListener.onWatchChange(r),yield z6(i.localStore,s))})}function v9(n,e,t,i){return p(this,null,function*(){let r=e.view.computeDocChanges(t);r.needsRefill&&(r=yield bm(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,r)));let s=i&&i.targetChanges.get(e.targetId),o=i&&i.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(r,n.isPrimaryClient,s,o);return cw(n,e.targetId,a.limboChanges),a.snapshot})}function _9(n,e){return p(this,null,function*(){let t=P(n);if(!t.currentUser.isEqual(e)){A(jr,"User change. New user:",e.toKey());let r=yield Nk(t.localStore,e);t.currentUser=e,p9(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Li(t,r.affectedDocuments)}})}function b9(n,e){let t=P(n),i=t.activeLimboResolutionsByTarget.get(e);if(i&&i.receivedDocument)return Y().add(i.key);{let r=Y(),s=t.queriesByTarget.get(e);if(!s)return r;for(let o of s){let a=t.queryViewsByQuery.get(o);r=r.unionWith(a.view.syncedDocuments)}return r}}function w9(n,e){return p(this,null,function*(){let t=P(n),i=yield bm(t.localStore,e.query,!0),r=e.view.synchronizeWithPersistedState(i);return t.isPrimaryClient&&cw(t,e.targetId,r.limboChanges),r})}function E9(n,e){return p(this,null,function*(){let t=P(n);return Bk(t.localStore,e).then(i=>Li(t,i))})}function S9(n,e,t,i){return p(this,null,function*(){let r=P(n),s=yield W6(r.localStore,e);if(s===null){A(jr,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield Fa(r.remoteStore):t==="acknowledged"||t==="rejected"?(lw(r,e,i||null),aw(r,e),K6(r.localStore,e)):L(),yield Li(r,s)})}function C9(n,e){return p(this,null,function*(){let t=P(n);if(dw(t),hw(t),e===!0&&t._isPrimaryClient!==!0){let i=t.sharedClientState.getAllActiveQueryTargets(),r=yield JD(t,i.toArray());t._isPrimaryClient=!0,yield t0(t.remoteStore,!0);for(let s of r)wm(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let i=[],r=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(xa(t,o),Ca(t.localStore,o,!0))),Xc(t.remoteStore,o)}),yield r,yield JD(t,i),T9(t),t._isPrimaryClient=!1,yield t0(t.remoteStore,!1)}})}function T9(n){let e=P(n);e.activeLimboResolutionsByTarget.forEach((t,i)=>{Xc(e.remoteStore,i)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new xe(O.comparator)}function JD(n,e,t){return p(this,null,function*(){let i=P(n),r=[],s=[];for(let o of e){let a,l=i.queriesByTarget.get(o);if(l&&l.length!==0){a=yield Sa(i.localStore,zt(l[0]));for(let c of l){let u=i.queryViewsByQuery.get(c),d=yield w9(i,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield Lk(i.localStore,o);a=yield Sa(i.localStore,c),yield ow(i,Jk(c),o,!1,a.resumeToken)}r.push(a)}return i.syncEngineListener.onWatchChange(s),r})}function Jk(n){return $1(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function x9(n){let e=P(n);return Q6(e.localStore)}function I9(n,e,t,i){return p(this,null,function*(){let r=P(n);if(r._isPrimaryClient){A(jr,"Ignoring unexpected query state notification.");return}let s=r.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Bk(r.localStore,K1(s[0])),a=xc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ut.EMPTY_BYTE_STRING);yield Li(r,o,a);break}case"rejected":{yield Ca(r.localStore,e,!0),xa(r,e,i);break}default:L()}})}function A9(n,e,t){return p(this,null,function*(){let i=dw(n);if(i._isPrimaryClient){for(let r of e){if(i.queriesByTarget.has(r)){A(jr,"Adding an already active target "+r);continue}let s=yield Lk(i.localStore,r),o=yield Sa(i.localStore,s);yield ow(i,Jk(s),o.targetId,!1,o.resumeToken),wm(i.remoteStore,o)}for(let r of t)i.queriesByTarget.has(r)&&(yield Ca(i.localStore,r,!1).then(()=>{Xc(i.remoteStore,r),xa(i,r)}).catch(Vr))}})}function dw(n){let e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xk.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=b9.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=d9.bind(null,e),e.syncEngineListener.onWatchChange=e9.bind(null,e.eventManager),e.syncEngineListener.onWatchError=t9.bind(null,e.eventManager),e}function hw(n){let e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=h9.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=f9.bind(null,e),e}function D9(n,e,t){let i=P(n);k9(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}function k9(n,e,t){return p(this,null,function*(){try{let i=yield e.getMetadata();if(yield Z6(n.localStore,i))return yield e.close(),t._completeWith(s9(i)),Promise.resolve(new Set);t._updateProgress(Yk(i));let s=new o0(i,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Li(n,a.changedDocs,void 0),yield J6(n.localStore,i),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(i){return bn(jr,`Loading bundle failed with ${i}`),t._failWith(i),Promise.resolve(new Set)}})}var Lc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){this.serializer=Qc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Ok(this.persistence,new Gf,e.initialUser,this.serializer)}createPersistence(e){return new zf(jf.factory,this.serializer)}createSharedClientState(e){return new Wf}terminate(){return p(this,null,function*(){this.gcScheduler&&this.gcScheduler.stop(),yield this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var nm=class n extends Lc{constructor(e,t,i){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield qm(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield hw(this.onlineComponentProvider.syncEngine),yield Fa(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Ok(this.persistence,new Gf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let i=this.persistence.referenceDelegate.garbageCollector;return new Db(i,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let i=new $_(t,this.persistence);return new H_(e.asyncQueue,i)}createPersistence(e){let t=Z0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new jb(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Gk(),w5(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Wf}},u0=class n extends nm{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return p(this,null,function*(){yield qm(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof mc&&(this.sharedClientState.syncEngine={applyBatchState:S9.bind(null,t),applyTargetState:I9.bind(null,t),applyActiveTargetsChange:A9.bind(null,t),getActiveClients:x9.bind(null,t),synchronizeWithChangedDocuments:E9.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(i=>p(this,null,function*(){yield C9(this.onlineComponentProvider.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=Gk();if(!mc.isAvailable(t))throw new S(_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let i=Z0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new mc(t,e.asyncQueue,i,e.clientId,e.initialUser)}},Bc=class{initialize(e,t){return p(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ZD(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=_9.bind(null,this.syncEngine),yield t0(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return J5()}createDatastore(e){let t=Qc(e.databaseInfo.databaseId),i=_5(e.databaseInfo);return A5(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return P5(this.localStore,this.datastore,e.asyncQueue,t=>ZD(this.syncEngine,t,0),b5())}createSyncEngine(e,t){return a9(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return B5(this.remoteStore)}};var R9=10240;function M9(n,e=R9){let t=0;return{read(){return p(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function fw(n,e,t){if(!t)throw new S(_.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mw(n,e,t,i){if(e===!0&&i===!0)throw new S(_.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function e1(n){if(!O.isDocumentKey(n))throw new S(_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function t1(n){if(O.isDocumentKey(n))throw new S(_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function O9(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Zc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=N9(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":L()}function N9(n){return n.constructor?n.constructor.name:null}function ne(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new S(_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Zc(n);throw new S(_.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function eR(n,e){if(e<=0)throw new S(_.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function P9(n,e){if(!(n instanceof Uint8Array))throw new S(_.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Zc(n)}`);return M9(n,e)}var Ia=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Oe("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var d0=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var h0=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new $e,this.buffer=new Uint8Array,this.textDecoder=Ez(),this.nextElementImpl().then(i=>{i&&i.isBundleMetadata()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i?.payload)}`))},i=>this.metadata.reject(i))}close(){return this.reader.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}nextElement(){return p(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return p(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),i=Number(t);isNaN(i)&&this.raiseError(`length string (${t}) is not valid number`);let r=yield this.readJsonString(i);return new d0(JSON.parse(r),e.length+i)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}readLength(){return p(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return p(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return p(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function F9(n,e){return new h0(n,e)}var f0=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new S(_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=yield k5(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{let r=O.fromPath(i);this.mutations.push(new Sc(r,this.precondition(r)))}),yield D5(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=j.min();else throw L();let i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new S(_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?qe.exists(!1):qe.updateTime(t):qe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new S(_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qe.updateTime(t)}else return qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var m0=class{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.attemptsRemaining=i.maxAttempts,this.backoff=new Pc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>p(this,null,function*(){let e=new f0(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.handleTransactionError(r)}))}).catch(i=>{this.handleTransactionError(i)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Gc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!uk(t)}return!1}};var Lr="FirestoreClient",L9=100,B9=11,V9=20,q9=22,p0=class{constructor(e,t,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=et.UNAUTHENTICATED,this.clientId=wf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,s=>p(this,null,function*(){A(Lr,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(i,s=>(A(Lr,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}getConfiguration(){return p(this,null,function*(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:L9}})}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new S(_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new $e;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let i=Ba(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}};function _f(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),A(Lr,"Initializing OfflineComponentProvider");let t=yield n.getConfiguration();yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(r=>p(this,null,function*(){i.isEqual(r)||(yield Nk(e.localStore,r),i=r)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function g0(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield pw(n);A(Lr,"Initializing OnlineComponentProvider");let i=yield n.getConfiguration();yield e.initialize(t,i),n.setCredentialChangeListener(r=>XD(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>XD(e.remoteStore,s)),n._onlineComponents=e})}function tR(n){return n.name==="FirebaseError"?n.code===_.FAILED_PRECONDITION||n.code===_.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===q9||n.code===V9||n.code===B9:!0}function pw(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){A(Lr,"Using user provided OfflineComponentProvider");try{yield _f(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!tR(t))throw t;bn("Error using user provided cache. Falling back to memory cache: "+t),yield _f(n,new Lc)}}else A(Lr,"Using default OfflineComponentProvider"),yield _f(n,new Lc);return n._offlineComponents})}function Em(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(A(Lr,"Using user provided OnlineComponentProvider"),yield g0(n,n._uninitializedComponentsProvider._online)):(A(Lr,"Using default OnlineComponentProvider"),yield g0(n,new Bc))),n._onlineComponents})}function nR(n){return pw(n).then(e=>e.persistence)}function gw(n){return pw(n).then(e=>e.localStore)}function iR(n){return Em(n).then(e=>e.remoteStore)}function yw(n){return Em(n).then(e=>e.syncEngine)}function U9(n){return Em(n).then(e=>e.datastore)}function Aa(n){return p(this,null,function*(){let e=yield Em(n),t=e.eventManager;return t.onListen=l9.bind(null,e.syncEngine),t.onUnlisten=c9.bind(null,e.syncEngine),t})}function z9(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let e=yield nR(n),t=yield iR(n);return e.setNetworkEnabled(!0),F5(t)}))}function j9(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let e=yield nR(n),t=yield iR(n);return e.setNetworkEnabled(!1),L5(t)}))}function G9(n){let e=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let t=yield yw(n);return m9(t,e)})),e.promise}function H9(n,e,t,i){let r=new Ia(i),s=new Fc(e,r,t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let o=yield Aa(n);return iw(o,s)})),()=>{r.mute(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let o=yield Aa(n);return rw(o,s)}))}}function $9(n,e){let t=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield gw(n);return X9(i,e,t)})),t.promise}function rR(n,e,t={}){let i=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield Aa(n);return Z9(r,n.asyncQueue,e,t,i)})),i.promise}function W9(n,e){let t=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield gw(n);return J9(i,e,t)})),t.promise}function sR(n,e,t={}){let i=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield Aa(n);return eG(r,n.asyncQueue,e,t,i)})),i.promise}function K9(n,e){let t=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield yw(n);return u9(i,e,t)})),t.promise}function Q9(n,e){let t=new Ia(e);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield Aa(n);return i9(i,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let i=yield Aa(n);return r9(i,t)}))}}function Y9(n,e,t){let i=new $e;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let r=yield U9(n);new m0(n.asyncQueue,r,t,e,i).run()})),i.promise}function X9(n,e,t){return p(this,null,function*(){try{let i=yield G6(n,e);i.isFoundDocument()?t.resolve(i):i.isNoDocument()?t.resolve(null):t.reject(new S(_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(i){let r=Ba(i,`Failed to get document '${e} from cache`);t.reject(r)}})}function Z9(n,e,t,i,r){let s=new Ia({next:a=>{e.enqueueAndForget(()=>rw(n,o));let l=a.docs.has(t);!l&&a.fromCache?r.reject(new S(_.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&i.source==="server"?r.reject(new S(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new Fc(Na(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return iw(n,o)}function J9(n,e,t){return p(this,null,function*(){try{let i=yield bm(n,e,!0),r=new tm(e,i.remoteKeys),s=r.computeDocChanges(i.documents),o=r.applyChanges(s,!1);t.resolve(o.snapshot)}catch(i){let r=Ba(i,`Failed to execute query '${e} against cache`);t.reject(r)}})}function eG(n,e,t,i,r){let s=new Ia({next:a=>{e.enqueueAndForget(()=>rw(n,o)),a.fromCache&&i.source==="server"?r.reject(new S(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(a)},error:a=>r.reject(a)}),o=new Fc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return iw(n,o)}function tG(n,e,t,i){let r=iG(t,Qc(e));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){D9(yield yw(n),r,i)}))}function nG(n,e){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return e5(yield gw(n),e)}))}function iG(n,e){let t;return typeof n=="string"?t=dk().encode(n):t=n,F9(P9(t),e)}function rG(n,e){return n.timeoutSeconds===e.timeoutSeconds}function oR(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var sG="ComponentProvider",n1=new Map;function oG(n){let e=n1.get(n);e&&(A(sG,"Removing Datastore"),n1.delete(n),e.terminate())}function aG(n,e,t,i){return new Z_(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,oR(i.experimentalLongPollingOptions),i.useFetchStreams)}var aR="firestore.googleapis.com",i1=!0,r1=5,s1=30,lG=!0,im=class{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new S(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aR,this.ssl=i1}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:i1;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=kk;else{if(e.cacheSizeBytes!==Kc&&e.cacheSizeBytes<qD)throw new S(_.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${qD}`);this.cacheSizeBytes=e.cacheSizeBytes}mw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=lG:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oR((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),cG(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&rG(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function cG(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new S(_.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<r1)throw new S(_.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${r1})`);if(n.timeoutSeconds>s1)throw new S(_.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${s1})`)}}var Ps=class{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new im({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new S(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new S(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new im(e),e.credentials!==void 0&&(this._authCredentials=lU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return oG(this),Promise.resolve()}};function lR(n,e,t,i={}){var r;n=ne(n,Ps);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==aR&&s.host!==o&&bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,l;if(typeof i.mockUserToken=="string")a=i.mockUserToken,l=et.MOCK_USER;else{a=yE(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);let c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new S(_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new et(c)}n._authCredentials=new F_(new bf(a,l))}}var vt=class n{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ee=class n{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},fi=class n extends vt{constructor(e,t,i){super(e,t,Na(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new O(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function vw(n,e,...t){if(n=Re(n),fw("collection","path",e),n instanceof Ps){let i=ce.fromString(e,...t);return t1(i),new fi(n,null,i)}else{if(!(n instanceof Ee)&&!(n instanceof fi))throw new S(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(ce.fromString(e,...t));return t1(i),new fi(n.firestore,null,i)}}function cR(n,e){if(n=ne(n,Ps),fw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new S(_.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vt(n,null,G4(e))}function Jc(n,e,...t){if(n=Re(n),arguments.length===1&&(e=wf.newId()),fw("doc","path",e),n instanceof Ps){let i=ce.fromString(e,...t);return e1(i),new Ee(n,null,new O(i))}else{if(!(n instanceof Ee)&&!(n instanceof fi))throw new S(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=n._path.child(ce.fromString(e,...t));return e1(i),new Ee(n.firestore,n instanceof fi?n.converter:null,new O(i))}}function _w(n,e){return n=Re(n),e=Re(e),(n instanceof Ee||n instanceof fi)&&(e instanceof Ee||e instanceof fi)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function bw(n,e){return n=Re(n),e=Re(e),n instanceof vt&&e instanceof vt?n.firestore===e.firestore&&$c(n._query,e._query)&&n.converter===e.converter:!1}var uG="AsyncQueue",y0=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Pc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new $e;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return p(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(qr(e))A(uG,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(i=>{this.failure=i,this.operationInProgress=!1;let r=hG(i);throw Oe("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.operationInProgress=!1,i))));return this.tail=t,t}enqueueAfterDelay(e,t,i){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=n0.createAndSchedule(this,e,t,i,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&L()}verifyOperationInProgress(){}drain(){return p(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function dG(){return new y0}function hG(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var v0=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new $e,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var uR=Kc,ke=class extends Ps{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=dG(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||dR(this),this._firestoreClient.terminate()}};function nt(n){return n._firestoreClient||dR(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function dR(n){var e,t,i;let r=n._freezeSettings(),s=aG(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._firestoreClient=new p0(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=r.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}function hR(n,e){n=ne(n,ke),wR(n);let t=nt(n);if(t._uninitializedComponentsProvider)throw new S(_.FAILED_PRECONDITION,"SDK cache is already specified.");bn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let i=n._freezeSettings(),r=new Bc,s=new nm(r,i.cacheSizeBytes,e?.forceOwnership);return mR(t,r,s)}function fR(n){n=ne(n,ke),wR(n);let e=nt(n);if(e._uninitializedComponentsProvider)throw new S(_.FAILED_PRECONDITION,"SDK cache is already specified.");bn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),i=new Bc,r=new u0(i,t.cacheSizeBytes);return mR(e,i,r)}function mR(n,e,t){let i=new $e;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield _f(n,t),yield g0(n,e),i.resolve()}catch(r){let s=r;if(!tR(s))throw s;bn("Error enabling indexeddb cache. Falling back to memory cache: "+s),i.reject(s)}})).then(()=>i.promise)}function pR(n){if(n._initialized&&!n._terminated)throw new S(_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new $e;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield O6(Z0(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function gR(n){n=ne(n,ke);let e=nt(n);return G9(e)}function yR(n){n=ne(n,ke);let e=nt(n);return z9(e)}function vR(n){n=ne(n,ke);let e=nt(n);return j9(e)}function _R(n,e){n=ne(n,ke);let t=nt(n),i=new v0;return tG(t,n._databaseId,e,i),i}function bR(n,e){n=ne(n,ke);let t=nt(n);return nG(t,e).then(i=>i?new vt(n,null,i.query):null)}function wR(n){if(n._initialized||n._terminated)throw new S(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function fG(n,e=!0){oU(wE),Ka(new Xr("firestore",(t,{instanceIdentifier:i,options:r})=>{let s=t.getProvider("app").getImmediate(),o=new ke(new L_(t.getProvider("auth-internal")),new U_(t.getProvider("app-check-internal")),i4(s,i),s);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),ji(XA,ZA,n),ji(XA,ZA,"esm2017")}var gi=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ut.fromBase64String(e))}catch(t){throw new S(_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ut.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Bn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new S(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ni=class{constructor(e){this._methodName=e}};var Fs=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new S(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new S(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var mG=/^__.*__$/,_0=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Ln(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pr(e,this.data,t,this.fieldTransforms)}},rm=class{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Ln(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ER(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var sm=class n{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.contextWith({path:i,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return om(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(ER(this.dataSource)&&mG.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},b0=class{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Qc(e)}createContext(e,t,i,r=!1){return new sm({dataSource:e,methodName:t,targetDoc:i,path:Ke.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Us(n){let e=n._freezeSettings(),t=Qc(n._databaseId);return new b0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sm(n,e,t,i,r,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);Sw("Data must be an object, but it was:",o,i);let a=TR(i,o),l,c;if(s.merge)l=new sn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=T0(e,d,t);if(!o.contains(h))throw new S(_.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);IR(u,h)||u.push(h)}l=new sn(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new _0(new Rt(a),l,c)}var Vc=class n extends Ni{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function SR(n,e,t){return new sm({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var w0=class n extends Ni{_toFieldTransform(e){return new Rs(e.path,new Or)}isEqual(e){return e instanceof n}},E0=class extends Ni{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=SR(this,e,!0),i=this._elements.map(s=>zs(s,t)),r=new Mi(i);return new Rs(e.path,r)}isEqual(e){return this===e}},S0=class extends Ni{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=SR(this,e,!0),i=this._elements.map(s=>zs(s,t)),r=new Oi(i);return new Rs(e.path,r)}isEqual(e){return this===e}},C0=class extends Ni{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Nr(e.serializer,tk(e.serializer,this._operand));return new Rs(e.path,t)}isEqual(e){return this===e}};function ww(n,e,t,i){let r=n.createContext(1,e,t);Sw("Data must be an object, but it was:",r,i);let s=[],o=Rt.empty();qs(i,(l,c)=>{let u=Cw(e,l,t);c=Re(c);let d=r.childContextForFieldPath(u);if(c instanceof Vc)s.push(u);else{let h=zs(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new sn(s);return new rm(o,a,r.fieldTransforms)}function Ew(n,e,t,i,r,s){let o=n.createContext(1,e,t),a=[T0(e,i,t)],l=[r];if(s.length%2!==0)throw new S(_.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(T0(e,s[h])),l.push(s[h+1]);let c=[],u=Rt.empty();for(let h=a.length-1;h>=0;--h)if(!IR(c,a[h])){let m=a[h],y=l[h];y=Re(y);let v=o.childContextForFieldPath(m);if(y instanceof Vc)c.push(m);else{let b=zs(y,v);b!=null&&(c.push(m),u.set(m,b))}}let d=new sn(c);return new rm(u,d,o.fieldTransforms)}function CR(n,e,t,i=!1){let r=n.createContext(i?4:3,e);return zs(t,r)}function zs(n,e){if(n=Re(n),xR(n))return Sw("Unsupported field value:",e,n),TR(n,e);if(n instanceof Ni)return gG(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return pG(n,e)}else return yG(n,e)}function TR(n,e){let t={};return A1(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qs(n,(i,r)=>{let s=zs(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function pG(n,e){let t=[],i=0;for(let r of n){let s=zs(r,e.childContextForArray(i));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),i++}return{arrayValue:{values:t}}}function gG(n,e){if(!ER(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function yG(n,e){if(n=Re(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return tk(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ne.fromDate(n);return{timestampValue:ba(e.serializer,t)}}else if(n instanceof Ne){let t=new Ne(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:ba(e.serializer,t)}}else{if(n instanceof Fs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof gi)return{bytesValue:hk(e.serializer,n._byteString)};if(n instanceof Ee){let t=e.databaseId,i=n.firestore._databaseId;if(!i.isEqual(t))throw e.createError(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:W0(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Zc(n)}`)}}function xR(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ne)&&!(n instanceof Fs)&&!(n instanceof gi)&&!(n instanceof Ee)&&!(n instanceof Ni)}function Sw(n,e,t){if(!xR(t)||!O9(t)){let i=Zc(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function T0(n,e,t){if(e=Re(e),e instanceof Bn)return e._internalPath;if(typeof e=="string")return Cw(n,e);throw om("Field path arguments must be of type string or ",n,!1,void 0,t)}var vG=new RegExp("[~\\*/\\[\\]]");function Cw(n,e,t){if(e.search(vG)>=0)throw om(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Bn(...e.split("."))._internalPath}catch{throw om(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function om(n,e,t,i,r){let s=i&&!i.isEmpty(),o=r!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new S(_.INVALID_ARGUMENT,a+n+l)}function IR(n,e){return n.some(t=>t.isEqual(e))}var Ls=class{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new x0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Cm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},x0=class extends Ls{data(){return super.data()}};function Cm(n,e){return typeof e=="string"?Cw(n,e):e instanceof Bn?e._internalPath:e._delegate._internalPath}function AR(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new S(_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var qc=class{},Bs=class extends qc{};function Bi(n,e,...t){let i=[];e instanceof qc&&i.push(e),i=i.concat(t),xG(i);for(let r of i)n=r._apply(n);return n}var am=class n extends Bs{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=this._parse(e);return BR(e._query,t),new vt(e.firestore,e.converter,H0(e._query,t))}_parse(e){let t=Us(e.firestore);return _G(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function DR(n,e,t){let i=e,r=Cm("where",n);return am._create(r,i,t)}var I0=class n extends qc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:me.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(CG(e._query,t),new vt(e.firestore,e.converter,H0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var A0=class n extends Bs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=bG(e._query,this._field,this._direction);return new vt(e.firestore,e.converter,W4(e._query,t))}};function kR(n,e="asc"){let t=e,i=Cm("orderBy",n);return A0._create(i,t)}var lm=class n extends Bs{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){return new vt(e.firestore,e.converter,kf(e._query,this._limit,this._limitType))}};function RR(n){return eR("limit",n),lm._create("limit",n,"F")}function MR(n){return eR("limitToLast",n),lm._create("limitToLast",n,"L")}var cm=class n extends Bs{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=LR(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,K4(e._query,t))}};function OR(...n){return cm._create("startAt",n,!0)}function NR(...n){return cm._create("startAfter",n,!1)}var um=class n extends Bs{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new n(e,t,i)}_apply(e){let t=LR(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,Q4(e._query,t))}};function PR(...n){return um._create("endBefore",n,!1)}function FR(...n){return um._create("endAt",n,!0)}function LR(n,e,t,i){if(t[0]=Re(t[0]),t[0]instanceof Ls)return wG(n._query,n.firestore._databaseId,e,t[0]._document,i);{let r=Us(n.firestore);return EG(n._query,n.firestore._databaseId,r,e,t,i)}}function _G(n,e,t,i,r,s,o){let a;if(r.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new S(_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){a1(o,s);let c=[];for(let u of o)c.push(o1(i,n,u));a={arrayValue:{values:c}}}else a=o1(i,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&a1(o,s),a=CR(t,e,o,s==="in"||s==="not-in");return ee.create(r,s,a)}function bG(n,e,t){if(n.startAt!==null)throw new S(_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new S(_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ds(e,t)}function wG(n,e,t,i,r){if(!i)throw new S(_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of ya(n))if(o.field.isKeyField())s.push(As(e,i.key));else{let a=i.data.field(o.field);if(gm(a))throw new S(_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new S(_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new mi(s,r)}function EG(n,e,t,i,r,s){let o=n.explicitOrderBy;if(r.length>o.length)throw new S(_.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<r.length;l++){let c=r[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new S(_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!G0(n)&&c.indexOf("/")!==-1)throw new S(_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ce.fromString(c));if(!O.isDocumentKey(d))throw new S(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new O(d);a.push(As(e,h))}else{let d=CR(t,i,c);a.push(d)}}return new mi(a,s)}function o1(n,e,t){if(t=Re(t),typeof t=="string"){if(t==="")throw new S(_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!G0(e)&&t.indexOf("/")!==-1)throw new S(_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let i=e.path.child(ce.fromString(t));if(!O.isDocumentKey(i))throw new S(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return As(n,new O(i))}else{if(t instanceof Ee)return As(n,t._key);throw new S(_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zc(t)}.`)}}function a1(n,e){if(!Array.isArray(n)||n.length===0)throw new S(_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function SG(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function BR(n,e){let t=TG(n.filters,SG(e.op));if(t!==null)throw t===e.op?new S(_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new S(_.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function CG(n,e){let t=n,i=e.getFlattenedFilters();for(let r of i)BR(t,r),t=H0(t,r)}function TG(n,e){for(let t of n)for(let i of t.getFlattenedFilters())if(e.indexOf(i.op)>=0)return i.op;return null}function xG(n){let e=n.filter(i=>i instanceof I0).length,t=n.filter(i=>i instanceof am).length;if(e>1||e>0&&t>0)throw new S(_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Da=class{convertValue(e,t="none"){switch(Is(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let i={};return qs(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new Fs(Ue(e.latitude),Ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":let i=U0(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(vc(e));default:return null}}convertTimestamp(e){let t=Dr(e);return new Ne(t.seconds,t.nanos)}convertDocumentKey(e,t){let i=ce.fromString(e);q(Ek(i));let r=new Rr(i.get(1),i.get(3)),s=new O(i.popFirst(5));return r.isEqual(t)||Oe(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Tm(n,e,t){let i;return n?t&&(t.merge||t.mergeFields)?i=n.toFirestore(e,t):i=n.toFirestore(e):i=e,i}var D0=class extends Da{constructor(e){super(),this.firestore=e}convertBytes(e){return new gi(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}};function k0(n){return IG(n,["next","error","complete"])}function IG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Pi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},En=class extends Ls{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Br(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let i=this._document.data.field(Cm("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}},Br=class extends En{data(e={}){return super.data(e)}},Vn=class{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Pi(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Br(this._firestore,this._userDataWriter,i.key,i,new Pi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new S(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=AG(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function AG(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(i=>{let r=new Br(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Pi(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter);return i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(i=>e||i.type!==3).map(i=>{let r=new Br(n._firestore,n._userDataWriter,i.doc.key,i.doc,new Pi(n._snapshot.mutatedKeys.has(i.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return i.type!==0&&(s=t.indexOf(i.doc.key),t=t.delete(i.doc.key)),i.type!==1&&(t=t.add(i.doc),o=t.indexOf(i.doc.key)),{type:DG(i.type),doc:r,oldIndex:s,newIndex:o}})}}function DG(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function Tw(n,e){return n instanceof En&&e instanceof En?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Vn&&e instanceof Vn?n._firestore===e._firestore&&bw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function VR(n){n=ne(n,Ee);let e=ne(n.firestore,ke),t=nt(e);return rR(t,n._key).then(i=>Dw(e,n,i))}var Fi=class extends Da{constructor(e){super(),this.firestore=e}convertBytes(e){return new gi(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}};function qR(n){n=ne(n,Ee);let e=ne(n.firestore,ke),t=nt(e),i=new Fi(e);return $9(t,n._key).then(r=>new En(e,i,n._key,r,new Pi(r!==null&&r.hasLocalMutations,!0),n.converter))}function UR(n){n=ne(n,Ee);let e=ne(n.firestore,ke),t=nt(e);return rR(t,n._key,{source:"server"}).then(i=>Dw(e,n,i))}function zR(n){n=ne(n,vt);let e=ne(n.firestore,ke),t=nt(e),i=new Fi(e);return AR(n._query),sR(t,n._query).then(r=>new Vn(e,i,n,r))}function jR(n){n=ne(n,vt);let e=ne(n.firestore,ke),t=nt(e),i=new Fi(e);return W9(t,n._query).then(r=>new Vn(e,i,n,r))}function GR(n){n=ne(n,vt);let e=ne(n.firestore,ke),t=nt(e),i=new Fi(e);return sR(t,n._query,{source:"server"}).then(r=>new Vn(e,i,n,r))}function xw(n,e,t){n=ne(n,Ee);let i=ne(n.firestore,ke),r=Tm(n.converter,e,t),s=Us(i),a=Sm(s,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,qe.none());return Va(i,[a])}function Iw(n,e,t,...i){n=ne(n,Ee);let r=ne(n.firestore,ke),s=Us(r);e=Re(e);let o;typeof e=="string"||e instanceof Bn?o=Ew(s,"updateDoc",n._key,e,t,i):o=ww(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,qe.exists(!0));return Va(r,[a])}function HR(n){let e=ne(n.firestore,ke),t=[new Fr(n._key,qe.none())];return Va(e,t)}function $R(n,e){let t=ne(n.firestore,ke),i=Jc(n),r=Tm(n.converter,e),s=Us(n.firestore),a=Sm(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,qe.exists(!1));return Va(t,[a]).then(()=>i)}function Aw(n,...e){var t,i,r;n=Re(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]=="object"&&!k0(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(k0(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let l,c,u;if(n instanceof Ee)c=ne(n.firestore,ke),u=Na(n._key.path),l={next:h=>{e[o]&&e[o](Dw(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=ne(n,vt);c=ne(h.firestore,ke),u=h._query;let m=new Fi(c);l={next:y=>{e[o]&&e[o](new Vn(c,m,h,y))},error:e[o+1],complete:e[o+2]},AR(n._query)}let d=nt(c);return H9(d,u,a,l)}function WR(n,e){n=ne(n,ke);let t=nt(n),i=k0(e)?e:{next:e};return Q9(t,i)}function Va(n,e){let t=nt(n);return K9(t,e)}function Dw(n,e,t){let i=t.docs.get(e._key),r=new Fi(n);return new En(n,r,e._key,i,new Pi(t.hasPendingWrites,t.fromCache),e.converter)}var kG={maxAttempts:5};function RG(n){if(n.maxAttempts<1)throw new S(_.INVALID_ARGUMENT,"Max attempts must be at least 1")}var dm=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Us(e)}set(e,t,i){this._verifyNotCommitted();let r=Tr(e,this._firestore),s=Tm(r.converter,t,i),o=Sm(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,qe.none())),this}update(e,t,i,...r){this._verifyNotCommitted();let s=Tr(e,this._firestore);t=Re(t);let o;return typeof t=="string"||t instanceof Bn?o=Ew(this._dataReader,"WriteBatch.update",s._key,t,i,r):o=ww(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,qe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Tr(e,this._firestore);return this._mutations=this._mutations.concat(new Fr(t._key,qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new S(_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Tr(n,e){if(n=Re(n),n.firestore!==e)throw new S(_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var R0=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Us(e)}get(e){let t=Tr(e,this._firestore),i=new D0(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return L();let s=r[0];if(s.isFoundDocument())return new Ls(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new Ls(this._firestore,i,t._key,null,t.converter);throw L()})}set(e,t,i){let r=Tr(e,this._firestore),s=Tm(r.converter,t,i),o=Sm(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){let s=Tr(e,this._firestore);t=Re(t);let o;return typeof t=="string"||t instanceof Bn?o=Ew(this._dataReader,"Transaction.update",s._key,t,i,r):o=ww(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Tr(e,this._firestore);return this._transaction.delete(t._key),this}};var M0=class extends R0{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Tr(e,this._firestore),i=new Fi(this._firestore);return super.get(e).then(r=>new En(this._firestore,i,t._key,r._document,new Pi(!1,!1),t.converter))}};function KR(n,e,t){n=ne(n,ke);let i=Object.assign(Object.assign({},kG),t);RG(i);let r=nt(n);return Y9(r,s=>e(new M0(n,s)),i)}function QR(){return new Vc("deleteField")}function YR(){return new w0("serverTimestamp")}function XR(...n){return new E0("arrayUnion",n)}function ZR(...n){return new S0("arrayRemove",n)}function JR(n){return new C0("increment",n)}fG("node");var MG="@firebase/firestore-compat",OG="0.3.23";function Pw(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new S("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function eM(){if(typeof Uint8Array>"u")throw new S("unimplemented","Uint8Arrays are not available in this environment.")}function tM(){if(!D1())throw new S("unimplemented","Blobs are unavailable in Firestore in this environment.")}var xm=class n{constructor(e){this._delegate=e}static fromBase64String(e){return tM(),new n(gi.fromBase64String(e))}static fromUint8Array(e){return eM(),new n(gi.fromUint8Array(e))}toBase64(){return tM(),this._delegate.toBase64()}toUint8Array(){return eM(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function kw(n){return NG(n,["next","error","complete"])}function NG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var Rw=class{enableIndexedDbPersistence(e,t){return hR(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return fR(e._delegate)}clearIndexedDbPersistence(e){return pR(e._delegate)}},Im=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof Rr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&bn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){lR(this._delegate,e,t,i)}enableNetwork(){return yR(this._delegate)}disableNetwork(){return vR(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,mw("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return gR(this._delegate)}onSnapshotsInSync(e){return WR(this._delegate,e)}get app(){if(!this._appCompat)throw new S("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new za(this,vw(this._delegate,e))}catch(t){throw jt(t,"collection()","Firestore.collection()")}}doc(e){try{return new yi(this,Jc(this._delegate,e))}catch(t){throw jt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new $s(this,cR(this._delegate,e))}catch(t){throw jt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return KR(this._delegate,t=>e(new Am(this,t)))}batch(){return nt(this._delegate),new Dm(new dm(this._delegate,e=>Va(this._delegate,e)))}loadBundle(e){return _R(this._delegate,e)}namedQuery(e){return bR(this._delegate,e).then(t=>t?new $s(this,t):null)}},qa=class extends Da{constructor(e){super(),this.firestore=e}convertBytes(e){return new xm(new gi(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return yi.forKey(t,this.firestore,null)}};function PG(n){c1(n)}var Am=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new qa(e)}get(e){let t=js(e);return this._delegate.get(t).then(i=>new Gs(this._firestore,new En(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let r=js(e);return i?(Pw("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=js(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=js(e);return this._delegate.delete(t),this}},Dm=class{constructor(e){this._delegate=e}set(e,t,i){let r=js(e);return i?(Pw("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){let s=js(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){let t=js(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ua=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new Br(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Hs(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new n(e,new qa(e),t),r.set(t,s)),s}};Ua.INSTANCES=new WeakMap;var yi=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qa(e)}static forPath(e,t,i){if(e.length%2!==0)throw new S("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Ee(t._delegate,i,new O(e)))}static forKey(e,t,i){return new n(t,new Ee(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new za(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new za(this.firestore,vw(this._delegate,e))}catch(t){throw jt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Re(e),e instanceof Ee?_w(this._delegate,e):!1}set(e,t){t=Pw("DocumentReference.set",t);try{return t?xw(this._delegate,e,t):xw(this._delegate,e)}catch(i){throw jt(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Iw(this._delegate,e):Iw(this._delegate,e,t,...i)}catch(r){throw jt(r,"updateDoc()","DocumentReference.update()")}}delete(){return HR(this._delegate)}onSnapshot(...e){let t=nM(e),i=iM(e,r=>new Gs(this.firestore,new En(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Aw(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=qR(this._delegate):e?.source==="server"?t=UR(this._delegate):t=VR(this._delegate),t.then(i=>new Gs(this.firestore,new En(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ua.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function jt(n,e,t){return n.message=n.message.replace(e,t),n}function nM(n){for(let e of n)if(typeof e=="object"&&!kw(e))return e;return{}}function iM(n,e){var t,i;let r;return kw(n[0])?r=n[0]:kw(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}var Gs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new yi(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Tw(this._delegate,e._delegate)}},Hs=class extends Gs{data(e){let t=this._delegate.data(e);return this._delegate._converter||u1(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},$s=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new qa(e)}where(e,t,i){try{return new n(this.firestore,Bi(this._delegate,DR(e,t,i)))}catch(r){throw jt(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Bi(this._delegate,kR(e,t)))}catch(i){throw jt(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Bi(this._delegate,RR(e)))}catch(t){throw jt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Bi(this._delegate,MR(e)))}catch(t){throw jt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Bi(this._delegate,OR(...e)))}catch(t){throw jt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Bi(this._delegate,NR(...e)))}catch(t){throw jt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Bi(this._delegate,PR(...e)))}catch(t){throw jt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Bi(this._delegate,FR(...e)))}catch(t){throw jt(t,"endAt()","Query.endAt()")}}isEqual(e){return bw(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=jR(this._delegate):e?.source==="server"?t=GR(this._delegate):t=zR(this._delegate),t.then(i=>new eu(this.firestore,new Vn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=nM(e),i=iM(e,r=>new eu(this.firestore,new Vn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Aw(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ua.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Mw=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Hs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},eu=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new $s(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Hs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Mw(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new Hs(this._firestore,i))})}isEqual(e){return Tw(this._delegate,e._delegate)}},za=class n extends $s{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new yi(this.firestore,e):null}doc(e){try{return e===void 0?new yi(this.firestore,Jc(this._delegate)):new yi(this.firestore,Jc(this._delegate,e))}catch(t){throw jt(t,"doc()","CollectionReference.doc()")}}add(e){return $R(this._delegate,e).then(t=>new yi(this.firestore,t))}isEqual(e){return _w(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ua.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function js(n){return ne(n,Ee)}var Ow=class n{constructor(...e){this._delegate=new Bn(...e)}static documentId(){return new n(Ke.keyField().canonicalString())}isEqual(e){return e=Re(e),e instanceof Bn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Nw=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=YR();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=QR();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=XR(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=ZR(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=JR(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var FG={Firestore:Im,GeoPoint:Fs,Timestamp:Ne,Blob:xm,Transaction:Am,WriteBatch:Dm,DocumentReference:yi,DocumentSnapshot:Gs,Query:$s,QueryDocumentSnapshot:Hs,QuerySnapshot:eu,CollectionReference:za,FieldPath:Ow,FieldValue:Nw,setLogLevel:PG,CACHE_SIZE_UNLIMITED:uR};function LG(n,e){n.INTERNAL.registerComponent(new Xr("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},FG)))}function BG(n){LG(n,(e,t)=>new Im(e,t,new Rw)),n.registerVersion(MG,OG,"node")}BG(Ht);function VG(n,e=ou){return new qi(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function rM(n,e){return VG(n,e)}function qG(n,e){return rM(n,e).pipe(Ys(void 0),lu(),Le(t=>{let[i,r]=t;return r.exists?i?.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}}))}function Bw(n,e){return rM(n,e).pipe(Le(t=>({payload:t,type:"query"})))}var km=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:r,query:s}=cM(i,t);return new Mm(r,s,this.afs)}snapshotChanges(){return qG(this.ref,this.afs.schedulers.outsideAngular).pipe($t)}valueChanges(e={}){return this.snapshotChanges().pipe(Le(({payload:t})=>e.idField?qn(it({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Un(this.ref.get(e)).pipe($t)}};function Rm(n,e){return Bw(n,e).pipe(Ys(void 0),lu(),Le(t=>{let[i,r]=t,s=r.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=i?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function sM(n,e,t){return Rm(n,t).pipe(cu((i,r)=>UG(i,r.map(s=>s.payload),e),[]),eE(),Le(i=>i.map(r=>({type:r.type,payload:r}))))}function UG(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=zG(n,i))}),n}function Fw(n,e,t,...i){let r=n.slice();return r.splice(e,t,...i),r}function zG(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Fw(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Fw(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Fw(n,e.oldIndex,1);break}return n}function oM(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Mm=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Rm(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Le(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe(Ys(void 0),lu(),Ha(([i,r])=>r.length>0||!i),Le(([,i])=>i),$t)}auditTrail(e){return this.stateChanges(e).pipe(cu((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=oM(e);return sM(this.query,t,this.afs.schedulers.outsideAngular).pipe($t)}valueChanges(e={}){return Bw(this.query,this.afs.schedulers.outsideAngular).pipe(Le(t=>t.payload.docs.map(i=>e.idField?qn(it({},i.data()),{[e.idField]:i.id}):i.data())),$t)}get(e){return Un(this.query.get(e)).pipe($t)}add(e){return this.ref.add(e)}doc(e){return new km(this.ref.doc(e),this.afs)}},Lw=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Rm(this.query,this.afs.schedulers.outsideAngular).pipe($t):Rm(this.query,this.afs.schedulers.outsideAngular).pipe(Le(t=>t.filter(i=>e.indexOf(i.type)>-1)),Ha(t=>t.length>0),$t)}auditTrail(e){return this.stateChanges(e).pipe(cu((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=oM(e);return sM(this.query,t,this.afs.schedulers.outsideAngular).pipe($t)}valueChanges(e={}){return Bw(this.query,this.afs.schedulers.outsideAngular).pipe(Le(i=>i.payload.docs.map(r=>e.idField?it({[e.idField]:r.id},r.data()):r.data())),$t)}get(e){return Un(this.query.get(e)).pipe($t)}},aM=new _e("angularfire2.enableFirestorePersistence"),lM=new _e("angularfire2.firestore.persistenceSettings"),jG=new _e("angularfire2.firestore.settings"),GG=new _e("angularfire2.firestore.use-emulator");function cM(n,e=t=>t){return{query:e(n),ref:n}}var Vw=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,r,s,o,a,l,c,u,d,h,m,y,v,b,D,E){this.schedulers=l;let k=Ja(t,a,i),R=u;d&&vp(k,a,h,y,v,b,m,D),[this.firestore,this.persistenceEnabled$]=Lu(`${k.name}.firestore`,"AngularFirestore",k.name,()=>{let V=a.runOutsideAngular(()=>k.firestore());if(s&&V.settings(s),R&&V.useEmulator(...R),r&&!Su(o)){let $=()=>{try{return Un(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Z){return typeof console<"u"&&console.warn(Z),Ui(!1)}};return[V,a.runOutsideAngular($)]}else return[V,Ui(!1)]},[s,R,r])}collection(t,i){let r;typeof t=="string"?r=this.firestore.collection(t):r=t;let{ref:s,query:o}=cM(r,i),a=this.schedulers.ngZone.run(()=>s);return new Mm(a,o,this)}collectionGroup(t,i){let r=i||(o=>o),s=this.firestore.collectionGroup(t);return new Lw(r(s),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let r=this.schedulers.ngZone.run(()=>i);return new km(r,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(H(to),H(no,8),H(aM,8),H(jG,8),H(zi),H(ft),H(Nu),H(lM,8),H(GG,8),H(Bu,8),H(hp,8),H(fp,8),H(mp,8),H(pp,8),H(gp,8),H(yp,8),H(Jr,8))};static \u0275prov=je({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),uM=(()=>{class n{constructor(){Ht.registerVersion("angularfire",eo.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:aM,useValue:!0},{provide:lM,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=oe({type:n});static \u0275inj=se({providers:[Vw]})}return n})();var vi=(()=>{let e=class e{constructor(i,r){this.afAuth=i,this.firestore=r,this.messageCounter=1,this.user$=this.afAuth.authState}getMessages(...i){let r=i.map(s=>this.firestore.collection(`users/${s}/messages`).valueChanges());return au(r).pipe(Le(s=>s.reduce((o,a)=>o.concat(a),[])))}sendMessage(i,r,s){let o=`message${this.messageCounter++}`,l={sender:i,text:s,timestamp:new Date};return this.firestore.collection(`users/${r}/messages`).doc(o).set(l)}signIn(i,r){return this.afAuth.signInWithEmailAndPassword(i,r)}signOut(){return this.afAuth.signOut()}};e.\u0275fac=function(r){return new(r||e)(H(Bu),H(Vw))},e.\u0275prov=je({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var vM=(()=>{let e=class e{constructor(i,r){this._renderer=i,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(i,r){this._renderer.setProperty(this._elementRef.nativeElement,i,r)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}};e.\u0275fac=function(r){return new(r||e)(ue(Gm),ue(on))},e.\u0275dir=Et({type:e});let n=e;return n})(),$G=(()=>{let e=class e extends vM{};e.\u0275fac=(()=>{let i;return function(s){return(i||(i=sE(e)))(s||e)}})(),e.\u0275dir=Et({type:e,features:[Zs]});let n=e;return n})(),_M=new _e("NgValueAccessor");var WG={provide:_M,useExisting:jm(()=>Gr),multi:!0};function KG(){let n=$m()?$m().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var QG=new _e("CompositionEventMode"),Gr=(()=>{let e=class e extends vM{constructor(i,r,s){super(i,r),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!KG())}writeValue(i){let r=i??"";this.setProperty("value",r)}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}};e.\u0275fac=function(r){return new(r||e)(ue(Gm),ue(on),ue(QG,8))},e.\u0275dir=Et({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,s){r&1&&St("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[Yr([WG]),Zs]});let n=e;return n})();var YG=new _e("NgValidators"),XG=new _e("NgAsyncValidators");function bM(n){return n!=null}function wM(n){return cE(n)?Un(n):n}function EM(n){let e={};return n.forEach(t=>{e=t!=null?it(it({},e),t):e}),Object.keys(e).length===0?null:e}function SM(n,e){return e.map(t=>t(n))}function ZG(n){return!n.validate}function CM(n){return n.map(e=>ZG(e)?e:t=>e.validate(t))}function JG(n){if(!n)return null;let e=n.filter(bM);return e.length==0?null:function(t){return EM(SM(t,e))}}function TM(n){return n!=null?JG(CM(n)):null}function eH(n){if(!n)return null;let e=n.filter(bM);return e.length==0?null:function(t){let i=SM(t,e).map(wM);return Yw(i).pipe(Le(EM))}}function xM(n){return n!=null?eH(CM(n)):null}function dM(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function tH(n){return n._rawValidators}function nH(n){return n._rawAsyncValidators}function qw(n){return n?Array.isArray(n)?n:[n]:[]}function Pm(n,e){return Array.isArray(n)?n.includes(e):n===e}function hM(n,e){let t=qw(e);return qw(n).forEach(r=>{Pm(t,r)||t.push(r)}),t}function fM(n,e){return qw(e).filter(t=>!Pm(n,t))}var Fm=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=TM(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Uw=class extends Fm{get formDirective(){return null}get path(){return null}},iu=class extends Fm{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},zw=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},iH={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},dQ=qn(it({},iH),{"[class.ng-submitted]":"isSubmitted"}),Ga=(()=>{let e=class e extends zw{constructor(i){super(i)}};e.\u0275fac=function(r){return new(r||e)(ue(iu,2))},e.\u0275dir=Et({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,s){r&2&&Wr("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Zs]});let n=e;return n})();var tu="VALID",Nm="INVALID",ja="PENDING",nu="DISABLED";function rH(n){return(Lm(n)?n.validators:n)||null}function sH(n){return Array.isArray(n)?TM(n):n||null}function oH(n,e){return(Lm(e)?e.asyncValidators:n)||null}function aH(n){return Array.isArray(n)?xM(n):n||null}function Lm(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var jw=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===tu}get invalid(){return this.status===Nm}get pending(){return this.status==ja}get disabled(){return this.status===nu}get enabled(){return this.status!==nu}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(hM(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(hM(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(fM(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(fM(e,this._rawAsyncValidators))}hasValidator(e){return Pm(this._rawValidators,e)}hasAsyncValidator(e){return Pm(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ja,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=nu,this.errors=null,this._forEachChild(i=>{i.disable(qn(it({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(qn(it({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=tu,this._forEachChild(i=>{i.enable(qn(it({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(qn(it({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===tu||this.status===ja)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?nu:tu}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ja,this._hasOwnPendingAsyncValidator=!0;let t=wM(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Xs,this.statusChanges=new Xs}_calculateStatus(){return this._allControlsDisabled()?nu:this.errors?Nm:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ja)?ja:this._anyControlsHaveStatus(Nm)?Nm:tu}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Lm(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=sH(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=aH(this._rawAsyncValidators)}};var IM=new _e("CallSetDisabledState",{providedIn:"root",factory:()=>Gw}),Gw="always";function lH(n,e){return[...e.path,n]}function cH(n,e,t=Gw){dH(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),hH(n,e),mH(n,e),fH(n,e),uH(n,e)}function mM(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function uH(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function dH(n,e){let t=tH(n);e.validator!==null?n.setValidators(dM(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=nH(n);e.asyncValidator!==null?n.setAsyncValidators(dM(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();mM(e._rawValidators,r),mM(e._rawAsyncValidators,r)}function hH(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&AM(n,e)})}function fH(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&AM(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function AM(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function mH(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function pH(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function gH(n){return Object.getPrototypeOf(n.constructor)===$G}function yH(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===Gr?t=s:gH(s)?i=s:r=s}),r||i||t||null}function pM(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function gM(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var vH=class extends jw{constructor(e=null,t,i){super(rH(t),oH(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Lm(t)&&(t.nonNullable||t.initialValueIsDefault)&&(gM(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){pM(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){pM(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){gM(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var _H={provide:iu,useExisting:jm(()=>Ws)},yM=(()=>Promise.resolve())(),Ws=(()=>{let e=class e extends iu{constructor(i,r,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new vH,this._registered=!1,this.name="",this.update=new Xs,this._parent=i,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=yH(this,o)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){let r=i.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),pH(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){cH(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(i){yM.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){let r=i.isDisabled.currentValue,s=r!==0&&_u(r);yM.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?lH(i,this._parent):[i]}};e.\u0275fac=function(r){return new(r||e)(ue(Uw,9),ue(YG,10),ue(XG,10),ue(_M,10),ue(pu,8),ue(IM,8))},e.\u0275dir=Et({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Yr([_H]),Zs,du]});let n=e;return n})();var bH=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({});let n=e;return n})();var wH=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[bH]});let n=e;return n})();var DM=(()=>{let e=class e{static withConfig(i){return{ngModule:e,providers:[{provide:IM,useValue:i.callSetDisabledState??Gw}]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[wH]});let n=e;return n})();var EH=(n,e)=>({"message-right":n,"message-left":e});function SH(n,e){if(n&1&&(he(0,"div",13),pt(1),Ce()),n&2){let t=e.$implicit,i=Js();mt("ngClass",yu(2,EH,t.sender===i.user,t.sender!==i.user)),Pt(1),Qr(" ",t.text," ")}}var RM=(()=>{let e=class e{constructor(i){this.sharedService=i,this.user="userB",this.messages=[],this.newMessage=""}ngOnInit(){this.refreshMessages()}refreshMessages(){this.sharedService.getMessages("userA","userB").subscribe(i=>{this.messages=i.sort((r,s)=>r.timestamp-s.timestamp),this.chatPartner=this.getChatPartnerName()})}getChatPartnerName(){let i=Array.from(new Set(this.messages.map(s=>s.sender))),r=i.indexOf(this.user);return i[(r+1)%i.length]}sendMessage(i){this.newMessage.trim()!==""&&this.sharedService.sendMessage(this.user,i,this.newMessage.trim()).then(()=>{this.newMessage="",console.log(this.messages),this.refreshMessages()})}getUniqueSenders(){return Array.from(new Set(this.messages.map(i=>i.sender)))}};e.\u0275fac=function(r){return new(r||e)(ue(vi))},e.\u0275cmp=Nt({type:e,selectors:[["app-chat"]],decls:30,vars:3,consts:[[2,"background-image","url(https://images.unsplash.com/photo-1682686580036-b5e25932ce9a?q=80&w=1975&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDF8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)"],[1,"kkmsgbx"],[1,"kkmsgbx1"],[1,"text-center"],[1,"kkmsgbx2"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"kkmsgbx3"],[1,"input-group","mb-3"],["type","text","placeholder","Type your message..","aria-describedby","basic-addon1",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-prepend"],["id","basic-addon1",1,"btn","kkmsgbtn","input-group-text",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-send"],["d","M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"],[3,"ngClass"]],template:function(r,s){r&1&&(he(0,"div",0),Gt(1,"br")(2,"br")(3,"br")(4,"br")(5,"br")(6,"br"),he(7,"mat-card",1)(8,"mat-card-header",2)(9,"div",3)(10,"h2"),pt(11),Ce()()(),he(12,"mat-card-content",4),zn(13,SH,2,5,"div",5),Ce(),he(14,"mat-card-footer",6)(15,"div",7)(16,"input",8),St("ngModelChange",function(a){return s.newMessage=a}),Ce(),he(17,"div",9)(18,"button",10),St("click",function(){return s.sendMessage("userA")}),pt(19,"Sent A"),he(20,"span"),pt(21,"\xA0"),hu(),he(22,"svg",11),Gt(23,"path",12),Ce()()()()()()(),fu(),Gt(24,"br")(25,"br")(26,"br")(27,"br")(28,"br")(29,"br"),Ce()),r&2&&(Pt(11),Qr("",s.chatPartner," Chat"),Pt(2),mt("ngForOf",s.messages),Pt(3),mt("ngModel",s.newMessage))},dependencies:[bu,wu,Gr,Ga,Ws,Du,ku,Mu,Ru],styles:[".kkmsgbx[_ngcontent-%COMP%]{width:400px;height:550px;margin-left:200px}.kkmsgbx1[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-top-right-radius:20px;border-top-left-radius:20px}.kkmsgbx2[_ngcontent-%COMP%]{width:400px;max-height:400px;background-color:#f2f2f2;overflow-y:auto}.kkmsgbx3[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-bottom-right-radius:20px;border-bottom-left-radius:20px}.kkmsgbtn[_ngcontent-%COMP%]{border-radius:4px;background:#A426D1;display:inline-flex;color:#fff;text-align:center;font-family:League Spartan,sans-serif;font-size:23px;font-weight:500}.message-right[_ngcontent-%COMP%]{text-align:right;padding:10px;margin:5px;border-radius:10px;font-family:League Spartan,sans-serif;background-color:#ee7fff}.message-left[_ngcontent-%COMP%]{text-align:left;font-family:League Spartan,sans-serif;padding:10px;margin:5px;border-radius:10px;background-color:#fff}.message-container[_ngcontent-%COMP%]{padding:5px;margin:5px;clear:both;overflow:auto}.kkmsgbx2[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;background-color:transparent}"]});let n=e;return n})();var CH=(n,e)=>({"message-right":n,"message-left":e});function TH(n,e){if(n&1&&(he(0,"div",13),pt(1),Ce()),n&2){let t=e.$implicit,i=Js();mt("ngClass",yu(2,CH,t.sender===i.user,t.sender!==i.user)),Pt(1),Qr(" ",t.text," ")}}var MM=(()=>{let e=class e{constructor(i){this.sharedService=i,this.user="userA",this.messages=[],this.newMessage=""}ngOnInit(){this.refreshMessages()}refreshMessages(){this.sharedService.getMessages("userA","userB").subscribe(i=>{this.messages=i.sort((r,s)=>r.timestamp-s.timestamp),this.chatPartner=this.getChatPartnerName()})}getChatPartnerName(){let i=Array.from(new Set(this.messages.map(s=>s.sender))),r=i.indexOf(this.user);return i[(r+1)%i.length]}sendMessage(i){this.newMessage.trim()!==""&&this.sharedService.sendMessage(this.user,i,this.newMessage.trim()).then(()=>{this.newMessage="",console.log(this.messages),this.refreshMessages()})}getUniqueSenders(){return Array.from(new Set(this.messages.map(i=>i.sender)))}};e.\u0275fac=function(r){return new(r||e)(ue(vi))},e.\u0275cmp=Nt({type:e,selectors:[["app-chat2"]],decls:30,vars:3,consts:[[2,"background-image","url(https://images.unsplash.com/photo-1682686580036-b5e25932ce9a?q=80&w=1975&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDF8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)"],[1,"kkmsgbx"],[1,"kkmsgbx1"],[1,"text-center"],[1,"kkmsgbx2"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"kkmsgbx3"],[1,"input-group","mb-3"],["type","text","placeholder","Type your message..","aria-describedby","basic-addon1",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-prepend"],["id","basic-addon1",1,"btn","kkmsgbtn","input-group-text",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-send"],["d","M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"],[3,"ngClass"]],template:function(r,s){r&1&&(he(0,"div",0),Gt(1,"br")(2,"br")(3,"br")(4,"br")(5,"br")(6,"br"),he(7,"mat-card",1)(8,"mat-card-header",2)(9,"div",3)(10,"h2"),pt(11),Ce()()(),he(12,"mat-card-content",4),zn(13,TH,2,5,"div",5),Ce(),he(14,"mat-card-footer",6)(15,"div",7)(16,"input",8),St("ngModelChange",function(a){return s.newMessage=a}),Ce(),he(17,"div",9)(18,"button",10),St("click",function(){return s.sendMessage("userB")}),pt(19,"Sent B"),he(20,"span"),pt(21,"\xA0"),hu(),he(22,"svg",11),Gt(23,"path",12),Ce()()()()()()(),fu(),Gt(24,"br")(25,"br")(26,"br")(27,"br")(28,"br")(29,"br"),Ce()),r&2&&(Pt(11),Qr("",s.chatPartner," Chat"),Pt(2),mt("ngForOf",s.messages),Pt(3),mt("ngModel",s.newMessage))},dependencies:[bu,wu,Gr,Ga,Ws,Du,ku,Mu,Ru],styles:[".kkmsgbx[_ngcontent-%COMP%]{width:400px;height:550px;margin-left:200px}.kkmsgbx1[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-top-right-radius:20px;border-top-left-radius:20px}.kkmsgbx2[_ngcontent-%COMP%]{width:400px;max-height:400px;background-color:#f2f2f2;overflow-y:auto}.kkmsgbx3[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-bottom-right-radius:20px;border-bottom-left-radius:20px}.kkmsgbtn[_ngcontent-%COMP%]{border-radius:4px;background:#A426D1;display:inline-flex;color:#fff;text-align:center;font-family:League Spartan,sans-serif;font-size:23px;font-weight:500}.message-right[_ngcontent-%COMP%]{text-align:right;padding:10px;margin:5px;border-radius:10px;font-family:League Spartan,sans-serif;background-color:#ee7fff}.message-left[_ngcontent-%COMP%]{text-align:left;font-family:League Spartan,sans-serif;padding:10px;margin:5px;border-radius:10px;background-color:#fff}.message-container[_ngcontent-%COMP%]{padding:5px;margin:5px;clear:both;overflow:auto}.kkmsgbx2[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;background-color:transparent}"]});let n=e;return n})();function xH(n,e){n&1&&Gt(0,"div")}function IH(n,e){n&1&&(he(0,"h1"),pt(1,"Welcome UserA!"),Ce())}function AH(n,e){if(n&1&&zn(0,IH,2,0,"h1",3),n&2){let t=e.isUserA;mt("ngIf",t)}}function DH(n,e){n&1&&(he(0,"h1"),pt(1,"Welcome UserB!"),Ce())}function kH(n,e){if(n&1&&zn(0,DH,2,0,"h1",3),n&2){let t=e.isUserA;mt("ngIf",!t)}}var NM=(()=>{let e=class e{constructor(i,r){this.authService=i,this.router=r,this.isUserA=!1,this.authService.user$.subscribe(s=>{s&&(this.isUserA=s.email==="karthikeyan.u.s4s@gmail.com",this.isUserA?this.router.navigate(["/userA"]):this.router.navigate(["/userB"]))})}};e.\u0275fac=function(r){return new(r||e)(ue(vi),ue(Cu))},e.\u0275cmp=Nt({type:e,selectors:[["app-chat3"]],decls:5,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["userAContent",""],["userBContent",""],[4,"ngIf"]],template:function(r,s){if(r&1&&zn(0,xH,1,0,"div",0)(1,AH,1,1,"ng-template",null,1,vu)(3,kH,1,1,"ng-template",null,2,vu),r&2){let o=gu(2),a=gu(4);mt("ngIf",s.isUserA)("ngIfThen",o)("ngIfElse",a)}},dependencies:[uE],styles:[".kkmsgbx[_ngcontent-%COMP%]{width:400px;height:550px;margin-left:200px}.kkmsgbx1[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-top-right-radius:20px;border-top-left-radius:20px}.kkmsgbx2[_ngcontent-%COMP%]{width:400px;max-height:400px;background-color:#f2f2f2;overflow-y:auto}.kkmsgbx3[_ngcontent-%COMP%]{width:400px;height:75px;background-color:#fff;border-bottom-right-radius:20px;border-bottom-left-radius:20px}.kkmsgbtn[_ngcontent-%COMP%]{border-radius:4px;background:#A426D1;display:inline-flex;color:#fff;text-align:center;font-family:League Spartan,sans-serif;font-size:23px;font-weight:500}.message-right[_ngcontent-%COMP%]{text-align:right;padding:10px;margin:5px;border-radius:10px;font-family:League Spartan,sans-serif;background-color:#ee7fff}.message-left[_ngcontent-%COMP%]{text-align:left;font-family:League Spartan,sans-serif;padding:10px;margin:5px;border-radius:10px;background-color:#fff}.message-container[_ngcontent-%COMP%]{padding:5px;margin:5px;clear:both;overflow:auto}.kkmsgbx2[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;background-color:transparent}"]});let n=e;return n})();var RH=[{path:"userA",component:RM},{path:"userB",component:MM},{path:"chat",component:NM}],PM=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[Wm.forRoot(RH),Wm]});let n=e;return n})();var FM=(()=>{let e=class e{constructor(i,r){this.authService=i,this.router=r,this.email="",this.password=""}signIn(){this.authService.signIn(this.email,this.password).then(()=>{this.router.navigate(["/chat"])}).catch(i=>{console.error(i)})}};e.\u0275fac=function(r){return new(r||e)(ue(vi),ue(Cu))},e.\u0275cmp=Nt({type:e,selectors:[["app-example"]],decls:5,vars:2,consts:[[1,"authentication-container"],["placeholder","Email",3,"ngModel","ngModelChange"],["placeholder","Password",3,"ngModel","ngModelChange"],[3,"click"]],template:function(r,s){r&1&&(he(0,"div",0)(1,"input",1),St("ngModelChange",function(a){return s.email=a}),Ce(),he(2,"input",2),St("ngModelChange",function(a){return s.password=a}),Ce(),he(3,"button",3),St("click",function(){return s.signIn()}),pt(4,"Sign In"),Ce()()),r&2&&(Pt(1),mt("ngModel",s.email),Pt(1),mt("ngModel",s.password))},dependencies:[Gr,Ga,Ws],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap";*[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;margin:0;padding:0;box-sizing:border-box}body[_ngcontent-%COMP%]{background-image:url(https://i.ibb.co/xqpypMx/back.png);background-size:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-repeat:no-repeat;background-position:center;position:relative}.title[_ngcontent-%COMP%]{color:#fff;font-size:32px;font-weight:600;text-align:center;margin-bottom:15px;animation-name:_ngcontent-%COMP%_onloadAnim;animation-duration:1s}.formDiv[_ngcontent-%COMP%]{position:absolute;top:100px}.formDiv[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;width:100%;text-align:center;color:#ffa467;margin-top:8px;text-decoration:none;letter-spacing:1px;transition:.3s;animation-name:_ngcontent-%COMP%_onloadAnim;animation-duration:1s}.formDiv[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fff}.input-group[_ngcontent-%COMP%]{max-width:350px;width:100%;background:#f0f0f0;margin:10px 0;height:50px;border-radius:50px;display:grid;grid-template-columns:15% 85%;padding:0 .4rem;position:relative;animation-name:_ngcontent-%COMP%_onloadAnim;animation-duration:1s}.input-group[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{text-align:center;line-height:50px;color:#acacac;transition:.5s;font-size:15px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;outline:none;border:none;line-height:1;font-weight:500;font-size:14px;color:#333;transition:.3s}.btn[_ngcontent-%COMP%]{width:100%;height:45px;max-width:350px;background:#fff;border:2px solid #fff;border-radius:25px;color:#f26200;cursor:pointer;font-weight:500;transition:.3s;margin-top:10px;animation-name:_ngcontent-%COMP%_onloadAnim;animation-duration:1s}.btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;margin-left:4px}.btn[_ngcontent-%COMP%]:hover{background:none;color:#fff}@keyframes _ngcontent-%COMP%_onloadAnim{0%{transform:translateY(-88%)}to{transform:translateY(0)}}@media only screen and (max-width: 990px){body[_ngcontent-%COMP%]{background-size:130%}}@media only screen and (max-width: 740px){body[_ngcontent-%COMP%]{background-size:175%}}@media only screen and (max-width: 555px){body[_ngcontent-%COMP%]{background-size:245%}}@media only screen and (max-width: 420px){body[_ngcontent-%COMP%]{background-size:265%}}@media only screen and (max-width: 380px){body[_ngcontent-%COMP%]{background-size:320%}}']});let n=e;return n})();var Bm=(()=>{let e=class e{constructor(){this.title="officewrk"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=Nt({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(r,s){r&1&&Gt(0,"app-example")(1,"router-outlet")},dependencies:[pE,FM]});let n=e;return n})();var LM=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({});let n=e;return n})();var $w=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[_i,Eu,xE,_i]});let n=e;return n})();var BM=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=se({imports:[_i,$w,$w,LM,_i]});let n=e;return n})();var OH={apiKey:"AIzaSyCnQbgNXDJT6sy1_f8gx3d74kM-3FY2uCw",authDomain:"pubkin-6efd2.firebaseapp.com",projectId:"pubkin-6efd2",storageBucket:"pubkin-6efd2.appspot.com",messagingSenderId:"1019249625237",appId:"1:1019249625237:web:73473b4f492538851a739c"},VM=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e,bootstrap:[Bm]}),e.\u0275inj=se({providers:[vi,fE()],imports:[hE,PM,DM,sS.initializeApp(OH),uM,zE,BM]});let n=e;return n})();var NH=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oe({type:e,bootstrap:[Bm]}),e.\u0275inj=se({imports:[VM,mE]});let n=e;return n})();export{NH as a};
